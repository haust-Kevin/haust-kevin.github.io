



<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#FFF">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">


<link rel="alternate" type="application/rss+xml" title="æ²‰æ€å½•" href="https://haust-kevin.github.io/rss.xml" />
<link rel="alternate" type="application/atom+xml" title="æ²‰æ€å½•" href="https://haust-kevin.github.io/atom.xml" />
<link rel="alternate" type="application/json" title="æ²‰æ€å½•" href="https://haust-kevin.github.io/feed.json" />

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/artitalk"></script>

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=HarmonyOS%20Sans:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="/css/app.css?v=0.2.5">

  
  <meta name="keywords" content="å•ä¾‹æ¨¡å¼,å…¨å±€å¯¹è±¡,ææ„é¡ºåº,æœªå®šä¹‰è¡Œä¸º,æ„é€ ææ„é™·é˜±,C++ æŠ€å·§,åˆå§‹åŒ–æ´‹è‘±æ¨¡å‹,ä»£ç å®‰å…¨" />


<link rel="canonical" href="https://haust-kevin.github.io/2025/11/01/2025-11-01-global-destruct-trap/">



  <title>
å…¨å±€å¯¹è±¡ææ„é™·é˜±ï¼šä¸ºä»€ä¹ˆä¸èƒ½ä¾èµ–å…¶ä»–å…¨å±€æˆ–å•ä¾‹å¯¹è±¡ - C++ - æŠ€æœ¯åˆ†äº« |
Kevin's Blog = æ²‰æ€å½• = Talk is cheap. Show me the code.</title>
<meta name="generator" content="Hexo 6.3.0"></head>
<body itemscope itemtype="http://schema.org/WebPage">
  <div id="loading">
    <div class="cat">
      <div class="body"></div>
      <div class="head">
        <div class="face"></div>
      </div>
      <div class="foot">
        <div class="tummy-end"></div>
        <div class="bottom"></div>
        <div class="legs left"></div>
        <div class="legs right"></div>
      </div>
      <div class="paw">
        <div class="hands left"></div>
        <div class="hands right"></div>
      </div>
    </div>
  </div>
  <div id="container">
    <header id="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="inner">
        <div id="brand">
          <div class="pjax">
          
  <h1 itemprop="name headline">å…¨å±€å¯¹è±¡ææ„é™·é˜±ï¼šä¸ºä»€ä¹ˆä¸èƒ½ä¾èµ–å…¶ä»–å…¨å±€æˆ–å•ä¾‹å¯¹è±¡
  </h1>
  
<div class="meta">
  <span class="item" title="åˆ›å»ºæ—¶é—´ï¼š2025-11-01 16:32:58">
    <span class="icon">
      <i class="ic i-calendar"></i>
    </span>
    <span class="text">å‘è¡¨äº</span>
    <time itemprop="dateCreated datePublished" datetime="2025-11-01T16:32:58+08:00">2025-11-01</time>
  </span>
  <span class="item" title="æœ¬æ–‡å­—æ•°">
    <span class="icon">
      <i class="ic i-pen"></i>
    </span>
    <span class="text">æœ¬æ–‡å­—æ•°</span>
    <span>5.3k</span>
    <span class="text">å­—</span>
  </span>
  <span class="item" title="é˜…è¯»æ—¶é•¿">
    <span class="icon">
      <i class="ic i-clock"></i>
    </span>
    <span class="text">é˜…è¯»æ—¶é•¿</span>
    <span>5 åˆ†é’Ÿ</span>
  </span>
</div>


          </div>
        </div>
        <nav id="nav">
  <div class="inner">
    <div class="toggle">
      <div class="lines" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
        <span class="line"></span>
        <span class="line"></span>
        <span class="line"></span>
      </div>
    </div>
    <ul class="menu">
      <li class="item title"><a href="/" rel="start">Kevin's Blog</a></li>
    </ul>
    <ul class="right">
      <li class="item theme">
        <i class="ic i-sun"></i>
      </li>
      <li class="item search">
        <i class="ic i-search"></i>
      </li>
    </ul>
  </div>
</nav>

      </div>
      <div id="imgs" class="pjax">
        <ul>
          <li class="item" data-background-image="https://cdn.jsdelivr.net/gh/haust-Kevin/static@master/images/common/202308191646846.jpg"></li>
          <li class="item" data-background-image="https://cdn.jsdelivr.net/gh/haust-Kevin/static@master/images/common/202309022040028.jpg"></li>
          <li class="item" data-background-image="https://cdn.jsdelivr.net/gh/haust-Kevin/static@master/images/common/202308191646847.jpg"></li>
          <li class="item" data-background-image="https://cdn.jsdelivr.net/gh/haust-Kevin/static@master/images/common/202308191646849.jpg"></li>
          <li class="item" data-background-image="https://cdn.jsdelivr.net/gh/haust-Kevin/static@master/images/common/202309022040038.jpg"></li>
          <li class="item" data-background-image="https://cdn.jsdelivr.net/gh/haust-Kevin/static@master/images/common/202405112157423.jpg"></li>
        </ul>
      </div>
      
      <div id="waves">
        <svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
          <defs>
            <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" />
          </defs>
          <g class="parallax">
            <use xlink:href="#gentle-wave" x="48" y="0" />
            <use xlink:href="#gentle-wave" x="48" y="3" />
            <use xlink:href="#gentle-wave" x="48" y="5" />
            <use xlink:href="#gentle-wave" x="48" y="7" />
          </g>
        </svg>
      </div>
    </header>
    <main>
      <div class="inner">
        <div id="main" class="pjax">
          
  <div class="article wrap">
    
<div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList">
<i class="ic i-home"></i>
<span><a href="/">é¦–é¡µ</a></span><i class="ic i-angle-right"></i>
<span  itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/" itemprop="item" rel="index" title="åˆ†ç±»äº æŠ€æœ¯åˆ†äº«"><span itemprop="name">æŠ€æœ¯åˆ†äº«</span></a>
<meta itemprop="position" content="1" /></span>
<i class="ic i-angle-right"></i>
<span  class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/C/" itemprop="item" rel="index" title="åˆ†ç±»äº C++"><span itemprop="name">C++</span></a>
<meta itemprop="position" content="2" /></span>
</div>

    <article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN">
  <link itemprop="mainEntityOfPage" href="https://haust-kevin.github.io/2025/11/01/2025-11-01-global-destruct-trap/">

  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.jpg">
    <meta itemprop="name" content="å°é¥¼å¹²">
    <meta itemprop="description" content="Talk is cheap. Show me the code., æ€è€ƒæœªçŸ¥ï¼Œè¿½æ±‚å“è¶Š">
  </span>

  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="æ²‰æ€å½•">
  </span>

  <div class="body md" itemprop="articleBody">
    

    <div class="note primary">
<p>æœ¬ç« è®²è§£ C++ å…¨å±€å¯¹è±¡ææ„é—®é¢˜åŠå®‰å…¨å®è·µæ¡†æ¶ã€‚</p>
</div>
<h1 id="ä¸ºä»€ä¹ˆå…¨å±€å¯¹è±¡çš„ææ„å‡½æ•°é‡Œä¸èƒ½ä½¿ç”¨å…¶ä»–å…¨å±€å¯¹è±¡æˆ–å•ä¾‹å¯¹è±¡çš„æ–¹æ³•"><a class="anchor" href="#ä¸ºä»€ä¹ˆå…¨å±€å¯¹è±¡çš„ææ„å‡½æ•°é‡Œä¸èƒ½ä½¿ç”¨å…¶ä»–å…¨å±€å¯¹è±¡æˆ–å•ä¾‹å¯¹è±¡çš„æ–¹æ³•">#</a> ä¸ºä»€ä¹ˆå…¨å±€å¯¹è±¡çš„ææ„å‡½æ•°é‡Œä¸èƒ½ä½¿ç”¨å…¶ä»–å…¨å±€å¯¹è±¡æˆ–å•ä¾‹å¯¹è±¡çš„æ–¹æ³•</h1>
<h2 id="å¼•è¨€"><a class="anchor" href="#å¼•è¨€">#</a> å¼•è¨€</h2>
<p>åœ¨ C++ å¼€å‘ä¸­ï¼Œå…¨å±€å¯¹è±¡å’Œå•ä¾‹æ¨¡å¼æ˜¯å¸¸è§çš„æŠ€æœ¯é€‰æ‹©ï¼Œå®ƒä»¬ä¸ºæˆ‘ä»¬æä¾›äº†è·¨æ¨¡å—å…±äº«æ•°æ®å’ŒåŠŸèƒ½çš„ä¾¿åˆ©æ–¹å¼ã€‚ç„¶è€Œï¼Œå½“ç¨‹åºç»ˆæ­¢æ—¶ï¼Œè¿™äº›å…¨å±€å¯¹è±¡çš„é”€æ¯é¡ºåºå¯èƒ½ä¼šå¸¦æ¥æ„æƒ³ä¸åˆ°çš„é—®é¢˜ï¼Œç”šè‡³å¯¼è‡´ç¨‹åºå´©æºƒã€‚</p>
<p>æœ¬æ–‡å°†æ·±å…¥æ¢è®¨ä¸ºä»€ä¹ˆå…¨å±€å¯¹è±¡çš„ææ„å‡½æ•°ä¸­ä¸åº”è¯¥è°ƒç”¨å…¶ä»–å…¨å±€å¯¹è±¡æˆ–å•ä¾‹å¯¹è±¡çš„æ–¹æ³•ï¼Œé€šè¿‡å®é™…çš„ä»£ç æ¡ˆä¾‹å±•ç¤ºè¿™ä¸ªé—®é¢˜çš„æœ¬è´¨ï¼Œå¹¶æä¾›ä¸€äº›å®‰å…¨çš„ç¼–ç¨‹å®è·µå»ºè®®ã€‚</p>
<h2 id="é—®é¢˜çš„æœ¬è´¨é™æ€åˆå§‹åŒ–é¡ºåºç¾éš¾"><a class="anchor" href="#é—®é¢˜çš„æœ¬è´¨é™æ€åˆå§‹åŒ–é¡ºåºç¾éš¾">#</a> é—®é¢˜çš„æœ¬è´¨ï¼šé™æ€åˆå§‹åŒ–é¡ºåºç¾éš¾</h2>
<p>C++ ä¸­çš„å…¨å±€å¯¹è±¡ï¼ˆåŒ…æ‹¬å•ä¾‹ï¼‰é¢ä¸´ç€è‘—åçš„ &quot;é™æ€åˆå§‹åŒ–é¡ºåºç¾éš¾&quot;ï¼ˆStatic Initialization Order Fiascoï¼‰ã€‚è¿™ä¸ªé—®é¢˜çš„æ ¸å¿ƒåœ¨äºï¼š</p>
<ol>
<li><strong>åˆå§‹åŒ–é¡ºåºä¸ç¡®å®š</strong>ï¼šä¸åŒç¿»è¯‘å•å…ƒï¼ˆtranslation unitï¼‰ä¸­çš„å…¨å±€å¯¹è±¡åˆå§‹åŒ–é¡ºåºæ˜¯æœªå®šä¹‰çš„</li>
<li><strong>ææ„é¡ºåºä¸åˆå§‹åŒ–é¡ºåºç›¸å</strong>ï¼šå…¨å±€å¯¹è±¡çš„ææ„é¡ºåºæ˜¯åˆå§‹åŒ–é¡ºåºçš„é€†åº</li>
<li><strong>è·¨å¯¹è±¡ä¾èµ–å±é™©</strong>ï¼šå½“ä¸€ä¸ªå…¨å±€å¯¹è±¡çš„ææ„å‡½æ•°ä¾èµ–äºå¦ä¸€ä¸ªå…¨å±€å¯¹è±¡æ—¶ï¼Œå°±å¯èƒ½å‡ºç°é—®é¢˜</li>
</ol>
<h3 id="ææ„é¡ºåºè§„åˆ™"><a class="anchor" href="#ææ„é¡ºåºè§„åˆ™">#</a> ææ„é¡ºåºè§„åˆ™</h3>
<p>æ ¹æ® C++ æ ‡å‡†ï¼š</p>
<ul>
<li>åŒä¸€ç¿»è¯‘å•å…ƒå†…çš„å…¨å±€å¯¹è±¡æŒ‰ç…§å®šä¹‰é¡ºåºåˆå§‹åŒ–ï¼Œé€†åºææ„</li>
<li>ä¸åŒç¿»è¯‘å•å…ƒé—´çš„å…¨å±€å¯¹è±¡åˆå§‹åŒ–é¡ºåºæœªå®šä¹‰ï¼Œå› æ­¤ææ„é¡ºåºä¹Ÿæœªå®šä¹‰</li>
<li>å±€éƒ¨é™æ€å¯¹è±¡åœ¨é¦–æ¬¡ä½¿ç”¨æ—¶åˆå§‹åŒ–ï¼Œåœ¨ç¨‹åºç»“æŸæ—¶ææ„</li>
</ul>
<h2 id="å•æ–‡ä»¶æ¡ˆä¾‹åˆ†æ"><a class="anchor" href="#å•æ–‡ä»¶æ¡ˆä¾‹åˆ†æ">#</a> å•æ–‡ä»¶æ¡ˆä¾‹åˆ†æ</h2>
<p>è®©æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸ªç®€å•çš„å•æ–‡ä»¶ç¤ºä¾‹ï¼Œå±•ç¤ºå…¨å±€å¯¹è±¡ææ„æ—¶çš„æ½œåœ¨é—®é¢˜ï¼š</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">// å…¨å±€æ—¥å¿—ç®¡ç†å™¨å•ä¾‹</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">LogManager</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token function">LogManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="8"></td><td><pre>        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"LogManager æ„é€ å‡½æ•°"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    </pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">static</span> LogManager<span class="token operator">&amp;</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token keyword">static</span> LogManager instance<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token keyword">return</span> instance<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    </pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token keyword">void</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> message<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> tag <span class="token operator">&lt;&lt;</span> message <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    </pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token operator">~</span><span class="token function">LogManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"LogManager ææ„å‡½æ•°"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    std<span class="token double-colon punctuation">::</span>string tag <span class="token operator">=</span> <span class="token string">"LogManager"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token comment">// å…¨å±€æ•°æ®åº“ç®¡ç†å™¨</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">DatabaseManager</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token function">DatabaseManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"DatabaseManager æ„é€ å‡½æ•°"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>        <span class="token class-name">LogManager</span><span class="token double-colon punctuation">::</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"æ•°æ®åº“ç®¡ç†å™¨åˆå§‹åŒ–"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>    </pre></td></tr><tr><td data-num="36"></td><td><pre>    <span class="token operator">~</span><span class="token function">DatabaseManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>        <span class="token comment">// å±é™©ï¼šåœ¨ææ„å‡½æ•°ä¸­è°ƒç”¨å…¶ä»–å…¨å±€å¯¹è±¡çš„æ–¹æ³•</span></pre></td></tr><tr><td data-num="38"></td><td><pre>        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"DatabaseManager ææ„å‡½æ•°å¼€å§‹"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>        <span class="token class-name">LogManager</span><span class="token double-colon punctuation">::</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"æ•°æ®åº“ç®¡ç†å™¨é”€æ¯"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"DatabaseManager ææ„å‡½æ•°ç»“æŸ"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="43"></td><td><pre></pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token comment">// å…¨å±€å¯¹è±¡å®šä¹‰</span></pre></td></tr><tr><td data-num="45"></td><td><pre>DatabaseManager g_dbManager<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="46"></td><td><pre></pre></td></tr><tr><td data-num="47"></td><td><pre><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="48"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"=== ç¨‹åºå¼€å§‹ ==="</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="49"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"=== ç¨‹åºç»“æŸï¼Œå¼€å§‹é”€æ¯å…¨å±€å¯¹è±¡ ==="</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="50"></td><td><pre>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="51"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œè™½ç„¶ç¨‹åºèƒ½å¤Ÿæ­£å¸¸è¿è¡Œï¼Œä½†éšè—ç€ä¸€ä¸ªæ½œåœ¨çš„é—®é¢˜ï¼š <code>DatabaseManager</code>  çš„ææ„å‡½æ•°è°ƒç”¨äº† <code>LogManager</code>  çš„æ–¹æ³•ã€‚å¦‚æœ <code>LogManager</code>  åœ¨ <code>DatabaseManager</code>  ä¹‹å‰è¢«é”€æ¯ï¼Œé‚£ä¹ˆè¿™æ¬¡è°ƒç”¨å°±ä¼šå¯¼è‡´æœªå®šä¹‰è¡Œä¸ºã€‚</p>
<h2 id="å¤šæ–‡ä»¶æ¡ˆä¾‹åˆ†æ"><a class="anchor" href="#å¤šæ–‡ä»¶æ¡ˆä¾‹åˆ†æ">#</a> å¤šæ–‡ä»¶æ¡ˆä¾‹åˆ†æ</h2>
<p>å½“å…¨å±€å¯¹è±¡åˆ†å¸ƒåœ¨å¤šä¸ªæ–‡ä»¶ä¸­æ—¶ï¼Œé—®é¢˜å˜å¾—æ›´åŠ å¤æ‚å’Œå±é™©ï¼š</p>
<p><strong>log_manager.h</strong></p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">LOG_MANAGER_H</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LOG_MANAGER_H</span></span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string></span></span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">LogManager</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token function">LogManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    </pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">static</span> LogManager<span class="token operator">&amp;</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">void</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token operator">~</span><span class="token function">LogManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    </pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token function">LogManager</span><span class="token punctuation">(</span><span class="token keyword">const</span> LogManager<span class="token operator">&amp;</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">delete</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    LogManager<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">const</span> LogManager<span class="token operator">&amp;</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">delete</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    std<span class="token double-colon punctuation">::</span>string tag <span class="token operator">=</span> <span class="token string">"LogManager"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span></pre></td></tr></table></figure><p><strong>log_manager.cpp</strong></p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"log_manager.h"</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token class-name">LogManager</span><span class="token double-colon punctuation">::</span><span class="token function">LogManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> </pre></td></tr><tr><td data-num="5"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"LogManager æ„é€ å‡½æ•° (æ¥è‡ªlog_manager.cpp)"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>LogManager<span class="token operator">&amp;</span> <span class="token class-name">LogManager</span><span class="token double-colon punctuation">::</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">static</span> LogManager instance<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">return</span> instance<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">void</span> <span class="token class-name">LogManager</span><span class="token double-colon punctuation">::</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> message<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> tag <span class="token operator">&lt;&lt;</span> message <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token class-name">LogManager</span><span class="token double-colon punctuation">::</span><span class="token operator">~</span><span class="token function">LogManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"LogManager ææ„å‡½æ•° (æ¥è‡ªlog_manager.cpp)"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong>database_manager.cpp</strong></p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"database_manager.h"</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"log_manager.h"</span></span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream></span></span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token class-name">DatabaseManager</span><span class="token double-colon punctuation">::</span><span class="token function">DatabaseManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"DatabaseManager æ„é€ å‡½æ•° (æ¥è‡ªdatabase_manager.cpp)"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token class-name">LogManager</span><span class="token double-colon punctuation">::</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"æ•°æ®åº“ç®¡ç†å™¨åˆå§‹åŒ–"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token class-name">DatabaseManager</span><span class="token double-colon punctuation">::</span><span class="token operator">~</span><span class="token function">DatabaseManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"DatabaseManager ææ„å‡½æ•°å¼€å§‹ (æ¥è‡ªdatabase_manager.cpp)"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token class-name">LogManager</span><span class="token double-colon punctuation">::</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"æ•°æ®åº“ç®¡ç†å™¨é”€æ¯"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"DatabaseManager ææ„å‡½æ•°ç»“æŸ (æ¥è‡ªdatabase_manager.cpp)"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>åœ¨å¤šæ–‡ä»¶æƒ…å†µä¸‹ï¼Œé“¾æ¥é¡ºåºå¯èƒ½ä¼šå½±å“å…¨å±€å¯¹è±¡çš„åˆå§‹åŒ–é¡ºåºï¼Œä»è€Œæ”¹å˜ææ„é¡ºåºã€‚è¿™ä½¿å¾—é—®é¢˜æ›´åŠ éš¾ä»¥é¢„æµ‹å’Œè°ƒè¯•ã€‚</p>
<h2 id="ä¸ºä»€ä¹ˆæœ‰æ—¶è°ƒç”¨ä¸ä¼šå´©æºƒ"><a class="anchor" href="#ä¸ºä»€ä¹ˆæœ‰æ—¶è°ƒç”¨ä¸ä¼šå´©æºƒ">#</a> ä¸ºä»€ä¹ˆæœ‰æ—¶è°ƒç”¨ä¸ä¼šå´©æºƒï¼Ÿ</h2>
<p>æœ‰è¶£çš„æ˜¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå³ä½¿è°ƒç”¨äº†å·²ç»è¢«é”€æ¯çš„å¯¹è±¡æ–¹æ³•ï¼Œç¨‹åºä¹Ÿä¸ä¼šç«‹å³å´©æºƒã€‚è¿™ä¸»è¦æ˜¯å› ä¸ºï¼š</p>
<h3 id="éè™šå‡½æ•°è°ƒç”¨çš„ç‰¹æ®Šæ€§"><a class="anchor" href="#éè™šå‡½æ•°è°ƒç”¨çš„ç‰¹æ®Šæ€§">#</a> éè™šå‡½æ•°è°ƒç”¨çš„ç‰¹æ®Šæ€§</h3>
<p>å½“è°ƒç”¨éè™šå‡½æ•°ä¸”ä¸è®¿é—®æˆå‘˜å˜é‡æ—¶ï¼Œå³ä½¿å¯¹è±¡å·²ç»è¢«é”€æ¯ï¼Œè°ƒç”¨ä¹Ÿå¯èƒ½æˆåŠŸï¼š</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">SafeLogger</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">staticLog</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> message<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"[STATIC LOG] "</span> <span class="token operator">&lt;&lt;</span> message <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    </pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">void</span> <span class="token function">safeLog</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> message<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"[SAFE LOG] "</span> <span class="token operator">&lt;&lt;</span> message <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    </pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">unsafeLog</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> message<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"[UNSAFE LOG] "</span> <span class="token operator">&lt;&lt;</span> message <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    std<span class="token double-colon punctuation">::</span>string tag <span class="token operator">=</span> <span class="token string">"SafeLogger"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><strong>å®‰å…¨è°ƒç”¨çš„åŸå› </strong>ï¼š</p>
<ol>
<li><strong>é™æ€å‡½æ•°</strong>ï¼šä¸ä¾èµ–äºå¯¹è±¡å®ä¾‹ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨</li>
<li><strong>éè™šå‡½æ•°</strong>ï¼šä¸éœ€è¦é€šè¿‡è™šå‡½æ•°è¡¨è°ƒç”¨ï¼Œç¼–è¯‘æ—¶å·²ç»ç¡®å®šåœ°å€</li>
<li><strong>ä¸è®¿é—®æˆå‘˜å˜é‡</strong>ï¼šä¸éœ€è¦ä½¿ç”¨ <code>this</code>  æŒ‡é’ˆè®¿é—®å¯¹è±¡çŠ¶æ€</li>
</ol>
<p>å½“æ»¡è¶³è¿™ä¸‰ä¸ªæ¡ä»¶æ—¶ï¼Œå³ä½¿å¯¹è±¡å·²ç»è¢«é”€æ¯ï¼Œå‡½æ•°è°ƒç”¨ä»ç„¶å¯èƒ½æˆåŠŸï¼Œå› ä¸ºï¼š</p>
<ul>
<li>å‡½æ•°ä»£ç åœ¨ç¨‹åºå†…å­˜ç©ºé—´ä¸­ä»ç„¶å­˜åœ¨</li>
<li>è°ƒç”¨ä¸ä¾èµ–äºå¯¹è±¡çš„å®é™…çŠ¶æ€</li>
<li>ä¸éœ€è¦é€šè¿‡è™šå‡½æ•°è¡¨è¿›è¡ŒåŠ¨æ€åˆ†å‘</li>
</ul>
<h3 id="å±é™©çš„æƒ…å†µ"><a class="anchor" href="#å±é™©çš„æƒ…å†µ">#</a> å±é™©çš„æƒ…å†µ</h3>
<p>ç„¶è€Œï¼Œä¸€æ—¦æ¶‰åŠä»¥ä¸‹ä»»ä½•ä¸€ç§æƒ…å†µï¼Œç¨‹åºå°±å¯èƒ½å´©æºƒï¼š</p>
<ol>
<li><strong>è™šå‡½æ•°è°ƒç”¨</strong>ï¼šéœ€è¦é€šè¿‡è™šå‡½æ•°è¡¨ï¼Œè€Œè™šå‡½æ•°è¡¨å¯èƒ½å·²ç»è¢«é”€æ¯</li>
<li><strong>è®¿é—®æˆå‘˜å˜é‡</strong>ï¼šéœ€è¦ä½¿ç”¨ <code>this</code>  æŒ‡é’ˆï¼Œè€Œå¯¹è±¡å¯èƒ½å·²ç»è¢«é‡Šæ”¾</li>
<li><strong>ä½¿ç”¨å¯¹è±¡çš„å†…éƒ¨çŠ¶æ€</strong>ï¼šå¯¹è±¡çŠ¶æ€å¯èƒ½å·²ç»è¢«ç ´å</li>
</ol>
<h2 id="è§£å†³æ–¹æ¡ˆå’Œæœ€ä½³å®è·µ"><a class="anchor" href="#è§£å†³æ–¹æ¡ˆå’Œæœ€ä½³å®è·µ">#</a> è§£å†³æ–¹æ¡ˆå’Œæœ€ä½³å®è·µ</h2>
<h3 id="1-é¿å…åœ¨ææ„å‡½æ•°ä¸­è°ƒç”¨å…¶ä»–å…¨å±€å¯¹è±¡"><a class="anchor" href="#1-é¿å…åœ¨ææ„å‡½æ•°ä¸­è°ƒç”¨å…¶ä»–å…¨å±€å¯¹è±¡">#</a> 1. é¿å…åœ¨ææ„å‡½æ•°ä¸­è°ƒç”¨å…¶ä»–å…¨å±€å¯¹è±¡</h3>
<p>æœ€æ ¹æœ¬çš„è§£å†³æ–¹æ¡ˆæ˜¯é‡æ–°è®¾è®¡æ¶æ„ï¼Œé¿å…åœ¨ææ„å‡½æ•°ä¸­ä¾èµ–å…¶ä»–å…¨å±€å¯¹è±¡ï¼š</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">DatabaseManager</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token operator">~</span><span class="token function">DatabaseManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token comment">// å®‰å…¨ï¼šä¸è°ƒç”¨å…¶ä»–å…¨å±€å¯¹è±¡</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token function">cleanupResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token function">closeConnections</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id="2-ä½¿ç”¨ä¾èµ–æ³¨å…¥"><a class="anchor" href="#2-ä½¿ç”¨ä¾èµ–æ³¨å…¥">#</a> 2. ä½¿ç”¨ä¾èµ–æ³¨å…¥</h3>
<p>é€šè¿‡ä¾èµ–æ³¨å…¥å°†ä¾èµ–å…³ç³»æ˜ç¡®åŒ–ï¼š</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">DatabaseManager</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    std<span class="token double-colon punctuation">::</span>shared_ptr<span class="token operator">&lt;</span>Logger<span class="token operator">></span> logger<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    </pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token function">DatabaseManager</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>shared_ptr<span class="token operator">&lt;</span>Logger<span class="token operator">></span> log<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">logger</span><span class="token punctuation">(</span>log<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    </pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token operator">~</span><span class="token function">DatabaseManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>            logger<span class="token operator">-></span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"æ•°æ®åº“ç®¡ç†å™¨é”€æ¯"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id="3-ä½¿ç”¨é”€æ¯ç®¡ç†å™¨"><a class="anchor" href="#3-ä½¿ç”¨é”€æ¯ç®¡ç†å™¨">#</a> 3. ä½¿ç”¨é”€æ¯ç®¡ç†å™¨</h3>
<p>å®ç°ä¸€ä¸ªä¸“é—¨çš„é”€æ¯ç®¡ç†å™¨æ¥æ§åˆ¶é”€æ¯é¡ºåºï¼š</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">DestructionManager</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">static</span> DestructionManager<span class="token operator">&amp;</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">void</span> <span class="token function">registerDestructor</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>function<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span> destructor<span class="token punctuation">,</span> <span class="token keyword">int</span> phase<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">void</span> <span class="token function">destroyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h3 id="4-ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆå’Œraii"><a class="anchor" href="#4-ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆå’Œraii">#</a> 4. ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆå’Œ RAII</h3>
<p>åˆ©ç”¨æ™ºèƒ½æŒ‡é’ˆå’Œ RAII æœºåˆ¶ç®¡ç†èµ„æºç”Ÿå‘½å‘¨æœŸï¼š</p>
<figure class="highlight cpp"><figcaption data-lang="C++"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">DatabaseManager</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">private</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    std<span class="token double-colon punctuation">::</span>unique_ptr<span class="token operator">&lt;</span>Connection<span class="token operator">></span> connection<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    </pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">public</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token operator">~</span><span class="token function">DatabaseManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token comment">//connection ä¼šè‡ªåŠ¨é‡Šæ”¾ï¼Œä¸éœ€è¦æ‰‹åŠ¨å¤„ç†</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a class="anchor" href="#æ€»ç»“">#</a> æ€»ç»“</h2>
<p>å…¨å±€å¯¹è±¡ææ„å‡½æ•°ä¸­è°ƒç”¨å…¶ä»–å…¨å±€å¯¹è±¡æ–¹æ³•çš„é—®é¢˜æ˜¯ä¸€ä¸ªå¤æ‚ä½†é‡è¦çš„ä¸»é¢˜ã€‚ç†è§£è¿™ä¸ªé—®é¢˜çš„æœ¬è´¨æœ‰åŠ©äºæˆ‘ä»¬ï¼š</p>
<ol>
<li><strong>é¿å…æ½œåœ¨çš„ç¨‹åºå´©æºƒ</strong>ï¼šè®¤è¯†åˆ°è¿™ä¸ªé—®é¢˜çš„å­˜åœ¨ï¼Œåœ¨è®¾è®¡å’Œç¼–ç æ—¶é¿å…å±é™©çš„ä¾èµ–å…³ç³»</li>
<li><strong>æé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§</strong>ï¼šé€šè¿‡åˆç†çš„æ¶æ„è®¾è®¡å‡å°‘å¯¹è±¡é—´çš„è€¦åˆ</li>
<li><strong>å¢å¼ºç¨‹åºçš„å¥å£®æ€§</strong>ï¼šä½¿ç”¨æ›´å®‰å…¨çš„è®¾è®¡æ¨¡å¼å’Œç¼–ç¨‹å®è·µ</li>
</ol>
<p>è™½ç„¶ C<ins> æä¾›äº†å¼ºå¤§çš„åŠŸèƒ½ï¼Œä½†ä¹Ÿè¦æ±‚å¼€å‘è€…å¯¹å¯¹è±¡ç”Ÿå‘½å‘¨æœŸæœ‰æ·±å…¥çš„ç†è§£ã€‚é€šè¿‡éµå¾ªæœ€ä½³å®è·µï¼Œæˆ‘ä»¬å¯ä»¥æ„å»ºæ›´åŠ å¥å£®å’Œå¯é çš„ C</ins> åº”ç”¨ç¨‹åºã€‚</p>
<p>ğŸ¯ è®°ä½ï¼š<strong>åœ¨å…¨å±€å¯¹è±¡çš„ææ„å‡½æ•°ä¸­è°ƒç”¨å…¶ä»–å…¨å±€å¯¹è±¡çš„æ–¹æ³•ï¼Œå°±åƒæ˜¯åœ¨æ‹†é™¤å»ºç­‘ç‰©æ—¶è¿˜åœ¨ä½¿ç”¨ç”µæ¢¯ä¸€æ ·å±é™©ã€‚</strong></p>
<h2 id="å‚è€ƒèµ„æ–™"><a class="anchor" href="#å‚è€ƒèµ„æ–™">#</a> å‚è€ƒèµ„æ–™</h2>
<ul>
<li><span class="exturl" data-url="aHR0cHM6Ly9lbi5jcHByZWZlcmVuY2UuY29tL3cvY3BwL2xhbmd1YWdlL3Npb2YuaHRtbA==">Static Initialization Order Fiasco - cppreference.com</span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly93d3cuZnJlZWNvZGVjYW1wLm9yZy9uZXdzL2NwcC1zdGF0aWMtaW5pdGlhbGl6YXRpb24tb3JkZXItZmlhc2NvLw==">What is the Static Initialization Order Fiasco in C++? - freeCodeCamp</span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9qYWNvYmZpbGlwcC5jb20vRHJEb2Jicy9hcnRpY2xlcy9DVUovMTk5OS85OTEwL2dhYnJpbG92L2dhYnJpbG92Lmh0bQ==">Controlling the Destruction Order of Singleton Objects - Dr. Dobbs</span></li>
<li><span class="exturl" data-url="aHR0cHM6Ly9zb3VyY2VtYWtpbmcuY29tL2Rlc2lnbl9wYXR0ZXJucy90b19raWxsX2Ffc2luZ2xldG9u">To Kill A Singleton - SourceMaking</span></li>
</ul>
<hr />
<p><em>å»ºè®®è¯»è€…åœ¨è‡ªå·±çš„ç¯å¢ƒä¸­å°è¯•è¿™äº›ä¾‹å­ï¼Œæ·±å…¥ç†è§£å…¨å±€å¯¹è±¡ææ„çš„å¤æ‚æ€§ã€‚ä¸åŒç¼–è¯‘å™¨ä¸‹æœªå®šä¹‰è¡Œä¸ºå¤„ç†å¯èƒ½ä¸ä¸€è‡´ã€‚</em></p>

      <div class="tags">
          <a href="/tags/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F/" rel="tag"><i class="ic i-tag"></i> å•ä¾‹æ¨¡å¼</a>
          <a href="/tags/%E5%85%A8%E5%B1%80%E5%AF%B9%E8%B1%A1/" rel="tag"><i class="ic i-tag"></i> å…¨å±€å¯¹è±¡</a>
          <a href="/tags/%E6%9E%90%E6%9E%84%E9%A1%BA%E5%BA%8F/" rel="tag"><i class="ic i-tag"></i> ææ„é¡ºåº</a>
          <a href="/tags/%E6%9C%AA%E5%AE%9A%E4%B9%89%E8%A1%8C%E4%B8%BA/" rel="tag"><i class="ic i-tag"></i> æœªå®šä¹‰è¡Œä¸º</a>
          <a href="/tags/%E6%9E%84%E9%80%A0%E6%9E%90%E6%9E%84%E9%99%B7%E9%98%B1/" rel="tag"><i class="ic i-tag"></i> æ„é€ ææ„é™·é˜±</a>
          <a href="/tags/C-%E6%8A%80%E5%B7%A7/" rel="tag"><i class="ic i-tag"></i> C++ æŠ€å·§</a>
          <a href="/tags/%E5%88%9D%E5%A7%8B%E5%8C%96%E6%B4%8B%E8%91%B1%E6%A8%A1%E5%9E%8B/" rel="tag"><i class="ic i-tag"></i> åˆå§‹åŒ–æ´‹è‘±æ¨¡å‹</a>
          <a href="/tags/%E4%BB%A3%E7%A0%81%E5%AE%89%E5%85%A8/" rel="tag"><i class="ic i-tag"></i> ä»£ç å®‰å…¨</a>
      </div>
  </div>

   <footer>

    <div class="meta">
  <span class="item">
    <span class="icon">
      <i class="ic i-calendar-check"></i>
    </span>
    <span class="text">æ›´æ–°äº</span>
    <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-11-01 17:06:46" itemprop="dateModified" datetime="2025-11-01T17:06:46+08:00">2025-11-01</time>
  </span>
  <span id="2025/11/01/2025-11-01-global-destruct-trap/" class="item leancloud_visitors" data-flag-title="å…¨å±€å¯¹è±¡ææ„é™·é˜±ï¼šä¸ºä»€ä¹ˆä¸èƒ½ä¾èµ–å…¶ä»–å…¨å±€æˆ–å•ä¾‹å¯¹è±¡" title="é˜…è¯»æ¬¡æ•°">
      <span class="icon">
        <i class="ic i-eye"></i>
      </span>
      <span class="text">é˜…è¯»æ¬¡æ•°</span>
      <span class="leancloud-visitors-count"></span>
      <span class="text">æ¬¡</span>
  </span>
</div>

      

      

<div id="copyright">
<ul>
  <li class="author">
    <strong>æœ¬æ–‡ä½œè€…ï¼š </strong>å°é¥¼å¹² <i class="ic i-at"><em>@</em></i>æ²‰æ€å½•
  </li>
  <li class="link">
    <strong>æœ¬æ–‡é“¾æ¥ï¼š</strong>
    <a href="https://haust-kevin.github.io/2025/11/01/2025-11-01-global-destruct-trap/" title="å…¨å±€å¯¹è±¡ææ„é™·é˜±ï¼šä¸ºä»€ä¹ˆä¸èƒ½ä¾èµ–å…¶ä»–å…¨å±€æˆ–å•ä¾‹å¯¹è±¡">https://haust-kevin.github.io/2025/11/01/2025-11-01-global-destruct-trap/</a>
  </li>
  <li class="license">
    <strong>ç‰ˆæƒå£°æ˜ï¼š </strong>æœ¬ç«™æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼
  </li>
</ul>
</div>

  </footer>

</article>

  </div>
  

<div class="post-nav">
    <div class="item left">
      

  <a href="/2025/03/18/2025-04-threadpool-by-cpp-02-blockingqueue-md/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;gh&#x2F;haust-Kevin&#x2F;static@master&#x2F;images&#x2F;common&#x2F;202309022040040.jpg" title="C++ ThreadPoolï¼š02. BlockingQueue çš„å®ç°">
  <span class="type">ä¸Šä¸€ç¯‡</span>
  <span class="category"><i class="ic i-flag"></i> C++</span>
  <h3>C++ ThreadPoolï¼š02. BlockingQueue çš„å®ç°</h3>
  </a>

    </div>
    <div class="item right">
      

  <a href="/2025/11/02/2025-11-02-design-patterns-in-cpp/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;cdn.jsdelivr.net&#x2F;gh&#x2F;haust-Kevin&#x2F;static@master&#x2F;images&#x2F;common&#x2F;202309022040028.jpg" title="23ç§è®¾è®¡æ¨¡å¼å®Œæ•´æŒ‡å— - C++å®ç°è¯¦è§£">
  <span class="type">ä¸‹ä¸€ç¯‡</span>
  <span class="category"><i class="ic i-flag"></i> C++</span>
  <h3>23ç§è®¾è®¡æ¨¡å¼å®Œæ•´æŒ‡å— - C++å®ç°è¯¦è§£</h3>
  </a>

    </div>
</div>

  
  <div class="wrap" id="comments"></div>


        </div>
        <div id="sidebar">
          

<div class="inner">

  <div class="panels">
    <div class="inner">
      <div class="contents panel pjax" data-title="æ–‡ç« ç›®å½•">
          <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E5%85%A8%E5%B1%80%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%9E%90%E6%9E%84%E5%87%BD%E6%95%B0%E9%87%8C%E4%B8%8D%E8%83%BD%E4%BD%BF%E7%94%A8%E5%85%B6%E4%BB%96%E5%85%A8%E5%B1%80%E5%AF%B9%E8%B1%A1%E6%88%96%E5%8D%95%E4%BE%8B%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-number">1.</span> <span class="toc-text"> ä¸ºä»€ä¹ˆå…¨å±€å¯¹è±¡çš„ææ„å‡½æ•°é‡Œä¸èƒ½ä½¿ç”¨å…¶ä»–å…¨å±€å¯¹è±¡æˆ–å•ä¾‹å¯¹è±¡çš„æ–¹æ³•</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%95%E8%A8%80"><span class="toc-number">1.1.</span> <span class="toc-text"> å¼•è¨€</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E7%9A%84%E6%9C%AC%E8%B4%A8%E9%9D%99%E6%80%81%E5%88%9D%E5%A7%8B%E5%8C%96%E9%A1%BA%E5%BA%8F%E7%81%BE%E9%9A%BE"><span class="toc-number">1.2.</span> <span class="toc-text"> é—®é¢˜çš„æœ¬è´¨ï¼šé™æ€åˆå§‹åŒ–é¡ºåºç¾éš¾</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%90%E6%9E%84%E9%A1%BA%E5%BA%8F%E8%A7%84%E5%88%99"><span class="toc-number">1.2.1.</span> <span class="toc-text"> ææ„é¡ºåºè§„åˆ™</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%95%E6%96%87%E4%BB%B6%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90"><span class="toc-number">1.3.</span> <span class="toc-text"> å•æ–‡ä»¶æ¡ˆä¾‹åˆ†æ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E6%96%87%E4%BB%B6%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90"><span class="toc-number">1.4.</span> <span class="toc-text"> å¤šæ–‡ä»¶æ¡ˆä¾‹åˆ†æ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E6%9C%89%E6%97%B6%E8%B0%83%E7%94%A8%E4%B8%8D%E4%BC%9A%E5%B4%A9%E6%BA%83"><span class="toc-number">1.5.</span> <span class="toc-text"> ä¸ºä»€ä¹ˆæœ‰æ—¶è°ƒç”¨ä¸ä¼šå´©æºƒï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%9E%E8%99%9A%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E7%9A%84%E7%89%B9%E6%AE%8A%E6%80%A7"><span class="toc-number">1.5.1.</span> <span class="toc-text"> éè™šå‡½æ•°è°ƒç”¨çš„ç‰¹æ®Šæ€§</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%B1%E9%99%A9%E7%9A%84%E6%83%85%E5%86%B5"><span class="toc-number">1.5.2.</span> <span class="toc-text"> å±é™©çš„æƒ…å†µ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E5%92%8C%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="toc-number">1.6.</span> <span class="toc-text"> è§£å†³æ–¹æ¡ˆå’Œæœ€ä½³å®è·µ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E9%81%BF%E5%85%8D%E5%9C%A8%E6%9E%90%E6%9E%84%E5%87%BD%E6%95%B0%E4%B8%AD%E8%B0%83%E7%94%A8%E5%85%B6%E4%BB%96%E5%85%A8%E5%B1%80%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.6.1.</span> <span class="toc-text"> 1. é¿å…åœ¨ææ„å‡½æ•°ä¸­è°ƒç”¨å…¶ä»–å…¨å±€å¯¹è±¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E4%BD%BF%E7%94%A8%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5"><span class="toc-number">1.6.2.</span> <span class="toc-text"> 2. ä½¿ç”¨ä¾èµ–æ³¨å…¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E4%BD%BF%E7%94%A8%E9%94%80%E6%AF%81%E7%AE%A1%E7%90%86%E5%99%A8"><span class="toc-number">1.6.3.</span> <span class="toc-text"> 3. ä½¿ç”¨é”€æ¯ç®¡ç†å™¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E4%BD%BF%E7%94%A8%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88%E5%92%8Craii"><span class="toc-number">1.6.4.</span> <span class="toc-text"> 4. ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆå’Œ RAII</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">1.7.</span> <span class="toc-text"> æ€»ç»“</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-number">1.8.</span> <span class="toc-text"> å‚è€ƒèµ„æ–™</span></a></li></ol></li></ol>
      </div>
      <div class="related panel pjax" data-title="ç³»åˆ—æ–‡ç« ">
        <ul>
          <li><a href="/2025/01/26/2025-01-singleton-in-so/" rel="bookmark" title="å•ä¾‹æ¨¡å¼çš„é™·é˜±">å•ä¾‹æ¨¡å¼çš„é™·é˜±</a></li><li><a href="/2025/03/16/2025-03-understanding-of-shared-from-this/" rel="bookmark" title="C++ï¼šæ·±å…¥ç†è§£ std::enable_shared_from_this ä¸ shared_from_this">C++ï¼šæ·±å…¥ç†è§£ std::enable_shared_from_this ä¸ shared_from_this</a></li><li><a href="/2025/03/17/2025-04-threadpool-by-cpp-01-fwk/" rel="bookmark" title="C++ ThreadPoolï¼š01. Java ThreadPoolExecutor çš„ C++ å®ç°">C++ ThreadPoolï¼š01. Java ThreadPoolExecutor çš„ C++ å®ç°</a></li><li><a href="/2025/03/18/2025-04-threadpool-by-cpp-02-blockingqueue-md/" rel="bookmark" title="C++ ThreadPoolï¼š02. BlockingQueue çš„å®ç°">C++ ThreadPoolï¼š02. BlockingQueue çš„å®ç°</a></li><li class="active"><a href="/2025/11/01/2025-11-01-global-destruct-trap/" rel="bookmark" title="å…¨å±€å¯¹è±¡ææ„é™·é˜±ï¼šä¸ºä»€ä¹ˆä¸èƒ½ä¾èµ–å…¶ä»–å…¨å±€æˆ–å•ä¾‹å¯¹è±¡">å…¨å±€å¯¹è±¡ææ„é™·é˜±ï¼šä¸ºä»€ä¹ˆä¸èƒ½ä¾èµ–å…¶ä»–å…¨å±€æˆ–å•ä¾‹å¯¹è±¡</a></li><li><a href="/2025/11/02/2025-11-02-design-patterns-in-cpp/" rel="bookmark" title="23ç§è®¾è®¡æ¨¡å¼å®Œæ•´æŒ‡å— - C++å®ç°è¯¦è§£">23ç§è®¾è®¡æ¨¡å¼å®Œæ•´æŒ‡å— - C++å®ç°è¯¦è§£</a></li>
        </ul>
      </div>
      <div class="overview panel" data-title="ç«™ç‚¹æ¦‚è§ˆ">
        <div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="image" itemprop="image" alt="å°é¥¼å¹²"
      data-src="/images/avatar.jpg">
  <p class="name" itemprop="name">å°é¥¼å¹²</p>
  <div class="description" itemprop="description">æ€è€ƒæœªçŸ¥ï¼Œè¿½æ±‚å“è¶Š</div>
</div>

<nav class="state">
    <div class="item posts">
      <a href="/archives/">
        <span class="count">23</span>
        <span class="name">æ–‡ç« </span>
      </a>
    </div>
    <div class="item categories">
      <a href="/categories/">
        <span class="count">18</span>
        <span class="name">åˆ†ç±»</span>
      </a>
    </div>
    <div class="item tags">
      <a href="/tags/">
        <span class="count">55</span>
        <span class="name">æ ‡ç­¾</span>
      </a>
    </div>
</nav>

<div class="social">
      <span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL2hhdXN0LUtldmlu" title="https:&#x2F;&#x2F;github.com&#x2F;haust-Kevin"><i class="ic i-github"></i></span>
      <span class="exturl item zhihu" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3Blb3BsZS93YW5nLWRpbmctYmFuZy05Ng==" title="https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;wang-ding-bang-96"><i class="ic i-zhihu"></i></span>
      <a href="/about/about-me" title="&#x2F;about&#x2F;about-me" class="item about"><i class="ic i-address-card"></i></a>
      <span class="exturl item email" data-url="bWFpbHRvOjMzNjQ5MTc5OTBAcXEuY29t" title="mailto:3364917990@qq.com"><i class="ic i-envelope"></i></span>
      <span class="exturl item bilibili" data-url="aHR0cHM6Ly9zcGFjZS5iaWxpYmlsaS5jb20vNDgxNzgwMTcw" title="https:&#x2F;&#x2F;space.bilibili.com&#x2F;481780170"><i class="ic i-bilibili"></i></span>
      <span class="exturl item qq" data-url="aHR0cDovL3dwYS5xcS5jb20vbXNncmQ/dj0zJnVpbj0zMzY0OTE3OTkwJnNpdGU9cXEmbWVudT15ZXM=" title="http:&#x2F;&#x2F;wpa.qq.com&#x2F;msgrd?v&#x3D;3&amp;uin&#x3D;3364917990&amp;site&#x3D;qq&amp;menu&#x3D;yes"><i class="ic i-qq"></i></span>
</div>

<ul class="menu">
  
    
  <li class="item">
    <a href="/" rel="section"><i class="ic i-home"></i>é¦–é¡µ</a>
  </li>

        
  <li class="item dropdown">
      <a href="javascript:void(0);"><i class="ic i-feather"></i>æ–‡ç« </a>
    <ul class="submenu">

        
  <li class="item">
    <a href="/archives/" rel="section"><i class="ic i-list-alt"></i>å½’æ¡£</a>
  </li>

        
  <li class="item">
    <a href="/categories/" rel="section"><i class="ic i-th"></i>åˆ†ç±»</a>
  </li>

        
  <li class="item">
    <a href="/tags/" rel="section"><i class="ic i-tags"></i>æ ‡ç­¾</a>
  </li>

  </ul>
        
  <li class="item dropdown">
      <a href="/links/friends/" rel="section"><i class="ic i-link"></i>é“¾æ¥</a>
    <ul class="submenu">

        
  <li class="item">
    <a href="/links/friends/" rel="section"><i class="ic i-heart"></i>å‹é“¾</a>
  </li>

        
  <li class="item">
    <a href="/links/recommend/" rel="section"><i class="ic i-magic"></i>æ¨è</a>
  </li>

  </ul>
        
  <li class="item dropdown">
      <a href="javascript:void(0);"><i class="ic i-user"></i>å…³äº</a>
    <ul class="submenu">

        
  <li class="item">
    <a href="/about/about-me/" rel="section"><i class="ic i-address-card"></i>åšä¸»</a>
  </li>

        
  <li class="item">
    <a href="/about/about-site/" rel="section"><i class="ic i-cloud"></i>æœ¬ç«™</a>
  </li>

  </ul>
    
  <li class="item">
    <a href="/moments/" rel="section"><i class="ic i-pen"></i>è¯´è¯´</a>
  </li>

    
  <li class="item">
    <span class="exturl" data-url="aHR0cHM6Ly93d3cudHJhdmVsbGluZ3MuY24vZ28uaHRtbA=="><i class="ic i-paper-plane"></i>å¼€å¾€</span>
  </li>


</ul>

      </div>
    </div>
  </div>

  <ul id="quick">
    <li class="prev pjax">
        <a href="/2025/03/18/2025-04-threadpool-by-cpp-02-blockingqueue-md/" rel="prev" title="ä¸Šä¸€ç¯‡"><i class="ic i-chevron-left"></i></a>
    </li>
    <li class="up"><i class="ic i-arrow-up"></i></li>
    <li class="down"><i class="ic i-arrow-down"></i></li>
    <li class="next pjax">
        <a href="/2025/11/02/2025-11-02-design-patterns-in-cpp/" rel="next" title="ä¸‹ä¸€ç¯‡"><i class="ic i-chevron-right"></i></a>
    </li>
    <li class="percent"></li>
  </ul>
</div>


        </div>
        <div class="dimmer"></div>
      </div>
    </main>
    <footer id="footer">
      <div class="inner">
        <div class="widgets">
          
<div class="rpost pjax">
  <h2>éšæœºæ–‡ç« </h2>
  <ul>
      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/OpenHarmony/" title="åˆ†ç±»äº OpenHarmony">OpenHarmony</a>
</div>

    <span><a href="/2025/02/16/2025-02-openharmony-ipc/" title="OpenHarmonyï¼šIPC é€šä¿¡ç¼–ç¨‹èŒƒå¼">OpenHarmonyï¼šIPC é€šä¿¡ç¼–ç¨‹èŒƒå¼</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E9%9D%A2%E8%AF%95%E6%8C%87%E5%8C%97/" title="åˆ†ç±»äº é¢è¯•æŒ‡åŒ—">é¢è¯•æŒ‡åŒ—</a>
<i class="ic i-angle-right"></i>
<a href="/categories/%E9%9D%A2%E8%AF%95%E6%8C%87%E5%8C%97/Web/" title="åˆ†ç±»äº Web">Web</a>
</div>

    <span><a href="/2023/11/01/2023-11-interview-web-spring/" title="é¢è¯•æŒ‡åŒ—ï¼šSpring">é¢è¯•æŒ‡åŒ—ï¼šSpring</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E9%9D%A2%E8%AF%95%E6%8C%87%E5%8C%97/" title="åˆ†ç±»äº é¢è¯•æŒ‡åŒ—">é¢è¯•æŒ‡åŒ—</a>
<i class="ic i-angle-right"></i>
<a href="/categories/%E9%9D%A2%E8%AF%95%E6%8C%87%E5%8C%97/%E6%95%B0%E6%8D%AE%E5%BA%93/" title="åˆ†ç±»äº æ•°æ®åº“">æ•°æ®åº“</a>
</div>

    <span><a href="/2023/10/28/2023-10-interview-db-redis/" title="é¢è¯•æŒ‡åŒ—ï¼šRedis æ•°æ®åº“">é¢è¯•æŒ‡åŒ—ï¼šRedis æ•°æ®åº“</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/" title="åˆ†ç±»äº æŠ€æœ¯åˆ†äº«">æŠ€æœ¯åˆ†äº«</a>
<i class="ic i-angle-right"></i>
<a href="/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/C/" title="åˆ†ç±»äº C++">C++</a>
</div>

    <span><a href="/2025/03/16/2025-03-understanding-of-shared-from-this/" title="C++ï¼šæ·±å…¥ç†è§£ std::enable_shared_from_this ä¸ shared_from_this">C++ï¼šæ·±å…¥ç†è§£ std::enable_shared_from_this ä¸ shared_from_this</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/" title="åˆ†ç±»äº æŠ€æœ¯åˆ†äº«">æŠ€æœ¯åˆ†äº«</a>
<i class="ic i-angle-right"></i>
<a href="/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/C/" title="åˆ†ç±»äº C++">C++</a>
</div>

    <span><a href="/2025/11/02/2025-11-02-design-patterns-in-cpp/" title="23ç§è®¾è®¡æ¨¡å¼å®Œæ•´æŒ‡å— - C++å®ç°è¯¦è§£">23ç§è®¾è®¡æ¨¡å¼å®Œæ•´æŒ‡å— - C++å®ç°è¯¦è§£</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/" title="åˆ†ç±»äº æŠ€æœ¯åˆ†äº«">æŠ€æœ¯åˆ†äº«</a>
<i class="ic i-angle-right"></i>
<a href="/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/C/" title="åˆ†ç±»äº C++">C++</a>
</div>

    <span><a href="/2025/03/18/2025-04-threadpool-by-cpp-02-blockingqueue-md/" title="C++ ThreadPoolï¼š02. BlockingQueue çš„å®ç°">C++ ThreadPoolï¼š02. BlockingQueue çš„å®ç°</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E9%9D%A2%E8%AF%95%E6%8C%87%E5%8C%97/" title="åˆ†ç±»äº é¢è¯•æŒ‡åŒ—">é¢è¯•æŒ‡åŒ—</a>
<i class="ic i-angle-right"></i>
<a href="/categories/%E9%9D%A2%E8%AF%95%E6%8C%87%E5%8C%97/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/" title="åˆ†ç±»äº è®¡ç®—æœºåŸºç¡€">è®¡ç®—æœºåŸºç¡€</a>
</div>

    <span><a href="/2023/10/24/2023-10-interview-network/" title="é¢è¯•æŒ‡åŒ—ï¼šè®¡ç®—æœºç½‘ç»œ">é¢è¯•æŒ‡åŒ—ï¼šè®¡ç®—æœºç½‘ç»œ</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/" title="åˆ†ç±»äº æŠ€æœ¯åˆ†äº«">æŠ€æœ¯åˆ†äº«</a>
<i class="ic i-angle-right"></i>
<a href="/categories/%E6%8A%80%E6%9C%AF%E5%88%86%E4%BA%AB/C/" title="åˆ†ç±»äº C++">C++</a>
</div>

    <span><a href="/2025/11/01/2025-11-01-global-destruct-trap/" title="å…¨å±€å¯¹è±¡ææ„é™·é˜±ï¼šä¸ºä»€ä¹ˆä¸èƒ½ä¾èµ–å…¶ä»–å…¨å±€æˆ–å•ä¾‹å¯¹è±¡">å…¨å±€å¯¹è±¡ææ„é™·é˜±ï¼šä¸ºä»€ä¹ˆä¸èƒ½ä¾èµ–å…¶ä»–å…¨å±€æˆ–å•ä¾‹å¯¹è±¡</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E4%BA%BA%E6%96%87%E7%A4%BE%E7%A7%91/" title="åˆ†ç±»äº äººæ–‡ç¤¾ç§‘">äººæ–‡ç¤¾ç§‘</a>
</div>

    <span><a href="/2023/08/22/2023-08-%E7%BD%97%E7%BF%94%E8%B0%88%E3%80%8A%E9%87%8D%E5%88%91%E4%B8%BB%E4%B9%89%E3%80%8B/" title="ç½—ç¿”è¯´åˆ‘æ³•ï¼šé‡åˆ‘ä¸»ä¹‰">ç½—ç¿”è¯´åˆ‘æ³•ï¼šé‡åˆ‘ä¸»ä¹‰</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/Linux/" title="åˆ†ç±»äº Linux">Linux</a>
</div>

    <span><a href="/2023/08/17/2023-08-brew-replace-download-source/" title="HomeBrewï¼šbrew æ›´æ¢ä¸‹è½½æº">HomeBrewï¼šbrew æ›´æ¢ä¸‹è½½æº</a></span>
  </li>

  </ul>
</div>
<div>
  <h2>æœ€æ–°è¯„è®º</h2>
  <ul class="leancloud-recent-comment"></ul>
</div>

        </div>
        <div class="status">
  <div class="copyright">
    
    &copy; 2023 â€“ 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="ic i-blog"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">å°é¥¼å¹² @ Kevin's Blog</span>
  </div>
  <div class="count">
    <span class="post-meta-item-icon">
      <i class="ic i-chart-area"></i>
    </span>
    <span title="ç«™ç‚¹æ€»å­—æ•°">145k å­—</span>

    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="ic i-coffee"></i>
    </span>
    <span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">2:12</span>
  </div>
  <div class="powered-by">
    åŸºäº <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span>
  </div>
</div>

      </div>
    </footer>
  </div>
<script data-config type="text/javascript">
  var LOCAL = {
    path: '2025/11/01/2025-11-01-global-destruct-trap/',
    favicon: {
      show: "è¦æ¯å¤©å¼€å¿ƒå“¦ ^_^",
      hide: "ç­‰ä½ å›æ¥å‘¦~"
    },
    search : {
      placeholder: "æ–‡ç« æœç´¢",
      empty: "å…³äº ã€Œ ${query} ã€ï¼Œä»€ä¹ˆä¹Ÿæ²¡æœåˆ°",
      stats: "${time} ms å†…æ‰¾åˆ° ${hits} æ¡ç»“æœ"
    },
    valine: true,fancybox: true,
    copyright: 'å¤åˆ¶æˆåŠŸï¼Œè½¬è½½è¯·éµå®ˆ <i class="ic i-creative-commons"></i>BY-NC-SA åè®®ã€‚',
    ignores : [
      function(uri) {
        return uri.includes('#');
      },
      function(uri) {
        return new RegExp(LOCAL.path+"$").test(uri);
      }
    ]
  };
</script>

<script src="https://cdn.polyfill.io/v2/polyfill.js"></script>

<script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script>

<script src="/js/app.js?v=0.2.5"></script>




</body>
</html>
