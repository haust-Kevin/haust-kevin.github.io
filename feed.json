{
    "version": "https://jsonfeed.org/version/1",
    "title": "æ²‰æ€å½•",
    "subtitle": "Talk is cheap. Show me the code.",
    "icon": "https://haust-kevin.github.io/images/favicon.ico",
    "description": "æ€è€ƒæœªçŸ¥ï¼Œè¿½æ±‚å“è¶Š",
    "home_page_url": "https://haust-kevin.github.io",
    "items": [
        {
            "id": "https://haust-kevin.github.io/2025/11/01/2025-11-01-global-destruct-trap/",
            "url": "https://haust-kevin.github.io/2025/11/01/2025-11-01-global-destruct-trap/",
            "title": "å…¨å±€å¯¹è±¡ææ„é™·é˜±ï¼šä¸ºä»€ä¹ˆä¸èƒ½ä¾èµ–å…¶ä»–å…¨å±€æˆ–å•ä¾‹å¯¹è±¡",
            "date_published": "2025-11-01T08:32:58.000Z",
            "content_html": "<div class=\"note primary\">\n<p>æœ¬ç« è®²è§£ C++ å…¨å±€å¯¹è±¡ææ„é—®é¢˜åŠå®‰å…¨å®è·µæ¡†æ¶ã€‚</p>\n</div>\n<h1 id=\"ä¸ºä»€ä¹ˆå…¨å±€å¯¹è±¡çš„ææ„å‡½æ•°é‡Œä¸èƒ½ä½¿ç”¨å…¶ä»–å…¨å±€å¯¹è±¡æˆ–å•ä¾‹å¯¹è±¡çš„æ–¹æ³•\"><a class=\"anchor\" href=\"#ä¸ºä»€ä¹ˆå…¨å±€å¯¹è±¡çš„ææ„å‡½æ•°é‡Œä¸èƒ½ä½¿ç”¨å…¶ä»–å…¨å±€å¯¹è±¡æˆ–å•ä¾‹å¯¹è±¡çš„æ–¹æ³•\">#</a> ä¸ºä»€ä¹ˆå…¨å±€å¯¹è±¡çš„ææ„å‡½æ•°é‡Œä¸èƒ½ä½¿ç”¨å…¶ä»–å…¨å±€å¯¹è±¡æˆ–å•ä¾‹å¯¹è±¡çš„æ–¹æ³•</h1>\n<h2 id=\"å¼•è¨€\"><a class=\"anchor\" href=\"#å¼•è¨€\">#</a> å¼•è¨€</h2>\n<p>åœ¨ C++ å¼€å‘ä¸­ï¼Œå…¨å±€å¯¹è±¡å’Œå•ä¾‹æ¨¡å¼æ˜¯å¸¸è§çš„æŠ€æœ¯é€‰æ‹©ï¼Œå®ƒä»¬ä¸ºæˆ‘ä»¬æä¾›äº†è·¨æ¨¡å—å…±äº«æ•°æ®å’ŒåŠŸèƒ½çš„ä¾¿åˆ©æ–¹å¼ã€‚ç„¶è€Œï¼Œå½“ç¨‹åºç»ˆæ­¢æ—¶ï¼Œè¿™äº›å…¨å±€å¯¹è±¡çš„é”€æ¯é¡ºåºå¯èƒ½ä¼šå¸¦æ¥æ„æƒ³ä¸åˆ°çš„é—®é¢˜ï¼Œç”šè‡³å¯¼è‡´ç¨‹åºå´©æºƒã€‚</p>\n<p>æœ¬æ–‡å°†æ·±å…¥æ¢è®¨ä¸ºä»€ä¹ˆå…¨å±€å¯¹è±¡çš„ææ„å‡½æ•°ä¸­ä¸åº”è¯¥è°ƒç”¨å…¶ä»–å…¨å±€å¯¹è±¡æˆ–å•ä¾‹å¯¹è±¡çš„æ–¹æ³•ï¼Œé€šè¿‡å®é™…çš„ä»£ç æ¡ˆä¾‹å±•ç¤ºè¿™ä¸ªé—®é¢˜çš„æœ¬è´¨ï¼Œå¹¶æä¾›ä¸€äº›å®‰å…¨çš„ç¼–ç¨‹å®è·µå»ºè®®ã€‚</p>\n<h2 id=\"é—®é¢˜çš„æœ¬è´¨é™æ€åˆå§‹åŒ–é¡ºåºç¾éš¾\"><a class=\"anchor\" href=\"#é—®é¢˜çš„æœ¬è´¨é™æ€åˆå§‹åŒ–é¡ºåºç¾éš¾\">#</a> é—®é¢˜çš„æœ¬è´¨ï¼šé™æ€åˆå§‹åŒ–é¡ºåºç¾éš¾</h2>\n<p>C++ ä¸­çš„å…¨å±€å¯¹è±¡ï¼ˆåŒ…æ‹¬å•ä¾‹ï¼‰é¢ä¸´ç€è‘—åçš„ &quot;é™æ€åˆå§‹åŒ–é¡ºåºç¾éš¾&quot;ï¼ˆStatic Initialization Order Fiascoï¼‰ã€‚è¿™ä¸ªé—®é¢˜çš„æ ¸å¿ƒåœ¨äºï¼š</p>\n<ol>\n<li><strong>åˆå§‹åŒ–é¡ºåºä¸ç¡®å®š</strong>ï¼šä¸åŒç¿»è¯‘å•å…ƒï¼ˆtranslation unitï¼‰ä¸­çš„å…¨å±€å¯¹è±¡åˆå§‹åŒ–é¡ºåºæ˜¯æœªå®šä¹‰çš„</li>\n<li><strong>ææ„é¡ºåºä¸åˆå§‹åŒ–é¡ºåºç›¸å</strong>ï¼šå…¨å±€å¯¹è±¡çš„ææ„é¡ºåºæ˜¯åˆå§‹åŒ–é¡ºåºçš„é€†åº</li>\n<li><strong>è·¨å¯¹è±¡ä¾èµ–å±é™©</strong>ï¼šå½“ä¸€ä¸ªå…¨å±€å¯¹è±¡çš„ææ„å‡½æ•°ä¾èµ–äºå¦ä¸€ä¸ªå…¨å±€å¯¹è±¡æ—¶ï¼Œå°±å¯èƒ½å‡ºç°é—®é¢˜</li>\n</ol>\n<h3 id=\"ææ„é¡ºåºè§„åˆ™\"><a class=\"anchor\" href=\"#ææ„é¡ºåºè§„åˆ™\">#</a> ææ„é¡ºåºè§„åˆ™</h3>\n<p>æ ¹æ® C++ æ ‡å‡†ï¼š</p>\n<ul>\n<li>åŒä¸€ç¿»è¯‘å•å…ƒå†…çš„å…¨å±€å¯¹è±¡æŒ‰ç…§å®šä¹‰é¡ºåºåˆå§‹åŒ–ï¼Œé€†åºææ„</li>\n<li>ä¸åŒç¿»è¯‘å•å…ƒé—´çš„å…¨å±€å¯¹è±¡åˆå§‹åŒ–é¡ºåºæœªå®šä¹‰ï¼Œå› æ­¤ææ„é¡ºåºä¹Ÿæœªå®šä¹‰</li>\n<li>å±€éƒ¨é™æ€å¯¹è±¡åœ¨é¦–æ¬¡ä½¿ç”¨æ—¶åˆå§‹åŒ–ï¼Œåœ¨ç¨‹åºç»“æŸæ—¶ææ„</li>\n</ul>\n<h2 id=\"å•æ–‡ä»¶æ¡ˆä¾‹åˆ†æ\"><a class=\"anchor\" href=\"#å•æ–‡ä»¶æ¡ˆä¾‹åˆ†æ\">#</a> å•æ–‡ä»¶æ¡ˆä¾‹åˆ†æ</h2>\n<p>è®©æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸ªç®€å•çš„å•æ–‡ä»¶ç¤ºä¾‹ï¼Œå±•ç¤ºå…¨å±€å¯¹è±¡ææ„æ—¶çš„æ½œåœ¨é—®é¢˜ï¼š</p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;iostream></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;string></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">// å…¨å±€æ—¥å¿—ç®¡ç†å™¨å•ä¾‹</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">LogManager</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">private</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token function\">LogManager</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span> </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        std<span class=\"token double-colon punctuation\">::</span>cout <span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">\"LogManager æ„é€ å‡½æ•°\"</span> <span class=\"token operator\">&lt;&lt;</span> std<span class=\"token double-colon punctuation\">::</span>endl<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">public</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">static</span> LogManager<span class=\"token operator\">&amp;</span> <span class=\"token function\">getInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">static</span> LogManager instance<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token keyword\">return</span> instance<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> std<span class=\"token double-colon punctuation\">::</span>string<span class=\"token operator\">&amp;</span> message<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        std<span class=\"token double-colon punctuation\">::</span>cout <span class=\"token operator\">&lt;&lt;</span> tag <span class=\"token operator\">&lt;&lt;</span> message <span class=\"token operator\">&lt;&lt;</span> std<span class=\"token double-colon punctuation\">::</span>endl<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token operator\">~</span><span class=\"token function\">LogManager</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        std<span class=\"token double-colon punctuation\">::</span>cout <span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">\"LogManager ææ„å‡½æ•°\"</span> <span class=\"token operator\">&lt;&lt;</span> std<span class=\"token double-colon punctuation\">::</span>endl<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token keyword\">private</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    std<span class=\"token double-colon punctuation\">::</span>string tag <span class=\"token operator\">=</span> <span class=\"token string\">\"LogManager\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token comment\">// å…¨å±€æ•°æ®åº“ç®¡ç†å™¨</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">DatabaseManager</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token keyword\">public</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token function\">DatabaseManager</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        std<span class=\"token double-colon punctuation\">::</span>cout <span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">\"DatabaseManager æ„é€ å‡½æ•°\"</span> <span class=\"token operator\">&lt;&lt;</span> std<span class=\"token double-colon punctuation\">::</span>endl<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token class-name\">LogManager</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">getInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ•°æ®åº“ç®¡ç†å™¨åˆå§‹åŒ–\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token operator\">~</span><span class=\"token function\">DatabaseManager</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token comment\">// å±é™©ï¼šåœ¨ææ„å‡½æ•°ä¸­è°ƒç”¨å…¶ä»–å…¨å±€å¯¹è±¡çš„æ–¹æ³•</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        std<span class=\"token double-colon punctuation\">::</span>cout <span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">\"DatabaseManager ææ„å‡½æ•°å¼€å§‹\"</span> <span class=\"token operator\">&lt;&lt;</span> std<span class=\"token double-colon punctuation\">::</span>endl<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token class-name\">LogManager</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">getInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ•°æ®åº“ç®¡ç†å™¨é”€æ¯\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        std<span class=\"token double-colon punctuation\">::</span>cout <span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">\"DatabaseManager ææ„å‡½æ•°ç»“æŸ\"</span> <span class=\"token operator\">&lt;&lt;</span> std<span class=\"token double-colon punctuation\">::</span>endl<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token comment\">// å…¨å±€å¯¹è±¡å®šä¹‰</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>DatabaseManager g_dbManager<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre></pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>    std<span class=\"token double-colon punctuation\">::</span>cout <span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">\"=== ç¨‹åºå¼€å§‹ ===\"</span> <span class=\"token operator\">&lt;&lt;</span> std<span class=\"token double-colon punctuation\">::</span>endl<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>    std<span class=\"token double-colon punctuation\">::</span>cout <span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">\"=== ç¨‹åºç»“æŸï¼Œå¼€å§‹é”€æ¯å…¨å±€å¯¹è±¡ ===\"</span> <span class=\"token operator\">&lt;&lt;</span> std<span class=\"token double-colon punctuation\">::</span>endl<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œè™½ç„¶ç¨‹åºèƒ½å¤Ÿæ­£å¸¸è¿è¡Œï¼Œä½†éšè—ç€ä¸€ä¸ªæ½œåœ¨çš„é—®é¢˜ï¼š <code>DatabaseManager</code>  çš„ææ„å‡½æ•°è°ƒç”¨äº† <code>LogManager</code>  çš„æ–¹æ³•ã€‚å¦‚æœ <code>LogManager</code>  åœ¨ <code>DatabaseManager</code>  ä¹‹å‰è¢«é”€æ¯ï¼Œé‚£ä¹ˆè¿™æ¬¡è°ƒç”¨å°±ä¼šå¯¼è‡´æœªå®šä¹‰è¡Œä¸ºã€‚</p>\n<h2 id=\"å¤šæ–‡ä»¶æ¡ˆä¾‹åˆ†æ\"><a class=\"anchor\" href=\"#å¤šæ–‡ä»¶æ¡ˆä¾‹åˆ†æ\">#</a> å¤šæ–‡ä»¶æ¡ˆä¾‹åˆ†æ</h2>\n<p>å½“å…¨å±€å¯¹è±¡åˆ†å¸ƒåœ¨å¤šä¸ªæ–‡ä»¶ä¸­æ—¶ï¼Œé—®é¢˜å˜å¾—æ›´åŠ å¤æ‚å’Œå±é™©ï¼š</p>\n<p><strong>log_manager.h</strong></p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">ifndef</span> <span class=\"token expression\">LOG_MANAGER_H</span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">LOG_MANAGER_H</span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;string></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">LogManager</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">private</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token function\">LogManager</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">public</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">static</span> LogManager<span class=\"token operator\">&amp;</span> <span class=\"token function\">getInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> std<span class=\"token double-colon punctuation\">::</span>string<span class=\"token operator\">&amp;</span> message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token operator\">~</span><span class=\"token function\">LogManager</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token function\">LogManager</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> LogManager<span class=\"token operator\">&amp;</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">delete</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    LogManager<span class=\"token operator\">&amp;</span> <span class=\"token keyword\">operator</span><span class=\"token operator\">=</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> LogManager<span class=\"token operator\">&amp;</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">delete</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token keyword\">private</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    std<span class=\"token double-colon punctuation\">::</span>string tag <span class=\"token operator\">=</span> <span class=\"token string\">\"LogManager\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endif</span></span></pre></td></tr></table></figure><p><strong>log_manager.cpp</strong></p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">\"log_manager.h\"</span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;iostream></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token class-name\">LogManager</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">LogManager</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span> </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    std<span class=\"token double-colon punctuation\">::</span>cout <span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">\"LogManager æ„é€ å‡½æ•° (æ¥è‡ªlog_manager.cpp)\"</span> <span class=\"token operator\">&lt;&lt;</span> std<span class=\"token double-colon punctuation\">::</span>endl<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>LogManager<span class=\"token operator\">&amp;</span> <span class=\"token class-name\">LogManager</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">getInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">static</span> LogManager instance<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">return</span> instance<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token class-name\">LogManager</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> std<span class=\"token double-colon punctuation\">::</span>string<span class=\"token operator\">&amp;</span> message<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    std<span class=\"token double-colon punctuation\">::</span>cout <span class=\"token operator\">&lt;&lt;</span> tag <span class=\"token operator\">&lt;&lt;</span> message <span class=\"token operator\">&lt;&lt;</span> std<span class=\"token double-colon punctuation\">::</span>endl<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token class-name\">LogManager</span><span class=\"token double-colon punctuation\">::</span><span class=\"token operator\">~</span><span class=\"token function\">LogManager</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    std<span class=\"token double-colon punctuation\">::</span>cout <span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">\"LogManager ææ„å‡½æ•° (æ¥è‡ªlog_manager.cpp)\"</span> <span class=\"token operator\">&lt;&lt;</span> std<span class=\"token double-colon punctuation\">::</span>endl<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><strong>database_manager.cpp</strong></p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">\"database_manager.h\"</span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">\"log_manager.h\"</span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;iostream></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token class-name\">DatabaseManager</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">DatabaseManager</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    std<span class=\"token double-colon punctuation\">::</span>cout <span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">\"DatabaseManager æ„é€ å‡½æ•° (æ¥è‡ªdatabase_manager.cpp)\"</span> <span class=\"token operator\">&lt;&lt;</span> std<span class=\"token double-colon punctuation\">::</span>endl<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token class-name\">LogManager</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">getInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ•°æ®åº“ç®¡ç†å™¨åˆå§‹åŒ–\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token class-name\">DatabaseManager</span><span class=\"token double-colon punctuation\">::</span><span class=\"token operator\">~</span><span class=\"token function\">DatabaseManager</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    std<span class=\"token double-colon punctuation\">::</span>cout <span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">\"DatabaseManager ææ„å‡½æ•°å¼€å§‹ (æ¥è‡ªdatabase_manager.cpp)\"</span> <span class=\"token operator\">&lt;&lt;</span> std<span class=\"token double-colon punctuation\">::</span>endl<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token class-name\">LogManager</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">getInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ•°æ®åº“ç®¡ç†å™¨é”€æ¯\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    std<span class=\"token double-colon punctuation\">::</span>cout <span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">\"DatabaseManager ææ„å‡½æ•°ç»“æŸ (æ¥è‡ªdatabase_manager.cpp)\"</span> <span class=\"token operator\">&lt;&lt;</span> std<span class=\"token double-colon punctuation\">::</span>endl<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>åœ¨å¤šæ–‡ä»¶æƒ…å†µä¸‹ï¼Œé“¾æ¥é¡ºåºå¯èƒ½ä¼šå½±å“å…¨å±€å¯¹è±¡çš„åˆå§‹åŒ–é¡ºåºï¼Œä»è€Œæ”¹å˜ææ„é¡ºåºã€‚è¿™ä½¿å¾—é—®é¢˜æ›´åŠ éš¾ä»¥é¢„æµ‹å’Œè°ƒè¯•ã€‚</p>\n<h2 id=\"ä¸ºä»€ä¹ˆæœ‰æ—¶è°ƒç”¨ä¸ä¼šå´©æºƒ\"><a class=\"anchor\" href=\"#ä¸ºä»€ä¹ˆæœ‰æ—¶è°ƒç”¨ä¸ä¼šå´©æºƒ\">#</a> ä¸ºä»€ä¹ˆæœ‰æ—¶è°ƒç”¨ä¸ä¼šå´©æºƒï¼Ÿ</h2>\n<p>æœ‰è¶£çš„æ˜¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå³ä½¿è°ƒç”¨äº†å·²ç»è¢«é”€æ¯çš„å¯¹è±¡æ–¹æ³•ï¼Œç¨‹åºä¹Ÿä¸ä¼šç«‹å³å´©æºƒã€‚è¿™ä¸»è¦æ˜¯å› ä¸ºï¼š</p>\n<h3 id=\"éè™šå‡½æ•°è°ƒç”¨çš„ç‰¹æ®Šæ€§\"><a class=\"anchor\" href=\"#éè™šå‡½æ•°è°ƒç”¨çš„ç‰¹æ®Šæ€§\">#</a> éè™šå‡½æ•°è°ƒç”¨çš„ç‰¹æ®Šæ€§</h3>\n<p>å½“è°ƒç”¨éè™šå‡½æ•°ä¸”ä¸è®¿é—®æˆå‘˜å˜é‡æ—¶ï¼Œå³ä½¿å¯¹è±¡å·²ç»è¢«é”€æ¯ï¼Œè°ƒç”¨ä¹Ÿå¯èƒ½æˆåŠŸï¼š</p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">SafeLogger</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">staticLog</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> std<span class=\"token double-colon punctuation\">::</span>string<span class=\"token operator\">&amp;</span> message<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        std<span class=\"token double-colon punctuation\">::</span>cout <span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">\"[STATIC LOG] \"</span> <span class=\"token operator\">&lt;&lt;</span> message <span class=\"token operator\">&lt;&lt;</span> std<span class=\"token double-colon punctuation\">::</span>endl<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token function\">safeLog</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> std<span class=\"token double-colon punctuation\">::</span>string<span class=\"token operator\">&amp;</span> message<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        std<span class=\"token double-colon punctuation\">::</span>cout <span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">\"[SAFE LOG] \"</span> <span class=\"token operator\">&lt;&lt;</span> message <span class=\"token operator\">&lt;&lt;</span> std<span class=\"token double-colon punctuation\">::</span>endl<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">virtual</span> <span class=\"token keyword\">void</span> <span class=\"token function\">unsafeLog</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> std<span class=\"token double-colon punctuation\">::</span>string<span class=\"token operator\">&amp;</span> message<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        std<span class=\"token double-colon punctuation\">::</span>cout <span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">\"[UNSAFE LOG] \"</span> <span class=\"token operator\">&lt;&lt;</span> message <span class=\"token operator\">&lt;&lt;</span> std<span class=\"token double-colon punctuation\">::</span>endl<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">private</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    std<span class=\"token double-colon punctuation\">::</span>string tag <span class=\"token operator\">=</span> <span class=\"token string\">\"SafeLogger\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p><strong>å®‰å…¨è°ƒç”¨çš„åŸå› </strong>ï¼š</p>\n<ol>\n<li><strong>é™æ€å‡½æ•°</strong>ï¼šä¸ä¾èµ–äºå¯¹è±¡å®ä¾‹ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨</li>\n<li><strong>éè™šå‡½æ•°</strong>ï¼šä¸éœ€è¦é€šè¿‡è™šå‡½æ•°è¡¨è°ƒç”¨ï¼Œç¼–è¯‘æ—¶å·²ç»ç¡®å®šåœ°å€</li>\n<li><strong>ä¸è®¿é—®æˆå‘˜å˜é‡</strong>ï¼šä¸éœ€è¦ä½¿ç”¨ <code>this</code>  æŒ‡é’ˆè®¿é—®å¯¹è±¡çŠ¶æ€</li>\n</ol>\n<p>å½“æ»¡è¶³è¿™ä¸‰ä¸ªæ¡ä»¶æ—¶ï¼Œå³ä½¿å¯¹è±¡å·²ç»è¢«é”€æ¯ï¼Œå‡½æ•°è°ƒç”¨ä»ç„¶å¯èƒ½æˆåŠŸï¼Œå› ä¸ºï¼š</p>\n<ul>\n<li>å‡½æ•°ä»£ç åœ¨ç¨‹åºå†…å­˜ç©ºé—´ä¸­ä»ç„¶å­˜åœ¨</li>\n<li>è°ƒç”¨ä¸ä¾èµ–äºå¯¹è±¡çš„å®é™…çŠ¶æ€</li>\n<li>ä¸éœ€è¦é€šè¿‡è™šå‡½æ•°è¡¨è¿›è¡ŒåŠ¨æ€åˆ†å‘</li>\n</ul>\n<h3 id=\"å±é™©çš„æƒ…å†µ\"><a class=\"anchor\" href=\"#å±é™©çš„æƒ…å†µ\">#</a> å±é™©çš„æƒ…å†µ</h3>\n<p>ç„¶è€Œï¼Œä¸€æ—¦æ¶‰åŠä»¥ä¸‹ä»»ä½•ä¸€ç§æƒ…å†µï¼Œç¨‹åºå°±å¯èƒ½å´©æºƒï¼š</p>\n<ol>\n<li><strong>è™šå‡½æ•°è°ƒç”¨</strong>ï¼šéœ€è¦é€šè¿‡è™šå‡½æ•°è¡¨ï¼Œè€Œè™šå‡½æ•°è¡¨å¯èƒ½å·²ç»è¢«é”€æ¯</li>\n<li><strong>è®¿é—®æˆå‘˜å˜é‡</strong>ï¼šéœ€è¦ä½¿ç”¨ <code>this</code>  æŒ‡é’ˆï¼Œè€Œå¯¹è±¡å¯èƒ½å·²ç»è¢«é‡Šæ”¾</li>\n<li><strong>ä½¿ç”¨å¯¹è±¡çš„å†…éƒ¨çŠ¶æ€</strong>ï¼šå¯¹è±¡çŠ¶æ€å¯èƒ½å·²ç»è¢«ç ´å</li>\n</ol>\n<h2 id=\"è§£å†³æ–¹æ¡ˆå’Œæœ€ä½³å®è·µ\"><a class=\"anchor\" href=\"#è§£å†³æ–¹æ¡ˆå’Œæœ€ä½³å®è·µ\">#</a> è§£å†³æ–¹æ¡ˆå’Œæœ€ä½³å®è·µ</h2>\n<h3 id=\"1-é¿å…åœ¨ææ„å‡½æ•°ä¸­è°ƒç”¨å…¶ä»–å…¨å±€å¯¹è±¡\"><a class=\"anchor\" href=\"#1-é¿å…åœ¨ææ„å‡½æ•°ä¸­è°ƒç”¨å…¶ä»–å…¨å±€å¯¹è±¡\">#</a> 1. é¿å…åœ¨ææ„å‡½æ•°ä¸­è°ƒç”¨å…¶ä»–å…¨å±€å¯¹è±¡</h3>\n<p>æœ€æ ¹æœ¬çš„è§£å†³æ–¹æ¡ˆæ˜¯é‡æ–°è®¾è®¡æ¶æ„ï¼Œé¿å…åœ¨ææ„å‡½æ•°ä¸­ä¾èµ–å…¶ä»–å…¨å±€å¯¹è±¡ï¼š</p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">DatabaseManager</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token operator\">~</span><span class=\"token function\">DatabaseManager</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token comment\">// å®‰å…¨ï¼šä¸è°ƒç”¨å…¶ä»–å…¨å±€å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token function\">cleanupResources</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token function\">closeConnections</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"2-ä½¿ç”¨ä¾èµ–æ³¨å…¥\"><a class=\"anchor\" href=\"#2-ä½¿ç”¨ä¾èµ–æ³¨å…¥\">#</a> 2. ä½¿ç”¨ä¾èµ–æ³¨å…¥</h3>\n<p>é€šè¿‡ä¾èµ–æ³¨å…¥å°†ä¾èµ–å…³ç³»æ˜ç¡®åŒ–ï¼š</p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">DatabaseManager</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">private</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    std<span class=\"token double-colon punctuation\">::</span>shared_ptr<span class=\"token operator\">&lt;</span>Logger<span class=\"token operator\">></span> logger<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">public</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token function\">DatabaseManager</span><span class=\"token punctuation\">(</span>std<span class=\"token double-colon punctuation\">::</span>shared_ptr<span class=\"token operator\">&lt;</span>Logger<span class=\"token operator\">></span> log<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token function\">logger</span><span class=\"token punctuation\">(</span>log<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token operator\">~</span><span class=\"token function\">DatabaseManager</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>logger<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            logger<span class=\"token operator\">-></span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"æ•°æ®åº“ç®¡ç†å™¨é”€æ¯\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"3-ä½¿ç”¨é”€æ¯ç®¡ç†å™¨\"><a class=\"anchor\" href=\"#3-ä½¿ç”¨é”€æ¯ç®¡ç†å™¨\">#</a> 3. ä½¿ç”¨é”€æ¯ç®¡ç†å™¨</h3>\n<p>å®ç°ä¸€ä¸ªä¸“é—¨çš„é”€æ¯ç®¡ç†å™¨æ¥æ§åˆ¶é”€æ¯é¡ºåºï¼š</p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">DestructionManager</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">static</span> DestructionManager<span class=\"token operator\">&amp;</span> <span class=\"token function\">getInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token function\">registerDestructor</span><span class=\"token punctuation\">(</span>std<span class=\"token double-colon punctuation\">::</span>function<span class=\"token operator\">&lt;</span><span class=\"token keyword\">void</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">></span> destructor<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> phase<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token function\">destroyAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"4-ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆå’Œraii\"><a class=\"anchor\" href=\"#4-ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆå’Œraii\">#</a> 4. ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆå’Œ RAII</h3>\n<p>åˆ©ç”¨æ™ºèƒ½æŒ‡é’ˆå’Œ RAII æœºåˆ¶ç®¡ç†èµ„æºç”Ÿå‘½å‘¨æœŸï¼š</p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">DatabaseManager</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">private</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    std<span class=\"token double-colon punctuation\">::</span>unique_ptr<span class=\"token operator\">&lt;</span>Connection<span class=\"token operator\">></span> connection<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">public</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token operator\">~</span><span class=\"token function\">DatabaseManager</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token comment\">//connection ä¼šè‡ªåŠ¨é‡Šæ”¾ï¼Œä¸éœ€è¦æ‰‹åŠ¨å¤„ç†</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h2 id=\"æ€»ç»“\"><a class=\"anchor\" href=\"#æ€»ç»“\">#</a> æ€»ç»“</h2>\n<p>å…¨å±€å¯¹è±¡ææ„å‡½æ•°ä¸­è°ƒç”¨å…¶ä»–å…¨å±€å¯¹è±¡æ–¹æ³•çš„é—®é¢˜æ˜¯ä¸€ä¸ªå¤æ‚ä½†é‡è¦çš„ä¸»é¢˜ã€‚ç†è§£è¿™ä¸ªé—®é¢˜çš„æœ¬è´¨æœ‰åŠ©äºæˆ‘ä»¬ï¼š</p>\n<ol>\n<li><strong>é¿å…æ½œåœ¨çš„ç¨‹åºå´©æºƒ</strong>ï¼šè®¤è¯†åˆ°è¿™ä¸ªé—®é¢˜çš„å­˜åœ¨ï¼Œåœ¨è®¾è®¡å’Œç¼–ç æ—¶é¿å…å±é™©çš„ä¾èµ–å…³ç³»</li>\n<li><strong>æé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§</strong>ï¼šé€šè¿‡åˆç†çš„æ¶æ„è®¾è®¡å‡å°‘å¯¹è±¡é—´çš„è€¦åˆ</li>\n<li><strong>å¢å¼ºç¨‹åºçš„å¥å£®æ€§</strong>ï¼šä½¿ç”¨æ›´å®‰å…¨çš„è®¾è®¡æ¨¡å¼å’Œç¼–ç¨‹å®è·µ</li>\n</ol>\n<p>è™½ç„¶ C<ins> æä¾›äº†å¼ºå¤§çš„åŠŸèƒ½ï¼Œä½†ä¹Ÿè¦æ±‚å¼€å‘è€…å¯¹å¯¹è±¡ç”Ÿå‘½å‘¨æœŸæœ‰æ·±å…¥çš„ç†è§£ã€‚é€šè¿‡éµå¾ªæœ€ä½³å®è·µï¼Œæˆ‘ä»¬å¯ä»¥æ„å»ºæ›´åŠ å¥å£®å’Œå¯é çš„ C</ins> åº”ç”¨ç¨‹åºã€‚</p>\n<p>ğŸ¯ è®°ä½ï¼š<strong>åœ¨å…¨å±€å¯¹è±¡çš„ææ„å‡½æ•°ä¸­è°ƒç”¨å…¶ä»–å…¨å±€å¯¹è±¡çš„æ–¹æ³•ï¼Œå°±åƒæ˜¯åœ¨æ‹†é™¤å»ºç­‘ç‰©æ—¶è¿˜åœ¨ä½¿ç”¨ç”µæ¢¯ä¸€æ ·å±é™©ã€‚</strong></p>\n<h2 id=\"å‚è€ƒèµ„æ–™\"><a class=\"anchor\" href=\"#å‚è€ƒèµ„æ–™\">#</a> å‚è€ƒèµ„æ–™</h2>\n<ul>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9lbi5jcHByZWZlcmVuY2UuY29tL3cvY3BwL2xhbmd1YWdlL3Npb2YuaHRtbA==\">Static Initialization Order Fiasco - cppreference.com</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuZnJlZWNvZGVjYW1wLm9yZy9uZXdzL2NwcC1zdGF0aWMtaW5pdGlhbGl6YXRpb24tb3JkZXItZmlhc2NvLw==\">What is the Static Initialization Order Fiasco in C++? - freeCodeCamp</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9qYWNvYmZpbGlwcC5jb20vRHJEb2Jicy9hcnRpY2xlcy9DVUovMTk5OS85OTEwL2dhYnJpbG92L2dhYnJpbG92Lmh0bQ==\">Controlling the Destruction Order of Singleton Objects - Dr. Dobbs</span></li>\n<li><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zb3VyY2VtYWtpbmcuY29tL2Rlc2lnbl9wYXR0ZXJucy90b19raWxsX2Ffc2luZ2xldG9u\">To Kill A Singleton - SourceMaking</span></li>\n</ul>\n<hr />\n<p><em>å»ºè®®è¯»è€…åœ¨è‡ªå·±çš„ç¯å¢ƒä¸­å°è¯•è¿™äº›ä¾‹å­ï¼Œæ·±å…¥ç†è§£å…¨å±€å¯¹è±¡ææ„çš„å¤æ‚æ€§ã€‚ä¸åŒç¼–è¯‘å™¨ä¸‹æœªå®šä¹‰è¡Œä¸ºå¤„ç†å¯èƒ½ä¸ä¸€è‡´ã€‚</em></p>\n",
            "tags": [
                "æŠ€æœ¯åˆ†äº«",
                "C++",
                "å•ä¾‹æ¨¡å¼",
                "å…¨å±€å¯¹è±¡",
                "ææ„é¡ºåº",
                "æœªå®šä¹‰è¡Œä¸º",
                "æ„é€ ææ„é™·é˜±",
                "C++ æŠ€å·§",
                "åˆå§‹åŒ–æ´‹è‘±æ¨¡å‹",
                "ä»£ç å®‰å…¨"
            ]
        },
        {
            "id": "https://haust-kevin.github.io/2025/03/18/2025-04-threadpool-by-cpp-02-blockingqueue-md/",
            "url": "https://haust-kevin.github.io/2025/03/18/2025-04-threadpool-by-cpp-02-blockingqueue-md/",
            "title": "C++ ThreadPoolï¼š02. BlockingQueue çš„å®ç°",
            "date_published": "2025-03-18T14:10:24.000Z",
            "content_html": "<div class=\"note primary\">\n<p>æœ¬ç« å®Œæˆ java å››ç§ BlockingQueue çš„ C++ å®ç°</p>\n</div>\n<h2 id=\"åŸæœ‰-blockingqueue\"><a class=\"anchor\" href=\"#åŸæœ‰-blockingqueue\">#</a> åŸæœ‰ BlockingQueue</h2>\n<ul>\n<li><code>ArrayBlockingQueue</code> ï¼šåŸºäºæ•°ç»„çš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ã€‚é˜Ÿåˆ—æŒ‰ FIFO åŸåˆ™å¯¹å…ƒç´ è¿›è¡Œæ’åºï¼Œé˜Ÿåˆ—å¤´éƒ¨æ˜¯åœ¨é˜Ÿåˆ—ä¸­å­˜æ´»æ—¶é—´æœ€é•¿çš„å…ƒç´ ï¼Œé˜Ÿå°¾åˆ™æ˜¯å­˜åœ¨æ—¶é—´æœ€çŸ­çš„å…ƒç´ ã€‚æ–°å…ƒç´ æ’å…¥åˆ°é˜Ÿåˆ—çš„å°¾éƒ¨ï¼Œé˜Ÿåˆ—è·å–æ“ä½œåˆ™æ˜¯ä»é˜Ÿåˆ—å¤´éƒ¨å¼€å§‹è·å¾—å…ƒç´ ã€‚ è¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„ â€œæœ‰ç•Œç¼“å­˜åŒºâ€ï¼Œå›ºå®šå¤§å°çš„æ•°ç»„åœ¨å…¶ä¸­ä¿æŒç”Ÿäº§è€…æ’å…¥çš„å…ƒç´ å’Œä½¿ç”¨è€…æå–çš„å…ƒç´ ã€‚ä¸€æ—¦åˆ›å»ºäº†è¿™æ ·çš„ç¼“å­˜åŒºï¼Œå°±ä¸èƒ½å†å¢åŠ å…¶å®¹é‡ã€‚è¯•å›¾å‘å·²æ»¡é˜Ÿåˆ—ä¸­æ”¾å…¥å…ƒç´ ä¼šå¯¼è‡´æ“ä½œå—é˜»å¡ï¼›è¯•å›¾ä»ç©ºé˜Ÿåˆ—ä¸­æå–å…ƒç´ å°†å¯¼è‡´ç±»ä¼¼é˜»å¡ã€‚</li>\n<li><code>LinkedBlockingQueue</code> ï¼šåŸºäºé“¾è¡¨çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚ä¸ ArrayBlockingQueue ä¸€æ ·é‡‡ç”¨ FIFO åŸåˆ™å¯¹å…ƒç´ è¿›è¡Œæ’åºã€‚åŸºäºé“¾è¡¨çš„é˜Ÿåˆ—ååé‡é€šå¸¸è¦é«˜äºåŸºäºæ•°ç»„çš„é˜Ÿåˆ—ã€‚</li>\n<li><code>SynchronousQueue</code> ï¼šåŒæ­¥çš„é˜»å¡é˜Ÿåˆ—ã€‚å…¶ä¸­æ¯ä¸ªæ’å…¥æ“ä½œå¿…é¡»ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹çš„å¯¹åº”ç§»é™¤æ“ä½œï¼Œç­‰å¾…è¿‡ç¨‹ä¸€ç›´å¤„äºé˜»å¡çŠ¶æ€ï¼ŒåŒç†ï¼Œæ¯ä¸€ä¸ªç§»é™¤æ“ä½œå¿…é¡»ç­‰åˆ°å¦ä¸€ä¸ªçº¿ç¨‹çš„å¯¹åº”æ’å…¥æ“ä½œã€‚SynchronousQueue æ²¡æœ‰ä»»ä½•å®¹é‡ã€‚ä¸èƒ½åœ¨åŒæ­¥é˜Ÿåˆ—ä¸Šè¿›è¡Œ peekï¼Œå› ä¸ºä»…åœ¨è¯•å›¾è¦ç§»é™¤å…ƒç´ æ—¶ï¼Œè¯¥å…ƒç´ æ‰å­˜åœ¨ï¼›é™¤éå¦ä¸€ä¸ªçº¿ç¨‹è¯•å›¾ç§»é™¤æŸä¸ªå…ƒç´ ï¼Œå¦åˆ™ä¹Ÿä¸èƒ½ï¼ˆä½¿ç”¨ä»»ä½•æ–¹æ³•ï¼‰æ’å…¥å…ƒç´ ã€‚</li>\n<li><code>PriorityBlockingQueue</code> ï¼šåŸºäºä¼˜å…ˆçº§çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚ä¼˜å…ˆçº§é˜Ÿåˆ—çš„å…ƒç´ æŒ‰ç…§å…¶è‡ªç„¶é¡ºåºè¿›è¡Œæ’åºï¼Œæˆ–è€…æ ¹æ®æ„é€ é˜Ÿåˆ—æ—¶æä¾›çš„ Comparator è¿›è¡Œæ’åºï¼Œå…·ä½“å–å†³äºæ‰€ä½¿ç”¨çš„æ„é€ æ–¹æ³•ã€‚</li>\n</ul>\n<h2 id=\"åˆ†åˆ«å®ç°\"><a class=\"anchor\" href=\"#åˆ†åˆ«å®ç°\">#</a> åˆ†åˆ«å®ç°</h2>\n<h3 id=\"arrayblockingqueue\"><a class=\"anchor\" href=\"#arrayblockingqueue\">#</a> ArrayBlockingQueue</h3>\n<p>é€šè¿‡é¢„å…ˆå®šä¹‰å›ºå®šå®¹é‡çš„æ•°ç»„ï¼Œé€šè¿‡ç´¢å¼•ç¡®å®šé˜Ÿé¦–å’Œé˜Ÿå°¾ä½ç½®ã€‚ç”±äºé˜Ÿåˆ—æ»¡ï¼Œé˜Ÿé¦–å’Œé˜Ÿå°¾ç´¢å¼•ä¼šé‡å ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªæ ‡å¿—ä½ full ç¡®å®šæ˜¯å¦é˜Ÿåˆ—å·²æ»¡ã€‚</p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">template</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">typename</span> <span class=\"token class-name\">E</span><span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">ArrayBlockingQueue</span> <span class=\"token operator\">:</span> <span class=\"token base-clause\"><span class=\"token keyword\">public</span> <span class=\"token class-name\">BlockingQueue</span><span class=\"token operator\">&lt;</span><span class=\"token class-name\">E</span><span class=\"token operator\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">explicit</span> <span class=\"token function\">ArrayBlockingQueue</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> capacity<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token operator\">:</span> <span class=\"token function\">queue</span><span class=\"token punctuation\">(</span>capacity<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">capacity</span><span class=\"token punctuation\">(</span>capacity<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token operator\">~</span><span class=\"token function\">ArrayBlockingQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">override</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">default</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">bool</span> <span class=\"token function\">Offer</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> E <span class=\"token operator\">&amp;</span>e<span class=\"token punctuation\">,</span> <span class=\"token keyword\">long</span> <span class=\"token keyword\">long</span> timeout<span class=\"token punctuation\">,</span> TimeUnit unit<span class=\"token punctuation\">)</span> <span class=\"token keyword\">override</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        std<span class=\"token double-colon punctuation\">::</span>unique_lock <span class=\"token function\">lock</span><span class=\"token punctuation\">(</span>mtx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token keyword\">bool</span> success <span class=\"token operator\">=</span> cvFull<span class=\"token punctuation\">.</span><span class=\"token function\">wait_for</span><span class=\"token punctuation\">(</span>lock<span class=\"token punctuation\">,</span> std<span class=\"token double-colon punctuation\">::</span>chrono<span class=\"token double-colon punctuation\">::</span><span class=\"token function\">nanoseconds</span><span class=\"token punctuation\">(</span><span class=\"token function\">NANOSECONDS</span><span class=\"token punctuation\">(</span>timeout<span class=\"token punctuation\">,</span> unit<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">&amp;</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token operator\">!</span>full<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>success<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        queue<span class=\"token punctuation\">[</span>endIdx<span class=\"token operator\">++</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> e<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        endIdx <span class=\"token operator\">%=</span> capacity<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>endIdx <span class=\"token operator\">==</span> startIdx<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            full <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        cvEmpty<span class=\"token punctuation\">.</span><span class=\"token function\">notify_one</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token function\">Put</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> E <span class=\"token operator\">&amp;</span>e<span class=\"token punctuation\">)</span> <span class=\"token keyword\">override</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        std<span class=\"token double-colon punctuation\">::</span>unique_lock <span class=\"token function\">lock</span><span class=\"token punctuation\">(</span>mtx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        cvFull<span class=\"token punctuation\">.</span><span class=\"token function\">wait</span><span class=\"token punctuation\">(</span>lock<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">&amp;</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token keyword\">return</span> <span class=\"token operator\">!</span>full<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        queue<span class=\"token punctuation\">[</span>endIdx<span class=\"token operator\">++</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> e<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        endIdx <span class=\"token operator\">%=</span> capacity<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>endIdx <span class=\"token operator\">==</span> startIdx<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>            full <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        cvEmpty<span class=\"token punctuation\">.</span><span class=\"token function\">notify_one</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token keyword\">bool</span> <span class=\"token function\">Poll</span><span class=\"token punctuation\">(</span>E <span class=\"token operator\">&amp;</span>e<span class=\"token punctuation\">,</span> <span class=\"token keyword\">long</span> <span class=\"token keyword\">long</span> timeout<span class=\"token punctuation\">,</span> TimeUnit unit<span class=\"token punctuation\">)</span> <span class=\"token keyword\">override</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        std<span class=\"token double-colon punctuation\">::</span>unique_lock <span class=\"token function\">lock</span><span class=\"token punctuation\">(</span>mtx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        <span class=\"token keyword\">bool</span> success <span class=\"token operator\">=</span> cvEmpty<span class=\"token punctuation\">.</span><span class=\"token function\">wait_for</span><span class=\"token punctuation\">(</span>lock<span class=\"token punctuation\">,</span> std<span class=\"token double-colon punctuation\">::</span>chrono<span class=\"token double-colon punctuation\">::</span><span class=\"token function\">nanoseconds</span><span class=\"token punctuation\">(</span><span class=\"token function\">NANOSECONDS</span><span class=\"token punctuation\">(</span>timeout<span class=\"token punctuation\">,</span> unit<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">&amp;</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            <span class=\"token keyword\">return</span> startIdx <span class=\"token operator\">!=</span> endIdx <span class=\"token operator\">||</span> full<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>success<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>        e <span class=\"token operator\">=</span> queue<span class=\"token punctuation\">[</span>startIdx<span class=\"token operator\">++</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>        startIdx <span class=\"token operator\">%=</span> capacity<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>        full <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>        cvFull<span class=\"token punctuation\">.</span><span class=\"token function\">notify_one</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>    E <span class=\"token function\">Take</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">override</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>        std<span class=\"token double-colon punctuation\">::</span>unique_lock <span class=\"token function\">lock</span><span class=\"token punctuation\">(</span>mtx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>        cvEmpty<span class=\"token punctuation\">.</span><span class=\"token function\">wait</span><span class=\"token punctuation\">(</span>lock<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">&amp;</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token keyword\">return</span> startIdx <span class=\"token operator\">!=</span> endIdx <span class=\"token operator\">||</span> full<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>        <span class=\"token keyword\">auto</span> e <span class=\"token operator\">=</span> queue<span class=\"token punctuation\">[</span>startIdx<span class=\"token operator\">++</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>        startIdx <span class=\"token operator\">%=</span> capacity<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>        full <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>        cvFull<span class=\"token punctuation\">.</span><span class=\"token function\">notify_one</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>        <span class=\"token keyword\">return</span> e<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>    <span class=\"token keyword\">int</span> <span class=\"token function\">RemainingCapacity</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">override</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>        std<span class=\"token double-colon punctuation\">::</span>lock_guard <span class=\"token function\">guard</span><span class=\"token punctuation\">(</span>mtx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>        <span class=\"token keyword\">return</span> full <span class=\"token operator\">?</span> <span class=\"token number\">0</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>endIdx <span class=\"token operator\">+</span> capacity <span class=\"token operator\">-</span> startIdx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre></pre></td></tr><tr><td data-num=\"68\"></td><td><pre><span class=\"token keyword\">private</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>    std<span class=\"token double-colon punctuation\">::</span>vector<span class=\"token operator\">&lt;</span>E<span class=\"token operator\">></span> queue<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>    <span class=\"token keyword\">int</span> startIdx <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>    <span class=\"token keyword\">int</span> endIdx <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>    <span class=\"token keyword\">bool</span> full <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>    std<span class=\"token double-colon punctuation\">::</span>mutex mtx<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>    std<span class=\"token double-colon punctuation\">::</span>condition_variable cvEmpty<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>    std<span class=\"token double-colon punctuation\">::</span>condition_variable cvFull<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>    <span class=\"token keyword\">int</span> capacity<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"linkedblockingqueue\"><a class=\"anchor\" href=\"#linkedblockingqueue\">#</a> LinkedBlockingQueue</h3>\n<p>LinkedBlockingQueue ä¸ ArrayBlockingQueue ç›¸æ¯”ï¼Œä¸»è¦å°‘äº†å®¹é‡é™åˆ¶ï¼Œä»¥åŠå­˜å‚¨æ•°æ®çš„ç»“æ„ä½“ç”±æ•°ç»„æ”¹æˆäº†  <code>list</code></p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">template</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">typename</span> <span class=\"token class-name\">E</span><span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">LinkedBlockingQueue</span> <span class=\"token operator\">:</span> <span class=\"token base-clause\"><span class=\"token keyword\">public</span> <span class=\"token class-name\">BlockingQueue</span><span class=\"token operator\">&lt;</span><span class=\"token class-name\">E</span><span class=\"token operator\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token function\">LinkedBlockingQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">default</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token operator\">~</span><span class=\"token function\">LinkedBlockingQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">override</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">default</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">bool</span> <span class=\"token function\">Offer</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> E <span class=\"token operator\">&amp;</span>e<span class=\"token punctuation\">,</span> <span class=\"token keyword\">long</span> <span class=\"token keyword\">long</span> timeout<span class=\"token punctuation\">,</span> TimeUnit unit<span class=\"token punctuation\">)</span> <span class=\"token keyword\">override</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        std<span class=\"token double-colon punctuation\">::</span>lock_guard <span class=\"token function\">guard</span><span class=\"token punctuation\">(</span>mtx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        queue<span class=\"token punctuation\">.</span><span class=\"token function\">push_back</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        cvEmpty<span class=\"token punctuation\">.</span><span class=\"token function\">notify_one</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token function\">Put</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> E <span class=\"token operator\">&amp;</span>e<span class=\"token punctuation\">)</span> <span class=\"token keyword\">override</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        std<span class=\"token double-colon punctuation\">::</span>lock_guard <span class=\"token function\">lock</span><span class=\"token punctuation\">(</span>mtx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        queue<span class=\"token punctuation\">.</span><span class=\"token function\">push_back</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        cvEmpty<span class=\"token punctuation\">.</span><span class=\"token function\">notify_one</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">bool</span> <span class=\"token function\">Poll</span><span class=\"token punctuation\">(</span>E <span class=\"token operator\">&amp;</span>e<span class=\"token punctuation\">,</span> <span class=\"token keyword\">long</span> <span class=\"token keyword\">long</span> timeout<span class=\"token punctuation\">,</span> TimeUnit unit<span class=\"token punctuation\">)</span> <span class=\"token keyword\">override</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        std<span class=\"token double-colon punctuation\">::</span>unique_lock <span class=\"token function\">lock</span><span class=\"token punctuation\">(</span>mtx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token keyword\">bool</span> success <span class=\"token operator\">=</span> cvEmpty<span class=\"token punctuation\">.</span><span class=\"token function\">wait_for</span><span class=\"token punctuation\">(</span>lock<span class=\"token punctuation\">,</span> <span class=\"token function\">NANOSECONDS</span><span class=\"token punctuation\">(</span>timeout<span class=\"token punctuation\">,</span> unit<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">&amp;</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token operator\">!</span>queue<span class=\"token punctuation\">.</span><span class=\"token function\">empty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>success<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        e <span class=\"token operator\">=</span> queue<span class=\"token punctuation\">.</span><span class=\"token function\">front</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        queue<span class=\"token punctuation\">.</span><span class=\"token function\">pop_front</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        cvFull<span class=\"token punctuation\">.</span><span class=\"token function\">notify_one</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    E <span class=\"token function\">Take</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">override</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        std<span class=\"token double-colon punctuation\">::</span>unique_lock <span class=\"token function\">lock</span><span class=\"token punctuation\">(</span>mtx<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        cvEmpty<span class=\"token punctuation\">.</span><span class=\"token function\">wait</span><span class=\"token punctuation\">(</span>lock<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">&amp;</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token keyword\">return</span> <span class=\"token operator\">!</span>queue<span class=\"token punctuation\">.</span><span class=\"token function\">empty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        <span class=\"token keyword\">auto</span> e <span class=\"token operator\">=</span> queue<span class=\"token punctuation\">.</span><span class=\"token function\">front</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        queue<span class=\"token punctuation\">.</span><span class=\"token function\">pop_front</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        cvFull<span class=\"token punctuation\">.</span><span class=\"token function\">notify_one</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        <span class=\"token keyword\">return</span> e<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    <span class=\"token keyword\">int</span> <span class=\"token function\">RemainingCapacity</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">override</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        <span class=\"token keyword\">return</span> INT_MAX<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre></pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token keyword\">private</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>    std<span class=\"token double-colon punctuation\">::</span>list<span class=\"token operator\">&lt;</span>E<span class=\"token operator\">></span> queue<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>    std<span class=\"token double-colon punctuation\">::</span>mutex mtx<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>    std<span class=\"token double-colon punctuation\">::</span>condition_variable cvEmpty<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>    std<span class=\"token double-colon punctuation\">::</span>condition_variable cvFull<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"synchronousqueue\"><a class=\"anchor\" href=\"#synchronousqueue\">#</a> SynchronousQueue</h3>\n<p><code>SynchronousQueue</code>  ä½œä¸ºåŒæ­¥é˜Ÿåˆ—ï¼Œå‡ºé˜Ÿæ“ä½œåªéœ€è¦ç›‘å¬é˜Ÿåˆ—æœ‰æ•°æ®äº‹ä»¶å³å¯ï¼Œå…¥é˜Ÿéœ€è¦å…¥é˜Ÿå‰ç›‘å¬æ— æ•°æ®ï¼Œå…¥é˜Ÿåç›‘å¬æ•°æ®è¢«å¤„ç†å®Œæˆ</p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">template</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">typename</span> <span class=\"token class-name\">E</span><span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">SynchronousQueue</span> <span class=\"token operator\">:</span> <span class=\"token base-clause\"><span class=\"token keyword\">public</span> <span class=\"token class-name\">BlockingQueue</span><span class=\"token operator\">&lt;</span><span class=\"token class-name\">E</span><span class=\"token operator\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">class</span> <span class=\"token class-name\">Transferer</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">public</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">bool</span> <span class=\"token function\">Request</span><span class=\"token punctuation\">(</span>E <span class=\"token operator\">&amp;</span>e<span class=\"token punctuation\">,</span> <span class=\"token keyword\">bool</span> checkOnce <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            hasValSem<span class=\"token punctuation\">.</span><span class=\"token function\">acquire</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            e <span class=\"token operator\">=</span> tmp<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            doneSem<span class=\"token punctuation\">.</span><span class=\"token function\">release</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token keyword\">bool</span> <span class=\"token function\">Post</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> E <span class=\"token operator\">&amp;</span>e<span class=\"token punctuation\">,</span> <span class=\"token keyword\">bool</span> checkOnce <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>checkOnce<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>postSem<span class=\"token punctuation\">.</span><span class=\"token function\">try_acquire</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                    <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                postSem<span class=\"token punctuation\">.</span><span class=\"token function\">acquire</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            tmp <span class=\"token operator\">=</span> e<span class=\"token punctuation\">;</span> <span class=\"token comment\">// æš‚å­˜æ•°æ®</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            hasValSem<span class=\"token punctuation\">.</span><span class=\"token function\">release</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            doneSem<span class=\"token punctuation\">.</span><span class=\"token function\">acquire</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            postSem<span class=\"token punctuation\">.</span><span class=\"token function\">release</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token keyword\">private</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        E tmp<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        std<span class=\"token double-colon punctuation\">::</span>binary_semaphore postSem<span class=\"token punctuation\">&#123;</span><span class=\"token number\">1</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        std<span class=\"token double-colon punctuation\">::</span>binary_semaphore hasValSem<span class=\"token punctuation\">&#123;</span><span class=\"token number\">0</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        std<span class=\"token double-colon punctuation\">::</span>binary_semaphore doneSem<span class=\"token punctuation\">&#123;</span><span class=\"token number\">0</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token keyword\">public</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token function\">SynchronousQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">default</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token operator\">~</span><span class=\"token function\">SynchronousQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">override</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">default</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token keyword\">bool</span> <span class=\"token function\">Offer</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> E <span class=\"token operator\">&amp;</span>e<span class=\"token punctuation\">,</span> <span class=\"token keyword\">long</span> <span class=\"token keyword\">long</span> timeout<span class=\"token punctuation\">,</span> TimeUnit unit<span class=\"token punctuation\">)</span> <span class=\"token keyword\">override</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token function\">Put</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> E <span class=\"token operator\">&amp;</span>e<span class=\"token punctuation\">)</span> <span class=\"token keyword\">override</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>        transferer<span class=\"token punctuation\">.</span><span class=\"token function\">Post</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>    <span class=\"token keyword\">bool</span> <span class=\"token function\">Poll</span><span class=\"token punctuation\">(</span>E <span class=\"token operator\">&amp;</span>e<span class=\"token punctuation\">,</span> <span class=\"token keyword\">long</span> <span class=\"token keyword\">long</span> timeout<span class=\"token punctuation\">,</span> TimeUnit unit<span class=\"token punctuation\">)</span> <span class=\"token keyword\">override</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>    E <span class=\"token function\">Take</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">override</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>        E e<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>        transferer<span class=\"token punctuation\">.</span><span class=\"token function\">Request</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>        <span class=\"token keyword\">return</span> e<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>    <span class=\"token keyword\">int</span> <span class=\"token function\">RemainingCapacity</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">override</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre></pre></td></tr><tr><td data-num=\"61\"></td><td><pre><span class=\"token keyword\">private</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>    Transferer transferer<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h2 id=\"æµ‹è¯•ç”¨ä¾‹\"><a class=\"anchor\" href=\"#æµ‹è¯•ç”¨ä¾‹\">#</a> æµ‹è¯•ç”¨ä¾‹</h2>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token function\">ut_BlockingQueue</span><span class=\"token punctuation\">(</span>Concurrency<span class=\"token double-colon punctuation\">::</span>BlockingQueue<span class=\"token operator\">&lt;</span><span class=\"token keyword\">int</span><span class=\"token operator\">></span> <span class=\"token operator\">&amp;</span>queue<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> std<span class=\"token double-colon punctuation\">::</span>string <span class=\"token operator\">&amp;</span>tag<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">auto</span> start <span class=\"token operator\">=</span> std<span class=\"token double-colon punctuation\">::</span>chrono<span class=\"token double-colon punctuation\">::</span>high_resolution_clock<span class=\"token double-colon punctuation\">::</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">auto</span> result <span class=\"token operator\">=</span> std<span class=\"token double-colon punctuation\">::</span><span class=\"token generic-function\"><span class=\"token function\">make_shared</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>Concurrency<span class=\"token double-colon punctuation\">::</span>LinkedBlockingQueue<span class=\"token operator\">&lt;</span><span class=\"token keyword\">int</span><span class=\"token operator\">></span> <span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    std<span class=\"token double-colon punctuation\">::</span>atomic cnt <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">int</span> range <span class=\"token operator\">=</span> <span class=\"token number\">100000</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">int</span> threadNum <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">auto</span> producer <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">&amp;</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> n<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            queue<span class=\"token punctuation\">.</span><span class=\"token function\">Put</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    std<span class=\"token double-colon punctuation\">::</span>mutex m<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    std<span class=\"token double-colon punctuation\">::</span>condition_variable cv<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">auto</span> consumer <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">&amp;</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token keyword\">while</span> <span class=\"token punctuation\">(</span><span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            result<span class=\"token operator\">-></span><span class=\"token function\">Put</span><span class=\"token punctuation\">(</span>queue<span class=\"token punctuation\">.</span><span class=\"token function\">Take</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token operator\">++</span>cnt<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>cnt<span class=\"token punctuation\">.</span><span class=\"token function\">load</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">>=</span> range <span class=\"token operator\">*</span> threadNum<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                cv<span class=\"token punctuation\">.</span><span class=\"token function\">notify_one</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    std<span class=\"token double-colon punctuation\">::</span>vector<span class=\"token operator\">&lt;</span>std<span class=\"token double-colon punctuation\">::</span>shared_ptr<span class=\"token operator\">&lt;</span>std<span class=\"token double-colon punctuation\">::</span>thread<span class=\"token operator\">></span> <span class=\"token operator\">></span> ts<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> threadNum<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        ts<span class=\"token punctuation\">.</span><span class=\"token function\">push_back</span><span class=\"token punctuation\">(</span>std<span class=\"token double-colon punctuation\">::</span><span class=\"token generic-function\"><span class=\"token function\">make_shared</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>std<span class=\"token double-colon punctuation\">::</span>thread<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>producer<span class=\"token punctuation\">,</span> range<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">5</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        ts<span class=\"token punctuation\">.</span><span class=\"token function\">push_back</span><span class=\"token punctuation\">(</span>std<span class=\"token double-colon punctuation\">::</span><span class=\"token generic-function\"><span class=\"token function\">make_shared</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>std<span class=\"token double-colon punctuation\">::</span>thread<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>consumer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token keyword\">auto</span> <span class=\"token operator\">&amp;</span>t<span class=\"token operator\">:</span> ts<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        t<span class=\"token operator\">-></span><span class=\"token function\">detach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    std<span class=\"token double-colon punctuation\">::</span>unique_lock<span class=\"token operator\">&lt;</span>std<span class=\"token double-colon punctuation\">::</span>mutex<span class=\"token operator\">></span> <span class=\"token function\">lock</span><span class=\"token punctuation\">(</span>m<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    cv<span class=\"token punctuation\">.</span><span class=\"token function\">wait</span><span class=\"token punctuation\">(</span>lock<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">&amp;</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        <span class=\"token keyword\">return</span> cnt<span class=\"token punctuation\">.</span><span class=\"token function\">load</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> range <span class=\"token operator\">*</span> threadNum<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    std<span class=\"token double-colon punctuation\">::</span>cout <span class=\"token operator\">&lt;&lt;</span> cnt <span class=\"token operator\">&lt;&lt;</span> std<span class=\"token double-colon punctuation\">::</span>endl<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token keyword\">auto</span> stop <span class=\"token operator\">=</span> std<span class=\"token double-colon punctuation\">::</span>chrono<span class=\"token double-colon punctuation\">::</span>high_resolution_clock<span class=\"token double-colon punctuation\">::</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token keyword\">auto</span> duration <span class=\"token operator\">=</span> std<span class=\"token double-colon punctuation\">::</span>chrono<span class=\"token double-colon punctuation\">::</span><span class=\"token generic-function\"><span class=\"token function\">duration_cast</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>std<span class=\"token double-colon punctuation\">::</span>chrono<span class=\"token double-colon punctuation\">::</span>milliseconds<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>stop <span class=\"token operator\">-</span> start<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">count</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    std<span class=\"token double-colon punctuation\">::</span>cout <span class=\"token operator\">&lt;&lt;</span> tag <span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">\" Elapsed time: \"</span> <span class=\"token operator\">&lt;&lt;</span> duration <span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">\" ms\\n\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    std<span class=\"token double-colon punctuation\">::</span>cout <span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">\"cnt: \"</span> <span class=\"token operator\">&lt;&lt;</span> cnt <span class=\"token operator\">&lt;&lt;</span> std<span class=\"token double-colon punctuation\">::</span>endl<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre></pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>    <span class=\"token keyword\">auto</span> q1 <span class=\"token operator\">=</span> Concurrency<span class=\"token double-colon punctuation\">::</span><span class=\"token generic-function\"><span class=\"token function\">ArrayBlockingQueue</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token keyword\">int</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token number\">1000000</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>    <span class=\"token function\">ut_BlockingQueue</span><span class=\"token punctuation\">(</span>q1<span class=\"token punctuation\">,</span> <span class=\"token string\">\"ArrayBlockingQueue\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>    <span class=\"token keyword\">auto</span> q2 <span class=\"token operator\">=</span> Concurrency<span class=\"token double-colon punctuation\">::</span><span class=\"token generic-function\"><span class=\"token function\">LinkedBlockingQueue</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token keyword\">int</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>    <span class=\"token function\">ut_BlockingQueue</span><span class=\"token punctuation\">(</span>q2<span class=\"token punctuation\">,</span> <span class=\"token string\">\"LinkedBlockingQueue\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>    <span class=\"token keyword\">auto</span> q3 <span class=\"token operator\">=</span> Concurrency<span class=\"token double-colon punctuation\">::</span><span class=\"token generic-function\"><span class=\"token function\">SynchronousQueue</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token keyword\">int</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>    <span class=\"token function\">ut_BlockingQueue</span><span class=\"token punctuation\">(</span>q3<span class=\"token punctuation\">,</span> <span class=\"token string\">\"SynchronousQueue\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æµ‹è¯•ç”¨ä¾‹è¾“å‡ºç»“æœ</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">1000000</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>ArrayBlockingQueue Elapsed time: <span class=\"token number\">825</span> ms</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>cnt: <span class=\"token number\">1000000</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">1000000</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>LinkedBlockingQueue Elapsed time: <span class=\"token number\">938</span> ms</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>cnt: <span class=\"token number\">1000000</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">1000000</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>SynchronousQueue Elapsed time: <span class=\"token number\">919</span> ms</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>cnt: <span class=\"token number\">1000000</span></pre></td></tr></table></figure>",
            "tags": [
                "æŠ€æœ¯åˆ†äº«",
                "C++",
                "Java",
                "C++",
                "ThreadPool",
                "çº¿ç¨‹æ± "
            ]
        },
        {
            "id": "https://haust-kevin.github.io/2025/03/17/2025-04-threadpool-by-cpp-01-fwk/",
            "url": "https://haust-kevin.github.io/2025/03/17/2025-04-threadpool-by-cpp-01-fwk/",
            "title": "C++ ThreadPoolï¼š01. Java ThreadPoolExecutor çš„ C++ å®ç°",
            "date_published": "2025-03-16T17:01:58.000Z",
            "content_html": "<div class=\"note primary\">\n<p>æœ¬ç« æ­å»º java ThreadPoolExecutor çº¿ç¨‹æ± çš„ C++ ç®€æ˜“å®ç°æ¡†æ¶</p>\n</div>\n<h2 id=\"ç®€ä»‹\"><a class=\"anchor\" href=\"#ç®€ä»‹\">#</a> ç®€ä»‹</h2>\n<p>è¿‘æœŸæƒ³åŠ å›ºå¤šçº¿ç¨‹åœºæ™¯ç¼–ç¨‹èƒ½åŠ›ï¼Œæƒ³ä½¿ç”¨ C++ å®ç°ä¸€å¥—ç±»ä¼¼ Java  <code>ThreadPoolExecutor</code>  çš„çº¿ç¨‹æ± ã€‚æœ¬ç« ä»‹ç»å„ç»„ä»¶çš„åŸºç¡€åŠŸèƒ½æ¡†æ¶ã€‚</p>\n<h3 id=\"threadpoolexecutor-å®ç°\"><a class=\"anchor\" href=\"#threadpoolexecutor-å®ç°\">#</a> ThreadPoolExecutor å®ç°</h3>\n<h4 id=\"java-çº¿ç¨‹æ± çš„å‚æ•°\"><a class=\"anchor\" href=\"#java-çº¿ç¨‹æ± çš„å‚æ•°\">#</a> Java çº¿ç¨‹æ± çš„å‚æ•°</h4>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">ThreadPoolExecutor</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> corePoolSize<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>                            <span class=\"token keyword\">int</span> maximumPoolSize<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>                            <span class=\"token keyword\">long</span> keepAliveTime<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>                            <span class=\"token class-name\">TimeUnit</span> unit<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>                            <span class=\"token class-name\">BlockingQueue</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Runnable</span><span class=\"token punctuation\">></span></span> workQueue<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                            <span class=\"token class-name\">ThreadFactory</span> threadFactory<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                            <span class=\"token class-name\">RejectedExecutionHandler</span> handler<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>corePoolSize <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span> <span class=\"token operator\">||</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        maximumPoolSize <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span> <span class=\"token operator\">||</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        maximumPoolSize <span class=\"token operator\">&lt;</span> corePoolSize <span class=\"token operator\">||</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        keepAliveTime <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalArgumentException</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>workQueue <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">||</span> threadFactory <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">||</span> handler <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">NullPointerException</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>corePoolSize <span class=\"token operator\">=</span> corePoolSize<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>maximumPoolSize <span class=\"token operator\">=</span> maximumPoolSize<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>workQueue <span class=\"token operator\">=</span> workQueue<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>keepAliveTime <span class=\"token operator\">=</span> unit<span class=\"token punctuation\">.</span><span class=\"token function\">toNanos</span><span class=\"token punctuation\">(</span>keepAliveTime<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>threadFactory <span class=\"token operator\">=</span> threadFactory<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>handler <span class=\"token operator\">=</span> handler<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li><strong>corePoolSize</strong>ï¼ˆæ ¸å¿ƒå·¥ä½œçº¿ç¨‹æ•°ï¼‰ï¼šå½“å‘çº¿ç¨‹æ± æäº¤ä¸€ä¸ªä»»åŠ¡æ—¶ï¼Œè‹¥çº¿ç¨‹æ± å·²åˆ›å»ºçš„çº¿ç¨‹æ•°å°äº corePoolSizeï¼Œå³ä¾¿æ­¤æ—¶å­˜åœ¨ç©ºé—²çº¿ç¨‹ï¼Œä¹Ÿä¼šé€šè¿‡åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹æ¥æ‰§è¡Œè¯¥ä»»åŠ¡ï¼Œç›´åˆ°å·²åˆ›å»ºçš„çº¿ç¨‹æ•°å¤§äºæˆ–ç­‰äº corePoolSize æ—¶ã€‚</li>\n<li><strong>maximumPoolSize</strong>ï¼ˆæœ€å¤§çº¿ç¨‹æ•°ï¼‰ï¼šçº¿ç¨‹æ± æ‰€å…è®¸çš„æœ€å¤§çº¿ç¨‹ä¸ªæ•°ã€‚å½“é˜Ÿåˆ—æ»¡äº†ï¼Œä¸”å·²åˆ›å»ºçš„çº¿ç¨‹æ•°å°äº maximumPoolSizeï¼Œåˆ™çº¿ç¨‹æ± ä¼šåˆ›å»ºæ–°çš„çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ã€‚å¦å¤–ï¼Œå¯¹äºæ— ç•Œé˜Ÿåˆ—ï¼Œå¯å¿½ç•¥è¯¥å‚æ•°ã€‚</li>\n<li><strong>keepAliveTime</strong>ï¼ˆå¤šä½™çº¿ç¨‹å­˜æ´»æ—¶é—´ï¼‰ï¼šå½“çº¿ç¨‹æ± ä¸­çº¿ç¨‹æ•°å¤§äºæ ¸å¿ƒçº¿ç¨‹æ•°æ—¶ï¼Œçº¿ç¨‹çš„ç©ºé—²æ—¶é—´å¦‚æœè¶…è¿‡çº¿ç¨‹å­˜æ´»æ—¶é—´ï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹å°±ä¼šè¢«é”€æ¯ï¼Œç›´åˆ°çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°å°äºç­‰äºæ ¸å¿ƒçº¿ç¨‹æ•°ã€‚</li>\n<li><strong>workQueue</strong>ï¼ˆé˜Ÿåˆ—ï¼‰ï¼šç”¨äºä¼ è¾“å’Œä¿å­˜ç­‰å¾…æ‰§è¡Œä»»åŠ¡çš„é˜»å¡é˜Ÿåˆ—ã€‚</li>\n<li><strong>threadFactory</strong>ï¼ˆçº¿ç¨‹åˆ›å»ºå·¥å‚ï¼‰ï¼šç”¨äºåˆ›å»ºæ–°çº¿ç¨‹ã€‚threadFactory åˆ›å»ºçš„çº¿ç¨‹ä¹Ÿæ˜¯é‡‡ç”¨ new Thread () æ–¹å¼ï¼ŒthreadFactory åˆ›å»ºçš„çº¿ç¨‹åéƒ½å…·æœ‰ç»Ÿä¸€çš„é£æ ¼ï¼špool-m-thread-nï¼ˆm ä¸ºçº¿ç¨‹æ± çš„ç¼–å·ï¼Œn ä¸ºçº¿ç¨‹æ± å†…çš„çº¿ç¨‹ç¼–å·ï¼‰ã€‚</li>\n<li><strong>handler</strong>ï¼ˆæ‹’ç»ç­–ç•¥ï¼‰ï¼šå½“çº¿ç¨‹æ± å’Œé˜Ÿåˆ—éƒ½æ»¡äº†ï¼Œå†åŠ å…¥çº¿ç¨‹ä¼šæ‰§è¡Œæ­¤ç­–ç•¥</li>\n</ul>\n<h4 id=\"ä»»åŠ¡æ·»åŠ æµç¨‹å›¾\"><a class=\"anchor\" href=\"#ä»»åŠ¡æ·»åŠ æµç¨‹å›¾\">#</a> ä»»åŠ¡æ·»åŠ æµç¨‹å›¾</h4>\n<p><img data-src=\"https://cdn.jsdelivr.net/gh/haust-Kevin/static@master/images/20250318214731716.png\" alt=\"å›¾ç‰‡\" /></p>\n<h2 id=\"éœ€è¦å®ç°çš„æ¡†æ¶\"><a class=\"anchor\" href=\"#éœ€è¦å®ç°çš„æ¡†æ¶\">#</a> éœ€è¦å®ç°çš„æ¡†æ¶</h2>\n<h3 id=\"timeunit\"><a class=\"anchor\" href=\"#timeunit\">#</a> TimeUnit</h3>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">ifndef</span> <span class=\"token expression\">TIME_UNIT_H</span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">TIME_UNIT_H</span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">namespace</span> Concurrency <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">constexpr</span> <span class=\"token keyword\">long</span> <span class=\"token keyword\">long</span> NANO_SCALE <span class=\"token operator\">=</span> <span class=\"token number\">1L</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">constexpr</span> <span class=\"token keyword\">long</span> <span class=\"token keyword\">long</span> MICRO_SCALE <span class=\"token operator\">=</span> <span class=\"token number\">1000L</span> <span class=\"token operator\">*</span> NANO_SCALE<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">constexpr</span> <span class=\"token keyword\">long</span> <span class=\"token keyword\">long</span> MILLI_SCALE <span class=\"token operator\">=</span> <span class=\"token number\">1000L</span> <span class=\"token operator\">*</span> MICRO_SCALE<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">constexpr</span> <span class=\"token keyword\">long</span> <span class=\"token keyword\">long</span> SECOND_SCALE <span class=\"token operator\">=</span> <span class=\"token number\">1000L</span> <span class=\"token operator\">*</span> MILLI_SCALE<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">constexpr</span> <span class=\"token keyword\">long</span> <span class=\"token keyword\">long</span> MINUTE_SCALE <span class=\"token operator\">=</span> <span class=\"token number\">60L</span> <span class=\"token operator\">*</span> SECOND_SCALE<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">constexpr</span> <span class=\"token keyword\">long</span> <span class=\"token keyword\">long</span> HOUR_SCALE <span class=\"token operator\">=</span> <span class=\"token number\">60L</span> <span class=\"token operator\">*</span> MINUTE_SCALE<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">constexpr</span> <span class=\"token keyword\">long</span> <span class=\"token keyword\">long</span> DAY_SCALE <span class=\"token operator\">=</span> <span class=\"token number\">24L</span> <span class=\"token operator\">*</span> HOUR_SCALE<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">enum</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TimeUnit</span><span class=\"token operator\">:</span> <span class=\"token base-clause\"><span class=\"token keyword\">long</span> <span class=\"token keyword\">long</span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    NANOSECONDS <span class=\"token operator\">=</span> NANO_SCALE<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    MICROSECONDS <span class=\"token operator\">=</span> MICRO_SCALE<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    MILLISECONDS <span class=\"token operator\">=</span> MILLI_SCALE<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    SECONDS <span class=\"token operator\">=</span> SECOND_SCALE<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    MINUTES <span class=\"token operator\">=</span> MINUTE_SCALE<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    HOURS <span class=\"token operator\">=</span> HOUR_SCALE<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    DAYS <span class=\"token operator\">=</span> DAY_SCALE</pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endif</span> <span class=\"token comment\">// TIME_UNIT_H</span></span></pre></td></tr></table></figure><h3 id=\"blockingqueue\"><a class=\"anchor\" href=\"#blockingqueue\">#</a> BlockingQueue</h3>\n<p><code>BlockingQueue</code>  åªæå–äº†éƒ¨åˆ†é˜Ÿåˆ—éœ€è¦çš„æ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯é˜»å¡ <code>push</code> ã€ <code>pop</code>  å’Œå•æ¬¡å°è¯• <code>push</code> ã€ <code>pop</code> ã€‚<br />\nç›®å‰åªå®šä¹‰äº†æ¥å£ï¼Œåç»­ä¼šæœ‰ç« èŠ‚ä»”ç»†è¯´æ˜å¤šç§é˜Ÿåˆ—çš„å®ç°ã€‚</p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">ifndef</span> <span class=\"token expression\">BLOCKING_QUEUE_H</span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">BLOCKING_QUEUE_H</span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">namespace</span> Concurrency <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">template</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">typename</span> <span class=\"token class-name\">E</span><span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">BlockingQueue</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">public</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">virtual</span> <span class=\"token operator\">~</span><span class=\"token function\">BlockingQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">default</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">virtual</span> <span class=\"token keyword\">bool</span> <span class=\"token function\">Offer</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> E <span class=\"token operator\">&amp;</span>e<span class=\"token punctuation\">,</span> <span class=\"token keyword\">long</span> <span class=\"token keyword\">long</span> timeout<span class=\"token punctuation\">,</span> TimeUnit unit<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">virtual</span> <span class=\"token keyword\">void</span> <span class=\"token function\">Put</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> E <span class=\"token operator\">&amp;</span>e<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">virtual</span> <span class=\"token keyword\">bool</span> <span class=\"token function\">Poll</span><span class=\"token punctuation\">(</span>E <span class=\"token operator\">&amp;</span>e<span class=\"token punctuation\">,</span> <span class=\"token keyword\">long</span> <span class=\"token keyword\">long</span> timeout<span class=\"token punctuation\">,</span> TimeUnit unit<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">virtual</span> E <span class=\"token function\">Take</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token keyword\">virtual</span> <span class=\"token keyword\">int</span> <span class=\"token function\">RemainingCapacity</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endif</span> <span class=\"token comment\">// BLOCKING_QUEUE_H</span></span></pre></td></tr></table></figure><h3 id=\"threadfactory\"><a class=\"anchor\" href=\"#threadfactory\">#</a> ThreadFactory</h3>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">ifndef</span> <span class=\"token expression\">THREAD_FACTORY_H</span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">THREAD_FACTORY_H</span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">\"Thread.h\"</span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">namespace</span> Concurrency <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">ThreadFactory</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">public</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">virtual</span> <span class=\"token operator\">~</span><span class=\"token function\">ThreadFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">default</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">virtual</span> std<span class=\"token double-colon punctuation\">::</span>shared_ptr<span class=\"token operator\">&lt;</span>Thread<span class=\"token operator\">></span> <span class=\"token function\">NewThread</span><span class=\"token punctuation\">(</span>ExecutableTask task<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endif</span> <span class=\"token comment\">// THREAD_FACTORY_H</span></span></pre></td></tr></table></figure><h3 id=\"rejectedexecutionhandler\"><a class=\"anchor\" href=\"#rejectedexecutionhandler\">#</a> RejectedExecutionHandler</h3>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">ifndef</span> <span class=\"token expression\">REJECTED_EXECUTION_HANDLER_H</span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">REJECTED_EXECUTION_HANDLER_H</span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;memory></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">\"ExecutableTask.h\"</span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">namespace</span> Concurrency <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">ThreadPoolExecutor</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">RejectedExecutionHandler</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">public</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">virtual</span> <span class=\"token operator\">~</span><span class=\"token function\">RejectedExecutionHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">default</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">virtual</span> <span class=\"token keyword\">void</span> <span class=\"token function\">RejectedExecution</span><span class=\"token punctuation\">(</span>ExecutableTask task<span class=\"token punctuation\">,</span> std<span class=\"token double-colon punctuation\">::</span>shared_ptr<span class=\"token operator\">&lt;</span>ThreadPoolExecutor<span class=\"token operator\">></span> executor<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endif</span> <span class=\"token comment\">// REJECTED_EXECUTION_HANDLER_H</span></span></pre></td></tr></table></figure><h3 id=\"threadpoolexecutor\"><a class=\"anchor\" href=\"#threadpoolexecutor\">#</a> ThreadPoolExecutor</h3>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">ifndef</span> <span class=\"token expression\">THREAD_POOL_EXECUTOR_H</span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">THREAD_POOL_EXECUTOR_H</span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;functional></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;memory></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">\"BlockingQueue.h\"</span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">\"ExecutableTask.h\"</span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">\"RejectedExecutionHandler.h\"</span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">\"ThreadFactory.h\"</span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">\"TimeUnit.h\"</span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">namespace</span> Concurrency <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">constexpr</span> <span class=\"token keyword\">int</span> DEFAULT_CORE_POOL_SIZE <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">constexpr</span> <span class=\"token keyword\">int</span> DEFAULT_MAXIMUM_POOL_SIZE <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">constexpr</span> <span class=\"token keyword\">long</span> <span class=\"token keyword\">long</span> DEFAULT_KEEP_ALIVE_TIME <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">ThreadPoolExecutor</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">public</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token function\">ThreadPoolExecutor</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> corePoolSize<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                       <span class=\"token keyword\">int</span> maximumPoolSize<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                       <span class=\"token keyword\">long</span> <span class=\"token keyword\">long</span> keepAliveTime <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                       TimeUnit unit <span class=\"token operator\">=</span> TimeUnit<span class=\"token double-colon punctuation\">::</span>MILLISECONDS<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                       std<span class=\"token double-colon punctuation\">::</span>shared_ptr<span class=\"token operator\">&lt;</span>BlockingQueue<span class=\"token operator\">&lt;</span>ExecutableTask<span class=\"token operator\">></span> <span class=\"token operator\">></span> workQueue <span class=\"token operator\">=</span> <span class=\"token keyword\">nullptr</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                       std<span class=\"token double-colon punctuation\">::</span>shared_ptr<span class=\"token operator\">&lt;</span>ThreadFactory<span class=\"token operator\">></span> threadFactory <span class=\"token operator\">=</span> <span class=\"token keyword\">nullptr</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                       std<span class=\"token double-colon punctuation\">::</span>shared_ptr<span class=\"token operator\">&lt;</span>RejectedExecutionHandler<span class=\"token operator\">></span> rejectedHandler <span class=\"token operator\">=</span> <span class=\"token keyword\">nullptr</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>corePoolSize <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            corePoolSize <span class=\"token operator\">=</span> DEFAULT_CORE_POOL_SIZE<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>maximumPoolSize <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            maximumPoolSize <span class=\"token operator\">=</span> DEFAULT_MAXIMUM_POOL_SIZE<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>maximumPoolSize <span class=\"token operator\">&lt;</span> corePoolSize<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>            maximumPoolSize <span class=\"token operator\">=</span> corePoolSize<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>keepAliveTime <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>            keepAliveTime <span class=\"token operator\">=</span> DEFAULT_KEEP_ALIVE_TIME<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>workQueue <span class=\"token operator\">==</span> <span class=\"token keyword\">nullptr</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>            workQueue <span class=\"token operator\">=</span> <span class=\"token function\">CreateDefaultWorkQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>threadFactory <span class=\"token operator\">==</span> <span class=\"token keyword\">nullptr</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>            threadFactory <span class=\"token operator\">=</span> <span class=\"token function\">CreateDefaultThreadFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>rejectedHandler <span class=\"token operator\">==</span> <span class=\"token keyword\">nullptr</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>            rejectedHandler <span class=\"token operator\">=</span> <span class=\"token function\">CreateDefaultRejectedHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token operator\">-></span>corePoolSize <span class=\"token operator\">=</span> corePoolSize<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token operator\">-></span>maximumPoolSize <span class=\"token operator\">=</span> maximumPoolSize<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token operator\">-></span>keepAliveTime <span class=\"token operator\">=</span> keepAliveTime<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token operator\">-></span>unit <span class=\"token operator\">=</span> unit<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token operator\">-></span>workQueue <span class=\"token operator\">=</span> workQueue<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token operator\">-></span>threadFactory <span class=\"token operator\">=</span> threadFactory<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token operator\">-></span>rejectedHandler <span class=\"token operator\">=</span> rejectedHandler<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre></pre></td></tr><tr><td data-num=\"56\"></td><td><pre><span class=\"token keyword\">private</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>    <span class=\"token keyword\">static</span> std<span class=\"token double-colon punctuation\">::</span>shared_ptr<span class=\"token operator\">&lt;</span>BlockingQueue<span class=\"token operator\">&lt;</span>ExecutableTask<span class=\"token operator\">></span> <span class=\"token operator\">></span> <span class=\"token function\">CreateDefaultWorkQueue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>        <span class=\"token comment\">// TODO</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">nullptr</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>    <span class=\"token keyword\">static</span> std<span class=\"token double-colon punctuation\">::</span>shared_ptr<span class=\"token operator\">&lt;</span>ThreadFactory<span class=\"token operator\">></span> <span class=\"token function\">CreateDefaultThreadFactory</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>        <span class=\"token comment\">// TODO</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">nullptr</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>    <span class=\"token keyword\">static</span> std<span class=\"token double-colon punctuation\">::</span>shared_ptr<span class=\"token operator\">&lt;</span>RejectedExecutionHandler<span class=\"token operator\">></span> <span class=\"token function\">CreateDefaultRejectedHandler</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>        <span class=\"token comment\">// TODO</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">nullptr</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre></pre></td></tr><tr><td data-num=\"72\"></td><td><pre><span class=\"token keyword\">private</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>    <span class=\"token keyword\">int</span> corePoolSize<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>    <span class=\"token keyword\">int</span> maximumPoolSize<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>    <span class=\"token keyword\">long</span> <span class=\"token keyword\">long</span> keepAliveTime<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>    TimeUnit unit<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>    std<span class=\"token double-colon punctuation\">::</span>shared_ptr<span class=\"token operator\">&lt;</span>BlockingQueue<span class=\"token operator\">&lt;</span>ExecutableTask<span class=\"token operator\">></span> <span class=\"token operator\">></span> workQueue<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>    std<span class=\"token double-colon punctuation\">::</span>shared_ptr<span class=\"token operator\">&lt;</span>ThreadFactory<span class=\"token operator\">></span> threadFactory<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>    std<span class=\"token double-colon punctuation\">::</span>shared_ptr<span class=\"token operator\">&lt;</span>RejectedExecutionHandler<span class=\"token operator\">></span> rejectedHandler<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre></pre></td></tr><tr><td data-num=\"83\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endif</span> <span class=\"token comment\">// THREAD_POOL_EXECUTOR_H</span></span></pre></td></tr></table></figure><h2 id=\"åç»­ç« èŠ‚\"><a class=\"anchor\" href=\"#åç»­ç« èŠ‚\">#</a> åç»­ç« èŠ‚</h2>\n<p>åœ¨åç»­ç« èŠ‚ï¼Œæˆ‘ä»¬ä¼šä¾æ¬¡å¯¹ <code>BlockingQueue</code> ã€ <code>ThreadFactory</code> ã€ <code>RejectedExecutionHandler</code>  ç­‰è¿›è¡Œå®ç°ã€‚</p>\n",
            "tags": [
                "æŠ€æœ¯åˆ†äº«",
                "C++",
                "Java",
                "C++",
                "ThreadPool",
                "çº¿ç¨‹æ± "
            ]
        },
        {
            "id": "https://haust-kevin.github.io/2025/03/16/2025-03-understanding-of-shared-from-this/",
            "url": "https://haust-kevin.github.io/2025/03/16/2025-03-understanding-of-shared-from-this/",
            "title": "C++ï¼šæ·±å…¥ç†è§£ std::enable_shared_from_this ä¸ shared_from_this",
            "date_published": "2025-03-16T07:12:32.000Z",
            "content_html": "<h1 id=\"cæ·±å…¥ç†è§£-stdenable_shared_from_this-ä¸-shared_from_this\"><a class=\"anchor\" href=\"#cæ·±å…¥ç†è§£-stdenable_shared_from_this-ä¸-shared_from_this\">#</a> C++ï¼šæ·±å…¥ç†è§£ std::enable_shared_from_this ä¸ shared_from_this</h1>\n<h2 id=\"ä¸ºä»€ä¹ˆä»¥åŠä½•æ—¶ä½¿ç”¨-shared_from_this\"><a class=\"anchor\" href=\"#ä¸ºä»€ä¹ˆä»¥åŠä½•æ—¶ä½¿ç”¨-shared_from_this\">#</a> ä¸ºä»€ä¹ˆä»¥åŠä½•æ—¶ä½¿ç”¨ shared_from_this</h2>\n<h3 id=\"shared_from_this-çš„ä½œç”¨\"><a class=\"anchor\" href=\"#shared_from_this-çš„ä½œç”¨\">#</a> shared_from_this çš„ä½œç”¨</h3>\n<p>åœ¨é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­ï¼Œå¸¸å¸¸éœ€è¦åœ¨å¯¹è±¡çš„æˆå‘˜å‡½æ•°ä¸­è·å–æŒ‡å‘è‡ªèº«çš„æ™ºèƒ½æŒ‡é’ˆï¼Œä»¥ç¡®ä¿å¯¹è±¡åœ¨æŸäº›æ“ä½œï¼ˆç‰¹åˆ«æ˜¯å¼‚æ­¥æ“ä½œï¼‰æœŸé—´çš„ç”Ÿå‘½å‘¨æœŸã€‚ <code>std::enable_shared_from_this</code>  å’Œ  <code>shared_from_this</code>  æ­£æ˜¯ä¸ºäº†è§£å†³è¿™ä¸€éœ€æ±‚è€Œè®¾è®¡ã€‚</p>\n<h3 id=\"ä½¿ç”¨åœºæ™¯\"><a class=\"anchor\" href=\"#ä½¿ç”¨åœºæ™¯\">#</a> ä½¿ç”¨åœºæ™¯</h3>\n<ol>\n<li>å¼‚æ­¥æ“ä½œä¸å›è°ƒå‡½æ•°<br />\nåœ¨æ¶‰åŠå¼‚æ­¥æ“ä½œï¼ˆå¦‚å¼‚æ­¥ I/Oã€å®šæ—¶å™¨ã€çº¿ç¨‹ç­‰ï¼‰æ—¶ï¼Œéœ€è¦ç¡®ä¿å¯¹è±¡åœ¨å¼‚æ­¥æ“ä½œå®Œæˆä¹‹å‰ä¸ä¼šè¢«é”€æ¯ã€‚å¸¸è§çš„åœºæ™¯åŒ…æ‹¬ï¼š</li>\n</ol>\n<ul>\n<li>ç½‘ç»œç¼–ç¨‹ï¼šä½¿ç”¨å¼‚æ­¥ I/O æ“ä½œè¯»å–æˆ–å†™å…¥æ•°æ®ï¼Œéœ€è¦åœ¨å›è°ƒå‡½æ•°ä¸­è®¿é—®å¯¹è±¡çš„æˆå‘˜ã€‚</li>\n<li>å®šæ—¶å™¨å›è°ƒï¼šè®¾ç½®å®šæ—¶å™¨åï¼Œåœ¨å®šæ—¶å™¨è§¦å‘çš„å›è°ƒå‡½æ•°ä¸­éœ€è¦è®¿é—®å¯¹è±¡ã€‚</li>\n<li>çº¿ç¨‹æ± ä¸ä»»åŠ¡è°ƒåº¦ï¼šå°†å¯¹è±¡çš„æˆå‘˜å‡½æ•°ä½œä¸ºä»»åŠ¡æäº¤åˆ°çº¿ç¨‹æ± ï¼Œéœ€è¦ç¡®ä¿å¯¹è±¡åœ¨ä»»åŠ¡æ‰§è¡ŒæœŸé—´å­˜æ´»ã€‚</li>\n</ul>\n<ol start=\"2\">\n<li>é˜²æ­¢å¯¹è±¡è¿‡æ—©é”€æ¯<br />\nå½“å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå¯èƒ½åœ¨å¤–éƒ¨è¢«ç®¡ç†ï¼Œä½†åœ¨å†…éƒ¨éœ€è¦å»¶é•¿è‡ªèº«çš„ç”Ÿå‘½å‘¨æœŸã€‚ä¾‹å¦‚ï¼š</li>\n</ol>\n<ul>\n<li>äº‹ä»¶å‘å¸ƒ - è®¢é˜…æ¨¡å¼ï¼šå¯¹è±¡å‘å¸ƒäº‹ä»¶ï¼Œè®¢é˜…è€…å¯èƒ½å¼‚æ­¥å¤„ç†ï¼Œå‘å¸ƒè€…éœ€è¦ç¡®ä¿åœ¨æ‰€æœ‰è®¢é˜…è€…å¤„ç†å®Œä¹‹å‰ä¸è¢«é”€æ¯ã€‚</li>\n<li>èµ„æºç®¡ç†ç±»ï¼šå¯¹è±¡ç®¡ç†ç€ä¸€äº›èµ„æºï¼Œéœ€è¦åœ¨å¼‚æ­¥æ¸…ç†æˆ–å›æ”¶èµ„æºæ—¶é˜²æ­¢è‡ªèº«è¢«é”€æ¯ã€‚</li>\n</ul>\n<h3 id=\"å¿…è¦æ€§å’Œä¼˜ç‚¹\"><a class=\"anchor\" href=\"#å¿…è¦æ€§å’Œä¼˜ç‚¹\">#</a> å¿…è¦æ€§å’Œä¼˜ç‚¹</h3>\n<ol>\n<li>\n<p>ç¡®ä¿å¯¹è±¡ç”Ÿå‘½å‘¨æœŸçš„å®‰å…¨<br />\nä½¿ç”¨  <code>shared_from_this</code>  å¯ä»¥è·å–åˆ°è‡ªèº«çš„  <code>std::shared_ptr</code> ï¼Œä»è€Œå¢åŠ å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ï¼Œç¡®ä¿å¯¹è±¡åœ¨å¼‚æ­¥æ“ä½œæˆ–å›è°ƒè¿‡ç¨‹ä¸­ä¸ä¼šè¢«é”€æ¯ï¼Œé¿å…å‡ºç°æ‚¬ç©ºæŒ‡é’ˆå’Œæœªå®šä¹‰è¡Œä¸ºã€‚</p>\n</li>\n<li>\n<p>ç®€åŒ–å†…å­˜ç®¡ç†<br />\né€šè¿‡æ™ºèƒ½æŒ‡é’ˆè‡ªåŠ¨ç®¡ç†å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸï¼Œå‡å°‘äº†æ‰‹åŠ¨ç®¡ç†å†…å­˜çš„å¤æ‚æ€§ï¼Œé™ä½äº†å†…å­˜æ³„æ¼å’ŒåŒé‡é‡Šæ”¾çš„é£é™©ã€‚</p>\n</li>\n<li>\n<p>é˜²æ­¢å¤šé‡æ‰€æœ‰æƒé—®é¢˜<br />\nç›´æ¥åœ¨ç±»å†…éƒ¨ä½¿ç”¨  <code>std::shared_ptr(this)</code>  å¯èƒ½å¯¼è‡´å¤šä¸ªç‹¬ç«‹çš„  <code>shared_ptr</code>  ç®¡ç†åŒä¸€å¯¹è±¡ï¼Œé€ æˆå¼•ç”¨è®¡æ•°ä¸ä¸€è‡´ã€‚ <code>std::enable_shared_from_this</code>  ç¡®ä¿äº†æ‰€æœ‰çš„  <code>shared_ptr</code>  å…±äº«åŒä¸€ä¸ªå¼•ç”¨è®¡æ•°ã€‚ä¸‹é¢å†™ä¸€æ®µå‡ºé”™çš„ä»£ç ã€‚</p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">NetCallback</span> <span class=\"token operator\">:</span> <span class=\"token base-clause\"><span class=\"token keyword\">public</span> <span class=\"token class-name\">INetCallback</span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token function\">NetCallback</span><span class=\"token punctuation\">(</span>std<span class=\"token double-colon punctuation\">::</span>weak_ptr<span class=\"token operator\">&lt;</span>NetClient<span class=\"token operator\">></span> client<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token function\">client_</span><span class=\"token punctuation\">(</span>client<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token operator\">~</span><span class=\"token function\">NetCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">default</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token function\">NetChanged</span><span class=\"token punctuation\">(</span>std<span class=\"token double-colon punctuation\">::</span>shared_ptr<span class=\"token operator\">&lt;</span>NetChangedInfo<span class=\"token operator\">></span> info<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">auto</span> client <span class=\"token operator\">=</span> client_<span class=\"token punctuation\">.</span><span class=\"token function\">lock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            client<span class=\"token operator\">-></span><span class=\"token function\">OnNetChanged</span><span class=\"token punctuation\">(</span>info<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">private</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    std<span class=\"token double-colon punctuation\">::</span>weak_ptr<span class=\"token operator\">&lt;</span>NetClient<span class=\"token operator\">></span> client_<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token class-name\">NetClient</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">OnNetChanged</span><span class=\"token punctuation\">(</span>std<span class=\"token double-colon punctuation\">::</span>shared_ptr<span class=\"token operator\">&lt;</span>NetChangedInfo<span class=\"token operator\">></span> info<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token comment\">// do something</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token class-name\">NetClient</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">RegisterCallback</span><span class=\"token punctuation\">(</span>std<span class=\"token double-colon punctuation\">::</span>shared_ptr<span class=\"token operator\">&lt;</span>INetCallback<span class=\"token operator\">></span> callback<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">auto</span> proxy <span class=\"token operator\">=</span> <span class=\"token function\">GetProxy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    proxy<span class=\"token operator\">-></span><span class=\"token function\">RegisterCallback</span><span class=\"token punctuation\">(</span>std<span class=\"token double-colon punctuation\">::</span><span class=\"token generic-function\"><span class=\"token function\">make_shared</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>NetCallback<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token comment\">// è¿™é‡Œ this åº”æ”¹æˆ shared_from_thisï¼Œå¦åˆ™åˆ›å»ºçš„ `std::shared_ptr&lt;NetCallback>` åªæ˜¯ä¸´æ—¶å¯¹è±¡ã€‚</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token comment\">// ä¸´æ—¶ shared_ptr ä¼šåœ¨ææ„å delete å¤–éƒ¨çš„ `NetClient` å¯¹è±¡ã€‚</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n</ol>\n<h3 id=\"ç¤ºä¾‹\"><a class=\"anchor\" href=\"#ç¤ºä¾‹\">#</a> ç¤ºä¾‹</h3>\n<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨  <code>std::enable_shared_from_this</code>  çš„å…¸å‹ç¤ºä¾‹ï¼š</p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;iostream></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;memory></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">AsyncWorker</span> <span class=\"token operator\">:</span> <span class=\"token base-clause\"><span class=\"token keyword\">public</span> std<span class=\"token double-colon punctuation\">::</span><span class=\"token class-name\">enable_shared_from_this</span><span class=\"token operator\">&lt;</span><span class=\"token class-name\">AsyncWorker</span><span class=\"token operator\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">public</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token function\">StartAsyncOperation</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token comment\">// å‡è®¾è¿™æ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œçš„æ¨¡æ‹Ÿ</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        std<span class=\"token double-colon punctuation\">::</span><span class=\"token function\">thread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>sp <span class=\"token operator\">=</span> <span class=\"token function\">shared_from_this</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token comment\">// åœ¨å¼‚æ­¥çº¿ç¨‹ä¸­åˆ›å»ºæ–°çš„ shared_ptrï¼Œç¡®ä¿å¯¹è±¡ä¸è¢«é”€æ¯</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            sp<span class=\"token operator\">-></span><span class=\"token function\">DoWork</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// æ¨¡æ‹Ÿé•¿æ—¶æ“ä½œ</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">detach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token function\">DoWork</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token comment\">// æ‰§è¡Œå®é™…å·¥ä½œ</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        std<span class=\"token double-colon punctuation\">::</span>cout <span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">\"Async work is done.\"</span> <span class=\"token operator\">&lt;&lt;</span> std<span class=\"token double-colon punctuation\">::</span>endl<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">auto</span> worker <span class=\"token operator\">=</span> std<span class=\"token double-colon punctuation\">::</span><span class=\"token generic-function\"><span class=\"token function\">make_shared</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>AsyncWorker<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    worker<span class=\"token operator\">-></span><span class=\"token function\">StartAsyncOperation</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token comment\">// ä¸»çº¿ç¨‹å¯èƒ½åœ¨æ­¤é€€å‡ºï¼Œä½† AsyncWorker å¯¹è±¡ä»ç„¶å­˜æ´»ï¼Œç›´åˆ°å¼‚æ­¥æ“ä½œå®Œæˆ</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token comment\">//shared_ptr ä¸éšå½“å‰çº¿ç¨‹ç»“æŸè€Œææ„</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼š<br />\nå¯èƒ½å‡ºç°çš„é”™è¯¯å†™æ³•ï¼š</p>\n<ul>\n<li>çº¿ç¨‹é€šè¿‡ std::shared_ptr åˆ›å»º shared_ptrï¼Œä¼šå¯¼è‡´å­çº¿ç¨‹ç»“æŸé‡Œé¢é‡Šæ”¾æŒæœ‰çš„å¯¹è±¡ï¼Œä¸»çº¿ç¨‹ä¸­çš„  <code>this</code>  å°±å˜æˆäº†æ‚¬ç©ºæŒ‡é’ˆã€‚<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token function\">StartAsyncOperation</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    std<span class=\"token double-colon punctuation\">::</span><span class=\"token function\">thread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>sp <span class=\"token operator\">=</span> std<span class=\"token double-colon punctuation\">::</span><span class=\"token function\">make_shared</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        sp<span class=\"token operator\">-></span><span class=\"token function\">DoWork</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">detach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n<li>å¦‚æœä¸ä½¿ç”¨  <code>shared_from_this</code> ï¼Œåœ¨  <code>StartAsyncOperation</code>  ä¸­æ•è·  <code>this</code> ï¼Œä¸€æ—¦  <code>worker</code>  åœ¨ä¸»çº¿ç¨‹ä¸­è¶…å‡ºä½œç”¨åŸŸè¢«é”€æ¯ï¼Œå¼‚æ­¥çº¿ç¨‹ä¸­çš„  <code>this</code>  å°±å˜æˆäº†æ‚¬ç©ºæŒ‡é’ˆã€‚<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token function\">StartAsyncOperation</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    std<span class=\"token double-colon punctuation\">::</span><span class=\"token function\">thread</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token keyword\">this</span><span class=\"token operator\">-></span><span class=\"token function\">DoWork</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">detach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"shared_from_this-çš„è¿›é˜¶ç”¨æ³•\"><a class=\"anchor\" href=\"#shared_from_this-çš„è¿›é˜¶ç”¨æ³•\">#</a> shared_from_this çš„è¿›é˜¶ç”¨æ³•</h2>\n<h3 id=\"stdweak_ptr\"><a class=\"anchor\" href=\"#stdweak_ptr\">#</a> std::weak_ptr</h3>\n<p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œéœ€è¦æŒæœ‰å¯¹è±¡çš„å¼±å¼•ç”¨ï¼Œä»¥é¿å…å¾ªç¯å¼•ç”¨å¯¼è‡´çš„å†…å­˜æ³„æ¼ã€‚std::weak_ptr å¯ä»¥ä¸ shared_from_this ç»“åˆä½¿ç”¨ã€‚</p>\n<ul>\n<li>\n<p>è§‚å¯Ÿè€…æ¨¡å¼</p>\n<ul>\n<li>è§‚å¯Ÿè€…æ¨¡å¼æ˜¯åœ¨ subject çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œé€šçŸ¥è§‚å¯Ÿè€…çš„ä¸€ç§è®¾è®¡æ¨¡å¼ã€‚</li>\n<li>åœ¨å¤šæ•°å®ç°ä¸­ï¼Œæ¯ä¸ª subject æŒæœ‰æŒ‡å‘è§‚å¯Ÿè€…çš„æŒ‡é’ˆï¼Œè¿™ä½¿å¾—å½“ subject çŠ¶æ€æ”¹å˜æ—¶å¯ä»¥å¾ˆå®¹æ˜“é€šçŸ¥è§‚å¯Ÿè€…ã€‚</li>\n<li>subject ä¸ä¼šæ§åˆ¶å…¶è§‚å¯Ÿè€…çš„ç”Ÿå­˜æœŸï¼Œå› æ­¤åº”è¯¥æ˜¯æŒæœ‰è§‚å¯Ÿè€…çš„ weak_ptr æŒ‡é’ˆã€‚åŒæ—¶åœ¨ subject çš„ä½¿ç”¨æŸä¸ªæŒ‡é’ˆæ—¶ï¼Œå¯ä»¥å…ˆç¡®å®šæ˜¯å¦ç©ºæ‚¬ã€‚</li>\n</ul>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">Observer</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">virtual</span> <span class=\"token keyword\">void</span> <span class=\"token function\">OnNotify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">Subject</span> <span class=\"token operator\">:</span> <span class=\"token base-clause\"><span class=\"token keyword\">public</span> std<span class=\"token double-colon punctuation\">::</span><span class=\"token class-name\">enable_shared_from_this</span><span class=\"token operator\">&lt;</span><span class=\"token class-name\">Subject</span><span class=\"token operator\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">private</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token function\">Subject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">default</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token operator\">~</span><span class=\"token function\">Subject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">default</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">public</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">static</span> std<span class=\"token double-colon punctuation\">::</span>shared_ptr<span class=\"token operator\">&lt;</span>Subject<span class=\"token operator\">></span> <span class=\"token function\">GetInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">static</span> std<span class=\"token double-colon punctuation\">::</span>shared_ptr<span class=\"token operator\">&lt;</span>Subject<span class=\"token operator\">></span> instance <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> Subject<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token keyword\">return</span> instance<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token function\">AddObserver</span><span class=\"token punctuation\">(</span>std<span class=\"token double-colon punctuation\">::</span>weak_ptr<span class=\"token operator\">&lt;</span>Observer<span class=\"token operator\">></span> observer<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        observers_<span class=\"token punctuation\">.</span><span class=\"token function\">push_back</span><span class=\"token punctuation\">(</span>observer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token function\">NotifyObservers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">auto</span> it <span class=\"token operator\">=</span> observers_<span class=\"token punctuation\">.</span><span class=\"token function\">begin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> it <span class=\"token operator\">!=</span> observers_<span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">auto</span> obs <span class=\"token operator\">=</span> it<span class=\"token operator\">-></span><span class=\"token function\">lock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                obs<span class=\"token operator\">-></span><span class=\"token function\">OnNotify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                <span class=\"token operator\">++</span>it<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                it <span class=\"token operator\">=</span> observers_<span class=\"token punctuation\">.</span><span class=\"token function\">erase</span><span class=\"token punctuation\">(</span>it<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// ç§»é™¤å·²é”€æ¯çš„è§‚å¯Ÿè€…</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token keyword\">private</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    std<span class=\"token double-colon punctuation\">::</span>vector<span class=\"token operator\">&lt;</span>std<span class=\"token double-colon punctuation\">::</span>weak_ptr<span class=\"token operator\">&lt;</span>Observer<span class=\"token operator\">>></span> observers_<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure></li>\n<li>\n<p>å›è°ƒä½¿ç”¨å¤–éƒ¨å¯¹è±¡<br />\nå›è°ƒå‡½æ•°æƒ³ä½¿ç”¨å¤–éƒ¨å¯¹è±¡ï¼Œåˆä¸æƒ³è®©å›è°ƒç±»æŒæœ‰å¤–éƒ¨å¯¹è±¡ï¼Œæ§åˆ¶å¤–éƒ¨å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ</p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">TestClient</span> <span class=\"token operator\">:</span> <span class=\"token base-clause\">std<span class=\"token double-colon punctuation\">::</span><span class=\"token class-name\">enable_shared_from_this</span><span class=\"token operator\">&lt;</span><span class=\"token class-name\">TestClient</span><span class=\"token operator\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">private</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token function\">TestClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">default</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token operator\">~</span><span class=\"token function\">TestClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">default</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">public</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">static</span> std<span class=\"token double-colon punctuation\">::</span>shared_ptr<span class=\"token operator\">&lt;</span>TestClient<span class=\"token operator\">></span> <span class=\"token function\">GetInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token keyword\">static</span> std<span class=\"token double-colon punctuation\">::</span>shared_ptr<span class=\"token operator\">&lt;</span>TestClient<span class=\"token operator\">></span> instance <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> TestClient<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token keyword\">return</span> instance<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token function\">RegisterObserver</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">// å°†è‡ªèº« shared_ptr è½¬æˆ weak_ptrï¼Œè®© TestObserver æŒæœ‰ï¼ŒTestObserver ä¹Ÿä¸ä¼šå½±å“è‡ªèº«çš„ç”Ÿå‘½å‘¨æœŸ</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token class-name\">Subject</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">GetInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">AddObserver</span><span class=\"token punctuation\">(</span>std<span class=\"token double-colon punctuation\">::</span><span class=\"token generic-function\"><span class=\"token function\">make_shared</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>TestObserver<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token function\">shared_from_this</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token function\">HandleChanged</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token comment\">// DoSomething()</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token keyword\">private</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token keyword\">class</span> <span class=\"token class-name\">TestObserver</span> <span class=\"token operator\">:</span> <span class=\"token base-clause\"><span class=\"token keyword\">public</span> <span class=\"token class-name\">Observer</span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token keyword\">public</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token function\">TestObserver</span><span class=\"token punctuation\">(</span>std<span class=\"token double-colon punctuation\">::</span>weak_ptr<span class=\"token operator\">&lt;</span><span class=\"token operator\">></span> client<span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token function\">client_</span><span class=\"token punctuation\">(</span>client<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token operator\">~</span><span class=\"token function\">TestObserver</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">default</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token keyword\">void</span> <span class=\"token function\">OnNotify</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">override</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token keyword\">auto</span> client <span class=\"token operator\">=</span> client_<span class=\"token punctuation\">.</span><span class=\"token function\">lock</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>client <span class=\"token operator\">==</span> <span class=\"token keyword\">nullptr</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>                <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            client<span class=\"token operator\">-></span><span class=\"token function\">HandleChanged</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token keyword\">private</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        std<span class=\"token double-colon punctuation\">::</span>weak_ptr<span class=\"token operator\">&lt;</span>TestClient<span class=\"token operator\">></span> client_<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token class-name\">TestClient</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">GetInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">RegisterObserver</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token class-name\">Subject</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">GetInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">NotifyObservers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"shared_from_this-çš„é™·é˜±\"><a class=\"anchor\" href=\"#shared_from_this-çš„é™·é˜±\">#</a> shared_from_this çš„é™·é˜±</h2>\n<h3 id=\"å¸¸è§é™·é˜±\"><a class=\"anchor\" href=\"#å¸¸è§é™·é˜±\">#</a> å¸¸è§é™·é˜±</h3>\n<ol>\n<li>\n<p>å¯¹è±¡æœªç”± std::shared_ptr ç®¡ç†<br />\né—®é¢˜æè¿°ï¼šå¦‚æœå¯¹è±¡æœªç”±  <code>std::shared_ptr</code>  ç®¡ç†ï¼Œç›´æ¥è°ƒç”¨  <code>shared_from_this()</code>  å°†å¯¼è‡´æœªå®šä¹‰è¡Œä¸ºï¼Œé€šå¸¸ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</p>\n<p>è§£å†³æ–¹æ³•ï¼š</p>\n<ul>\n<li>ç¡®ä¿å¯¹è±¡ç”± std::shared_ptr åˆ›å»ºï¼šå§‹ç»ˆä½¿ç”¨  <code>std::make_shared&lt;T&gt;()</code>  ã€  <code>std::shared_ptr&lt;T&gt;</code>  æ¥åˆ›å»ºå¯¹è±¡ã€‚</li>\n<li>ç¦æ­¢åœ¨æ ˆä¸Šåˆ›å»ºå¯¹è±¡ï¼šé¿å…é€šè¿‡åœ¨æ ˆä¸Šå®šä¹‰å¯¹è±¡çš„æ–¹å¼åˆ›å»ºå®ä¾‹ã€‚</li>\n</ul>\n<p>ç¤ºä¾‹ï¼š</p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">MyClass</span> <span class=\"token operator\">:</span> <span class=\"token base-clause\"><span class=\"token keyword\">public</span> std<span class=\"token double-colon punctuation\">::</span><span class=\"token class-name\">enable_shared_from_this</span><span class=\"token operator\">&lt;</span><span class=\"token class-name\">MyClass</span><span class=\"token operator\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">// ...</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\">// é”™è¯¯ï¼šåœ¨æ ˆä¸Šåˆ›å»ºå¯¹è±¡ï¼Œshared_from_this () å°†å¤±è´¥</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token comment\">// MyClass obj;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token comment\">//auto ptr = obj.shared_from_this (); // æœªå®šä¹‰è¡Œä¸º</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token comment\">// æ­£ç¡®ï¼šä½¿ç”¨ shared_ptr ç®¡ç†å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">auto</span> obj <span class=\"token operator\">=</span> std<span class=\"token double-colon punctuation\">::</span><span class=\"token generic-function\"><span class=\"token function\">make_shared</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>MyClass<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">auto</span> ptr <span class=\"token operator\">=</span> obj<span class=\"token operator\">-></span><span class=\"token function\">shared_from_this</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// å®‰å…¨</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n<li>\n<p>åœ¨æ„é€ å‡½æ•°æˆ–ææ„å‡½æ•°ä¸­è°ƒç”¨  <code>shared_from_this()</code> <br />\n é—®é¢˜æè¿°ï¼šåœ¨å¯¹è±¡çš„æ„é€ å‡½æ•°æˆ–ææ„å‡½æ•°ä¸­è°ƒç”¨  <code>shared_from_this()</code>  æ˜¯ä¸å®‰å…¨çš„ï¼Œå› ä¸ºæ­¤æ—¶å¯¹è±¡å¯èƒ½å°šæœªå®Œå…¨æ„é€ æˆ–å·²å¼€å§‹ææ„ï¼Œ <code>shared_from_this()</code>  å°†å¯¼è‡´æœªå®šä¹‰è¡Œä¸ºã€‚</p>\n<p>è§£å†³æ–¹æ³•ï¼š</p>\n<ul>\n<li>é¿å…åœ¨æ„é€ å‡½æ•°æˆ–ææ„å‡½æ•°ä¸­ä½¿ç”¨  <code>shared_from_this</code> ã€‚</li>\n<li>é¿å…åœ¨æ„é€ å‡½æ•°ä¸­å¼€å¯å¯èƒ½ä¼šè°ƒç”¨  <code>shared_from_this</code>  çš„çº¿ç¨‹ã€‚</li>\n</ul>\n<p>ç¤ºä¾‹ï¼š</p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">MyClass</span> <span class=\"token operator\">:</span> <span class=\"token base-clause\"><span class=\"token keyword\">public</span> std<span class=\"token double-colon punctuation\">::</span><span class=\"token class-name\">enable_shared_from_this</span><span class=\"token operator\">&lt;</span><span class=\"token class-name\">MyClass</span><span class=\"token operator\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token function\">MyClass</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token comment\">// é”™è¯¯ï¼šåœ¨æ„é€ å‡½æ•°ä¸­ä½¿ç”¨ shared_from_this ()</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token comment\">//auto self = shared_from_this (); // æœªå®šä¹‰è¡Œä¸º</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token comment\">// é”™è¯¯ï¼šåœ¨æ„é€ å‡½æ•°ä¸­å¼€å¯ä¼šè°ƒç”¨ shared_from_this () çš„çº¿ç¨‹</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token comment\">// std::thread([this]()&#123; RegisterCallback(); &#125;).detach();</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token operator\">~</span><span class=\"token function\">MyClass</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token comment\">// é”™è¯¯ï¼šåœ¨ææ„å‡½æ•°ä¸­ä½¿ç”¨ shared_from_this ()</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token comment\">//auto self = shared_from_this (); // æœªå®šä¹‰è¡Œä¸º</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token function\">RegisterCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token keyword\">auto</span> self <span class=\"token operator\">=</span> <span class=\"token function\">shared_from_this</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// æ­£ç¡®</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token comment\">// å…¶å®ƒæ“ä½œ</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure></li>\n<li>\n<p>é¿å…æ‰‹åŠ¨ä½¿ç”¨  <code>std::shared_ptr(this)</code> <br />\n é—®é¢˜æè¿°ï¼šåœ¨ç±»å†…éƒ¨é€šè¿‡  <code>std::shared_ptr(this)</code>  æ‰‹åŠ¨æ„é€   <code>shared_ptr</code> ï¼Œä¼šå¯¼è‡´å¤šä¸ª  <code>shared_ptr</code>  åˆ†åˆ«ç®¡ç†åŒä¸€å¯¹è±¡ï¼Œå¼•ç”¨è®¡æ•°ä¸ä¸€è‡´ï¼Œæœ€ç»ˆå¯èƒ½å¯¼è‡´å¯¹è±¡è¢«å¤šæ¬¡åˆ é™¤ã€‚</p>\n<p>è§£å†³æ–¹æ³•ï¼š</p>\n<ul>\n<li>ä½¿ç”¨ shared_from_this () è·å– shared_ptrï¼Œç¡®ä¿æ‰€æœ‰ shared_ptr å…±äº«åŒä¸€ä¸ªå¼•ç”¨è®¡æ•°ã€‚</li>\n</ul>\n<p>ç¤ºä¾‹ï¼š</p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">MyClass</span> <span class=\"token operator\">:</span> <span class=\"token base-clause\"><span class=\"token keyword\">public</span> std<span class=\"token double-colon punctuation\">::</span><span class=\"token class-name\">enable_shared_from_this</span><span class=\"token operator\">&lt;</span><span class=\"token class-name\">MyClass</span><span class=\"token operator\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token function\">StartAsyncOperation</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token comment\">// é”™è¯¯ï¼šæ‰‹åŠ¨æ„é€  shared_ptr</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token comment\">//auto self = std::shared_ptr&lt;MyClass>(this); // ä¸å®‰å…¨</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token comment\">// æ­£ç¡®ï¼šä½¿ç”¨ shared_from_this ()</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token keyword\">auto</span> self <span class=\"token operator\">=</span> <span class=\"token function\">shared_from_this</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token comment\">// ä½¿ç”¨ self è¿›è¡Œå¼‚æ­¥æ“ä½œ</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure></li>\n<li>\n<p>å¾ªç¯å¼•ç”¨å¯¼è‡´å†…å­˜æ³„æ¼<br />\né—®é¢˜æè¿°ï¼šå½“å¯¹è±¡ä¹‹é—´äº’ç›¸æŒæœ‰ std::shared_ptrï¼Œå¯èƒ½å½¢æˆå¾ªç¯å¼•ç”¨ï¼Œå¯¼è‡´å†…å­˜æ— æ³•é‡Šæ”¾ã€‚</p>\n<p>è§£å†³æ–¹æ³•ï¼š</p>\n<ul>\n<li>ä½¿ç”¨ std::weak_ptr æ‰“ç ´å¾ªç¯å¼•ç”¨ï¼šåœ¨ä¸€æ–¹æŒæœ‰å¦ä¸€æ–¹çš„å¼±å¼•ç”¨ï¼Œé˜²æ­¢å¼•ç”¨è®¡æ•°æ— æ³•å½’é›¶ã€‚</li>\n</ul>\n<p>ç¤ºä¾‹ï¼š</p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">Child</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">Parent</span> <span class=\"token operator\">:</span> <span class=\"token base-clause\"><span class=\"token keyword\">public</span> std<span class=\"token double-colon punctuation\">::</span><span class=\"token class-name\">enable_shared_from_this</span><span class=\"token operator\">&lt;</span><span class=\"token class-name\">Parent</span><span class=\"token operator\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    std<span class=\"token double-colon punctuation\">::</span>shared_ptr<span class=\"token operator\">&lt;</span>Child<span class=\"token operator\">></span> child<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">Child</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">public</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    std<span class=\"token double-colon punctuation\">::</span>weak_ptr<span class=\"token operator\">&lt;</span>Parent<span class=\"token operator\">></span> parent<span class=\"token punctuation\">;</span> <span class=\"token comment\">// ä½¿ç”¨ weak_ptr æ‰“ç ´å¾ªç¯</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token function\">createFamily</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">auto</span> parent <span class=\"token operator\">=</span> std<span class=\"token double-colon punctuation\">::</span><span class=\"token generic-function\"><span class=\"token function\">make_shared</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>Parent<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">auto</span> child <span class=\"token operator\">=</span> std<span class=\"token double-colon punctuation\">::</span><span class=\"token generic-function\"><span class=\"token function\">make_shared</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>Child<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    parent<span class=\"token operator\">-></span>child <span class=\"token operator\">=</span> child<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    child<span class=\"token operator\">-></span>parent <span class=\"token operator\">=</span> parent<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token comment\">// å½“ parent å’Œ child è¶…å‡ºä½œç”¨åŸŸæ—¶ï¼Œå†…å­˜å¯ä»¥æ­£ç¡®é‡Šæ”¾</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n</ol>\n<h3 id=\"å°ç»“\"><a class=\"anchor\" href=\"#å°ç»“\">#</a> å°ç»“</h3>\n<p>åœ¨å¤æ‚çš„ç¼–ç¨‹åœºæ™¯ä¸­ï¼Œæ­£ç¡®ä½¿ç”¨  <code>std::enable_shared_from_this</code>  å’Œ  <code>shared_from_this</code>  å¯ä»¥æœ‰æ•ˆåœ°ç®¡ç†å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸï¼Œé˜²æ­¢å†…å­˜æ³„æ¼å’Œæ‚¬ç©ºæŒ‡é’ˆç­‰é—®é¢˜ã€‚ç„¶è€Œï¼Œéœ€è¦æ³¨æ„é¿å…ä¸€äº›å¸¸è§çš„é™·é˜±ï¼Œå¦‚å¯¹è±¡æœªç”±  <code>std::shared_ptr</code>  ç®¡ç†ã€åœ¨æ„é€ å‡½æ•°æˆ–ææ„å‡½æ•°ä¸­è°ƒç”¨  <code>shared_from_this</code>  ç­‰ã€‚</p>\n<h2 id=\"æå‡ä»£ç è´¨é‡å’Œå¯ç»´æŠ¤æ€§\"><a class=\"anchor\" href=\"#æå‡ä»£ç è´¨é‡å’Œå¯ç»´æŠ¤æ€§\">#</a> æå‡ä»£ç è´¨é‡å’Œå¯ç»´æŠ¤æ€§</h2>\n<ol>\n<li>æ˜ç¡®å¯¹è±¡çš„æ‰€æœ‰æƒ</li>\n</ol>\n<ul>\n<li>è°åˆ›å»ºï¼Œè°è´Ÿè´£ç®¡ç†ï¼š ç¡®ä¿å¯¹è±¡çš„åˆ›å»ºè€…è´Ÿè´£å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚</li>\n<li>å‡å°‘éšå¼ä¾èµ–ï¼š é¿å…éšè—çš„å…±äº«ï¼Œä½¿å¯¹è±¡å…³ç³»æ¸…æ™°æ˜äº†ã€‚</li>\n<li>åªæœ‰çœŸæ­£éœ€è¦æ§åˆ¶ç”Ÿå‘½å‘¨æœŸçš„ç±»æ‰éœ€è¦æŒæœ‰ shared_ptr å¯¹è±¡ï¼Œå…¶ä½™ä¸€èˆ¬å»ºè®® weak_ptrã€‚</li>\n</ul>\n<ol start=\"2\">\n<li>åˆç†ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆ</li>\n</ol>\n<ul>\n<li>é€‰æ‹©åˆé€‚çš„æ™ºèƒ½æŒ‡é’ˆç±»å‹ï¼š æ ¹æ®éœ€æ±‚é€‰æ‹© std::shared_ptrã€std::unique_ptrã€std::weak_ptrã€‚</li>\n<li>é¿å…è¿‡åº¦ä½¿ç”¨ shared_ptrï¼š ä¸è¦ä¸ºäº†æ–¹ä¾¿è€Œæ»¥ç”¨ shared_ptrï¼Œå¢åŠ ä¸å¿…è¦çš„æ€§èƒ½å¼€é”€ã€‚</li>\n</ul>\n<ol start=\"3\">\n<li>åŠ å¼ºä»£ç çš„å¯è¯»æ€§</li>\n</ol>\n<ul>\n<li>æ¸…æ™°çš„å‘½åå’Œæ³¨é‡Šï¼š è®©ä»£ç è‡ªè§£é‡Šï¼Œä¾¿äºä»–äººç†è§£ã€‚</li>\n<li>æ¨¡å—åŒ–è®¾è®¡ï¼š å°†ç›¸å…³çš„åŠŸèƒ½å°è£…åœ¨ç±»æˆ–æ¨¡å—ä¸­ï¼Œæé«˜ä»£ç çš„å¤ç”¨æ€§ã€‚</li>\n</ul>\n<h2 id=\"enable_shared_from_this-æºç \"><a class=\"anchor\" href=\"#enable_shared_from_this-æºç \">#</a> enable_shared_from_this æºç </h2>\n<p>ä¸‹é¢æ˜¯  <code>MSVC</code>  çš„  <code>enable_shared_from_this</code>  å®ç°ï¼Œæ³¨é‡Šæ‰äº†æ— å…³ç´§è¦çš„éƒ¨åˆ†ç»†èŠ‚ã€‚</p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">template</span> <span class=\"token operator\">&lt;</span><span class=\"token keyword\">class</span> <span class=\"token class-name\">_Ty</span><span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">enable_shared_from_this</span> <span class=\"token punctuation\">&#123;</span> <span class=\"token comment\">// provide member functions that create shared_ptr to this</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">public</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    shared_ptr<span class=\"token operator\">&lt;</span>_Ty<span class=\"token operator\">></span> <span class=\"token function\">shared_from_this</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token generic-function\"><span class=\"token function\">shared_ptr</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>_Ty<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>_Wptr<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token comment\">// shared_ptr&lt;const _Ty> shared_from_this() const &#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token comment\">//     return shared_ptr&lt;const _Ty>(_Wptr);</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token comment\">// &#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    weak_ptr<span class=\"token operator\">&lt;</span>_Ty<span class=\"token operator\">></span> <span class=\"token function\">weak_from_this</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">noexcept</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token keyword\">return</span> _Wptr<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token comment\">// weak_ptr&lt;const _Ty> weak_from_this() const noexcept &#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token comment\">//     return _Wptr;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token comment\">// &#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token keyword\">protected</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token keyword\">constexpr</span> <span class=\"token function\">enable_shared_from_this</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">noexcept</span> <span class=\"token operator\">:</span> <span class=\"token function\">_Wptr</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token comment\">// enable_shared_from_this(const enable_shared_from_this&amp;) noexcept : _Wptr() &#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token comment\">//     // construct (must value-initialize _Wptr)</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token comment\">// &#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token comment\">// enable_shared_from_this&amp; operator=(const enable_shared_from_this&amp;) noexcept &#123; // assign (must not change _Wptr)</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token comment\">//     return *this;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token comment\">// &#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token comment\">// ~enable_shared_from_this() = default;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token keyword\">private</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token keyword\">template</span> <span class=\"token operator\">&lt;</span><span class=\"token keyword\">class</span> <span class=\"token class-name\">_Yty</span><span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token keyword\">friend</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">shared_ptr</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token keyword\">mutable</span> weak_ptr<span class=\"token operator\">&lt;</span>_Ty<span class=\"token operator\">></span> _Wptr<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>é€šè¿‡ç¼–ç å¯ä»¥çœ‹åˆ°  <code>enable_shared_from_this</code>  åªæ˜¯ä¿å­˜äº†ä¸€ä¸ª <code>weak_ptr</code>  æˆå‘˜ï¼Œæ¯æ¬¡è°ƒç”¨ <code>shared_from_this</code>  æ—¶ï¼Œé€šè¿‡ <code>weak_ptr</code>  æ„é€ å‡ºä¸€ä»½ <code>shared_ptr</code> ï¼Œä»è€Œè¾¾åˆ°ä»å½“å‰å¯¹è±¡è¿”å› <code>shared_ptr</code>  çš„ä½œç”¨ã€‚</p>\n<h2 id=\"æ€»ç»“\"><a class=\"anchor\" href=\"#æ€»ç»“\">#</a> æ€»ç»“</h2>\n<p>std::enable_shared_from_this å’Œ shared_from_this æ˜¯ç°ä»£ C++ ä¸­å¼ºå¤§çš„å·¥å…·ï¼Œèƒ½å¤Ÿåœ¨å¤æ‚çš„å¼‚æ­¥å’Œå¤šçº¿ç¨‹ç¯å¢ƒä¸­å®‰å…¨åœ°ç®¡ç†å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚é€šè¿‡å®é™…é¡¹ç›®ä¸­çš„åº”ç”¨æ¡ˆä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒä»¬åœ¨ç½‘ç»œç¼–ç¨‹ã€GUI å¼€å‘ã€åˆ†å¸ƒå¼ç³»ç»Ÿç­‰é¢†åŸŸçš„å¹¿æ³›åº”ç”¨ã€‚</p>\n<p>åœ¨å®è·µä¸­ï¼Œçµæ´»åœ°è¿ç”¨ shared_from_thisï¼Œç»“åˆè®¾è®¡æ¨¡å¼å’Œå¼‚æ­¥ç¼–ç¨‹æ¡†æ¶ï¼Œå¯ä»¥å¤§å¤§æå‡ä»£ç çš„è´¨é‡å’Œå¯ç»´æŠ¤æ€§ã€‚åŒæ—¶ï¼Œéœ€è¦éµå¾ªæœ€ä½³å®è·µï¼Œé¿å…å¸¸è§çš„é™·é˜±ï¼Œç¡®ä¿ç¨‹åºçš„å¥å£®æ€§ã€‚</p>\n<p>\n\n<!--\n<h2 style=\"color: orange;\">ç»“è¯­</h2>  \n\n<p style=\"color: orange;\">\nåœ¨æˆ‘ä»¬çš„ç¼–ç¨‹å­¦ä¹ ä¹‹æ—…ä¸­ï¼Œç†è§£æ˜¯æˆ‘ä»¬è¿ˆå‘æ›´é«˜å±‚æ¬¡çš„é‡è¦ä¸€æ­¥ã€‚ç„¶è€Œï¼ŒæŒæ¡æ–°æŠ€èƒ½ã€æ–°ç†å¿µï¼Œå§‹ç»ˆéœ€è¦æ—¶é—´å’ŒåšæŒã€‚ä»å¿ƒç†å­¦çš„è§’åº¦çœ‹ï¼Œå­¦ä¹ å¾€å¾€ä¼´éšç€ä¸æ–­çš„è¯•é”™å’Œè°ƒæ•´ï¼Œè¿™å°±åƒæ˜¯æˆ‘ä»¬çš„å¤§è„‘åœ¨é€æ¸ä¼˜åŒ–å…¶è§£å†³é—®é¢˜çš„â€œç®—æ³•â€ã€‚\n</p>\n\n<p style=\"color: orange;\">\nè¿™å°±æ˜¯ä¸ºä»€ä¹ˆå½“æˆ‘ä»¬é‡åˆ°é”™è¯¯ï¼Œæˆ‘ä»¬åº”è¯¥å°†å…¶è§†ä¸ºå­¦ä¹ å’Œè¿›æ­¥çš„æœºä¼šï¼Œè€Œä¸ä»…ä»…æ˜¯å›°æ‰°ã€‚é€šè¿‡ç†è§£å’Œè§£å†³è¿™äº›é—®é¢˜ï¼Œæˆ‘ä»¬ä¸ä»…å¯ä»¥ä¿®å¤å½“å‰çš„ä»£ç ï¼Œæ›´å¯ä»¥æå‡æˆ‘ä»¬çš„ç¼–ç¨‹èƒ½åŠ›ï¼Œé˜²æ­¢åœ¨æœªæ¥çš„é¡¹ç›®ä¸­çŠ¯ç›¸åŒçš„é”™è¯¯ã€‚\n</p>\n-->\n</p>\n",
            "tags": [
                "æŠ€æœ¯åˆ†äº«",
                "C++",
                "C++",
                "IPC",
                "å›è°ƒ",
                "è§‚å¯Ÿè€…æ¨¡å¼",
                "æ™ºèƒ½æŒ‡é’ˆ"
            ]
        },
        {
            "id": "https://haust-kevin.github.io/2025/02/16/2025-02-openharmony-ipc/",
            "url": "https://haust-kevin.github.io/2025/02/16/2025-02-openharmony-ipc/",
            "title": "OpenHarmonyï¼šIPC é€šä¿¡ç¼–ç¨‹èŒƒå¼",
            "date_published": "2025-02-16T14:53:14.000Z",
            "content_html": "<h2 id=\"ç®€ä»‹\"><a class=\"anchor\" href=\"#ç®€ä»‹\">#</a> ç®€ä»‹</h2>\n<p>å¯¹äº OpenHarmony çš„ IPC æ¡†æ¶ï¼Œæ¯ä¸ªéƒ¨ä»¶éƒ½éœ€è¦ç”¨åˆ°ã€‚æœ¬æ–‡å°†ä»‹ç» OpenHarmony çš„è¿›ç¨‹é—´é€šä¿¡åŸç†ï¼Œå¹¶æä¾›ç›¸åº”çš„ä»£ç ç¤ºä¾‹ã€‚<br />\nIPC å’Œ RPC é€šå¸¸é‡‡ç”¨å®¢æˆ·ç«¯ - æœåŠ¡å™¨ï¼ˆClient-Serverï¼‰æ¨¡å‹ï¼Œåœ¨ä½¿ç”¨æ—¶ï¼Œè¯·æ±‚æœåŠ¡çš„ï¼ˆClientï¼‰ä¸€ç«¯è¿›ç¨‹å¯è·å–æä¾›æœåŠ¡ï¼ˆServerï¼‰ä¸€ç«¯æ‰€åœ¨è¿›ç¨‹çš„ä»£ç†ï¼ˆProxyï¼‰ï¼Œå¹¶é€šè¿‡æ­¤ä»£ç†è¯»å†™æ•°æ®æ¥å®ç°è¿›ç¨‹é—´çš„æ•°æ®é€šä¿¡ã€‚<br />\n<img data-src=\"https://cdn.jsdelivr.net/gh/haust-Kevin/static@master/images/20250217000734143.png\" alt=\"\" /></p>\n<h2 id=\"å¼€å‘æ­¥éª¤\"><a class=\"anchor\" href=\"#å¼€å‘æ­¥éª¤\">#</a> å¼€å‘æ­¥éª¤</h2>\n<h3 id=\"iservice\"><a class=\"anchor\" href=\"#iservice\">#</a> iService</h3>\n<p>å®šä¹‰ IPC æ¥å£ç±»ï¼Œè¡¨ç¤º IPC æä¾›çš„åŠŸèƒ½ã€‚<br />\nç»§æ‰¿ <code>IRemoteBroker</code> ï¼Œä¸”é€šè¿‡ <code>DECLARE_INTERFACE_DESCRIPTOR</code>  å®šä¹‰æè¿°ç¬¦ã€‚<br />\næä¾›çš„ IPC ä¸šåŠ¡å‡½æ•°å†™æˆçº¯è™šå‡½æ•°ã€‚ä¸šåŠ¡å‡½æ•°åœ¨ Proxy ç«¯å’Œ Stub ç«¯éƒ½éœ€è¦å®ç°ã€‚</p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">ITestAbility</span> <span class=\"token operator\">:</span> <span class=\"token base-clause\"><span class=\"token keyword\">public</span> <span class=\"token class-name\">IRemoteBroker</span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token function\">DECLARE_INTERFACE_DESCRIPTOR</span><span class=\"token punctuation\">(</span>u<span class=\"token string\">\"test.ITestAbility\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">virtual</span> <span class=\"token keyword\">int</span> <span class=\"token function\">TestPingAbility</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> std<span class=\"token double-colon punctuation\">::</span>u16string <span class=\"token operator\">&amp;</span>dummy<span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// å®šä¹‰ä¸šåŠ¡å‡½æ•°</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h3 id=\"proxy\"><a class=\"anchor\" href=\"#proxy\">#</a> Proxy</h3>\n<p>proxy æ˜¯åœ¨ Client ä¾§è´Ÿè´£ä¸ Service ä¾§è¿›è¡Œé€šä¿¡çš„ä¸­é—´ç±»ã€‚ä¸»è¦è´Ÿè´£å°† Client çš„æ•°æ®è¿›è¡Œç¼–ç å‘é€åˆ° Service ä¾§çš„ Stubã€‚<br />\nproxy éœ€è¦ç»§æ‰¿  <code>IRemoteProxy&lt;ITestAbility&gt;</code> ï¼Œå…¶ä¸­æ¨¡æ¿å‚æ•°ä¸ºæˆ‘ä»¬ä¸Šä¸€æ­¥å®šä¹‰çš„æ¥å£ç±»ã€‚<br />\nproxy éœ€è¦åŒ…å«ä¸€ä¸ª <code>BrokerDelegator&lt;TestAbilityProxy&gt;</code>  çš„é™æ€æˆå‘˜ï¼Œè‡ªåŠ¨æ¥ç®¡æˆ‘ä»¬çš„åŠŸèƒ½ï¼Œè€Œä¸éœ€è¦æ‰‹åŠ¨æ³¨å†Œã€‚<br />\nproxy é€šè¿‡ <code>SendRequest</code>  å°†  <code>IPC_CODE</code>  å’Œå°è£…å¥½çš„å‚æ•° å‘åˆ° Service ç«¯çš„ Stubã€‚</p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">TestAbilityProxy</span> <span class=\"token operator\">:</span> <span class=\"token base-clause\"><span class=\"token keyword\">public</span> <span class=\"token class-name\">IRemoteProxy</span><span class=\"token operator\">&lt;</span><span class=\"token class-name\">ITestAbility</span><span class=\"token operator\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">explicit</span> <span class=\"token function\">TestAbilityProxy</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> sptr<span class=\"token operator\">&lt;</span>IRemoteObject<span class=\"token operator\">></span> <span class=\"token operator\">&amp;</span>impl<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">int</span> <span class=\"token function\">TestPingService</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> std<span class=\"token double-colon punctuation\">::</span>u16string <span class=\"token operator\">&amp;</span>dummy<span class=\"token punctuation\">)</span> <span class=\"token keyword\">override</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">private</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">static</span> <span class=\"token keyword\">inline</span> BrokerDelegator<span class=\"token operator\">&lt;</span>TestAbilityProxy<span class=\"token operator\">></span> delegator_<span class=\"token punctuation\">;</span> <span class=\"token comment\">// æ–¹ä¾¿åç»­ä½¿ç”¨ iface_cast å®</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token class-name\">TestAbilityProxy</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">TestAbilityProxy</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> sptr<span class=\"token operator\">&lt;</span>IRemoteObject<span class=\"token operator\">></span> <span class=\"token operator\">&amp;</span>impl<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token operator\">:</span> <span class=\"token generic-function\"><span class=\"token function\">IRemoteProxy</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>ITestAbility<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>impl<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token class-name\">TestAbilityProxy</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">TestPingService</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> std<span class=\"token double-colon punctuation\">::</span>u16string <span class=\"token operator\">&amp;</span>dummy<span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    MessageOption option<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    MessageParcel dataParcel<span class=\"token punctuation\">,</span> replyParcel<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    dataParcel<span class=\"token punctuation\">.</span><span class=\"token function\">WriteString16</span><span class=\"token punctuation\">(</span>dummy<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token keyword\">int</span> error <span class=\"token operator\">=</span> <span class=\"token function\">Remote</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">SendRequest</span><span class=\"token punctuation\">(</span>TRANS_ID_PING_ABILITY<span class=\"token punctuation\">,</span> dataParcel<span class=\"token punctuation\">,</span> replyParcel<span class=\"token punctuation\">,</span> option<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">int</span> result <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>error <span class=\"token operator\">==</span> ERR_NONE<span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> replyParcel<span class=\"token punctuation\">.</span><span class=\"token function\">ReadInt32</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">:</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">return</span> result<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"stub\"><a class=\"anchor\" href=\"#stub\">#</a> Stub</h3>\n<p>Stub ä½œä¸ºæ¥æ”¶è¯·æ±‚çš„ä¸€ç«¯ï¼Œéœ€é‡å†™ OnRemoteRequest æ–¹æ³•ç”¨äºæ¥æ”¶å®¢æˆ·ç«¯è°ƒç”¨ã€‚å¯ä»¥é€šè¿‡å‘ <code>reply</code>  å†™æ•°æ®ï¼Œç›´æ¥å›ä¼ æ•°æ®ã€‚<br />\nå¯ä»¥çœ‹åˆ° Stub ä¹Ÿç»§æ‰¿äº† ITestAbilityï¼Œæ‰€ä»¥ Stub ä¹Ÿå¯ä»¥é‡å†™ TestPingAbility çš„æ–¹æ³•ã€‚</p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">TestAbilityStub</span> <span class=\"token operator\">:</span> <span class=\"token base-clause\"><span class=\"token keyword\">public</span> <span class=\"token class-name\">IRemoteStub</span><span class=\"token operator\">&lt;</span><span class=\"token class-name\">ITestAbility</span><span class=\"token operator\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span><span class=\"token operator\">:</span>    </pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">virtual</span> <span class=\"token keyword\">int</span> <span class=\"token function\">OnRemoteRequest</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">uint32_t</span> code<span class=\"token punctuation\">,</span> MessageParcel <span class=\"token operator\">&amp;</span>data<span class=\"token punctuation\">,</span> MessageParcel <span class=\"token operator\">&amp;</span>reply<span class=\"token punctuation\">,</span> MessageOption <span class=\"token operator\">&amp;</span>option<span class=\"token punctuation\">)</span> <span class=\"token keyword\">override</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">int</span> <span class=\"token function\">TestPingAbility</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> std<span class=\"token double-colon punctuation\">::</span>u16string <span class=\"token operator\">&amp;</span>dummy<span class=\"token punctuation\">)</span> <span class=\"token keyword\">override</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//stub å¯ä»¥ä¸å®ç°</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token class-name\">TestServiceStub</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">OnRemoteRequest</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">uint32_t</span> code<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    MessageParcel <span class=\"token operator\">&amp;</span>data<span class=\"token punctuation\">,</span> MessageParcel <span class=\"token operator\">&amp;</span>reply<span class=\"token punctuation\">,</span> MessageOption <span class=\"token operator\">&amp;</span>option<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>code<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">case</span> TRANS_ID_PING_ABILITY<span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        std<span class=\"token double-colon punctuation\">::</span>u16string dummy <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span><span class=\"token function\">ReadString16</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">int</span> result <span class=\"token operator\">=</span> <span class=\"token function\">TestPingAbility</span><span class=\"token punctuation\">(</span>dummy<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        reply<span class=\"token punctuation\">.</span><span class=\"token function\">WriteInt32</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">default</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token class-name\">IPCObjectStub</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">OnRemoteRequest</span><span class=\"token punctuation\">(</span>code<span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">,</span> reply<span class=\"token punctuation\">,</span> option<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"service\"><a class=\"anchor\" href=\"#service\">#</a> Service</h3>\n<p>æœ¬è´¨ä¸Š Service å°±æ˜¯ä¸€ä¸ª Stubï¼Œåªä¸è¿‡ä¸€èˆ¬ä¼šæŠŠä¸šåŠ¡å’Œ IPC å¤„ç†åˆ†ç¦»ï¼Œä¸šåŠ¡å†™åœ¨ Service é‡Œï¼Œç¼–è§£ç ç›¸å…³çš„ IPC å†™åœ¨ Stub ä¸­ã€‚å®ç°ä¸šåŠ¡ä¸ IPC è§£è€¦ã€‚<br />\nService ä¼šå®ç° æ¥å£ç±»çš„æ‰€æœ‰ä¸šåŠ¡å‡½æ•°ã€‚</p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">TestAbility</span> <span class=\"token operator\">:</span> <span class=\"token base-clause\"><span class=\"token keyword\">public</span> <span class=\"token class-name\">TestAbilityStub</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">public</span> <span class=\"token class-name\">SystemAbility</span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">public</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">int</span> <span class=\"token function\">TestPingAbility</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> std<span class=\"token double-colon punctuation\">::</span>u16string <span class=\"token operator\">&amp;</span>dummy<span class=\"token punctuation\">)</span> <span class=\"token keyword\">override</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token class-name\">TestAbility</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">TestPingAbility</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> std<span class=\"token double-colon punctuation\">::</span>u16string <span class=\"token operator\">&amp;</span>dummy<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure>",
            "tags": [
                "OpenHarmony",
                "C++",
                "OpenHarmony",
                "é¸¿è’™",
                "IPC"
            ]
        },
        {
            "id": "https://haust-kevin.github.io/2025/01/26/2025-01-singleton-in-so/",
            "url": "https://haust-kevin.github.io/2025/01/26/2025-01-singleton-in-so/",
            "title": "å•ä¾‹æ¨¡å¼çš„é™·é˜±",
            "date_published": "2025-01-25T16:09:55.000Z",
            "content_html": "<p>æœ€è¿‘åœ¨å†™ä»£ç æ—¶å‘ç°äº†ä¸€ä¸ªå¾ˆå¥‡æ€ªçš„ç°è±¡ï¼Œå•ä¾‹æ¨¡å¼ç”Ÿæˆçš„å•ä¾‹å®ä¾‹åœ¨åŒä¸€è¿›ç¨‹ä¸­å‡ºç°äº†å¤šæ¬¡ã€‚åœ¨æ­¤è®°å½•ä¸€ä¸‹ã€‚</p>\n<p>ä¸‹é¢æ˜¯æˆ‘å¤ç°çš„ä»£ç ï¼Œä¹Ÿå¯ä»¥ç›´æ¥åœ¨æˆ‘çš„ä»“åº“è¿›è¡Œä¸‹è½½</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRlZS5jb20vbGl0dGxlLXN3ZWV0LWNvb2tpZS9zaW5nbGV0b25fc29fdGVzdA==\">gitee</span></p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">git</span> clone https://gitee.com/little-sweet-cookie/singleton_so_test.git</pre></td></tr></table></figure><p>ä»£ç åŒ…æ‹¬äº”ä¸ªä»£ç æ–‡ä»¶å’Œä¸€ä¸ª makefile æ–‡ä»¶</p>\n<ul>\n<li><code>handler.h</code></li>\n<li><code>main.cc</code></li>\n<li><code>service_a.cc</code></li>\n<li><code>service_b.cc</code></li>\n<li><code>singleton.h</code></li>\n<li><code>makefile</code></li>\n</ul>\n<p>éœ€è¦çš„å•ä¾‹å®ä¾‹ï¼Œä½¿ç”¨å•ä¾‹æ¨¡æ¿å®ç°å•ä¾‹æ¨¡å¼</p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// handler.h</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">ifndef</span> <span class=\"token expression\">HANDLER_H</span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">HANDLER_H</span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">\"singleton.h\"</span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;iostream></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">Handler</span>  <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">public</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token function\">show</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        std<span class=\"token double-colon punctuation\">::</span>cout <span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">\"Handler::instance \"</span> <span class=\"token operator\">&lt;&lt;</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">long</span> <span class=\"token keyword\">long</span><span class=\"token punctuation\">)</span><span class=\"token keyword\">this</span> <span class=\"token operator\">&lt;&lt;</span> std<span class=\"token double-colon punctuation\">::</span>endl<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endif</span> <span class=\"token comment\">// !HANDLER_H</span></span></pre></td></tr></table></figure><p>å•ä¾‹æ¨¡æ¿</p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// singleton.h</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">ifndef</span> <span class=\"token expression\">SINGLETON_H</span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">SINGLETON_H</span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;memory></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">template</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">typename</span> <span class=\"token class-name\">T</span><span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">Singleton</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">public</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">static</span> std<span class=\"token double-colon punctuation\">::</span>shared_ptr<span class=\"token operator\">&lt;</span>T<span class=\"token operator\">></span> <span class=\"token function\">GetInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>instance <span class=\"token operator\">==</span> <span class=\"token keyword\">nullptr</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            instance <span class=\"token operator\">=</span> std<span class=\"token double-colon punctuation\">::</span><span class=\"token generic-function\"><span class=\"token function\">make_shared</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>T<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token keyword\">return</span> instance<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token function\">Singleton</span><span class=\"token punctuation\">(</span>T<span class=\"token operator\">&amp;&amp;</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">delete</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token function\">Singleton</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> T<span class=\"token operator\">&amp;</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">delete</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token keyword\">operator</span><span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> T<span class=\"token operator\">&amp;</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">delete</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token keyword\">protected</span><span class=\"token operator\">:</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token function\">Singleton</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">default</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token keyword\">virtual</span> <span class=\"token operator\">~</span><span class=\"token function\">Singleton</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">default</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token keyword\">static</span> std<span class=\"token double-colon punctuation\">::</span>shared_ptr<span class=\"token operator\">&lt;</span>T<span class=\"token operator\">></span> instance<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token keyword\">template</span><span class=\"token operator\">&lt;</span><span class=\"token keyword\">typename</span> <span class=\"token class-name\">T</span><span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>std<span class=\"token double-colon punctuation\">::</span>shared_ptr<span class=\"token operator\">&lt;</span>T<span class=\"token operator\">></span> Singleton<span class=\"token operator\">&lt;</span>T<span class=\"token operator\">></span><span class=\"token double-colon punctuation\">::</span>instance<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">endif</span> <span class=\"token comment\">// !SINGLETON_H</span></span></pre></td></tr></table></figure><p>ä¸šåŠ¡ A</p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// service_a.cc</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;iostream></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">\"handler.h\"</span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">\"singleton.h\"</span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">extern</span> <span class=\"token string\">\"C\"</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token function\">show_service_a</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token class-name\">Singleton</span><span class=\"token operator\">&lt;</span>Handler<span class=\"token operator\">></span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">GetInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">show</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    std<span class=\"token double-colon punctuation\">::</span>cout <span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">\"aaa\"</span> <span class=\"token operator\">&lt;&lt;</span> std<span class=\"token double-colon punctuation\">::</span>endl<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span> </pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ä¸šåŠ¡ B</p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// service_b.cc</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;iostream></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">\"handler.h\"</span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">\"singleton.h\"</span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">extern</span> <span class=\"token string\">\"C\"</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token function\">show_service_b</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token class-name\">Singleton</span><span class=\"token operator\">&lt;</span>Handler<span class=\"token operator\">></span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">GetInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">show</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    std<span class=\"token double-colon punctuation\">::</span>cout <span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">\"bbb\"</span> <span class=\"token operator\">&lt;&lt;</span> std<span class=\"token double-colon punctuation\">::</span>endl<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ä¸»å‡½æ•°</p>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// main.cc</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;dlfcn.h></span> </span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;iostream></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">\"handler.h\"</span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token function\">show_main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token class-name\">Singleton</span><span class=\"token operator\">&lt;</span>Handler<span class=\"token operator\">></span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">GetInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token function\">show</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    std<span class=\"token double-colon punctuation\">::</span>cout <span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">\"main\"</span> <span class=\"token operator\">&lt;&lt;</span> std<span class=\"token double-colon punctuation\">::</span>endl<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">int</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token function\">show_main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token operator\">*</span> handle<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">using</span> func <span class=\"token operator\">=</span> <span class=\"token keyword\">void</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">*</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    handle <span class=\"token operator\">=</span> <span class=\"token function\">dlopen</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"lib_service_a.so\"</span><span class=\"token punctuation\">,</span> RTLD_LAZY<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    func show_service_a <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>func<span class=\"token punctuation\">)</span><span class=\"token function\">dlsym</span><span class=\"token punctuation\">(</span>handle<span class=\"token punctuation\">,</span> <span class=\"token string\">\"show_service_a\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  </pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token function\">show_service_a</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    handle <span class=\"token operator\">=</span> <span class=\"token function\">dlopen</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"lib_service_b.so\"</span><span class=\"token punctuation\">,</span> RTLD_LAZY<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    func show_service_b <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>func<span class=\"token punctuation\">)</span><span class=\"token function\">dlsym</span><span class=\"token punctuation\">(</span>handle<span class=\"token punctuation\">,</span> <span class=\"token string\">\"show_service_b\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  </pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token function\">show_service_b</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>Makefile æ–‡ä»¶</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>// makefile</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>service_a_so:service_a.cc</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\tg++ <span class=\"token parameter variable\">-fPIC</span> <span class=\"token parameter variable\">-shared</span> service_a.cc <span class=\"token parameter variable\">-o</span> lib_service_a.so</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>service_b_so:service_b.cc</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\tg++ <span class=\"token parameter variable\">-fPIC</span> <span class=\"token parameter variable\">-shared</span> service_b.cc <span class=\"token parameter variable\">-o</span> lib_service_b.so</pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>main_so:main.cc</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\tg++ <span class=\"token parameter variable\">-fPIC</span> <span class=\"token parameter variable\">-shared</span> main.cc <span class=\"token parameter variable\">-o</span> lib_main.so</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>clean:</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t<span class=\"token function\">rm</span> <span class=\"token parameter variable\">-f</span> main.out lib_main.so</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t<span class=\"token function\">rm</span> <span class=\"token parameter variable\">-f</span> lib_service_a.so</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t<span class=\"token function\">rm</span> <span class=\"token parameter variable\">-f</span> lib_service_b.so</pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>all:clean service_a_so service_b_so main.cc</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\tg++ main.cc <span class=\"token parameter variable\">-o</span> main.out -Wl,-rpath<span class=\"token operator\">=</span>./</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t./main.out</pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>all_so:clean service_a_so service_b_so main_so</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t\tg++ lib_main.so <span class=\"token parameter variable\">-o</span> main.out -Wl,-rpath<span class=\"token operator\">=</span>./</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t./main.out</pre></td></tr></table></figure><p>è¯¡å¼‚ç°è±¡</p>\n<ol>\n<li>å½“æˆ‘ä½¿ç”¨  <code>make all</code>  æ—¶ï¼Œç»“æœå¦‚ä¸‹<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cookie@cookie-VirtualBox:~/repo/test_singleton$ <span class=\"token function\">make</span> all</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">rm</span> <span class=\"token parameter variable\">-f</span> main.out lib_main.so</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">rm</span> <span class=\"token parameter variable\">-f</span> lib_service_a.so</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">rm</span> <span class=\"token parameter variable\">-f</span> lib_service_b.so</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>g++ <span class=\"token parameter variable\">-fPIC</span> <span class=\"token parameter variable\">-shared</span> service_a.cc <span class=\"token parameter variable\">-o</span> lib_service_a.so</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>g++ <span class=\"token parameter variable\">-fPIC</span> <span class=\"token parameter variable\">-shared</span> service_b.cc <span class=\"token parameter variable\">-o</span> lib_service_b.so</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>g++ main.cc <span class=\"token parameter variable\">-o</span> main.out -Wl,-rpath<span class=\"token operator\">=</span>./</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>./main.out</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>Handler::instance <span class=\"token number\">102966796923584</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>main</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>Handler::instance <span class=\"token number\">102966796926512</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>aaa</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>Handler::instance <span class=\"token number\">102966796926512</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>bbb</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>cookie@cookie-VirtualBox:~/repo/test_singleton$</pre></td></tr></table></figure></li>\n<li>å½“æˆ‘ä½¿ç”¨  <code>make all_so</code>  æ—¶ï¼Œç»“æœå¦‚ä¸‹<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">rm</span> <span class=\"token parameter variable\">-f</span> main.out lib_main.so</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">rm</span> <span class=\"token parameter variable\">-f</span> lib_service_a.so</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">rm</span> <span class=\"token parameter variable\">-f</span> lib_service_b.so</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>g++ <span class=\"token parameter variable\">-fPIC</span> <span class=\"token parameter variable\">-shared</span> service_a.cc <span class=\"token parameter variable\">-o</span> lib_service_a.so</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>g++ <span class=\"token parameter variable\">-fPIC</span> <span class=\"token parameter variable\">-shared</span> service_b.cc <span class=\"token parameter variable\">-o</span> lib_service_b.so</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>g++ <span class=\"token parameter variable\">-fPIC</span> <span class=\"token parameter variable\">-shared</span> main.cc <span class=\"token parameter variable\">-o</span> lib_main.so</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>g++ lib_main.so <span class=\"token parameter variable\">-o</span> main.out -Wl,-rpath<span class=\"token operator\">=</span>./</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>./main.out</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>Handler::instance <span class=\"token number\">94236187448000</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>main</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>Handler::instance <span class=\"token number\">94236187448000</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>aaa</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>Handler::instance <span class=\"token number\">94236187448000</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>bbb</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>cookie@cookie-VirtualBox:~/repo/test_singleton$</pre></td></tr></table></figure></li>\n</ol>\n<p>å¯ä»¥çœ‹åˆ°ï¼Œ <code>make all</code>  æ—¶ï¼Œä¼šç”Ÿæˆä¸¤ä¸ªä¸åŒçš„å•ä¾‹ï¼Œä¸šåŠ¡ A ä¸ ä¸šåŠ¡ B ä¸ºåŒä¸€ä¸ªå®ä¾‹ï¼Œmain ä¸ºå¦ä¸€ä¸ªå®ä¾‹ã€‚<br />\nè€Œä½¿ç”¨  <code>make all_so</code>  æ—¶ï¼Œæ‰€æœ‰ so ä¸­çš„å•ä¾‹éƒ½æ˜¯åŒä¸€ä¸ªå®ä¾‹ã€‚</p>\n",
            "tags": [
                "æŠ€æœ¯åˆ†äº«",
                "C++",
                "Linux",
                "å•ä¾‹æ¨¡å¼",
                "C++",
                "åŠ¨æ€é“¾æ¥"
            ]
        },
        {
            "id": "https://haust-kevin.github.io/2025/01/19/2025-01-rust-init-env/",
            "url": "https://haust-kevin.github.io/2025/01/19/2025-01-rust-init-env/",
            "title": "Rustï¼šç¯å¢ƒæ­å»º",
            "date_published": "2025-01-19T12:29:28.000Z",
            "content_html": "<div class=\"note primary\">\n<p>æœ¬ç¯‡æ–‡ç« æŒ‡å¯¼æ­å»º Rust å¼€å‘ç¯å¢ƒã€‚é€šè¿‡æœ¬æ–‡å­¦ä¹ ï¼Œä½ å¯ä»¥ä½¿ç”¨é›†æˆ IDE è¿›è¡Œ Rust ç¼–ç¨‹ã€‚æœ¬æ–‡åŒ…æ‹¬ï¼š</p>\n<ol>\n<li>å®‰è£… rustup å·¥å…·é“¾</li>\n<li>å®‰è£… RustRover é›†æˆ IDE</li>\n</ol>\n</div>\n<h2 id=\"å®‰è£…-rust\"><a class=\"anchor\" href=\"#å®‰è£…-rust\">#</a> å®‰è£… Rust</h2>\n<h3 id=\"å®‰è£…-rustup-ç®¡ç†å·¥å…·é“¾\"><a class=\"anchor\" href=\"#å®‰è£…-rustup-ç®¡ç†å·¥å…·é“¾\">#</a> å®‰è£… rustup ç®¡ç†å·¥å…·é“¾</h3>\n<p>åœ¨è¿›è¡Œ Rust å¼€å‘å‰ä½ éœ€è¦å®‰è£… Rust å¼€å‘å¿…å¤‡çš„å·¥å…·é“¾ã€‚<br />\nä¸‹è½½åœ°å€ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucnVzdC1sYW5nLm9yZy96aC1DTi90b29scy9pbnN0YWxs\">rustup-init</span><br />\n ä¸‹è½½åï¼Œæ‰§è¡Œæ–‡ä»¶  <code>rustup-init.exe</code> ï¼Œåœ¨å¼¹å‡ºçš„çª—å£è¾“å…¥  <code>1</code>  å¹¶æŒ‰å›è½¦ã€‚ç­‰å¾…è„šæœ¬æ‰§è¡Œå®Œå³å¯ã€‚<br />\n<img data-src=\"https://cdn.jsdelivr.net/gh/haust-Kevin/static@master/images/20250119204327593.png\" alt=\"å›¾ç‰‡\" /></p>\n<h3 id=\"å®‰è£…-rustrover\"><a class=\"anchor\" href=\"#å®‰è£…-rustrover\">#</a> å®‰è£… RustRover</h3>\n<p>å·¥æ¬²å–„å…¶äº‹å¿…å…ˆåˆ©å…¶å™¨ï¼Œä½ éœ€è¦ä½¿ç”¨ä¸“ä¸šçš„ IDE è¿›è¡Œä»£ç å¼€å‘ï¼Œå¦åˆ™ä½¿ç”¨ Rust ç¼–ç¨‹æ˜¯éå¸¸ç—›è‹¦çš„äº‹ï¼ŒRust æœ€éš¾çš„å°±æ˜¯é€šè¿‡ç¼–è¯‘ï¼Œæ²¡æœ‰ IDE çš„é™æ€æ£€æŸ¥ï¼Œä½ å°†åœ¨ç¼–è¯‘ä¸Šæµªè´¹è®¸å¤šæ—¶é—´ã€‚å¯ä»¥ä½¿ç”¨ vscode å®‰è£…æ’ä»¶è¾¾åˆ° IDE çš„æ•ˆæœï¼Œä½†æˆ‘æ¨èä½¿ç”¨ RustRoverã€‚<br />\nä¸‹è½½åœ°å€ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuamV0YnJhaW5zLmNvbS9ydXN0Lw==\">Jetbrains RustRover</span><br />\n é€‰æ‹©ä¸ªäººéå•†ç”¨å³å¯ä½¿ç”¨ã€‚</p>\n<h2 id=\"enjoy-rust\"><a class=\"anchor\" href=\"#enjoy-rust\">#</a> Enjoy Rust</h2>\n",
            "tags": [
                "ç¯å¢ƒæ­å»º",
                "Rust",
                "RustRover"
            ]
        },
        {
            "id": "https://haust-kevin.github.io/2024/04/27/2024-04-leetcode-permutation-sequence/",
            "url": "https://haust-kevin.github.io/2024/04/27/2024-04-leetcode-permutation-sequence/",
            "title": "LeetCodeï¼š60. æ’åˆ—åºåˆ—",
            "date_published": "2024-04-27T14:03:28.000Z",
            "content_html": "<p>åŸé¢˜é“¾æ¥ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9sZWV0Y29kZS5jbi9wcm9ibGVtcy9wZXJtdXRhdGlvbi1zZXF1ZW5jZS9kZXNjcmlwdGlvbi8=\">60. æ’åˆ—åºåˆ—</span><br />\néš¾åº¦åˆ†ç±»ï¼š<font color=red>Hard</font></p>\n<h2 id=\"problem\"><a class=\"anchor\" href=\"#problem\">#</a> Problem</h2>\n<p>ç»™å‡ºé›†åˆ [1,2,3,...,n]ï¼Œå…¶æ‰€æœ‰å…ƒç´ å…±æœ‰ n! ç§æ’åˆ—ã€‚</p>\n<p>æŒ‰å¤§å°é¡ºåºåˆ—å‡ºæ‰€æœ‰æ’åˆ—æƒ…å†µï¼Œå¹¶ä¸€ä¸€æ ‡è®°ï¼Œå½“ n = 3 æ—¶ï¼Œæ‰€æœ‰æ’åˆ—å¦‚ä¸‹ï¼š</p>\n<p>&quot;123&quot;<br />\n&quot;132&quot;<br />\n&quot;213&quot;<br />\n&quot;231&quot;<br />\n&quot;312&quot;<br />\n&quot;321&quot;<br />\n ç»™å®š n å’Œ kï¼Œè¿”å›ç¬¬ k ä¸ªæ’åˆ—ã€‚</p>\n<p><strong>Examples</strong></p>\n<ul>\n<li>\n<p>ç¤ºä¾‹ 1ï¼š<br />\nè¾“å…¥ï¼šn = 3, k = 3<br />\n è¾“å‡ºï¼š&quot;213&quot;</p>\n</li>\n<li>\n<p>ç¤ºä¾‹ 2ï¼š<br />\nè¾“å…¥ï¼šn = 4, k = 9<br />\n è¾“å‡ºï¼š&quot;2314&quot;</p>\n</li>\n<li>\n<p>ç¤ºä¾‹ 3ï¼š<br />\nè¾“å…¥ï¼šn = 3, k = 1<br />\n è¾“å‡ºï¼š&quot;123&quot;</p>\n</li>\n</ul>\n<h2 id=\"approach\"><a class=\"anchor\" href=\"#approach\">#</a> Approach</h2>\n<p>ä¾‹å¦‚ï¼š  <code>n = 6, k = 373</code> <br />\n åˆå§‹åŒ–æ•°ç»„  <code>remain = [1, 2, 3, 4, 5, 6]</code> ;<br />\n é¦–å…ˆåº”è¯¥æ˜ç™½ï¼Œä»¥ <strong>1</strong> å¼€å¤´çš„å…¨æ’åˆ—æœ‰  <code>5!</code>  ä¸ªï¼Œä»¥ <strong>2</strong> å¼€å¤´çš„å…¨æ’åˆ—æœ‰  <code>5!</code>  ä¸ª â€¦â€¦ å…±  <code>5! âˆ— 6 = 6!</code>  ä¸ªï¼›</p>\n<ol>\n<li>æ•… k = 373 æ—¶ï¼Œå…¨æ’åˆ—çš„ç¬¬ä¸€ä¸ªæ•°å­—åº”è¯¥æ˜¯  <code>remain[k / 5!] = 4</code> ;</li>\n<li>æ•°ç»„åˆ é™¤  <code>4</code> , æ­¤æ—¶  <code>remain = [1, 2, 3, 5, 6]</code> ;  <code>k = k % 5! = 12</code> ;</li>\n<li>æ¥ä¸‹æ¥å°±æ˜¯åœ¨  <code>remain</code>  ä¸­æ‰¾ç¬¬ 12 ä¸ªå…¨æ’åˆ—ï¼Œé‡å¤ 1ï¼Œ2 æ­¥å³å¯ ã€‚</li>\n</ol>\n<h2 id=\"code\"><a class=\"anchor\" href=\"#code\">#</a> Code</h2>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">class</span> <span class=\"token class-name\">Solution</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getPermutation</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> n<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> k<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Integer</span><span class=\"token punctuation\">></span></span> remain <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Integer</span><span class=\"token punctuation\">></span></span> ans <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        k<span class=\"token operator\">--</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token keyword\">int</span> x <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;=</span> n<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            x <span class=\"token operator\">*=</span> i<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            remain<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span>remain<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            x <span class=\"token operator\">/=</span> <span class=\"token punctuation\">(</span>n<span class=\"token operator\">--</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token keyword\">int</span> index <span class=\"token operator\">=</span> k <span class=\"token operator\">/</span> x<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            ans<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>remain<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>index<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            remain<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span>index<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            k <span class=\"token operator\">%=</span> x<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token class-name\">String</span> ret <span class=\"token operator\">=</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">:</span> ans<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            ret <span class=\"token operator\">+=</span> <span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span><span class=\"token function\">valueOf</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token keyword\">return</span> ret<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure>",
            "tags": [
                "ç®—æ³•é¢˜è§£",
                "LeetCode",
                "algorithm",
                "leetcode",
                "hard",
                "æ•°å­¦"
            ]
        },
        {
            "id": "https://haust-kevin.github.io/2023/11/03/2023-11-interview-middleware-mq/",
            "url": "https://haust-kevin.github.io/2023/11/03/2023-11-interview-middleware-mq/",
            "title": "é¢è¯•æŒ‡åŒ—ï¼šæ¶ˆæ¯é˜Ÿåˆ—",
            "date_published": "2023-11-03T11:58:57.000Z",
            "content_html": "<h2 id=\"mq\"><a class=\"anchor\" href=\"#mq\">#</a> MQ</h2>\n<h3 id=\"å¸¸è§-mq-æ¨¡å‹\"><a class=\"anchor\" href=\"#å¸¸è§-mq-æ¨¡å‹\">#</a> å¸¸è§ MQ æ¨¡å‹</h3>\n<p><strong>é˜Ÿåˆ—æ¨¡å‹</strong><br />\næœ€ç®€å•çš„æ¶ˆæ¯æ¨¡å‹ï¼Œé˜Ÿåˆ—æ¨¡å¼ï¼Œç”¨é˜»å¡é˜Ÿåˆ—å®ç°çš„ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼ï¼Œä¹Ÿå¯ä»¥çœ‹ä½œä¸€ä¸ªé˜Ÿåˆ—æ¨¡å‹çš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚<br />\n<img data-src=\"https://cdn.jsdelivr.net/gh/haust-Kevin/static@master//images/202311051512755.png\" alt=\"\" /><br />\n<strong>å‘å¸ƒ - è®¢é˜…æ¨¡å‹</strong><br />\né˜Ÿåˆ—æ¨¡å¼ä¹Ÿå¯ä»¥æœ‰å¤šä¸ªç”Ÿäº§è€…æ¶ˆè´¹è€…ï¼Œä½†æ˜¯åŒä¸€ä¸ªæ¶ˆæ¯åªèƒ½è¢«ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªä¸ºé¢˜ï¼Œæ¼”åŒ–å‡ºäº†å¦ä¸€ç§æ¶ˆæ¯æ¨¡å‹ ** å‘å¸ƒ - è®¢é˜…æ¨¡å‹ï¼ˆPublish-Subscribe Patternï¼‰** ä¹Ÿè¢«ç§°ä¸ºä¸»é¢˜æ¨¡å‹ã€‚<br />\n<img data-src=\"https://cdn.jsdelivr.net/gh/haust-Kevin/static@master//images/202311051515770.png\" alt=\"\" /><br />\nåœ¨å‘å¸ƒ - è®¢é˜…æ¨¡å‹ä¸­ï¼Œæ¶ˆæ¯çš„å‘é€æ–¹ç§°ä¸ºå‘å¸ƒè€…ï¼ˆPublisherï¼‰ï¼Œæ¶ˆæ¯çš„æ¥æ”¶æ–¹ç§°ä¸ºè®¢é˜…è€…ï¼ˆSubscriberï¼‰ï¼ŒæœåŠ¡ç«¯å­˜æ”¾æ¶ˆæ¯çš„å®¹å™¨ç§°ä¸ºä¸»é¢˜ï¼ˆTopicï¼‰ã€‚å‘å¸ƒè€…å°†æ¶ˆæ¯å‘é€åˆ°ä¸»é¢˜ä¸­ï¼Œè®¢é˜…è€…åœ¨æ¥æ”¶æ¶ˆæ¯ä¹‹å‰éœ€è¦å…ˆ â€œè®¢é˜…ä¸»é¢˜â€ã€‚æ¯ä¸ªè®¢é˜…è€…éƒ½å¯ä»¥æ¥æ”¶åˆ°ä¸»é¢˜çš„æ‰€æœ‰æ¶ˆæ¯ã€‚</p>\n<h3 id=\"kafka\"><a class=\"anchor\" href=\"#kafka\">#</a> Kafka</h3>\n<p><strong>æ¶ˆæ¯æ¨¡å‹</strong><br />\n<img data-src=\"https://cdn.jsdelivr.net/gh/haust-Kevin/static@master//images/202311051521839.png\" alt=\"\" /><br />\n<strong>æœåŠ¡æ¶æ„</strong><br />\n<strong> partition</strong>ï¼škafka Topic å¯ä»¥åˆ’åˆ†ä¸ºå¤šä¸ª partitionï¼Œåˆ†å¸ƒåœ¨ä¸åŒçš„ Broker ä¸Šï¼Œå¤©ç„¶åˆ†å¸ƒå¼ï¼Œæ¯ä¸ª patition å¯ä»¥è®¾ç½®å‰¯æœ¬ï¼Œå…¶ä¸­ä¸» partition ä¸º leaderï¼Œå‰¯æœ¬ partition ä¸º followerï¼Œfollower å’Œ leader åœ¨ä¸åŒçš„æœºå™¨ï¼Œæ¶ˆæ¯çš„æ¥æ”¶å’Œå‘é€éƒ½æ˜¯ leader è´Ÿè´£çš„ï¼Œfollower partition ä¼šä» leader åŒæ­¥æ•°æ®ï¼Œå¦‚æœ leader æ‰€åœ¨çš„ borker æŒ‚äº†ï¼Œä¼šä» follower ä¸­é€‰ä¸¾ä¸€ä¸ªæˆä¸º leaderï¼Œé«˜å¯ç”¨ã€‚</p>\n<p><strong>Consumer Group</strong>ï¼šåœ¨ kafka çš„ Topic çš„è®¢é˜…å•ä½ä¹Ÿæ˜¯ Consumer Groupï¼Œæ¯ä¸ªæ¶ˆè´¹ç»„å¯ä»¥æ”¶åˆ°å®Œæ•´çš„æ¶ˆæ¯ï¼Œä½†æ˜¯åŒä¸€ä¸ªåˆ†åŒºçš„æ•°æ®åªèƒ½è¢«æ¶ˆè´¹è€…ç»„ä¸­çš„æŸä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ï¼Œåˆ†åŒºå’Œæ¶ˆè´¹è€…å…³ç³»æ˜¯å¤šå¯¹ä¸€ã€‚<br />\n<img data-src=\"https://cdn.jsdelivr.net/gh/haust-Kevin/static@master//images/202311051518428.png\" alt=\"\" /></p>\n<h3 id=\"mq-çš„ä½œç”¨\"><a class=\"anchor\" href=\"#mq-çš„ä½œç”¨\">#</a> MQ çš„ä½œç”¨</h3>\n<ul>\n<li><strong>è§£è€¦</strong>ï¼šå°†ç³»ç»ŸæŒ‰ç…§ä¸åŒçš„ä¸šåŠ¡åŠŸèƒ½æ‹†åˆ†å‡ºæ¥ï¼Œæ¶ˆæ¯ç”Ÿäº§è€…åªç®¡æŠŠæ¶ˆæ¯å‘å¸ƒåˆ° MQ ä¸­è€Œä¸ç”¨ç®¡è°æ¥å–ï¼Œæ¶ˆæ¯æ¶ˆè´¹è€…åªç®¡ä» MQ ä¸­å–æ¶ˆæ¯è€Œä¸ç®¡æ˜¯è°å‘å¸ƒçš„ã€‚æ¶ˆæ¯ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…éƒ½ä¸çŸ¥é“å¯¹æ–¹çš„å­˜åœ¨ï¼›</li>\n<li><strong>å¼‚æ­¥</strong>ï¼šä¸»æµç¨‹åªéœ€è¦å®Œæˆä¸šåŠ¡çš„æ ¸å¿ƒåŠŸèƒ½ï¼›å¯¹äºä¸šåŠ¡éæ ¸å¿ƒåŠŸèƒ½ï¼Œå°†æ¶ˆæ¯æ”¾å…¥åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¹‹ä¸­è¿›è¡Œå¼‚æ­¥å¤„ç†ï¼Œå‡å°‘è¯·æ±‚çš„ç­‰å¾…ï¼Œæé«˜ç³»ç»Ÿçš„æ€»ä½“æ€§èƒ½ï¼›</li>\n<li><strong>å‰Šå³° / é™æµ</strong>ï¼šå°†æ‰€æœ‰è¯·æ±‚éƒ½å†™åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œæ¶ˆè´¹æœåŠ¡å™¨æŒ‰ç…§è‡ªèº«èƒ½å¤Ÿå¤„ç†çš„è¯·æ±‚æ•°ä»é˜Ÿåˆ—ä¸­æ‹¿åˆ°è¯·æ±‚ï¼Œé˜²æ­¢è¯·æ±‚å¹¶å‘è¿‡é«˜å°†ç³»ç»Ÿæå´©æºƒï¼›</li>\n</ul>\n<h3 id=\"mq-çš„ç¼ºç‚¹\"><a class=\"anchor\" href=\"#mq-çš„ç¼ºç‚¹\">#</a> MQ çš„ç¼ºç‚¹</h3>\n<ul>\n<li><strong>ç³»ç»Ÿå¯ç”¨æ€§é™ä½</strong>ï¼šç³»ç»Ÿå¼•ç”¨çš„å¤–éƒ¨ä¾èµ–è¶Šå¤šï¼Œè¶Šå®¹æ˜“æŒ‚æ‰ï¼Œå¦‚æœ MQ æœåŠ¡å™¨æŒ‚æ‰ï¼Œé‚£ä¹ˆå¯èƒ½ä¼šå¯¼è‡´æ•´å¥—ç³»ç»Ÿå´©æºƒã€‚è¿™æ—¶å°±è¦è€ƒè™‘å¦‚ä½•ä¿è¯æ¶ˆæ¯é˜Ÿåˆ—çš„é«˜å¯ç”¨äº†ã€‚</li>\n<li><strong>ç³»ç»Ÿå¤æ‚åº¦æé«˜</strong>ï¼šåŠ å…¥æ¶ˆæ¯é˜Ÿåˆ—ä¹‹åï¼Œéœ€è¦ä¿è¯æ¶ˆæ¯æ²¡æœ‰é‡å¤æ¶ˆè´¹ã€å¦‚ä½•å¤„ç†æ¶ˆæ¯ä¸¢å¤±çš„æƒ…å†µã€å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¼ é€’çš„æœ‰åºæ€§ç­‰é—®é¢˜ã€‚</li>\n<li><strong>æ•°æ®ä¸€è‡´æ€§é—®é¢˜</strong>ï¼šA ç³»ç»Ÿå¤„ç†å®Œäº†ç›´æ¥è¿”å›æˆåŠŸäº†ï¼Œä½¿ç”¨è€…éƒ½ä»¥ä¸ºä½ è¿™ä¸ªè¯·æ±‚å°±æˆåŠŸäº†ï¼›ä½†æ˜¯é—®é¢˜æ˜¯ï¼Œè¦æ˜¯ BCD ä¸‰ä¸ªç³»ç»Ÿé‚£é‡Œï¼ŒBD ä¸¤ä¸ªç³»ç»Ÿå†™åº“æˆåŠŸäº†ï¼Œç»“æœ C ç³»ç»Ÿå†™åº“å¤±è´¥äº†ï¼Œå°±ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´äº†ã€‚</li>\n</ul>\n<h3 id=\"å¸¸è§-mq-çš„å¯¹æ¯”\"><a class=\"anchor\" href=\"#å¸¸è§-mq-çš„å¯¹æ¯”\">#</a> å¸¸è§ MQ çš„å¯¹æ¯”</h3>\n<table>\n<thead>\n<tr>\n<th>ç‰¹æ€§</th>\n<th>ActiveMQ</th>\n<th>RabbitMQ</th>\n<th>RocketMQ</th>\n<th>Kafka</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>å•æœºååé‡</td>\n<td>ä¸‡çº§ï¼Œæ¯” RocketMQã€Kafka ä½ä¸€ä¸ªæ•°é‡çº§</td>\n<td>åŒ ActiveMQ</td>\n<td>10 ä¸‡çº§ï¼Œæ”¯æ’‘é«˜åå</td>\n<td>10 ä¸‡çº§ï¼Œé«˜ååï¼Œä¸€èˆ¬é…åˆå¤§æ•°æ®ç±»çš„ç³»ç»Ÿæ¥è¿›è¡Œå®æ—¶æ•°æ®è®¡ç®—ã€æ—¥å¿—é‡‡é›†ç­‰åœºæ™¯</td>\n</tr>\n<tr>\n<td>topic æ•°é‡å¯¹ååé‡çš„å½±å“</td>\n<td colspan=\"2\"></td>\n<td>topic å¯ä»¥è¾¾åˆ°å‡ ç™¾ / å‡ åƒçš„çº§åˆ«ï¼Œååé‡ä¼šæœ‰è¾ƒå°å¹…åº¦çš„ä¸‹é™ï¼Œè¿™æ˜¯ RocketMQ çš„ä¸€å¤§ä¼˜åŠ¿ï¼Œåœ¨åŒç­‰æœºå™¨ä¸‹ï¼Œå¯ä»¥æ”¯æ’‘å¤§é‡çš„ topic</td>\n<td>topic ä»å‡ ååˆ°å‡ ç™¾ä¸ªæ—¶å€™ï¼Œååé‡ä¼šå¤§å¹…åº¦ä¸‹é™ï¼Œåœ¨åŒç­‰æœºå™¨ä¸‹ï¼ŒKafka å°½é‡ä¿è¯ topic æ•°é‡ä¸è¦è¿‡å¤šï¼Œå¦‚æœè¦æ”¯æ’‘å¤§è§„æ¨¡çš„ topicï¼Œéœ€è¦å¢åŠ æ›´å¤šçš„æœºå™¨èµ„æº</td>\n</tr>\n<tr>\n<td>æ—¶æ•ˆæ€§</td>\n<td>ms çº§</td>\n<td>å¾®ç§’çº§ï¼Œè¿™æ˜¯ RabbitMQ çš„ä¸€å¤§ç‰¹ç‚¹ï¼Œå»¶è¿Ÿæœ€ä½</td>\n<td>ms çº§</td>\n<td>å»¶è¿Ÿåœ¨ ms çº§ä»¥å†…</td>\n</tr>\n<tr>\n<td>å¯ç”¨æ€§</td>\n<td>é«˜ï¼ŒåŸºäºä¸»ä»æ¶æ„å®ç°é«˜å¯ç”¨</td>\n<td>åŒ ActiveMQ</td>\n<td>éå¸¸é«˜ï¼Œåˆ†å¸ƒå¼æ¶æ„</td>\n<td>éå¸¸é«˜ï¼Œåˆ†å¸ƒå¼ï¼Œä¸€ä¸ªæ•°æ®å¤šä¸ªå‰¯æœ¬ï¼Œå°‘æ•°æœºå™¨å®•æœºï¼Œä¸ä¼šä¸¢å¤±æ•°æ®ï¼Œä¸ä¼šå¯¼è‡´ä¸å¯ç”¨</td>\n</tr>\n<tr>\n<td>æ¶ˆæ¯å¯é æ€§</td>\n<td>æœ‰è¾ƒä½çš„æ¦‚ç‡ä¸¢å¤±æ•°æ®</td>\n<td>åŸºæœ¬ä¸ä¸¢</td>\n<td>ç»è¿‡å‚æ•°ä¼˜åŒ–é…ç½®ï¼Œå¯ä»¥åšåˆ° 0 ä¸¢å¤±</td>\n<td>åŒ RocketMQ</td>\n</tr>\n<tr>\n<td>åŠŸèƒ½æ”¯æŒ</td>\n<td>MQ é¢†åŸŸçš„åŠŸèƒ½æå…¶å®Œå¤‡</td>\n<td>åŸºäº erlang å¼€å‘ï¼Œå¹¶å‘èƒ½åŠ›å¾ˆå¼ºï¼Œæ€§èƒ½æå¥½ï¼Œå»¶æ—¶å¾ˆä½</td>\n<td>MQ åŠŸèƒ½è¾ƒä¸ºå®Œå–„ï¼Œè¿˜æ˜¯åˆ†å¸ƒå¼çš„ï¼Œæ‰©å±•æ€§å¥½</td>\n<td>åŠŸèƒ½è¾ƒä¸ºç®€å•ï¼Œä¸»è¦æ”¯æŒç®€å•çš„ MQ åŠŸèƒ½ï¼Œåœ¨å¤§æ•°æ®é¢†åŸŸçš„å®æ—¶è®¡ç®—ä»¥åŠæ—¥å¿—é‡‡é›†è¢«å¤§è§„æ¨¡ä½¿ç”¨</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸è¢«é‡å¤æ¶ˆè´¹\"><a class=\"anchor\" href=\"#å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸è¢«é‡å¤æ¶ˆè´¹\">#</a> å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸è¢«é‡å¤æ¶ˆè´¹</h3>\n<p>å› ä¸ºæ¶ˆæ¯é˜Ÿåˆ—çš„æœåŠ¡è´¨é‡æ˜¯ <strong>At least once</strong> ï¼Œå› æ­¤æ¶ˆæ¯é˜Ÿåˆ—æ— æ³•ä¿è¯æ¶ˆæ¯ä¸é‡å¤ï¼Œå› æ­¤æ¶ˆè´¹é‡å¤çš„é—®é¢˜å¾—ç”± Consumer ç«¯æ¥è§£å†³ã€‚<br />\nä¸€èˆ¬é‡‡ç”¨<strong>å¹‚ç­‰æ€§</strong>è§£å†³é‡å¤æ¶ˆæ¯é—®é¢˜ã€‚æ‰€ä»¥ã€Œå¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸è¢«é‡å¤æ¶ˆè´¹ï¼Ÿã€å°±è½¬å˜ä¸ºã€Œå¦‚ä½•ä¿è¯æ¶ˆè´¹è€…çš„å¹‚ç­‰æ€§ï¼Ÿã€<br />\n<strong>é‚£ä¹ˆå¦‚ä½•ä¿è¯å¹‚ç­‰æ€§å‘¢ï¼Ÿ</strong></p>\n<ol>\n<li>å†™æ•°æ®æ—¶ï¼Œå…ˆæ ¹æ®ä¸»é”®æŸ¥ä¸€ä¸‹è¿™æ¡æ•°æ®æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå·²ç»å­˜åœ¨åˆ™ updateï¼›</li>\n<li>æ•°æ®åº“çš„å”¯ä¸€é”®çº¦æŸä¹Ÿå¯ä»¥ä¿è¯ä¸ä¼šé‡å¤æ’å…¥å¤šæ¡ï¼Œå› ä¸ºé‡å¤æ’å…¥å¤šæ¡åªä¼šæŠ¥é”™ï¼Œä¸ä¼šå¯¼è‡´æ•°æ®åº“ä¸­å‡ºç°è„æ•°æ®ï¼›</li>\n<li>å¦‚æœæ˜¯å†™ redisï¼Œå°±æ²¡æœ‰é—®é¢˜ï¼Œå› ä¸º set æ“ä½œæ˜¯å¤©ç„¶å¹‚ç­‰æ€§çš„ã€‚</li>\n</ol>\n<h3 id=\"å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±è¿›è¡Œå¯é æ€§ä¼ è¾“\"><a class=\"anchor\" href=\"#å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±è¿›è¡Œå¯é æ€§ä¼ è¾“\">#</a> å¦‚ä½•ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±ï¼Œè¿›è¡Œå¯é æ€§ä¼ è¾“</h3>\n<p><img data-src=\"https://cdn.jsdelivr.net/gh/haust-Kevin/static@master//images/202311042311197.png\" alt=\"\" /><br />\nå¯ä»¥çœ‹åˆ°ä¸€å…±æœ‰ä¸‰ä¸ªé˜¶æ®µï¼Œåˆ†åˆ«æ˜¯<strong>ç”Ÿäº§æ¶ˆæ¯</strong>ã€<strong>å­˜å‚¨æ¶ˆæ¯</strong>å’Œ<strong>æ¶ˆè´¹æ¶ˆæ¯</strong>ã€‚æˆ‘ä»¬ä»è¿™ä¸‰ä¸ªé˜¶æ®µåˆ†åˆ«å…¥æ‰‹æ¥çœ‹çœ‹å¦‚ä½•ç¡®ä¿æ¶ˆæ¯ä¸ä¼šä¸¢å¤±ã€‚</p>\n<p><strong>ç”Ÿäº§æ¶ˆæ¯</strong><br />\nç”Ÿäº§è€…å‘é€æ¶ˆæ¯è‡³ Brokerï¼Œéœ€è¦å¤„ç† Broker çš„å“åº”ï¼Œä¸è®ºæ˜¯åŒæ­¥è¿˜æ˜¯å¼‚æ­¥å‘é€æ¶ˆæ¯ï¼ŒåŒæ­¥å’Œå¼‚æ­¥å›è°ƒéƒ½éœ€è¦<strong>åšå¥½ try-catch</strong>ï¼Œå¦¥å–„çš„å¤„ç†å“åº”ï¼Œå¦‚æœ Broker è¿”å›å†™å…¥å¤±è´¥ç­‰é”™è¯¯æ¶ˆæ¯ï¼Œéœ€è¦é‡è¯•å‘é€ã€‚å½“å¤šæ¬¡å‘é€å¤±è´¥éœ€è¦ä½œæŠ¥è­¦ï¼Œæ—¥å¿—è®°å½•ç­‰ã€‚<br />\nè¿™æ ·å°±èƒ½ä¿è¯åœ¨ç”Ÿäº§æ¶ˆæ¯é˜¶æ®µæ¶ˆæ¯ä¸ä¼šä¸¢å¤±ã€‚</p>\n<p><strong>å­˜å‚¨æ¶ˆæ¯</strong><br />\nå­˜å‚¨æ¶ˆæ¯é˜¶æ®µéœ€è¦<strong>åœ¨æ¶ˆæ¯åˆ·ç›˜ä¹‹åå†ç»™ç”Ÿäº§è€…å“åº”</strong>ï¼Œå‡è®¾æ¶ˆæ¯å†™å…¥ç¼“å­˜ä¸­å°±è¿”å›å“åº”ï¼Œé‚£ä¹ˆæœºå™¨çªç„¶æ–­ç”µè¿™æ¶ˆæ¯å°±æ²¡äº†ï¼Œè€Œç”Ÿäº§è€…ä»¥ä¸ºå·²ç»å‘é€æˆåŠŸäº†ã€‚<br />\nå¦‚æœ Broker æ˜¯é›†ç¾¤éƒ¨ç½²ï¼Œæœ‰å¤šå‰¯æœ¬æœºåˆ¶ï¼Œå³æ¶ˆæ¯ä¸ä»…ä»…è¦å†™å…¥å½“å‰ Broker, è¿˜éœ€è¦å†™å…¥å‰¯æœ¬æœºä¸­ã€‚é‚£é…ç½®æˆè‡³å°‘å†™å…¥ä¸¤å°æœºå­åå†ç»™ç”Ÿäº§è€…å“åº”ã€‚è¿™æ ·åŸºæœ¬ä¸Šå°±èƒ½ä¿è¯å­˜å‚¨çš„å¯é äº†ã€‚</p>\n<p><strong>æ¶ˆè´¹æ¶ˆæ¯</strong><br />\nè¿™é‡Œç»å¸¸ä¼šæœ‰åŒå­¦çŠ¯é”™ï¼Œæœ‰äº›åŒå­¦å½“æ¶ˆè´¹è€…æ‹¿åˆ°æ¶ˆæ¯ä¹‹åç›´æ¥å­˜å…¥å†…å­˜é˜Ÿåˆ—ä¸­å°±ç›´æ¥è¿”å›ç»™ Broker æ¶ˆè´¹æˆåŠŸï¼Œè¿™æ˜¯ä¸å¯¹çš„ã€‚<br />\nä½ éœ€è¦è€ƒè™‘æ‹¿åˆ°æ¶ˆæ¯æ”¾åœ¨å†…å­˜ä¹‹åæ¶ˆè´¹è€…å°±å®•æœºäº†æ€ä¹ˆåŠã€‚æ‰€ä»¥æˆ‘ä»¬åº”è¯¥<strong>åœ¨æ¶ˆè´¹è€…çœŸæ­£æ‰§è¡Œå®Œä¸šåŠ¡é€»è¾‘ä¹‹åï¼Œå†å‘é€ç»™ Broker æ¶ˆè´¹æˆåŠŸ</strong>ï¼Œè¿™æ‰æ˜¯çœŸæ­£çš„æ¶ˆè´¹äº†ã€‚<br />\næ‰€ä»¥åªè¦æˆ‘ä»¬åœ¨æ¶ˆæ¯ä¸šåŠ¡é€»è¾‘å¤„ç†å®Œæˆä¹‹åå†ç»™ Broker å“åº”ï¼Œé‚£ä¹ˆæ¶ˆè´¹é˜¶æ®µæ¶ˆæ¯å°±ä¸ä¼šä¸¢å¤±ã€‚</p>\n<p><strong>å°ç»“ä¸€ä¸‹</strong><br />\nå¯ä»¥çœ‹å‡ºï¼Œä¿è¯æ¶ˆæ¯çš„å¯é æ€§éœ€è¦ä¸‰æ–¹é…åˆã€‚</p>\n<ul>\n<li>ç”Ÿäº§è€…éœ€è¦å¤„ç†å¥½ Broker çš„å“åº”ï¼Œå‡ºé”™æƒ…å†µä¸‹åˆ©ç”¨é‡è¯•ã€æŠ¥è­¦ç­‰æ‰‹æ®µã€‚</li>\n<li>Broker éœ€è¦æ§åˆ¶å“åº”çš„æ—¶æœºï¼Œå•æœºæƒ…å†µä¸‹æ˜¯æ¶ˆæ¯åˆ·ç›˜åè¿”å›å“åº”ï¼Œé›†ç¾¤å¤šå‰¯æœ¬æƒ…å†µä¸‹ï¼Œå³å‘é€è‡³ä¸¤ä¸ªå‰¯æœ¬åŠä»¥ä¸Šçš„æƒ…å†µä¸‹å†è¿”å›å“åº”ã€‚</li>\n<li>æ¶ˆè´¹è€…éœ€è¦åœ¨æ‰§è¡Œå®ŒçœŸæ­£çš„ä¸šåŠ¡é€»è¾‘ä¹‹åå†è¿”å›å“åº”ç»™ Brokerã€‚</li>\n</ul>\n<h3 id=\"å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„æœ‰åºæ€§\"><a class=\"anchor\" href=\"#å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„æœ‰åºæ€§\">#</a> å¦‚ä½•ä¿è¯æ¶ˆæ¯çš„æœ‰åºæ€§</h3>\n<p>æœ‰åºæ€§åˆ†ï¼šå…¨å±€æœ‰åºå’Œéƒ¨åˆ†æœ‰åºã€‚<br />\n<strong>å…¨å±€æœ‰åº</strong><br />\nå¦‚æœè¦ä¿è¯æ¶ˆæ¯çš„å…¨å±€æœ‰åºï¼Œé¦–å…ˆåªèƒ½ç”±ä¸€ä¸ªç”Ÿäº§è€…å¾€ Topic å‘é€æ¶ˆæ¯ï¼Œå¹¶ä¸”ä¸€ä¸ª Topic å†…éƒ¨åªèƒ½æœ‰ä¸€ä¸ªé˜Ÿåˆ—ï¼ˆåˆ†åŒºï¼‰ã€‚æ¶ˆè´¹è€…ä¹Ÿå¿…é¡»æ˜¯å•çº¿ç¨‹æ¶ˆè´¹è¿™ä¸ªé˜Ÿåˆ—ã€‚è¿™æ ·çš„æ¶ˆæ¯å°±æ˜¯å…¨å±€æœ‰åºçš„ï¼<br />\nä¸è¿‡ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬éƒ½ä¸éœ€è¦å…¨å±€æœ‰åºï¼Œå³ä½¿æ˜¯åŒæ­¥ MySQL Binlog ä¹Ÿåªéœ€è¦ä¿è¯å•è¡¨æ¶ˆæ¯æœ‰åºå³å¯ã€‚<br />\n<img data-src=\"https://cdn.jsdelivr.net/gh/haust-Kevin/static@master//images/202311042348158.png\" alt=\"\" /></p>\n<p><strong>éƒ¨åˆ†æœ‰åº</strong><br />\nå› æ­¤ç»å¤§éƒ¨åˆ†çš„æœ‰åºéœ€æ±‚æ˜¯éƒ¨åˆ†æœ‰åºï¼Œéƒ¨åˆ†æœ‰åºæˆ‘ä»¬å°±å¯ä»¥å°† Topic å†…éƒ¨åˆ’åˆ†æˆæˆ‘ä»¬éœ€è¦çš„é˜Ÿåˆ—æ•°ï¼ŒæŠŠæ¶ˆæ¯é€šè¿‡ç‰¹å®šçš„ç­–ç•¥å‘å¾€å›ºå®šçš„é˜Ÿåˆ—ä¸­ï¼Œç„¶åæ¯ä¸ªé˜Ÿåˆ—å¯¹åº”ä¸€ä¸ªå•çº¿ç¨‹å¤„ç†çš„æ¶ˆè´¹è€…ã€‚è¿™æ ·å³å®Œæˆäº†éƒ¨åˆ†æœ‰åºçš„éœ€æ±‚ï¼Œåˆå¯ä»¥é€šè¿‡é˜Ÿåˆ—æ•°é‡çš„å¹¶å‘æ¥æé«˜æ¶ˆæ¯å¤„ç†æ•ˆç‡ã€‚<br />\n<img data-src=\"https://cdn.jsdelivr.net/gh/haust-Kevin/static@master//images/202311050007730.png\" alt=\"\" /></p>\n<h3 id=\"å¦‚ä½•å¤„ç†æ¶ˆæ¯å †ç§¯æƒ…å†µ\"><a class=\"anchor\" href=\"#å¦‚ä½•å¤„ç†æ¶ˆæ¯å †ç§¯æƒ…å†µ\">#</a> å¦‚ä½•å¤„ç†æ¶ˆæ¯å †ç§¯æƒ…å†µ</h3>\n<p><img data-src=\"https://cdn.jsdelivr.net/gh/haust-Kevin/static@master//images/202311050015622.jpg\" alt=\"\" /></p>\n<p>æ–°å»ºä¸€ä¸ªä¸´æ—¶çš„ Topicï¼Œè®¾ç½®ä¸º <code>5*X</code>  ä¸ª Partitionã€‚<br />\nåŸ Consumer ä¸å†å¤„ç†ä¸šåŠ¡é€»è¾‘äº†ï¼Œåªè´Ÿè´£æ¬è¿ï¼ŒæŠŠæ¶ˆæ¯æ”¾åˆ°ä¸´æ—¶ Topic ä¸­ã€‚<br />\nè¿™  <code>5*X</code>  ä¸ª Partition å¯ä»¥æœ‰ <code>5*X</code>  ä¸ª Consumer äº†ï¼Œå®ƒä»¬æ¥å¤„ç†åŸæ¥çš„ä¸šåŠ¡é€»è¾‘ã€‚<br />\nè¿™  <code>5*X</code>  ä¸ª Consumer æ¯ç§’ä¸€å…±èƒ½å¤„ç†åŸæ¥äº”å€æ•°é‡çš„æ¶ˆæ¯äº†ï¼Œè¿™æ ·å°±å¯ä»¥å¿«é€Ÿå¤„ç†å®Œç§¯å‹çš„æ¶ˆæ¯ã€‚<br />\nå½“å¤„ç†å®Œæ¶ˆæ¯ç§¯å‹åï¼Œå°†åŸæ¥çš„ Topic åˆ†åŒºå¢åŠ åˆ°é€‚å½“æ•°é‡ï¼ŒæŠŠæ•´ä½“ç»“æ„æ¢å¤ä¸ºåŸæ¥çš„å½¢å¼ã€‚</p>\n",
            "tags": [
                "é¢è¯•æŒ‡åŒ—",
                "ä¸­é—´ä»¶",
                "å…«è‚¡æ–‡",
                "æ¶ˆæ¯é˜Ÿåˆ—",
                "Kafka"
            ]
        },
        {
            "id": "https://haust-kevin.github.io/2023/11/01/2023-11-interview-web-spring/",
            "url": "https://haust-kevin.github.io/2023/11/01/2023-11-interview-web-spring/",
            "title": "é¢è¯•æŒ‡åŒ—ï¼šSpring",
            "date_published": "2023-11-01T10:02:28.000Z",
            "content_html": "<h2 id=\"framework\"><a class=\"anchor\" href=\"#framework\">#</a> Framework</h2>\n<p>Spring æ€»å…±å¤§çº¦æœ‰ 20 ä¸ªæ¨¡å—ï¼Œ ç”± 1300 å¤šä¸ªä¸åŒçš„æ–‡ä»¶æ„æˆã€‚ è€Œè¿™äº›ç»„ä»¶è¢«åˆ†åˆ«æ•´åˆåœ¨æ ¸å¿ƒå®¹å™¨ï¼ˆCore Containerï¼‰ ã€ AOPï¼ˆAspect Oriented Programmingï¼‰å’Œè®¾å¤‡æ”¯æŒï¼ˆInstrmentationï¼‰ ã€æ•°æ®è®¿é—®ä¸é›†æˆï¼ˆData Access/Integerationï¼‰ ã€ Webã€ æ¶ˆæ¯ï¼ˆMessagingï¼‰ ã€ Test ç­‰ 6 ä¸ªæ¨¡å—ä¸­ã€‚ ä»¥ä¸‹æ˜¯ Spring 5 çš„æ¨¡å—ç»“æ„å›¾ï¼š<br />\n<img data-src=\"https://cdn.jsdelivr.net/gh/haust-Kevin/static@master//images/202311021759403.png\" alt=\"\" /></p>\n<ul>\n<li>spring coreï¼šæä¾›äº†æ¡†æ¶çš„åŸºæœ¬ç»„æˆéƒ¨åˆ†ï¼ŒåŒ…æ‹¬æ§åˆ¶åè½¬ï¼ˆInversion of Controlï¼ŒIOCï¼‰å’Œä¾èµ–æ³¨å…¥ï¼ˆDependency Injectionï¼ŒDIï¼‰åŠŸèƒ½ã€‚</li>\n<li>spring beansï¼šæä¾›äº† BeanFactoryï¼Œæ˜¯å·¥å‚æ¨¡å¼çš„ä¸€ä¸ªç»å…¸å®ç°ï¼ŒSpring å°†ç®¡ç†å¯¹è±¡ç§°ä¸º Beanã€‚</li>\n<li>spring contextï¼šæ„å»ºäº core å°è£…åŒ…åŸºç¡€ä¸Šçš„ context å°è£…åŒ…ï¼Œæä¾›äº†ä¸€ç§æ¡†æ¶å¼çš„å¯¹è±¡è®¿é—®æ–¹æ³•ã€‚</li>\n<li>spring jdbcï¼šæä¾›äº†ä¸€ä¸ª JDBC çš„æŠ½è±¡å±‚ï¼Œæ¶ˆé™¤äº†çƒ¦ççš„ JDBC ç¼–ç å’Œæ•°æ®åº“å‚å•†ç‰¹æœ‰çš„é”™è¯¯ä»£ç è§£æï¼Œ ç”¨äºç®€åŒ– JDBCã€‚</li>\n<li>spring aopï¼šæä¾›äº†é¢å‘åˆ‡é¢çš„ç¼–ç¨‹å®ç°ï¼Œè®©ä½ å¯ä»¥è‡ªå®šä¹‰æ‹¦æˆªå™¨ã€åˆ‡ç‚¹ç­‰ã€‚</li>\n<li>spring Webï¼šæä¾›äº†é’ˆå¯¹ Web å¼€å‘çš„é›†æˆç‰¹æ€§ï¼Œä¾‹å¦‚æ–‡ä»¶ä¸Šä¼ ï¼Œåˆ©ç”¨ servlet listeners è¿›è¡Œ ioc å®¹å™¨åˆå§‹åŒ–å’Œé’ˆå¯¹ Web çš„ ApplicationContextã€‚</li>\n<li>spring testï¼šä¸»è¦ä¸ºæµ‹è¯•æä¾›æ”¯æŒçš„ï¼Œæ”¯æŒä½¿ç”¨ JUnit æˆ– TestNG å¯¹ Spring ç»„ä»¶è¿›è¡Œå•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•ã€‚</li>\n</ul>\n<h2 id=\"aop\"><a class=\"anchor\" href=\"#aop\">#</a> AOP</h2>\n<p>AOPï¼šAspect oriented programming é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼ŒAOP æ˜¯ OOPï¼ˆé¢å‘å¯¹è±¡ç¼–ç¨‹ï¼‰çš„ä¸€ç§å»¶ç»­ã€‚</p>\n<p>AOP æœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼šé™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†ã€‚</p>\n<h3 id=\"aop-å®ç°æ–¹å¼\"><a class=\"anchor\" href=\"#aop-å®ç°æ–¹å¼\">#</a> AOP å®ç°æ–¹å¼</h3>\n<p><strong>é™æ€ä»£ç†</strong><br />\né™æ€ä»£ç†ï¼šä»£ç†ç±»åœ¨ç¼–è¯‘é˜¶æ®µç”Ÿæˆï¼Œåœ¨ç¼–è¯‘é˜¶æ®µå°†é€šçŸ¥ç»‡å…¥ Java å­—èŠ‚ç ä¸­ï¼Œä¹Ÿç§°ç¼–è¯‘æ—¶å¢å¼ºã€‚AspectJ ä½¿ç”¨çš„æ˜¯é™æ€ä»£ç†ã€‚</p>\n<p>ç¼ºç‚¹ï¼šä»£ç†å¯¹è±¡éœ€è¦ä¸ç›®æ ‡å¯¹è±¡å®ç°ä¸€æ ·çš„æ¥å£ï¼Œå¹¶ä¸”å®ç°æ¥å£çš„æ–¹æ³•ï¼Œä¼šæœ‰å†—ä½™ä»£ç ã€‚åŒæ—¶ï¼Œä¸€æ—¦æ¥å£å¢åŠ æ–¹æ³•ï¼Œç›®æ ‡å¯¹è±¡ä¸ä»£ç†å¯¹è±¡éƒ½è¦ç»´æŠ¤ã€‚</p>\n<p><strong>åŠ¨æ€ä»£ç†</strong></p>\n<p>åŠ¨æ€ä»£ç†ï¼šä»£ç†ç±»åœ¨ç¨‹åºè¿è¡Œæ—¶åˆ›å»ºï¼ŒAOP æ¡†æ¶ä¸ä¼šå»ä¿®æ”¹å­—èŠ‚ç ï¼Œè€Œæ˜¯åœ¨å†…å­˜ä¸­ä¸´æ—¶ç”Ÿæˆä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œåœ¨è¿è¡ŒæœŸé—´å¯¹ä¸šåŠ¡æ–¹æ³•è¿›è¡Œå¢å¼ºï¼Œä¸ä¼šç”Ÿæˆæ–°ç±»ã€‚</p>\n<h3 id=\"spring-aop\"><a class=\"anchor\" href=\"#spring-aop\">#</a> Spring AOP</h3>\n<p>Spring çš„ AOP å®ç°åŸç†å…¶å®å¾ˆç®€å•ï¼Œå°±æ˜¯é€šè¿‡åŠ¨æ€ä»£ç†å®ç°çš„ã€‚å¦‚æœæˆ‘ä»¬ä¸º Spring çš„æŸä¸ª bean é…ç½®äº†åˆ‡é¢ï¼Œé‚£ä¹ˆ Spring åœ¨åˆ›å»ºè¿™ä¸ª bean çš„æ—¶å€™ï¼Œå®é™…ä¸Šåˆ›å»ºçš„æ˜¯è¿™ä¸ª bean çš„ä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œæˆ‘ä»¬åç»­å¯¹ bean ä¸­æ–¹æ³•çš„è°ƒç”¨ï¼Œå®é™…ä¸Šè°ƒç”¨çš„æ˜¯ä»£ç†ç±»é‡å†™çš„ä»£ç†æ–¹æ³•ã€‚è€Œ Spring çš„ AOP ä½¿ç”¨äº†ä¸¤ç§åŠ¨æ€ä»£ç†ï¼Œåˆ†åˆ«æ˜¯ JDK çš„åŠ¨æ€ä»£ç†ï¼Œä»¥åŠ CGLib çš„åŠ¨æ€ä»£ç†ã€‚</p>\n<p>å¦‚æœç›®æ ‡å¯¹è±¡å®ç°äº†æ¥å£ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šé‡‡ç”¨ JDK çš„åŠ¨æ€ä»£ç†å®ç° AOPï¼Œä¹Ÿå¯ä»¥å¼ºåˆ¶ä½¿ç”¨ CGLIB å®ç° AOPã€‚<br />\nå¦‚æœç›®æ ‡å¯¹è±¡æ²¡æœ‰å®ç°äº†æ¥å£ï¼Œå¿…é¡»é‡‡ç”¨ CGLIB åº“ã€‚</p>\n<h4 id=\"jdk-åŠ¨æ€ä»£ç†\"><a class=\"anchor\" href=\"#jdk-åŠ¨æ€ä»£ç†\">#</a> JDK åŠ¨æ€ä»£ç†</h4>\n<p>å¦‚æœç›®æ ‡ç±»å®ç°äº†æ¥å£ï¼ŒSpring AOP ä¼šé€‰æ‹©ä½¿ç”¨ JDK åŠ¨æ€ä»£ç†ç›®æ ‡ç±»ã€‚ä»£ç†ç±»æ ¹æ®ç›®æ ‡ç±»å®ç°çš„æ¥å£åŠ¨æ€ç”Ÿæˆï¼Œä¸éœ€è¦è‡ªå·±ç¼–å†™ï¼Œç”Ÿæˆçš„åŠ¨æ€ä»£ç†ç±»å’Œç›®æ ‡ç±»éƒ½å®ç°ç›¸åŒçš„æ¥å£ã€‚JDK åŠ¨æ€ä»£ç†çš„æ ¸å¿ƒæ˜¯ InvocationHandler æ¥å£å’Œ Proxy ç±»ã€‚<br />\n<strong>ç¼ºç‚¹</strong>ï¼šç›®æ ‡ç±»å¿…é¡»æœ‰å®ç°çš„æ¥å£ã€‚å¦‚æœæŸä¸ªç±»æ²¡æœ‰å®ç°æ¥å£ï¼Œé‚£ä¹ˆè¿™ä¸ªç±»å°±ä¸èƒ½ç”¨ JDK åŠ¨æ€ä»£ç†ã€‚</p>\n<h4 id=\"cglib-åŠ¨æ€ä»£ç†\"><a class=\"anchor\" href=\"#cglib-åŠ¨æ€ä»£ç†\">#</a> CGLIB åŠ¨æ€ä»£ç†</h4>\n<p>é€šè¿‡ç»§æ‰¿å®ç°ã€‚å¦‚æœç›®æ ‡ç±»æ²¡æœ‰å®ç°æ¥å£ï¼Œé‚£ä¹ˆ Spring AOP ä¼šé€‰æ‹©ä½¿ç”¨ CGLIB æ¥åŠ¨æ€ä»£ç†ç›®æ ‡ç±»ã€‚CGLIBï¼ˆCode Generation Libraryï¼‰å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆç±»çš„å­—èŠ‚ç ï¼ŒåŠ¨æ€åˆ›å»ºç›®æ ‡ç±»çš„å­ç±»å¯¹è±¡ï¼Œåœ¨å­ç±»å¯¹è±¡ä¸­å¢å¼ºç›®æ ‡ç±»ã€‚</p>\n<p>CGLIB æ˜¯é€šè¿‡ç»§æ‰¿çš„æ–¹å¼åšçš„åŠ¨æ€ä»£ç†ï¼Œå› æ­¤å¦‚æœæŸä¸ªç±»è¢«æ ‡è®°ä¸º finalï¼Œé‚£ä¹ˆå®ƒæ˜¯æ— æ³•ä½¿ç”¨ CGLIB åšåŠ¨æ€ä»£ç†çš„ã€‚</p>\n<p><strong>ä¼˜ç‚¹</strong>ï¼šç›®æ ‡ç±»ä¸éœ€è¦å®ç°ç‰¹å®šçš„æ¥å£ï¼Œæ›´åŠ çµæ´»ã€‚</p>\n<h3 id=\"spring-aop-ç›¸å…³æœ¯è¯­\"><a class=\"anchor\" href=\"#spring-aop-ç›¸å…³æœ¯è¯­\">#</a> Spring AOP ç›¸å…³æœ¯è¯­</h3>\n<ul>\n<li><strong>åˆ‡é¢ï¼ˆAspectï¼‰</strong>ï¼šåˆ‡é¢æ˜¯é€šçŸ¥å’Œåˆ‡ç‚¹çš„ç»“åˆã€‚é€šçŸ¥å’Œåˆ‡ç‚¹å…±åŒå®šä¹‰äº†åˆ‡é¢çš„å…¨éƒ¨å†…å®¹ã€‚</li>\n<li><strong>è¿æ¥ç‚¹ï¼ˆJoin pointï¼‰</strong>ï¼šæŒ‡æ–¹æ³•ï¼Œåœ¨ Spring AOP ä¸­ï¼Œä¸€ä¸ªè¿æ¥ç‚¹æ€»æ˜¯ä»£è¡¨ä¸€ä¸ªæ–¹æ³•çš„æ‰§è¡Œã€‚è¿æ¥ç‚¹æ˜¯åœ¨åº”ç”¨æ‰§è¡Œè¿‡ç¨‹ä¸­èƒ½å¤Ÿæ’å…¥åˆ‡é¢çš„ä¸€ä¸ªç‚¹ã€‚è¿™ä¸ªç‚¹å¯ä»¥æ˜¯è°ƒç”¨æ–¹æ³•æ—¶ã€æŠ›å‡ºå¼‚å¸¸æ—¶ã€ç”šè‡³ä¿®æ”¹ä¸€ä¸ªå­—æ®µæ—¶ã€‚åˆ‡é¢ä»£ç å¯ä»¥åˆ©ç”¨è¿™äº›ç‚¹æ’å…¥åˆ°åº”ç”¨çš„æ­£å¸¸æµç¨‹ä¹‹ä¸­ï¼Œå¹¶æ·»åŠ æ–°çš„è¡Œä¸ºã€‚</li>\n<li><strong>é€šçŸ¥ï¼ˆAdviceï¼‰</strong>ï¼šåœ¨ AOP æœ¯è¯­ä¸­ï¼Œåˆ‡é¢çš„å·¥ä½œè¢«ç§°ä¸ºé€šçŸ¥ã€‚</li>\n<li><strong>åˆ‡å…¥ç‚¹ï¼ˆPointcutï¼‰</strong>ï¼šåˆ‡ç‚¹çš„å®šä¹‰ä¼šåŒ¹é…é€šçŸ¥æ‰€è¦ç»‡å…¥çš„ä¸€ä¸ªæˆ–å¤šä¸ªè¿æ¥ç‚¹ã€‚æˆ‘ä»¬é€šå¸¸ä½¿ç”¨æ˜ç¡®çš„ç±»å’Œæ–¹æ³•åç§°ï¼Œæˆ–æ˜¯åˆ©ç”¨æ­£åˆ™è¡¨è¾¾å¼å®šä¹‰æ‰€åŒ¹é…çš„ç±»å’Œæ–¹æ³•åç§°æ¥æŒ‡å®šè¿™äº›åˆ‡ç‚¹ã€‚</li>\n<li><strong>å¼•å…¥ï¼ˆIntroductionï¼‰</strong>ï¼šå¼•å…¥å…è®¸æˆ‘ä»¬å‘ç°æœ‰ç±»æ·»åŠ æ–°æ–¹æ³•æˆ–å±æ€§ã€‚</li>\n<li><strong>ç›®æ ‡å¯¹è±¡ï¼ˆTarget Objectï¼‰</strong>ï¼š è¢«ä¸€ä¸ªæˆ–è€…å¤šä¸ªåˆ‡é¢ï¼ˆaspectï¼‰æ‰€é€šçŸ¥ï¼ˆadviseï¼‰çš„å¯¹è±¡ã€‚å®ƒé€šå¸¸æ˜¯ä¸€ä¸ªä»£ç†å¯¹è±¡ã€‚</li>\n<li><strong>ç»‡å…¥ï¼ˆWeavingï¼‰</strong>ï¼šç»‡å…¥æ˜¯æŠŠåˆ‡é¢åº”ç”¨åˆ°ç›®æ ‡å¯¹è±¡å¹¶åˆ›å»ºæ–°çš„ä»£ç†å¯¹è±¡çš„è¿‡ç¨‹ã€‚åœ¨ç›®æ ‡å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸé‡Œæœ‰ä»¥ä¸‹æ—¶é—´ç‚¹å¯ä»¥è¿›è¡Œç»‡å…¥ï¼š\n<ul>\n<li>ç¼–è¯‘æœŸï¼šåˆ‡é¢åœ¨ç›®æ ‡ç±»ç¼–è¯‘æ—¶è¢«ç»‡å…¥ã€‚AspectJ çš„ç»‡å…¥ç¼–è¯‘å™¨æ˜¯ä»¥è¿™ç§æ–¹å¼ç»‡å…¥åˆ‡é¢çš„ã€‚</li>\n<li>ç±»åŠ è½½æœŸï¼šåˆ‡é¢åœ¨ç›®æ ‡ç±»åŠ è½½åˆ° JVM æ—¶è¢«ç»‡å…¥ã€‚éœ€è¦ç‰¹æ®Šçš„ç±»åŠ è½½å™¨ï¼Œå®ƒå¯ä»¥åœ¨ç›®æ ‡ç±»è¢«å¼•å…¥åº”ç”¨ä¹‹å‰å¢å¼ºè¯¥ç›®æ ‡ç±»çš„å­—èŠ‚ç ã€‚AspectJ5 çš„åŠ è½½æ—¶ç»‡å…¥å°±æ”¯æŒä»¥è¿™ç§æ–¹å¼ç»‡å…¥åˆ‡é¢ã€‚</li>\n<li>è¿è¡ŒæœŸï¼šåˆ‡é¢åœ¨åº”ç”¨è¿è¡Œçš„æŸä¸ªæ—¶åˆ»è¢«ç»‡å…¥ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåœ¨ç»‡å…¥åˆ‡é¢æ—¶ï¼ŒAOP å®¹å™¨ä¼šä¸ºç›®æ ‡å¯¹è±¡åŠ¨æ€åœ°åˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡ã€‚SpringAOP å°±æ˜¯ä»¥è¿™ç§æ–¹å¼ç»‡å…¥åˆ‡é¢ã€‚</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"spring-aop-é€šçŸ¥ç±»å‹\"><a class=\"anchor\" href=\"#spring-aop-é€šçŸ¥ç±»å‹\">#</a> Spring AOP é€šçŸ¥ç±»å‹</h3>\n<ul>\n<li><strong>å‰ç½®é€šçŸ¥ï¼ˆBeforeï¼‰</strong>ï¼šåœ¨ç›®æ ‡æ–¹æ³•è¢«è°ƒç”¨ä¹‹å‰è°ƒç”¨é€šçŸ¥åŠŸèƒ½ï¼›</li>\n<li><strong>åç½®é€šçŸ¥ï¼ˆAfterï¼‰</strong>ï¼šåœ¨ç›®æ ‡æ–¹æ³•å®Œæˆä¹‹åè°ƒç”¨é€šçŸ¥ï¼Œæ­¤æ—¶ä¸ä¼šå…³å¿ƒæ–¹æ³•çš„è¾“å‡ºæ˜¯ä»€ä¹ˆï¼›</li>\n<li><strong>è¿”å›é€šçŸ¥ï¼ˆAfter-returning ï¼‰</strong>ï¼šåœ¨ç›®æ ‡æ–¹æ³•æˆåŠŸæ‰§è¡Œä¹‹åè°ƒç”¨é€šçŸ¥ï¼›</li>\n<li><strong>å¼‚å¸¸é€šçŸ¥ï¼ˆAfter-throwingï¼‰</strong>ï¼šåœ¨ç›®æ ‡æ–¹æ³•æŠ›å‡ºå¼‚å¸¸åè°ƒç”¨é€šçŸ¥ï¼›</li>\n<li><strong>ç¯ç»•é€šçŸ¥ï¼ˆAroundï¼‰</strong>ï¼šé€šçŸ¥åŒ…è£¹äº†è¢«é€šçŸ¥çš„æ–¹æ³•ï¼Œåœ¨è¢«é€šçŸ¥çš„æ–¹æ³•è°ƒç”¨ä¹‹å‰å’Œè°ƒç”¨ä¹‹åæ‰§è¡Œè‡ªå®šä¹‰çš„é€»è¾‘ã€‚</li>\n</ul>\n<h2 id=\"ioc\"><a class=\"anchor\" href=\"#ioc\">#</a> IOC</h2>\n<p>IoCï¼ˆInversion of Controlï¼‰æ˜¯æ§åˆ¶åè½¬çš„æ„æ€ï¼Œè¿™æ˜¯ä¸€ç§é¢å‘å¯¹è±¡ç¼–ç¨‹çš„è®¾è®¡æ€æƒ³ã€‚åœ¨ä¸é‡‡ç”¨è¿™ç§æ€æƒ³çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå·±ç»´æŠ¤å¯¹è±¡ä¸å¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œå¾ˆå®¹æ˜“é€ æˆå¯¹è±¡ä¹‹é—´çš„è€¦åˆåº¦è¿‡é«˜ï¼Œåœ¨ä¸€ä¸ªå¤§å‹çš„é¡¹ç›®ä¸­è¿™ååˆ†çš„ä¸åˆ©äºä»£ç çš„ç»´æŠ¤ã€‚IoC åˆ™å¯ä»¥è§£å†³è¿™ç§é—®é¢˜ï¼Œå®ƒå¯ä»¥å¸®æˆ‘ä»¬ç»´æŠ¤å¯¹è±¡ä¸å¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œé™ä½å¯¹è±¡ä¹‹é—´çš„è€¦åˆåº¦ã€‚</p>\n<p>è¯´åˆ° IoC å°±ä¸å¾—ä¸è¯´ DIï¼ˆDependency Injectionï¼‰ï¼ŒDI æ˜¯ä¾èµ–æ³¨å…¥çš„æ„æ€ï¼Œå®ƒæ˜¯ IoC å®ç°çš„å®ç°æ–¹å¼ï¼Œå°±æ˜¯è¯´ IoC æ˜¯é€šè¿‡ DI æ¥å®ç°çš„ã€‚ç”±äº IoC è¿™ä¸ªè¯æ±‡æ¯”è¾ƒæŠ½è±¡è€Œ DI å´æ›´ç›´è§‚ï¼Œæ‰€ä»¥å¾ˆå¤šæ—¶å€™æˆ‘ä»¬å°±ç”¨ DI æ¥ä»£æ›¿å®ƒï¼Œåœ¨å¾ˆå¤šæ—¶å€™æˆ‘ä»¬ç®€å•åœ°å°† IoC å’Œ DI åˆ’ç­‰å·ï¼Œè¿™æ˜¯ä¸€ç§ä¹ æƒ¯ã€‚è€Œå®ç°ä¾èµ–æ³¨å…¥çš„å…³é”®æ˜¯ IoC å®¹å™¨ï¼Œå®ƒçš„æœ¬è´¨å°±æ˜¯ä¸€ä¸ªå·¥å‚ã€‚</p>\n<p>åœ¨å…·ä½“çš„å®ç°ä¸­ï¼Œä¸»è¦ç”±ä¸‰ç§æ³¨å…¥æ–¹å¼ï¼š</p>\n<p><strong>æ„é€ æ–¹æ³•æ³¨å…¥</strong></p>\n<p>å°±æ˜¯è¢«æ³¨å…¥å¯¹è±¡å¯ä»¥åœ¨å®ƒçš„æ„é€ æ–¹æ³•ä¸­å£°æ˜ä¾èµ–å¯¹è±¡çš„å‚æ•°åˆ—è¡¨ï¼Œè®©å¤–éƒ¨çŸ¥é“å®ƒéœ€è¦å“ªäº›ä¾èµ–å¯¹è±¡ã€‚ç„¶åï¼ŒIoC Service Provider ä¼šæ£€æŸ¥è¢«æ³¨å…¥çš„å¯¹è±¡çš„æ„é€ æ–¹æ³•ï¼Œå–å¾—å®ƒæ‰€éœ€è¦çš„ä¾èµ–å¯¹è±¡åˆ—è¡¨ï¼Œè¿›è€Œä¸ºå…¶æ³¨å…¥ç›¸åº”çš„å¯¹è±¡ã€‚æ„é€ æ–¹æ³•æ³¨å…¥æ–¹å¼æ¯”è¾ƒç›´è§‚ï¼Œå¯¹è±¡è¢«æ„é€ å®Œæˆåï¼Œå³è¿›å…¥å°±ç»ªçŠ¶æ€ï¼Œå¯ä»¥é©¬ä¸Šä½¿ç”¨ã€‚</p>\n<p><strong>setter æ–¹æ³•æ³¨å…¥</strong></p>\n<p>é€šè¿‡ setter æ–¹æ³•ï¼Œå¯ä»¥æ›´æ”¹ç›¸åº”çš„å¯¹è±¡å±æ€§ã€‚æ‰€ä»¥ï¼Œå½“å‰å¯¹è±¡åªè¦ä¸ºå…¶ä¾èµ–å¯¹è±¡æ‰€å¯¹åº”çš„å±æ€§æ·»åŠ  setter æ–¹æ³•ï¼Œå°±å¯ä»¥é€šè¿‡ setter æ–¹æ³•å°†ç›¸åº”çš„ä¾èµ–å¯¹è±¡è®¾ç½®åˆ°è¢«æ³¨å…¥å¯¹è±¡ä¸­ã€‚setter æ–¹æ³•æ³¨å…¥è™½ä¸åƒæ„é€ æ–¹æ³•æ³¨å…¥é‚£æ ·ï¼Œè®©å¯¹è±¡æ„é€ å®Œæˆåå³å¯ä½¿ç”¨ï¼Œä½†ç›¸å¯¹æ¥è¯´æ›´å®½æ¾ä¸€äº›ï¼Œ å¯ä»¥åœ¨å¯¹è±¡æ„é€ å®Œæˆåå†æ³¨å…¥ã€‚</p>\n<p><strong>æ¥å£æ³¨å…¥</strong></p>\n<p>ç›¸å¯¹äºå‰ä¸¤ç§æ³¨å…¥æ–¹å¼æ¥è¯´ï¼Œæ¥å£æ³¨å…¥æ²¡æœ‰é‚£ä¹ˆç®€å•æ˜äº†ã€‚è¢«æ³¨å…¥å¯¹è±¡å¦‚æœæƒ³è¦ IoC Service Provider ä¸ºå…¶æ³¨å…¥ä¾èµ–å¯¹è±¡ï¼Œå°±å¿…é¡»å®ç°æŸä¸ªæ¥å£ã€‚è¿™ä¸ªæ¥å£æä¾›ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨æ¥ä¸ºå…¶æ³¨å…¥ä¾èµ–å¯¹è±¡ã€‚IoC Service Provider æœ€ç»ˆé€šè¿‡è¿™äº›æ¥å£æ¥äº†è§£åº”è¯¥ä¸ºè¢«æ³¨å…¥å¯¹è±¡æ³¨å…¥ä»€ä¹ˆä¾èµ–å¯¹è±¡ã€‚ç›¸å¯¹äºå‰ä¸¤ç§ä¾èµ–æ³¨å…¥æ–¹å¼ï¼Œæ¥å£æ³¨å…¥æ¯”è¾ƒæ­»æ¿å’Œçƒ¦çã€‚</p>\n<h3 id=\"ioc-å®¹å™¨åˆå§‹åŒ–è¿‡ç¨‹\"><a class=\"anchor\" href=\"#ioc-å®¹å™¨åˆå§‹åŒ–è¿‡ç¨‹\">#</a> IOC å®¹å™¨åˆå§‹åŒ–è¿‡ç¨‹</h3>\n<p>ioc å®¹å™¨åˆå§‹åŒ–è¿‡ç¨‹ï¼šBeanDefinition çš„èµ„æºå®šä½ã€è§£æå’Œæ³¨å†Œã€‚</p>\n<ul>\n<li>ä» XML ä¸­è¯»å–é…ç½®æ–‡ä»¶ã€‚</li>\n<li>å°† bean æ ‡ç­¾è§£ææˆ BeanDefinitionï¼Œå¦‚è§£æ property å…ƒç´ ï¼Œ å¹¶æ³¨å…¥åˆ° BeanDefinition å®ä¾‹ä¸­ã€‚</li>\n<li>å°† BeanDefinition æ³¨å†Œåˆ°å®¹å™¨ BeanDefinitionMap ä¸­ã€‚</li>\n<li>BeanFactory æ ¹æ® BeanDefinition çš„å®šä¹‰ä¿¡æ¯åˆ›å»ºå®ä¾‹åŒ–å’Œåˆå§‹åŒ– beanã€‚</li>\n</ul>\n<h3 id=\"beanfactory-applicationcontext\"><a class=\"anchor\" href=\"#beanfactory-applicationcontext\">#</a> BeanFactory &amp; ApplicationContext</h3>\n<p>å®ƒä»¬éƒ½æ˜¯ Spring ä¸­çš„ä¸¤ä¸ªæ¥å£ï¼Œç”¨æ¥è·å– Spring å®¹å™¨ä¸­çš„ beanã€‚</p>\n<p><strong>BeanFactory</strong><br />\nspring å®¹å™¨ä¸­å…·æœ‰ä»£è¡¨æ€§çš„å®¹å™¨å°±æ˜¯ BeanFactory æ¥å£ï¼Œè¿™ä¸ªæ˜¯ spring å®¹å™¨çš„é¡¶å±‚æ¥å£ï¼Œæä¾›äº†å®¹å™¨æœ€åŸºæœ¬çš„åŠŸèƒ½ã€‚</p>\n<p><strong>ApplicationContext</strong><br />\n åº”ç”¨ä¸Šä¸‹æ–‡ï¼Œç»§æ‰¿ BeanFactory æ¥å£ï¼Œå®ƒæ˜¯ Spring çš„ä¸€å„æ›´é«˜çº§çš„å®¹å™¨ï¼Œæä¾›äº†æ›´å¤šçš„æœ‰ç”¨çš„åŠŸèƒ½ï¼›</p>\n<ul>\n<li>å›½é™…åŒ–ï¼ˆMessageSourceï¼‰</li>\n<li>è®¿é—®èµ„æºï¼Œå¦‚ URL å’Œæ–‡ä»¶ï¼ˆResourceLoaderï¼‰</li>\n<li>è½½å…¥å¤šä¸ªï¼ˆæœ‰ç»§æ‰¿å…³ç³»ï¼‰ä¸Šä¸‹æ–‡ ï¼Œä½¿å¾—æ¯ä¸€ä¸ªä¸Šä¸‹æ–‡éƒ½ä¸“æ³¨äºä¸€ä¸ªç‰¹å®šçš„å±‚æ¬¡ï¼Œæ¯”å¦‚åº”ç”¨çš„ web å±‚</li>\n<li>æ¶ˆæ¯å‘é€ã€å“åº”æœºåˆ¶ï¼ˆApplicationEventPublisherï¼‰</li>\n<li>AOPï¼ˆæ‹¦æˆªå™¨ï¼‰</li>\n</ul>\n<h4 id=\"è£…è½½-bean-çš„åŒºåˆ«\"><a class=\"anchor\" href=\"#è£…è½½-bean-çš„åŒºåˆ«\">#</a> è£…è½½ bean çš„åŒºåˆ«</h4>\n<p><strong>BeanFactory</strong><br />\nBeanFactory åœ¨å¯åŠ¨çš„æ—¶å€™ä¸ä¼šå»å®ä¾‹åŒ– Beanï¼Œä¸­æœ‰ä»å®¹å™¨ä¸­æ‹¿ Bean çš„æ—¶å€™æ‰ä¼šå»å®ä¾‹åŒ–ï¼›</p>\n<p><strong>ApplicationContext</strong><br />\nApplicationContext åœ¨å¯åŠ¨çš„æ—¶å€™å°±æŠŠæ‰€æœ‰çš„ Bean å…¨éƒ¨å®ä¾‹åŒ–äº†ã€‚å®ƒè¿˜æä¾›äº†æ›´å¤šçš„åŠŸèƒ½ï¼Œå¦‚å›½é™…åŒ–ã€äº‹ä»¶ä¼ æ’­ã€èµ„æºåŠ è½½ç­‰ã€‚å®ƒè¿˜å¯ä»¥ä¸º Bean é…ç½®  <code>lazy-init=true</code>  æ¥è®© Bean å»¶è¿Ÿå®ä¾‹åŒ–ï¼›</p>\n<h3 id=\"å¾ªç¯ä¾èµ–é—®é¢˜\"><a class=\"anchor\" href=\"#å¾ªç¯ä¾èµ–é—®é¢˜\">#</a> å¾ªç¯ä¾èµ–é—®é¢˜</h3>\n<p>spring å¯¹å¾ªç¯ä¾èµ–çš„å¤„ç†æœ‰ä¸‰ç§æƒ…å†µï¼š</p>\n<ul>\n<li>æ„é€ å™¨çš„å¾ªç¯ä¾èµ–ï¼šè¿™ç§ä¾èµ– spring æ˜¯å¤„ç†ä¸äº†çš„ï¼Œç›´æ¥æŠ›å‡º BeanCurrentlylnCreationException å¼‚å¸¸ã€‚</li>\n<li>å•ä¾‹æ¨¡å¼ä¸‹çš„ setter å¾ªç¯ä¾èµ–ï¼šé€šè¿‡ã€Œä¸‰çº§ç¼“å­˜ã€å¤„ç†å¾ªç¯ä¾èµ–ã€‚</li>\n<li>éå•ä¾‹å¾ªç¯ä¾èµ–ï¼šæ— æ³•å¤„ç†ã€‚</li>\n</ul>\n<p>Spring åœ¨åˆ›å»º Bean çš„è¿‡ç¨‹ä¸­åˆ†ä¸ºä¸‰æ­¥ï¼š</p>\n<ol>\n<li>å®ä¾‹åŒ–ï¼Œå¯¹åº”æ–¹æ³•ï¼šAbstractAutowireCapableBeanFactory ä¸­çš„ createBeanInstance æ–¹æ³•ã€‚</li>\n<li>å±æ€§æ³¨å…¥ï¼Œå¯¹åº”æ–¹æ³•ï¼šAbstractAutowireCapableBeanFactory çš„ populateBean æ–¹æ³•ã€‚</li>\n<li>åˆå§‹åŒ–ï¼Œå¯¹åº”æ–¹æ³•ï¼šAbstractAutowireCapableBeanFactory çš„ initializeBean æ–¹æ³•ã€‚</li>\n</ol>\n<p>Spring ä¸ºäº†è§£å†³å•ä¾‹çš„å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œä½¿ç”¨äº†ä¸‰çº§ç¼“å­˜ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">/** Cache of singleton objects: bean name â€“> bean instance */</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Map</span> singletonObjects <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ConcurrentHashMap</span><span class=\"token punctuation\">(</span><span class=\"token number\">256</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">/** Cache of singleton factories: bean name â€“> ObjectFactory */</span> </pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Map</span><span class=\"token operator\">></span> singletonFactories <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token number\">16</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">/** Cache of early singleton objects: bean name â€“> bean instance */</span> </pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Map</span> earlySingletonObjects <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token punctuation\">(</span><span class=\"token number\">16</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p><strong>ä¸‰çº§ç¼“å­˜çš„ä½œç”¨</strong><br />\n <code>singletonFactories</code>  ï¼š è¿›å…¥å®ä¾‹åŒ–é˜¶æ®µçš„å•ä¾‹å¯¹è±¡å·¥å‚çš„ cache ï¼ˆä¸‰çº§ç¼“å­˜ï¼‰ã€‚<br />\n <code>earlySingletonObjects</code>  ï¼šå®Œæˆå®ä¾‹åŒ–ä½†æ˜¯å°šæœªåˆå§‹åŒ–çš„ï¼Œæå‰æš´å…‰çš„å•ä¾‹å¯¹è±¡çš„ Cache ï¼ˆäºŒçº§ç¼“å­˜ï¼‰ã€‚<br />\n <code>singletonObjects</code> ï¼šå®Œæˆåˆå§‹åŒ–çš„å•ä¾‹å¯¹è±¡çš„ cacheï¼ˆä¸€çº§ç¼“å­˜ï¼‰ã€‚</p>\n<p>æ­¥éª¤ï¼š</p>\n<ol>\n<li>Spring é¦–å…ˆä»ä¸€çº§ç¼“å­˜ singletonObjects ä¸­è·å–ã€‚</li>\n<li>å¦‚æœè·å–ä¸åˆ°ï¼Œå¹¶ä¸”å¯¹è±¡æ­£åœ¨åˆ›å»ºä¸­ï¼Œå°±å†ä»äºŒçº§ç¼“å­˜ earlySingletonObjects ä¸­è·å–ã€‚</li>\n<li>å¦‚æœè¿˜æ˜¯è·å–ä¸åˆ°ä¸”å…è®¸ singletonFactories é€šè¿‡ getObject () è·å–ï¼Œå°±ä»ä¸‰çº§ç¼“å­˜ singletonFactory.getObject ()ï¼ˆä¸‰çº§ç¼“å­˜ï¼‰è·å–ã€‚</li>\n<li>å¦‚æœä»ä¸‰çº§ç¼“å­˜ä¸­è·å–åˆ°å°±ä» singletonFactories ä¸­ç§»é™¤ï¼Œå¹¶æ”¾å…¥ earlySingletonObjects ä¸­ã€‚å…¶å®ä¹Ÿå°±æ˜¯ä»ä¸‰çº§ç¼“å­˜ç§»åŠ¨åˆ°äº†äºŒçº§ç¼“å­˜ã€‚</li>\n</ol>\n<p>æˆ‘ä»¬åœ¨åˆ›å»º bean çš„æ—¶å€™ï¼Œä¼šé¦–å…ˆä» cache ä¸­è·å–è¿™ä¸ª beanï¼Œè¿™ä¸ªç¼“å­˜å°±æ˜¯ sigletonObjectsã€‚ä¸»è¦çš„è°ƒç”¨æ–¹æ³•æ˜¯ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">protected</span> <span class=\"token class-name\">Object</span> <span class=\"token function\">getSingleton</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> beanName<span class=\"token punctuation\">,</span> <span class=\"token keyword\">boolean</span> allowEarlyReference<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">// 1. å…ˆä»ä¸€çº§ç¼“å­˜ä¸­è·å–ï¼Œè·å–åˆ°ç›´æ¥è¿”å›</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token class-name\">Object</span> singletonObject <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>singletonObjects<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>beanName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\">// 2. å¦‚æœè·å–ä¸åˆ°å¹¶ä¸”å¯¹è±¡æ­£åœ¨åˆ›å»ºï¼Œå°±åˆ°äºŒçº§ç¼“å­˜ä¸­å»è·å–ï¼Œè·å–åˆ°ç›´æ¥è¿”å›</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>singletonObject <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">isSingletonCurrentlyInCreation</span><span class=\"token punctuation\">(</span>beanName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">synchronized</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>singletonObjects<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            singletonObject <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>earlySingletonObjects<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>beanName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token comment\">// 3. å¦‚æœä»è·å–ä¸åˆ°ï¼Œä¸”å…è®¸ singletonFactories (allowEarlyCurrentlyInCreation ()ï¼‰é€šè¿‡ getObject () è·å–ã€‚</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token comment\">// å°±åˆ°ä¸‰çº§ç¼“å­˜ä¸­ç”¨ getObject () è·å–ã€‚</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token comment\">// è·å–åˆ°å°±ä» singletonFactories ä¸­ç§»å‡ºï¼Œä¸”æ”¾è¿› earlySingletonObjectsã€‚</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token comment\">//ï¼ˆå³ä»ä¸‰çº§ç¼“å­˜ç§»åŠ¨åˆ°äºŒçº§ç¼“å­˜ï¼‰</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>singletonObject <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">&amp;&amp;</span> allowEarlyReference<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                <span class=\"token class-name\">ObjectFactory</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span> singletonFactory <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>singletonFactories<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>beanName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>singletonFactory <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                    singletonObject <span class=\"token operator\">=</span> singletonFactory<span class=\"token punctuation\">.</span><span class=\"token function\">getObject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>earlySingletonObjects<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span>beanName<span class=\"token punctuation\">,</span> singletonObject<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>singletonFactories<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span>beanName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token keyword\">return</span> singletonObject<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>ä»ä¸‰çº§ç¼“å­˜çš„åˆ†ææ¥çœ‹ï¼ŒSpring è§£å†³å¾ªç¯ä¾èµ–çš„è¯€çªå°±åœ¨äº singletonFactories è¿™ä¸ªæ»´ä¸‰çº§ cacheã€‚è¿™ä¸ª cache çš„ç±»å‹æ˜¯ ObjectFactoryï¼Œå®šä¹‰å¦‚ä¸‹ï¼š</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">ObjectFactory</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">T</span><span class=\"token punctuation\">></span></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token class-name\">T</span> <span class=\"token function\">getObject</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">BeansException</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>è¯¥ç±»å‹åœ¨ <code>addSingletonFactory</code>  æ–¹æ³•ä¸­å¼•ç”¨ã€‚æ–¹æ³•åˆè¢« <code>doCreateBean</code>  è°ƒç”¨ã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">protected</span> <span class=\"token keyword\">void</span> <span class=\"token function\">addSingletonFactory</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> beanName<span class=\"token punctuation\">,</span> <span class=\"token class-name\">ObjectFactory</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span> singletonFactory<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>     </pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token class-name\">Assert</span><span class=\"token punctuation\">.</span><span class=\"token function\">notNull</span><span class=\"token punctuation\">(</span>singletonFactory<span class=\"token punctuation\">,</span> <span class=\"token string\">\"Singleton factory must not be null\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>     </pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">synchronized</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>singletonObjects<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>         </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>singletonObjects<span class=\"token punctuation\">.</span><span class=\"token function\">containsKey</span><span class=\"token punctuation\">(</span>beanName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span>             </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>singletonFactories<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span>beanName<span class=\"token punctuation\">,</span> singletonFactory<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>             </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>earlySingletonObjects<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span>beanName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>            </pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>registeredSingletons<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>beanName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>         </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span>     </pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span> </pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><strong>doCreateBean</strong></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// ä¿å­˜çš„æ˜¯ FactoryBean çš„ beanName -> FactoryBean çš„ BeanWrapper</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">ConcurrentMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">BeanWrapper</span><span class=\"token punctuation\">></span></span> factoryBeanInstanceCache <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ConcurrentHashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">protected</span> <span class=\"token class-name\">Object</span> <span class=\"token function\">doCreateBean</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> beanName<span class=\"token punctuation\">,</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">RootBeanDefinition</span> mbd<span class=\"token punctuation\">,</span> <span class=\"token keyword\">final</span> <span class=\"token annotation punctuation\">@Nullable</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> args<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">throws</span> <span class=\"token class-name\">BeanCreationException</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token comment\">// Instantiate the bean.</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token class-name\">BeanWrapper</span> instanceWrapper <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>mbd<span class=\"token punctuation\">.</span><span class=\"token function\">isSingleton</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token comment\">// å•ä¾‹æƒ…å†µä¸‹æ¸…é™¤ç¼“å­˜ã€‚è¿™é‡Œä¿å­˜çš„æ˜¯ FactoryBean å’Œ BeanWrapper çš„æ˜ å°„å…³ç³»ã€‚ </span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token comment\">//factoryBeanInstanceCache æ˜¯åœ¨åˆ›å»ºå…¶ä»– bean çš„æ—¶å€™ç¼“å­˜äº†ä¸€ä¸‹ FactoryBean ã€‚è‡³äºå•ä¾‹æ¨¡å¼ä¸‹ç§»é™¤è€Œä¸æ˜¯è·å–ï¼Œå› ä¸ºå•ä¾‹åªéœ€è¦åˆ›å»ºä¸€æ¬¡ ï¼Ÿ å°šæœªç†è§£ã€‚</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        instanceWrapper <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>factoryBeanInstanceCache<span class=\"token punctuation\">.</span><span class=\"token function\">remove</span><span class=\"token punctuation\">(</span>beanName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token comment\">// å¦‚æœæ²¡æœ‰ç¼“å­˜ï¼Œåˆ™é‡æ–°åˆ›å»º</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>instanceWrapper <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token comment\">// 1. æ ¹æ®æŒ‡å®šçš„ bean ä½¿ç”¨å¯¹åº”çš„ç­–ç•¥åˆ›å»ºæ–°çš„å®ä¾‹ã€‚å¦‚ï¼šå·¥å‚æ–¹æ³•ã€æ„é€ å‡½æ•°è‡ªåŠ¨æ³¨å…¥ï¼Œç®€å•åˆå§‹åŒ–</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        instanceWrapper <span class=\"token operator\">=</span> <span class=\"token function\">createBeanInstance</span><span class=\"token punctuation\">(</span>beanName<span class=\"token punctuation\">,</span> mbd<span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token comment\">// è·å– bean å®ä¾‹</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">final</span> <span class=\"token class-name\">Object</span> bean <span class=\"token operator\">=</span> instanceWrapper<span class=\"token punctuation\">.</span><span class=\"token function\">getWrappedInstance</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token comment\">// è·å– bean ç±»å‹</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token class-name\">Class</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span> beanType <span class=\"token operator\">=</span> instanceWrapper<span class=\"token punctuation\">.</span><span class=\"token function\">getWrappedClass</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token comment\">// å°†ç›®æ ‡ç±»å‹æ›¿æ¢æˆå®é™…ç”Ÿæˆçš„ç±»å‹ã€‚çº æ­£äº†ä¸Šé¢è¯´åˆ°ç±»å‹é”™è¯¯ï¼ˆå¦‚æœå­˜åœ¨ï¼‰</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>beanType <span class=\"token operator\">!=</span> <span class=\"token class-name\">NullBean</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        mbd<span class=\"token punctuation\">.</span>resolvedTargetType <span class=\"token operator\">=</span> beanType<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token comment\">// Allow post-processors to modify the merged bean definition.</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token comment\">// 2. è°ƒç”¨  MergedBeanDefinitionPostProcessor åå¤„ç†å™¨</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token keyword\">synchronized</span> <span class=\"token punctuation\">(</span>mbd<span class=\"token punctuation\">.</span>postProcessingLock<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>mbd<span class=\"token punctuation\">.</span>postProcessed<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                <span class=\"token comment\">// è°ƒç”¨  MergedBeanDefinitionPostProcessor#postProcessMergedBeanDefinition åå¤„ç†å™¨çš„æ–¹æ³•ã€‚</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>                <span class=\"token function\">applyMergedBeanDefinitionPostProcessors</span><span class=\"token punctuation\">(</span>mbd<span class=\"token punctuation\">,</span> beanType<span class=\"token punctuation\">,</span> beanName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>            <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Throwable</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>                <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BeanCreationException</span><span class=\"token punctuation\">(</span>mbd<span class=\"token punctuation\">.</span><span class=\"token function\">getResourceDescription</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> beanName<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>                        <span class=\"token string\">\"Post-processing of merged bean definition failed\"</span><span class=\"token punctuation\">,</span> ex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>            mbd<span class=\"token punctuation\">.</span>postProcessed <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    <span class=\"token comment\">// Eagerly cache singletons to be able to resolve circular references</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token comment\">// even when triggered by lifecycle interfaces like BeanFactoryAware.</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    <span class=\"token comment\">// 3. åˆ¤æ–­æ˜¯å¦éœ€è¦ææ—©æ›å…‰ ï¼š å•ä¾‹ &amp; å…è®¸å¾ªç¯ä¾èµ– &amp; å½“å‰ bean å·²ç»æ­£åœ¨åˆ›å»ºä¸­</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>    <span class=\"token comment\">// ç”±äºå½“å‰ bean å·²ç»åœ¨åˆ›å»ºä¸­ï¼Œæœ¬æ¬¡åˆ›å»ºå¿…ç„¶æ˜¯å¾ªç¯å¼•ç”¨é€ æˆçš„ï¼Œæ‰€ä»¥è¿™é‡Œåˆ¤æ–­æ˜¯å¦å¯ä»¥éœ€è¦æå‰æ›å…‰</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>    <span class=\"token keyword\">boolean</span> earlySingletonExposure <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>mbd<span class=\"token punctuation\">.</span><span class=\"token function\">isSingleton</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>allowCircularReferences <span class=\"token operator\">&amp;&amp;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>            <span class=\"token function\">isSingletonCurrentlyInCreation</span><span class=\"token punctuation\">(</span>beanName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>earlySingletonExposure<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>logger<span class=\"token punctuation\">.</span><span class=\"token function\">isTraceEnabled</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>            logger<span class=\"token punctuation\">.</span><span class=\"token function\">trace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Eagerly caching bean '\"</span> <span class=\"token operator\">+</span> beanName <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>                    <span class=\"token string\">\"' to allow for resolving potential circular references\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>        <span class=\"token comment\">// 4. ä¸ºé¿å…åæœŸå¾ªç¯ä¾èµ–ï¼Œåœ¨ bean åˆå§‹åŒ–å®Œæˆå‰å°†åˆ›å»ºå®ä¾‹çš„ ObjectFactory åŠ å…¥å·¥ç¨‹  -- è§£å†³å¾ªç¯ä¾èµ–</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>        <span class=\"token function\">addSingletonFactory</span><span class=\"token punctuation\">(</span>beanName<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token function\">getEarlyBeanReference</span><span class=\"token punctuation\">(</span>beanName<span class=\"token punctuation\">,</span> mbd<span class=\"token punctuation\">,</span> bean<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>    <span class=\"token comment\">// Initialize the bean instance.</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>    <span class=\"token class-name\">Object</span> exposedObject <span class=\"token operator\">=</span> bean<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>        <span class=\"token comment\">//  5. å¯¹ bean è¿›è¡Œå±æ€§å¡«å……ï¼Œå°†å„ä¸ªå±æ€§å€¼æ³¨å…¥ï¼Œå…¶ä¸­å¦‚æœå­˜åœ¨ä¾èµ–äºå…¶ä»– bean çš„å±æ€§ï¼Œåˆ™ä¼šé€’å½’åˆå§‹ä¾èµ– bean</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>        <span class=\"token function\">populateBean</span><span class=\"token punctuation\">(</span>beanName<span class=\"token punctuation\">,</span> mbd<span class=\"token punctuation\">,</span> instanceWrapper<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>        <span class=\"token comment\">// è°ƒç”¨åˆå§‹åŒ–æ–¹æ³•ï¼Œæ¯”å¦‚ init-method</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>        exposedObject <span class=\"token operator\">=</span> <span class=\"token function\">initializeBean</span><span class=\"token punctuation\">(</span>beanName<span class=\"token punctuation\">,</span> exposedObject<span class=\"token punctuation\">,</span> mbd<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>    <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Throwable</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>ex <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">BeanCreationException</span> <span class=\"token operator\">&amp;&amp;</span> beanName<span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">BeanCreationException</span><span class=\"token punctuation\">)</span> ex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getBeanName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">BeanCreationException</span><span class=\"token punctuation\">)</span> ex<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>        <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BeanCreationException</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>                    mbd<span class=\"token punctuation\">.</span><span class=\"token function\">getResourceDescription</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> beanName<span class=\"token punctuation\">,</span> <span class=\"token string\">\"Initialization of bean failed\"</span><span class=\"token punctuation\">,</span> ex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>    <span class=\"token comment\">// 6. è¿›è¡Œå¾ªç¯ä¾èµ–æ£€æŸ¥</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>earlySingletonExposure<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>        <span class=\"token class-name\">Object</span> earlySingletonReference <span class=\"token operator\">=</span> <span class=\"token function\">getSingleton</span><span class=\"token punctuation\">(</span>beanName<span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>        <span class=\"token comment\">//earlySingletonReference  åªæœ‰åœ¨æ£€æµ‹åˆ°æœ‰å¾ªç¯ä¾èµ–çš„æƒ…å†µä¸‹æ‰ä¼šä¸ä¸ºç©º</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>earlySingletonReference <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>        <span class=\"token comment\">// å¦‚æœ exposedObject æ²¡æœ‰åœ¨åˆå§‹åŒ–æ–¹æ³•ä¸­è¢«æ”¹å˜ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰è¢«å¢å¼º</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>exposedObject <span class=\"token operator\">==</span> bean<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>                exposedObject <span class=\"token operator\">=</span> earlySingletonReference<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre>            <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>allowRawInjectionDespiteWrapping <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">hasDependentBean</span><span class=\"token punctuation\">(</span>beanName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre>                <span class=\"token class-name\">String</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> dependentBeans <span class=\"token operator\">=</span> <span class=\"token function\">getDependentBeans</span><span class=\"token punctuation\">(</span>beanName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre>                <span class=\"token class-name\">Set</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> actualDependentBeans <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">LinkedHashSet</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span>dependentBeans<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre>                <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> dependentBean <span class=\"token operator\">:</span> dependentBeans<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre>                    <span class=\"token comment\">// æ£€æµ‹ä¾èµ–</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre>                    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token function\">removeSingletonIfCreatedForTypeCheckOnly</span><span class=\"token punctuation\">(</span>dependentBean<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre>                        actualDependentBeans<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>dependentBean<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"94\"></td><td><pre>                <span class=\"token comment\">// å› ä¸º bean åˆ›å»ºåå…¶æ‰€ä¾èµ–çš„ bean ä¸€å®šæ˜¯å·²ç»åˆ›å»ºäº†çš„ã€‚actualDependentBeans ä¸ä¸ºç©ºè¯´æ˜å½“å‰ bean åˆ›å»ºåå…¶ä¾èµ–çš„ bena å´æ²¡æœ‰å…¨éƒ¨åˆ›å»ºå®Œï¼Œä¹Ÿå°±è¯´è¯´å­˜åœ¨å¾ªç¯ä¾èµ–ã€‚</span></pre></td></tr><tr><td data-num=\"95\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>actualDependentBeans<span class=\"token punctuation\">.</span><span class=\"token function\">isEmpty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"96\"></td><td><pre>                    <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BeanCurrentlyInCreationException</span><span class=\"token punctuation\">(</span>beanName<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"97\"></td><td><pre>                            <span class=\"token string\">\"Bean with name '\"</span> <span class=\"token operator\">+</span> beanName <span class=\"token operator\">+</span> <span class=\"token string\">\"' has been injected into other beans [\"</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"98\"></td><td><pre>                            <span class=\"token class-name\">StringUtils</span><span class=\"token punctuation\">.</span><span class=\"token function\">collectionToCommaDelimitedString</span><span class=\"token punctuation\">(</span>actualDependentBeans<span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"99\"></td><td><pre>                            <span class=\"token string\">\"] in its raw version as part of a circular reference, but has eventually been \"</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"100\"></td><td><pre>                            <span class=\"token string\">\"wrapped. This means that said other beans do not use the final version of the \"</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"101\"></td><td><pre>                            <span class=\"token string\">\"bean. This is often the result of over-eager type matching - consider using \"</span> <span class=\"token operator\">+</span></pre></td></tr><tr><td data-num=\"102\"></td><td><pre>                            <span class=\"token string\">\"'getBeanNamesOfType' with the 'allowEagerInit' flag turned off, for example.\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"103\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"104\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"105\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"106\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"107\"></td><td><pre></pre></td></tr><tr><td data-num=\"108\"></td><td><pre>    <span class=\"token comment\">// Register bean as disposable.</span></pre></td></tr><tr><td data-num=\"109\"></td><td><pre>    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"110\"></td><td><pre>        <span class=\"token comment\">// 7. æ ¹æ® Scopse æ³¨å†Œ bean</span></pre></td></tr><tr><td data-num=\"111\"></td><td><pre>        <span class=\"token function\">registerDisposableBeanIfNecessary</span><span class=\"token punctuation\">(</span>beanName<span class=\"token punctuation\">,</span> bean<span class=\"token punctuation\">,</span> mbd<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"112\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"113\"></td><td><pre>    <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">BeanDefinitionValidationException</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"114\"></td><td><pre>        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">BeanCreationException</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"115\"></td><td><pre>                mbd<span class=\"token punctuation\">.</span><span class=\"token function\">getResourceDescription</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> beanName<span class=\"token punctuation\">,</span> <span class=\"token string\">\"Invalid destruction signature\"</span><span class=\"token punctuation\">,</span> ex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"116\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"117\"></td><td><pre></pre></td></tr><tr><td data-num=\"118\"></td><td><pre>    <span class=\"token keyword\">return</span> exposedObject<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"119\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><code>doCreateBean</code>  å¤§è‡´é€»è¾‘å¦‚ä¸‹ï¼š</p>\n<ol>\n<li><code>createBeanInstance(beanName, mbd, args);</code>  ï¼šå®ä¾‹åŒ– beanï¼Œå°† BeanDefinition è½¬æ¢ä¸º BeanWrapper</li>\n<li><code>applyMergedBeanDefinitionPostProcessors(mbd, beanType, beanName);</code>  ï¼š MergedBeanDefinitionPostProcessor åå¤„ç†å™¨çš„åº”ç”¨ã€‚bean åˆå¹¶åçš„å¤„ç†ï¼Œæ¯”å¦‚ @Autowiredã€@Value æ³¨è§£æ­£æ˜¯é€šè¿‡ AutowiredAnnotationBeanPostProcessor#postProcessMergedBeanDefinition æ­¤æ–¹æ³•å®ç°çš„é¢„è§£æã€‚</li>\n<li><code>addSingletonFactory(beanName, () -&gt; getEarlyBeanReference(beanName, mbd, bean));</code>  ï¼š å…³äºå¾ªç¯ä¾èµ–çš„å¤„ç†ï¼Œæ·»åŠ  ObjectFactory åˆ° singletonFactories ç¼“å­˜ä¸­ï¼ŒåŒæ—¶è¿™é‡Œç»™äº†ç”¨æˆ·ä¸€ä¸ªæœºä¼šé€šè¿‡è°ƒç”¨ SmartInstantiationAwareBeanPostProcessor.getEarlyBeanReference æ–¹æ³•æ¥ç”±ç”¨æˆ·ç”Ÿæˆæš´éœ²çš„å®ä¾‹</li>\n<li><code>populateBean(beanName, mbd, instanceWrapper);</code>  ï¼šå¯¹åˆ›å»ºçš„ bean å†…éƒ¨çš„ä¸€äº›å±æ€§è¿›è¡Œå¡«å……æ³¨å…¥</li>\n<li><code>initializeBean(beanName, exposedObject, mbd);</code>  ï¼š åˆå§‹åŒ– bean çš„ä¸€äº›å±æ€§ï¼Œå¦‚ Aware æ¥å£çš„å®ç°ï¼Œ init-method å±æ€§ç­‰</li>\n<li>å¾ªç¯ä¾èµ–æ£€æŸ¥ã€‚å’Œç¬¬å››æ­¥ä¸åŒçš„æ˜¯ï¼Œè¿™é‡Œäº†æ˜¯åˆ¤æ–­æ˜¯å¦æ— æ³•è§£å†³å¾ªç¯ä¾èµ–ï¼Œå¦åˆ™æŠ›å‡ºå¼‚å¸¸ã€‚</li>\n<li><code>registerDisposableBeanIfNecessary(beanName, bean, mbd);</code>  ï¼š æ³¨å†Œ DisposableBean</li>\n<li>å®Œæˆåˆ›å»ºå¹¶è¿”å›ã€‚</li>\n</ol>\n<p><strong>addSingletonFactory</strong></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">addSingletonFactory</span><span class=\"token punctuation\">(</span>beanName<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token function\">getEarlyBeanReference</span><span class=\"token punctuation\">(</span>beanName<span class=\"token punctuation\">,</span> mbd<span class=\"token punctuation\">,</span> bean<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>è¿™ä¸€éƒ¨åˆ†çš„é€»è¾‘å°±æ˜¯ä¸ºäº†è§£å†³å¾ªç¯ä¾èµ–çš„é—®é¢˜ï¼Œå°†æœªåˆ›å»ºå®Œæˆçš„å½“å‰ beanï¼Œé€šè¿‡ ObjectFactory è¿›è¡Œä¸€ä¸ªåŒ…è£…ï¼Œæå‰æš´éœ²ç»™å…¶ä»– beanã€‚</p>\n<p><strong>getEarlyBeanReference</strong></p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">protected</span> <span class=\"token class-name\">Object</span> <span class=\"token function\">getEarlyBeanReference</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> beanName<span class=\"token punctuation\">,</span> <span class=\"token class-name\">RootBeanDefinition</span> mbd<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Object</span> bean<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token class-name\">Object</span> exposedObject <span class=\"token operator\">=</span> bean<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>mbd<span class=\"token punctuation\">.</span><span class=\"token function\">isSynthetic</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">hasInstantiationAwareBeanPostProcessors</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">BeanPostProcessor</span> bp <span class=\"token operator\">:</span> <span class=\"token function\">getBeanPostProcessors</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>bp <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">SmartInstantiationAwareBeanPostProcessor</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                <span class=\"token class-name\">SmartInstantiationAwareBeanPostProcessor</span> ibp <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">SmartInstantiationAwareBeanPostProcessor</span><span class=\"token punctuation\">)</span> bp<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                exposedObject <span class=\"token operator\">=</span> ibp<span class=\"token punctuation\">.</span><span class=\"token function\">getEarlyBeanReference</span><span class=\"token punctuation\">(</span>exposedObject<span class=\"token punctuation\">,</span> beanName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">return</span> exposedObject<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>æ‰€æœ‰çš„</p>\n<h2 id=\"bean\"><a class=\"anchor\" href=\"#bean\">#</a> Bean</h2>\n<h3 id=\"spring-å¦‚ä½•ç®¡ç†-bean\"><a class=\"anchor\" href=\"#spring-å¦‚ä½•ç®¡ç†-bean\">#</a> Spring å¦‚ä½•ç®¡ç† Bean</h3>\n<p>Spring é€šè¿‡ IoC å®¹å™¨æ¥ç®¡ç† Beanï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ XML é…ç½®æˆ–è€…æ³¨è§£é…ç½®ï¼Œæ¥æŒ‡å¯¼ IoC å®¹å™¨å¯¹ Bean çš„ç®¡ç†ã€‚å› ä¸ºæ³¨è§£é…ç½®æ¯” XML é…ç½®æ–¹ä¾¿å¾ˆå¤šï¼Œæ‰€ä»¥ç°åœ¨å¤§å¤šæ—¶å€™ä¼šä½¿ç”¨æ³¨è§£é…ç½®çš„æ–¹å¼ã€‚</p>\n<p>ä»¥ä¸‹æ˜¯ç®¡ç† Bean æ—¶å¸¸ç”¨çš„ä¸€äº›æ³¨è§£ï¼š</p>\n<p><code>@ComponentScan</code>  ç”¨äºå£°æ˜æ‰«æç­–ç•¥ï¼Œé€šè¿‡å®ƒçš„å£°æ˜ï¼Œå®¹å™¨å°±çŸ¥é“è¦æ‰«æå“ªäº›åŒ…ä¸‹å¸¦æœ‰å£°æ˜çš„ç±»ï¼Œä¹Ÿå¯ä»¥çŸ¥é“å“ªäº›ç‰¹å®šçš„ç±»æ˜¯è¢«æ’é™¤åœ¨å¤–çš„ã€‚</p>\n<p><code>@Component</code> ã€ <code>@Repository</code> ã€ <code>@Service</code> ã€ <code>@Controller</code>  ç”¨äºå£°æ˜ Beanï¼Œå®ƒä»¬çš„ä½œç”¨ä¸€æ ·ï¼Œä½†æ˜¯è¯­ä¹‰ä¸åŒã€‚@Component ç”¨äºå£°æ˜é€šç”¨çš„ Beanï¼Œ <code>@Repository</code>  ç”¨äºå£°æ˜ DAO å±‚çš„ Beanï¼Œ@Service ç”¨äºå£°æ˜ä¸šåŠ¡å±‚çš„ Beanï¼Œ <code>@Controller</code>  ç”¨äºå£°æ˜è§†å›¾å±‚çš„æ§åˆ¶å™¨ Beanï¼Œè¢«è¿™äº›æ³¨è§£å£°æ˜çš„ç±»å°±å¯ä»¥è¢«å®¹å™¨æ‰«æå¹¶åˆ›å»ºã€‚</p>\n<p><code>@Autowired</code> ã€ <code>@Qualifier</code>  ç”¨äºæ³¨å…¥ Beanï¼Œå³å‘Šè¯‰å®¹å™¨åº”è¯¥ä¸ºå½“å‰å±æ€§æ³¨å…¥å“ªä¸ª Beanã€‚å…¶ä¸­ï¼Œ@Autowired æ˜¯æŒ‰ç…§ Bean çš„ç±»å‹è¿›è¡ŒåŒ¹é…çš„ï¼Œå¦‚æœè¿™ä¸ªå±æ€§çš„ç±»å‹å…·æœ‰å¤šä¸ª Beanï¼Œå°±å¯ä»¥é€šè¿‡ @Qualifier æŒ‡å®š Bean çš„åç§°ï¼Œä»¥æ¶ˆé™¤æ­§ä¹‰ã€‚</p>\n<p><code>@Scope</code>  ç”¨äºå£°æ˜ Bean çš„ä½œç”¨åŸŸï¼Œé»˜è®¤æƒ…å†µä¸‹ Bean æ˜¯å•ä¾‹çš„ï¼Œå³åœ¨æ•´ä¸ªå®¹å™¨ä¸­è¿™ä¸ªç±»å‹åªæœ‰ä¸€ä¸ªå®ä¾‹ã€‚å¯ä»¥é€šè¿‡ <code>@Scope</code>  æ³¨è§£æŒ‡å®š prototype å€¼å°†å…¶å£°æ˜ä¸ºå¤šä¾‹çš„ï¼Œä¹Ÿå¯ä»¥å°† Bean å£°æ˜ä¸º session çº§ä½œç”¨åŸŸã€request çº§ä½œç”¨åŸŸç­‰ç­‰ï¼Œä½†æœ€å¸¸ç”¨çš„è¿˜æ˜¯é»˜è®¤çš„å•ä¾‹æ¨¡å¼ã€‚</p>\n<p><code>@PostConstruct</code> ã€ <code>@PreDestroy</code>  ç”¨äºå£°æ˜ Bean çš„ç”Ÿå‘½å‘¨æœŸã€‚å…¶ä¸­ï¼Œè¢« <code>@PostConstruct</code>  ä¿®é¥°çš„æ–¹æ³•å°†åœ¨ Bean å®ä¾‹åŒ–åè¢«è°ƒç”¨ï¼Œ <code>@PreDestroy</code>  ä¿®é¥°çš„æ–¹æ³•å°†åœ¨å®¹å™¨é”€æ¯å‰è¢«è°ƒç”¨ã€‚</p>\n<h3 id=\"bean-çš„ä½œç”¨åŸŸ\"><a class=\"anchor\" href=\"#bean-çš„ä½œç”¨åŸŸ\">#</a> Bean çš„ä½œç”¨åŸŸ</h3>\n<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒBean åœ¨ Spring å®¹å™¨ä¸­æ˜¯å•ä¾‹çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ @Scope æ³¨è§£ä¿®æ”¹ Bean çš„ä½œç”¨åŸŸã€‚è¯¥æ³¨è§£æœ‰å¦‚ä¸‹ 5 ä¸ªå–å€¼ï¼Œå®ƒä»¬ä»£è¡¨äº† Bean çš„ 5 ç§ä¸åŒç±»å‹çš„ä½œç”¨åŸŸï¼š</p>\n<table>\n<thead>\n<tr>\n<th>ç±»å‹</th>\n<th>è¯´æ˜</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>singleton</td>\n<td>åœ¨ Spring å®¹å™¨ä¸­ä»…å­˜åœ¨ä¸€ä¸ªå®ä¾‹ï¼Œå³ Bean ä»¥å•ä¾‹çš„å½¢å¼å­˜åœ¨ã€‚</td>\n</tr>\n<tr>\n<td>prototype</td>\n<td>æ¯æ¬¡è°ƒç”¨ getBean () æ—¶ï¼Œéƒ½ä¼šæ‰§è¡Œ new æ“ä½œï¼Œè¿”å›ä¸€ä¸ªæ–°çš„å®ä¾‹ã€‚</td>\n</tr>\n<tr>\n<td>request</td>\n<td>æ¯æ¬¡ HTTP è¯·æ±‚éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ Beanã€‚</td>\n</tr>\n<tr>\n<td>session</td>\n<td>åŒä¸€ä¸ª HTTP</td>\n<td>Session å…±äº«ä¸€ä¸ª Beanï¼Œä¸åŒçš„ HTTP Session ä½¿ç”¨ä¸åŒçš„ Beanã€‚</td>\n</tr>\n<tr>\n<td>globalSession</td>\n<td>åŒä¸€ä¸ªå…¨å±€çš„ Session å…±äº«ä¸€ä¸ª Beanï¼Œä¸€èˆ¬ç”¨äº Portlet ç¯å¢ƒã€‚</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"bean-çš„ç”Ÿå‘½å‘¨æœŸ\"><a class=\"anchor\" href=\"#bean-çš„ç”Ÿå‘½å‘¨æœŸ\">#</a> Bean çš„ç”Ÿå‘½å‘¨æœŸ</h3>\n<p><img data-src=\"https://cdn.jsdelivr.net/gh/haust-Kevin/static@master//images/202311011911438.png\" alt=\"\" /></p>\n<p>Spring bean çš„ç”Ÿå‘½å‘¨æœŸåªæœ‰å››ä¸ªä¸»è¦é˜¶æ®µï¼Œå…¶ä»–éƒ½æ˜¯åœ¨è¿™å››ä¸ªä¸»è¦é˜¶æ®µå‰åçš„æ‰©å±•ç‚¹ï¼Œè¿™å››ä¸ªé˜¶æ®µæ˜¯ï¼š</p>\n<ol>\n<li>å®ä¾‹åŒ– Instantiation</li>\n<li>å±æ€§èµ‹å€¼ Populate</li>\n<li>åˆå§‹åŒ– Initialization</li>\n<li>é”€æ¯ Destruction</li>\n</ol>\n<h3 id=\"beanfactory-factorybean\"><a class=\"anchor\" href=\"#beanfactory-factorybean\">#</a> BeanFactory &amp; FactoryBean</h3>\n<p><code>BeanFactory</code> ï¼šç®¡ç† Bean çš„å®¹å™¨ï¼ŒSpring ä¸­ç”Ÿæˆçš„ Bean éƒ½æ˜¯ç”±è¿™ä¸ªæ¥å£çš„å®ç°æ¥ç®¡ç†çš„ã€‚</p>\n<p><code>FactoryBean</code> ï¼šé€šå¸¸æ˜¯ç”¨æ¥åˆ›å»ºæ¯”è¾ƒå¤æ‚çš„ beanï¼Œä¸€èˆ¬çš„ bean ç›´æ¥ç”¨ xml é…ç½®å³å¯ï¼Œä½†å¦‚æœä¸€ä¸ª bean çš„åˆ›å»ºè¿‡ç¨‹ä¸­æ¶‰åŠåˆ°å¾ˆå¤šå…¶ä»–çš„ bean å’Œå¤æ‚çš„é€»è¾‘ï¼Œç›´æ¥ç”¨ xml é…ç½®æ¯”è¾ƒéº»çƒ¦ï¼Œè¿™æ—¶å¯ä»¥è€ƒè™‘ç”¨ FactoryBeanï¼Œå¯ä»¥éšè—å®ä¾‹åŒ–å¤æ‚ Bean çš„ç»†èŠ‚ã€‚<br />\nå½“é…ç½®æ–‡ä»¶ä¸­ bean æ ‡ç­¾çš„ class å±æ€§é…ç½®çš„å®ç°ç±»æ˜¯ FactoryBean æ—¶ï¼Œé€šè¿‡ getBean () æ–¹æ³•è¿”å›çš„ä¸æ˜¯ FactoryBean æœ¬èº«ï¼Œè€Œæ˜¯è°ƒç”¨ FactoryBean#getObject () æ–¹æ³•æ‰€è¿”å›çš„å¯¹è±¡ï¼Œç›¸å½“äº FactoryBean#getObject () ä»£ç†äº† getBean () æ–¹æ³•ã€‚å¦‚æœæƒ³å¾—åˆ° FactoryBean å¿…é¡»ä½¿ç”¨ '&amp;' + beanName çš„æ–¹å¼è·å–ã€‚</p>\n<h3 id=\"bean-æ³¨å…¥å®¹å™¨çš„æ–¹å¼\"><a class=\"anchor\" href=\"#bean-æ³¨å…¥å®¹å™¨çš„æ–¹å¼\">#</a> Bean æ³¨å…¥å®¹å™¨çš„æ–¹å¼</h3>\n<p>å°†æ™®é€šç±»äº¤ç»™ Spring å®¹å™¨ç®¡ç†ï¼Œé€šå¸¸æœ‰ä»¥ä¸‹æ–¹æ³•ï¼š</p>\n<p>1ã€ä½¿ç”¨ <code>@Configuration</code>  ä¸ <code>@Bean</code>  æ³¨è§£<br />\n 2ã€ä½¿ç”¨ <code>@Controller</code> ã€ <code>@Service</code> ã€ <code>@Repository</code> ã€ <code>@Component</code>  æ³¨è§£æ ‡æ³¨è¯¥ç±»ï¼Œç„¶åå¯ç”¨ <code>@ComponentScan</code>  è‡ªåŠ¨æ‰«æ<br />\n 3ã€ä½¿ç”¨ <code>@Import</code>  æ³¨è§£æŠŠ bean å¯¼å…¥åˆ°å½“å‰å®¹å™¨ä¸­ã€‚</p>\n<h2 id=\"å…¶å®ƒé—®é¢˜\"><a class=\"anchor\" href=\"#å…¶å®ƒé—®é¢˜\">#</a> å…¶å®ƒé—®é¢˜</h2>\n<h3 id=\"autowired-resource\"><a class=\"anchor\" href=\"#autowired-resource\">#</a> @Autowired &amp; @Resource</h3>\n<ul>\n<li>@Autowired æ˜¯ Spring æä¾›çš„æ³¨è§£ï¼Œ@Resource æ˜¯ JDK æä¾›çš„æ³¨è§£ã€‚</li>\n<li>@Autowired æ˜¯åªèƒ½æŒ‰ç±»å‹æ³¨å…¥ï¼Œ@Resource é»˜è®¤æŒ‰åç§°æ³¨å…¥ï¼Œä¹Ÿæ”¯æŒæŒ‰ç±»å‹æ³¨å…¥ã€‚</li>\n<li>@Autowired æŒ‰ç±»å‹è£…é…ä¾èµ–å¯¹è±¡ï¼Œé»˜è®¤æƒ…å†µä¸‹å®ƒè¦æ±‚ä¾èµ–å¯¹è±¡å¿…é¡»å­˜åœ¨ï¼Œå¦‚æœå…è®¸ null å€¼ï¼Œå¯ä»¥è®¾ç½®å®ƒ required å±æ€§ä¸º falseï¼Œå¦‚æœæˆ‘ä»¬æƒ³ä½¿ç”¨æŒ‰åç§°è£…é…ï¼Œå¯ä»¥ç»“åˆ @Qualifier æ³¨è§£ä¸€èµ·ä½¿ç”¨ã€‚@Resource æœ‰ä¸¤ä¸ªä¸­é‡è¦çš„å±æ€§ï¼šname å’Œ typeã€‚name å±æ€§æŒ‡å®š byNameï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®š name å±æ€§ï¼Œå½“æ³¨è§£æ ‡æ³¨åœ¨å­—æ®µä¸Šï¼Œå³é»˜è®¤å–å­—æ®µçš„åç§°ä½œä¸º bean åç§°å¯»æ‰¾ä¾èµ–å¯¹è±¡ï¼Œå½“æ³¨è§£æ ‡æ³¨åœ¨å±æ€§çš„ setter æ–¹æ³•ä¸Šï¼Œå³é»˜è®¤å–å±æ€§åä½œä¸º bean åç§°å¯»æ‰¾ä¾èµ–å¯¹è±¡ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ@Resource å¦‚æœæ²¡æœ‰æŒ‡å®š name å±æ€§ï¼Œå¹¶ä¸”æŒ‰ç…§é»˜è®¤çš„åç§°ä»ç„¶æ‰¾ä¸åˆ°ä¾èµ–å¯¹è±¡æ—¶ï¼Œ @Resource æ³¨è§£ä¼šå›é€€åˆ°æŒ‰ç±»å‹è£…é…ã€‚ä½†ä¸€æ—¦æŒ‡å®šäº† name å±æ€§ï¼Œå°±åªèƒ½æŒ‰åç§°è£…é…äº†ã€‚</li>\n</ul>\n<h3 id=\"spring-ä¸­é»˜è®¤æä¾›çš„å•ä¾‹æ˜¯çº¿ç¨‹å®‰å…¨çš„å—\"><a class=\"anchor\" href=\"#spring-ä¸­é»˜è®¤æä¾›çš„å•ä¾‹æ˜¯çº¿ç¨‹å®‰å…¨çš„å—\">#</a> Spring ä¸­é»˜è®¤æä¾›çš„å•ä¾‹æ˜¯çº¿ç¨‹å®‰å…¨çš„å—</h3>\n<p><strong>ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„</strong>ï¼ŒSpring å®¹å™¨æœ¬èº«å¹¶æ²¡æœ‰æä¾› Bean çš„çº¿ç¨‹å®‰å…¨ç­–ç•¥ã€‚å¦‚æœå•ä¾‹çš„ Bean æ˜¯ä¸€ä¸ªæ— çŠ¶æ€çš„ Beanï¼Œå³çº¿ç¨‹ä¸­çš„æ“ä½œä¸ä¼šå¯¹ Bean çš„æˆå‘˜æ‰§è¡ŒæŸ¥è¯¢ä»¥å¤–çš„æ“ä½œï¼Œé‚£ä¹ˆè¿™ä¸ªå•ä¾‹çš„ Bean æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚æ¯”å¦‚ï¼ŒControllerã€Serviceã€DAO è¿™æ ·çš„ç»„ä»¶ï¼Œé€šå¸¸éƒ½æ˜¯å•ä¾‹ä¸”çº¿ç¨‹å®‰å…¨çš„ã€‚å¦‚æœå•ä¾‹çš„ Bean æ˜¯ä¸€ä¸ªæœ‰çŠ¶æ€çš„ Beanï¼Œåˆ™å¯ä»¥é‡‡ç”¨ ThreadLocal å¯¹çŠ¶æ€æ•°æ®åšçº¿ç¨‹éš”ç¦»ï¼Œæ¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚</p>\n<h3 id=\"spring-å¦‚ä½•ç®¡ç†äº‹åŠ¡\"><a class=\"anchor\" href=\"#spring-å¦‚ä½•ç®¡ç†äº‹åŠ¡\">#</a> Spring å¦‚ä½•ç®¡ç†äº‹åŠ¡ï¼Ÿ</h3>\n<p>å‚è€ƒç­”æ¡ˆ</p>\n<p>Spring ä¸ºäº‹åŠ¡ç®¡ç†æä¾›äº†ä¸€è‡´çš„ç¼–ç¨‹æ¨¡æ¿ï¼Œåœ¨é«˜å±‚æ¬¡ä¸Šå»ºç«‹äº†ç»Ÿä¸€çš„äº‹åŠ¡æŠ½è±¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸ç®¡æ˜¯é€‰æ‹© MyBatisã€Hibernateã€JPA è¿˜æ˜¯ Spring JDBCï¼ŒSpring éƒ½å¯ä»¥è®©ç”¨æˆ·ä»¥ç»Ÿä¸€çš„ç¼–ç¨‹æ¨¡å‹è¿›è¡Œäº‹åŠ¡ç®¡ç†ã€‚</p>\n<h3 id=\"spring-æ”¯æŒä¸¤ç§äº‹åŠ¡ç¼–ç¨‹æ¨¡å‹\"><a class=\"anchor\" href=\"#spring-æ”¯æŒä¸¤ç§äº‹åŠ¡ç¼–ç¨‹æ¨¡å‹\">#</a> Spring æ”¯æŒä¸¤ç§äº‹åŠ¡ç¼–ç¨‹æ¨¡å‹ï¼š</h3>\n<p><strong>ç¼–ç¨‹å¼äº‹åŠ¡</strong><br />\n Spring æä¾›äº† TransactionTemplate æ¨¡æ¿ï¼Œåˆ©ç”¨è¯¥æ¨¡æ¿æˆ‘ä»¬å¯ä»¥é€šè¿‡ç¼–ç¨‹çš„æ–¹å¼å®ç°äº‹åŠ¡ç®¡ç†ï¼Œè€Œæ— éœ€å…³æ³¨èµ„æºè·å–ã€å¤ç”¨ã€é‡Šæ”¾ã€äº‹åŠ¡åŒæ­¥åŠå¼‚å¸¸å¤„ç†ç­‰æ“ä½œã€‚ç›¸å¯¹äºå£°æ˜å¼äº‹åŠ¡æ¥è¯´ï¼Œè¿™ç§æ–¹å¼ç›¸å¯¹éº»çƒ¦ä¸€äº›ï¼Œä½†æ˜¯å¥½åœ¨æ›´ä¸ºçµæ´»ï¼Œæˆ‘ä»¬å¯ä»¥å°†äº‹åŠ¡ç®¡ç†çš„èŒƒå›´æ§åˆ¶çš„æ›´ä¸ºç²¾ç¡®ã€‚</p>\n<p><strong>å£°æ˜å¼äº‹åŠ¡</strong><br />\n Spring äº‹åŠ¡ç®¡ç†çš„äº®ç‚¹åœ¨äºå£°æ˜å¼äº‹åŠ¡ç®¡ç†ï¼Œå®ƒå…è®¸æˆ‘ä»¬é€šè¿‡å£°æ˜çš„æ–¹å¼ï¼Œåœ¨ IoC é…ç½®ä¸­æŒ‡å®šäº‹åŠ¡çš„è¾¹ç•Œå’Œäº‹åŠ¡å±æ€§ï¼ŒSpring ä¼šè‡ªåŠ¨åœ¨æŒ‡å®šçš„äº‹åŠ¡è¾¹ç•Œä¸Šåº”ç”¨äº‹åŠ¡å±æ€§ã€‚ç›¸å¯¹äºç¼–ç¨‹å¼äº‹åŠ¡æ¥è¯´ï¼Œè¿™ç§æ–¹å¼ååˆ†çš„æ–¹ä¾¿ï¼Œåªéœ€è¦åœ¨éœ€è¦åšäº‹åŠ¡ç®¡ç†çš„æ–¹æ³•ä¸Šï¼Œå¢åŠ  @Transactional æ³¨è§£ï¼Œä»¥å£°æ˜äº‹åŠ¡ç‰¹å¾å³å¯ã€‚</p>\n<h3 id=\"spring-è‡ªåŠ¨è£…é…çš„æ–¹å¼æœ‰å“ªäº›\"><a class=\"anchor\" href=\"#spring-è‡ªåŠ¨è£…é…çš„æ–¹å¼æœ‰å“ªäº›\">#</a> Spring è‡ªåŠ¨è£…é…çš„æ–¹å¼æœ‰å“ªäº›</h3>\n<p>Spring çš„è‡ªåŠ¨è£…é…æœ‰ä¸‰ç§æ¨¡å¼ï¼šbyTypeï¼ˆæ ¹æ®ç±»å‹ï¼‰ï¼ŒbyNameï¼ˆæ ¹æ®åç§°ï¼‰ã€constructorï¼ˆæ ¹æ®æ„é€ å‡½æ•°ï¼‰ã€‚</p>\n<h2 id=\"spring-boot\"><a class=\"anchor\" href=\"#spring-boot\">#</a> Spring Boot</h2>\n<p>ä»æœ¬è´¨ä¸Šæ¥è¯´ï¼ŒSpring Boot å°±æ˜¯ Springï¼Œå®ƒåšäº†é‚£äº›æ²¡æœ‰å®ƒä½ è‡ªå·±ä¹Ÿä¼šå»åšçš„ Spring Bean é…ç½®ã€‚Spring Boot ä½¿ç”¨ â€œä¹ æƒ¯ä¼˜äºé…ç½®â€ çš„ç†å¿µè®©ä½ çš„é¡¹ç›®å¿«é€Ÿåœ°è¿è¡Œèµ·æ¥ï¼Œä½¿ç”¨ Spring Boot å¾ˆå®¹æ˜“åˆ›å»ºä¸€ä¸ªèƒ½ç‹¬ç«‹è¿è¡Œã€å‡†ç”Ÿäº§çº§åˆ«ã€åŸºäº Spring æ¡†æ¶çš„é¡¹ç›®ï¼Œä½¿ç”¨ Spring Boot ä½ å¯ä»¥ä¸ç”¨æˆ–è€…åªéœ€è¦å¾ˆå°‘çš„ Spring é…ç½®ã€‚</p>\n<p>ç®€è€Œè¨€ä¹‹ï¼ŒSpring Boot æœ¬èº«å¹¶ä¸æä¾› Spring çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œè€Œæ˜¯ä½œä¸º Spring çš„è„šæ‰‹æ¶æ¡†æ¶ï¼Œä»¥è¾¾åˆ°å¿«é€Ÿæ„å»ºé¡¹ç›®ã€é¢„ç½®ä¸‰æ–¹é…ç½®ã€å¼€ç®±å³ç”¨çš„ç›®çš„ã€‚Spring Boot æœ‰å¦‚ä¸‹çš„ä¼˜ç‚¹ï¼š</p>\n<ul>\n<li>å¯ä»¥å¿«é€Ÿæ„å»ºé¡¹ç›®ï¼›</li>\n<li>å¯ä»¥å¯¹ä¸»æµå¼€å‘æ¡†æ¶çš„æ— é…ç½®é›†æˆï¼›</li>\n<li>é¡¹ç›®å¯ç‹¬ç«‹è¿è¡Œï¼Œæ— éœ€å¤–éƒ¨ä¾èµ– Servlet å®¹å™¨ï¼›</li>\n<li>æä¾›è¿è¡Œæ—¶çš„åº”ç”¨ç›‘æ§ï¼›</li>\n<li>å¯ä»¥æå¤§åœ°æé«˜å¼€å‘ã€éƒ¨ç½²æ•ˆç‡ï¼›</li>\n<li>å¯ä»¥ä¸äº‘è®¡ç®—å¤©ç„¶é›†æˆã€‚</li>\n</ul>\n<h3 id=\"æ ¸å¿ƒæ³¨è§£\"><a class=\"anchor\" href=\"#æ ¸å¿ƒæ³¨è§£\">#</a> æ ¸å¿ƒæ³¨è§£</h3>\n<p>æ ¸å¿ƒæ³¨è§£æ˜¯ @SpringBootApplicationï¼Œå®ƒä¸»è¦ç”± @SpringBootConfigurationï¼Œ@EnableAutoConfiguration å’Œ @ComponentScan è¿™ä¸‰ä¸ªæ„æˆ</p>\n<ul>\n<li>\n<p><code>@SpringBootConfiguration</code>  é‡Œé¢å°±åªæœ‰ä¸€ä¸ª @Configuration ä¸»è¦æ³¨è§£ï¼Œä¹Ÿå°±æ˜¯æŠŠè¯¥ç±»å˜æˆä¸€ä¸ªé…ç½®ç±»æ‰€ä»¥ @SpringBootConfiguration å°±ç›¸å½“äº @Configurationã€‚</p>\n</li>\n<li>\n<p><code>@EnableAutoConfiguration</code>  æ˜¯ç”± @AutoConfigurationPackage å’Œ @Import (EnableAutoConfigurationImportSelector.class) è¿™ä¸¤ä¸ªç»„æˆçš„</p>\n<ul>\n<li>@AutoConfigurationPackage æ˜¯è‡ªåŠ¨é…ç½®åŒ…ï¼ŒåŒ…æ‹¬äº†ä¸€ä¸ª @Import æ³¨è§£ï¼Œç»™å®¹å™¨å¯¼å…¥äº†è‡ªåŠ¨é…ç½®åŒ…çš„æ³¨å†Œå™¨ï¼ŒAutoConfigurationPackages.Registrar.classï¼šå°†ä¸»å¯åŠ¨ç±»çš„æ‰€åœ¨åŒ…åŠåŒ…ä¸‹é¢æ‰€æœ‰å­åŒ…é‡Œé¢çš„æ‰€æœ‰ç»„ä»¶æ‰«æåˆ° Spring å®¹å™¨</li>\n<li>@Import (AutoConfigurationImportSelector.class)ï¼šå¯¼å…¥è‡ªåŠ¨é…ç½®å¯¼å…¥é€‰æ‹©å™¨ç»„ä»¶ï¼ŒAutoConfigurationImportSelector.classï¼šè‡ªåŠ¨é…ç½®å¯¼å…¥é€‰æ‹©å™¨ï¼Œä¸»è¦æ˜¯ä»ç±»è·¯å¾„ä¸‹çš„ META-INF/spring.factories ä¸­è·å–èµ„æº</li>\n</ul>\n</li>\n<li>\n<p><code> @ComponentScan</code> ï¼šæ‰«æåŒ…ï¼Œè¯¥æ³¨è§£é»˜è®¤ä¼šæ‰«æè¯¥ç±»æ‰€åœ¨çš„åŒ…ä¸‹æ‰€æœ‰çš„é…ç½®ç±»</p>\n</li>\n</ul>\n<h3 id=\"å¯åŠ¨æµç¨‹\"><a class=\"anchor\" href=\"#å¯åŠ¨æµç¨‹\">#</a> å¯åŠ¨æµç¨‹</h3>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">ConfigurableApplicationContext</span> <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> args<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">// åˆ›å»º StopWatchï¼Œç”¨äºç»Ÿè®¡ Springboot å¯åŠ¨çš„è€—æ—¶</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token class-name\">StopWatch</span> stopWatch <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">StopWatch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\">// å¼€å§‹è®¡æ—¶</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    stopWatch<span class=\"token punctuation\">.</span><span class=\"token function\">start</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token class-name\">DefaultBootstrapContext</span> bootstrapContext <span class=\"token operator\">=</span> <span class=\"token function\">createBootstrapContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token class-name\">ConfigurableApplicationContext</span> context <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token function\">configureHeadlessProperty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token comment\">// è·å–è¿è¡Œæ—¶ç›‘å¬å™¨</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token class-name\">SpringApplicationRunListeners</span> listeners <span class=\"token operator\">=</span> <span class=\"token function\">getRunListeners</span><span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token comment\">// è°ƒç”¨è¿è¡Œæ—¶ç›‘å¬å™¨çš„ starting () æ–¹æ³•</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token comment\">// è¯¥æ–¹æ³•éœ€è¦åœ¨ Springboot ä¸€å¯åŠ¨æ—¶å°±è°ƒç”¨ï¼Œç”¨äºç‰¹åˆ«æ—©æœŸçš„åˆå§‹åŒ–</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    listeners<span class=\"token punctuation\">.</span><span class=\"token function\">starting</span><span class=\"token punctuation\">(</span>bootstrapContext<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mainApplicationClass<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token comment\">// è·å– args å‚æ•°å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token class-name\">ApplicationArguments</span> applicationArguments <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DefaultApplicationArguments</span><span class=\"token punctuation\">(</span>args<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token comment\">// è¯»å– Springboot é…ç½®æ–‡ä»¶å¹¶åˆ›å»º Environment å¯¹è±¡</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token comment\">// è¿™é‡Œåˆ›å»ºçš„ Environment å¯¹è±¡å®é™…ä¸º ConfigurableEnvironment</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token class-name\">ConfigurableEnvironment</span> environment <span class=\"token operator\">=</span> <span class=\"token function\">prepareEnvironment</span><span class=\"token punctuation\">(</span>listeners<span class=\"token punctuation\">,</span> bootstrapContext<span class=\"token punctuation\">,</span> applicationArguments<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token function\">configureIgnoreBeanInfo</span><span class=\"token punctuation\">(</span>environment<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token comment\">// æ‰“å° Banner å›¾æ ‡</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token class-name\">Banner</span> printedBanner <span class=\"token operator\">=</span> <span class=\"token function\">printBanner</span><span class=\"token punctuation\">(</span>environment<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token comment\">// åˆ›å»º ApplicationContext åº”ç”¨è¡Œä¸‹æ–‡ï¼Œå³åˆ›å»ºå®¹å™¨</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        context <span class=\"token operator\">=</span> <span class=\"token function\">createApplicationContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        context<span class=\"token punctuation\">.</span><span class=\"token function\">setApplicationStartup</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>applicationStartup<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token comment\">// å‡†å¤‡å®¹å™¨</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token function\">prepareContext</span><span class=\"token punctuation\">(</span>bootstrapContext<span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">,</span> environment<span class=\"token punctuation\">,</span> listeners<span class=\"token punctuation\">,</span> applicationArguments<span class=\"token punctuation\">,</span> printedBanner<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token comment\">// åˆå§‹åŒ–å®¹å™¨</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token function\">refreshContext</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token function\">afterRefresh</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">,</span> applicationArguments<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token comment\">// åœæ­¢è®¡æ—¶</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        stopWatch<span class=\"token punctuation\">.</span><span class=\"token function\">stop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>logStartupInfo<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            <span class=\"token comment\">// æ‰“å°å¯åŠ¨è€—æ—¶ç­‰ä¿¡æ¯</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>            <span class=\"token keyword\">new</span> <span class=\"token class-name\">StartupInfoLogger</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>mainApplicationClass<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">logStarted</span><span class=\"token punctuation\">(</span><span class=\"token function\">getApplicationLog</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> stopWatch<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token comment\">// è°ƒç”¨è¿è¡Œæ—¶ç›‘å¬å™¨çš„ started () æ–¹æ³•</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        <span class=\"token comment\">// è¯¥æ–¹æ³•éœ€è¦åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨åï¼ŒCommandLineRunners å’Œ ApplicationRunners è¢«è°ƒç”¨å‰æ‰§è¡Œ</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        listeners<span class=\"token punctuation\">.</span><span class=\"token function\">started</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        <span class=\"token function\">callRunners</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">,</span> applicationArguments<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Throwable</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>        <span class=\"token function\">handleRunFailure</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">,</span> ex<span class=\"token punctuation\">,</span> listeners<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalStateException</span><span class=\"token punctuation\">(</span>ex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>    <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>        <span class=\"token comment\">// è°ƒç”¨è¿è¡Œæ—¶ç›‘å¬å™¨çš„ running () æ–¹æ³•</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>        <span class=\"token comment\">// è¯¥æ–¹æ³•éœ€è¦åœ¨ SpringApplication çš„ run () æ–¹æ³•æ‰§è¡Œå®Œä¹‹å‰è¢«è°ƒç”¨</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>        listeners<span class=\"token punctuation\">.</span><span class=\"token function\">running</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>    <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Throwable</span> ex<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>        <span class=\"token function\">handleRunFailure</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">,</span> ex<span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalStateException</span><span class=\"token punctuation\">(</span>ex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>    <span class=\"token keyword\">return</span> context<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><img data-src=\"https://cdn.jsdelivr.net/gh/haust-Kevin/static@master//images/202311021821659.jpg\" alt=\"\" /></p>\n<p>SpringApplication åœ¨ run æ–¹æ³•ä¸­é‡ç‚¹åšäº†ä»¥ä¸‹æ“ä½œï¼š</p>\n<ul>\n<li>è·å–ç›‘å¬å™¨å’Œå‚æ•°é…ç½®ï¼›</li>\n<li>æ‰“å° Banner ä¿¡æ¯ï¼›</li>\n<li>åˆ›å»ºå¹¶åˆå§‹åŒ–å®¹å™¨ï¼›</li>\n<li>ç›‘å¬å™¨å‘é€é€šçŸ¥ã€‚</li>\n</ul>\n<h2 id=\"spring-cloud\"><a class=\"anchor\" href=\"#spring-cloud\">#</a> Spring Cloud</h2>\n<p>Spring Cloud æ˜¯ä¸€æ•´å¥—åŸºäº Spring Boot çš„å¾®æœåŠ¡è§£å†³æ–¹æ¡ˆã€‚å®ƒä¸ºå¼€å‘è€…æä¾›äº†å¾ˆå¤šå·¥å…·ï¼Œç”¨äºå¿«é€Ÿæ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸€äº›é€šç”¨æ¨¡å¼ï¼Œä¾‹å¦‚ï¼šé…ç½®ç®¡ç†ã€æ³¨å†Œä¸­å¿ƒã€æœåŠ¡å‘ç°ã€é™æµã€ç½‘å…³ã€é“¾è·¯è¿½è¸ªç­‰ã€‚</p>\n<h3 id=\"æ ¸å¿ƒç»„ä»¶\"><a class=\"anchor\" href=\"#æ ¸å¿ƒç»„ä»¶\">#</a> æ ¸å¿ƒç»„ä»¶</h3>\n<ol>\n<li>æ³¨å†Œä¸­å¿ƒç»„ä»¶ï¼ˆæœåŠ¡æ²»ç†ï¼‰ï¼šNetflixÂ Eurekaï¼›</li>\n<li>è´Ÿè½½å‡è¡¡ç»„ä»¶ï¼šNetflixÂ Ribbonï¼Œå„ä¸ªå¾®æœåŠ¡è¿›è¡Œåˆ†æ‘Šï¼Œæé«˜æ€§èƒ½ï¼›</li>\n<li>ç†”æ–­å™¨ç»„ä»¶ï¼ˆæ–­è·¯å™¨ï¼‰ï¼šNetflix Hystrixï¼ŒResilience4j ï¼›ä¿æŠ¤ç³»ç»Ÿï¼Œæ§åˆ¶æ•…éšœèŒƒå›´ï¼›</li>\n<li>ç½‘å…³æœåŠ¡ç»„ä»¶ï¼šZuulï¼ŒSpring Cloud Gatewayï¼›api ç½‘å…³ï¼Œè·¯ç”±ï¼Œè´Ÿè½½å‡è¡¡ç­‰å¤šç§ä½œç”¨ï¼›</li>\n<li>é…ç½®ä¸­å¿ƒï¼šSpring Cloud Configï¼Œå°†é…ç½®æ–‡ä»¶ç»„åˆèµ·æ¥ï¼Œæ”¾åœ¨è¿œç¨‹ä»“åº“ï¼Œä¾¿äºç®¡ç†ï¼›</li>\n</ol>\n",
            "tags": [
                "é¢è¯•æŒ‡åŒ—",
                "Web",
                "å…«è‚¡æ–‡",
                "Spring",
                "Web"
            ]
        },
        {
            "id": "https://haust-kevin.github.io/2023/10/28/2023-10-interview-db-redis/",
            "url": "https://haust-kevin.github.io/2023/10/28/2023-10-interview-db-redis/",
            "title": "é¢è¯•æŒ‡åŒ—ï¼šRedis æ•°æ®åº“",
            "date_published": "2023-10-28T07:01:27.000Z",
            "content_html": "<h2 id=\"redis\"><a class=\"anchor\" href=\"#redis\">#</a> Redis</h2>\n<p>Redisï¼Œè‹±æ–‡å…¨ç§°æ˜¯ Remote Dictionary Serverï¼ˆè¿œç¨‹å­—å…¸æœåŠ¡ï¼‰ï¼Œæ˜¯ä¸€ä¸ªå¼€æºçš„ä½¿ç”¨ ANSI C è¯­è¨€ç¼–å†™ã€æ”¯æŒç½‘ç»œã€å¯åŸºäºå†…å­˜äº¦å¯æŒä¹…åŒ–çš„æ—¥å¿—å‹ã€Key-Value æ•°æ®åº“ï¼Œå¹¶æä¾›å¤šç§è¯­è¨€çš„ APIã€‚</p>\n<p>ä¸ MySQL æ•°æ®åº“ä¸åŒçš„æ˜¯ï¼Œ Redis çš„æ•°æ®æ˜¯å­˜åœ¨å†…å­˜ä¸­çš„ã€‚å®ƒçš„è¯»å†™é€Ÿåº¦éå¸¸å¿«ï¼Œæ¯ç§’å¯ä»¥å¤„ç†è¶…è¿‡ 10 ä¸‡æ¬¡è¯»å†™æ“ä½œã€‚å› æ­¤ redis è¢«å¹¿æ³›åº”ç”¨äºç¼“å­˜ï¼Œå¦å¤–ï¼Œ Redis ä¹Ÿç»å¸¸ç”¨æ¥åšåˆ†å¸ƒå¼é”ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œ Redis æ”¯æŒäº‹åŠ¡ã€æŒä¹…åŒ–ã€LUA è„šæœ¬ã€LRU é©±åŠ¨äº‹ä»¶ã€å¤šç§é›†ç¾¤æ–¹æ¡ˆã€‚</p>\n<h3 id=\"redis-ä¸ºä½•è¿™ä¹ˆå¿«\"><a class=\"anchor\" href=\"#redis-ä¸ºä½•è¿™ä¹ˆå¿«\">#</a> Redis ä¸ºä½•è¿™ä¹ˆå¿«</h3>\n<ul>\n<li>Redis æ˜¯çº¯å†…å­˜æ•°æ®åº“ï¼Œä¸€èˆ¬éƒ½æ˜¯ç®€å•çš„å­˜å–æ“ä½œï¼Œçº¿ç¨‹å ç”¨çš„æ—¶é—´å¾ˆå¤šï¼Œæ—¶é—´çš„èŠ±è´¹ä¸»è¦é›†ä¸­åœ¨ IO ä¸Šï¼Œæ‰€ä»¥è¯»å–é€Ÿåº¦å¿«ã€‚</li>\n<li>Redis ä½¿ç”¨çš„æ˜¯éé˜»å¡ IO ã€ IO å¤šè·¯å¤ç”¨ï¼Œä½¿ç”¨äº†å•çº¿ç¨‹æ¥è½®è¯¢æè¿°ç¬¦ï¼Œå°†æ•°æ®åº“çš„å¼€ã€å…³ã€è¯»ã€å†™éƒ½è½¬æ¢æˆäº†äº‹ä»¶ï¼Œå‡å°‘äº†çº¿ç¨‹åˆ‡æ¢æ—¶ä¸Šä¸‹æ–‡çš„åˆ‡æ¢å’Œç«äº‰ã€‚</li>\n</ul>\n<h3 id=\"ä¸ºä½•ä½¿ç”¨å•çº¿ç¨‹\"><a class=\"anchor\" href=\"#ä¸ºä½•ä½¿ç”¨å•çº¿ç¨‹\">#</a> ä¸ºä½•ä½¿ç”¨å•çº¿ç¨‹</h3>\n<p>å› ä¸º Redis æ˜¯åŸºäºå†…å­˜çš„æ“ä½œï¼ŒCPU ä¸ä¼šæˆä¸º Redis çš„ç“¶é¢ˆï¼Œè€Œæœ€æœ‰å¯èƒ½æ˜¯æœºå™¨å†…å­˜çš„å¤§å°æˆ–è€…ç½‘ç»œå¸¦å®½ã€‚æ—¢ç„¶å•çº¿ç¨‹å®¹æ˜“å®ç°ï¼Œè€Œä¸” CPU ä¸ä¼šæˆä¸ºç“¶é¢ˆï¼Œé‚£å°±é¡ºç†æˆç« åœ°é‡‡ç”¨å•çº¿ç¨‹çš„æ–¹æ¡ˆäº†ã€‚</p>\n<h3 id=\"redis-åœ¨æŒä¹…åŒ–æ—¶-fork-å‡ºä¸€ä¸ªå­è¿›ç¨‹è¿™æ—¶å·²ç»æœ‰ä¸¤ä¸ªè¿›ç¨‹äº†æ€ä¹ˆèƒ½è¯´æ˜¯å•çº¿ç¨‹å‘¢\"><a class=\"anchor\" href=\"#redis-åœ¨æŒä¹…åŒ–æ—¶-fork-å‡ºä¸€ä¸ªå­è¿›ç¨‹è¿™æ—¶å·²ç»æœ‰ä¸¤ä¸ªè¿›ç¨‹äº†æ€ä¹ˆèƒ½è¯´æ˜¯å•çº¿ç¨‹å‘¢\">#</a> Redis åœ¨æŒä¹…åŒ–æ—¶ fork å‡ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œè¿™æ—¶å·²ç»æœ‰ä¸¤ä¸ªè¿›ç¨‹äº†ï¼Œæ€ä¹ˆèƒ½è¯´æ˜¯å•çº¿ç¨‹å‘¢</h3>\n<p>Redis æ˜¯å•çº¿ç¨‹çš„ï¼Œä¸»è¦æ˜¯æŒ‡ Redis çš„ç½‘ç»œ IO å’Œé”®å€¼å¯¹è¯»å†™æ˜¯ç”±ä¸€ä¸ªçº¿ç¨‹æ¥å®Œæˆçš„ã€‚è€Œ Redis çš„å…¶ä»–åŠŸèƒ½ï¼Œå¦‚<strong>æŒä¹…åŒ–</strong>ã€<strong>å¼‚æ­¥åˆ é™¤</strong>ã€<strong>é›†ç¾¤æ•°æ®åŒæ­¥</strong>ç­‰ï¼Œåˆ™æ˜¯ä¾èµ–å…¶ä»–çº¿ç¨‹æ¥æ‰§è¡Œçš„ã€‚æ‰€ä»¥ï¼Œè¯´ Redis æ˜¯å•çº¿ç¨‹çš„åªæ˜¯ä¸€ç§ä¹ æƒ¯çš„è¯´æ³•ï¼Œäº‹å®ä¸Šå®ƒçš„åº•å±‚ä¸æ˜¯å•çº¿ç¨‹çš„ã€‚</p>\n<h3 id=\"å¦‚ä½•ä¿è¯-redis-çš„é«˜å¹¶å‘\"><a class=\"anchor\" href=\"#å¦‚ä½•ä¿è¯-redis-çš„é«˜å¹¶å‘\">#</a> å¦‚ä½•ä¿è¯ Redis çš„é«˜å¹¶å‘</h3>\n<p>Redis é€šè¿‡ä¸»ä»åŠ é›†ç¾¤æ¶æ„ï¼Œå®ç°è¯»å†™åˆ†ç¦»ï¼Œä¸»èŠ‚ç‚¹è´Ÿè´£å†™ï¼Œå¹¶å°†æ•°æ®åŒæ­¥ç»™å…¶ä»–ä»èŠ‚ç‚¹ï¼Œä»èŠ‚ç‚¹è´Ÿè´£è¯»ï¼Œä»è€Œå®ç°é«˜å¹¶å‘ã€‚</p>\n<h2 id=\"æŒä¹…åŒ–\"><a class=\"anchor\" href=\"#æŒä¹…åŒ–\">#</a> æŒä¹…åŒ–</h2>\n<p>redis æä¾›äº†ä¸¤ç§æŒä¹…åŒ–çš„æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯ RDBï¼ˆRedis DataBaseï¼‰å’Œ AOFï¼ˆAppend Only Fileï¼‰ã€‚</p>\n<p>RDB ï¼Œç®€è€Œè¨€ä¹‹ï¼Œå°±æ˜¯åœ¨ä¸åŒçš„æ—¶é—´ç‚¹ï¼Œå°† redis å­˜å‚¨çš„æ•°æ®ç”Ÿæˆå¿«ç…§å¹¶å­˜å‚¨åˆ°ç£ç›˜ç­‰ä»‹è´¨ä¸Šã€‚</p>\n<p>AOFï¼Œåˆ™æ˜¯æ¢äº†ä¸€ä¸ªè§’åº¦æ¥å®ç°æŒä¹…åŒ–ï¼Œé‚£å°±æ˜¯å°† redis æ‰§è¡Œè¿‡çš„æ‰€æœ‰å†™æŒ‡ä»¤è®°å½•ä¸‹æ¥ï¼Œåœ¨ä¸‹æ¬¡ redis é‡æ–°å¯åŠ¨æ—¶ï¼Œåªè¦æŠŠè¿™äº›å†™æŒ‡ä»¤ä»å‰åˆ°åå†é‡å¤æ‰§è¡Œä¸€éï¼Œå°±å¯ä»¥å®ç°æ•°æ®æ¢å¤äº†ã€‚</p>\n<p>å…¶å® RDB å’Œ AOF ä¸¤ç§æ–¹å¼ä¹Ÿå¯ä»¥åŒæ—¶ä½¿ç”¨ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœ redis é‡å¯çš„è¯ï¼Œåˆ™ä¼šä¼˜å…ˆé‡‡ç”¨ AOF æ–¹å¼æ¥è¿›è¡Œæ•°æ®æ¢å¤ï¼Œè¿™æ˜¯å› ä¸º AOF æ–¹å¼çš„æ•°æ®æ¢å¤å®Œæ•´åº¦æ›´é«˜ã€‚</p>\n<h3 id=\"rdb-æŒä¹…åŒ–\"><a class=\"anchor\" href=\"#rdb-æŒä¹…åŒ–\">#</a> RDB æŒä¹…åŒ–</h3>\n<p>RDB æ–¹å¼ï¼Œæ˜¯å°† redis æŸä¸€æ—¶åˆ»çš„æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ä¸­ï¼Œæ˜¯ä¸€ç§å¿«ç…§å¼çš„æŒä¹…åŒ–æ–¹æ³•ã€‚</p>\n<p>redis åœ¨è¿›è¡Œæ•°æ®æŒä¹…åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œä¼šå…ˆå°†æ•°æ®å†™å…¥åˆ°ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ä¸­ï¼Œå¾…æŒä¹…åŒ–è¿‡ç¨‹éƒ½ç»“æŸäº†ï¼Œæ‰ä¼šç”¨è¿™ä¸ªä¸´æ—¶æ–‡ä»¶æ›¿æ¢ä¸Šæ¬¡æŒä¹…åŒ–å¥½çš„æ–‡ä»¶ã€‚æ­£æ˜¯è¿™ç§ç‰¹æ€§ï¼Œè®©æˆ‘ä»¬å¯ä»¥éšæ—¶æ¥è¿›è¡Œå¤‡ä»½ï¼Œå› ä¸ºå¿«ç…§æ–‡ä»¶æ€»æ˜¯å®Œæ•´å¯ç”¨çš„ã€‚</p>\n<p>å¯¹äº RDB æ–¹å¼ï¼Œredis ä¼šå•ç‹¬åˆ›å»ºï¼ˆforkï¼‰ä¸€ä¸ªå­è¿›ç¨‹æ¥è¿›è¡ŒæŒä¹…åŒ–ï¼Œè€Œä¸»è¿›ç¨‹æ˜¯ä¸ä¼šè¿›è¡Œä»»ä½• IO æ“ä½œçš„ï¼Œè¿™æ ·å°±ç¡®ä¿äº† redis æé«˜çš„æ€§èƒ½ã€‚</p>\n<p>å¦‚æœéœ€è¦è¿›è¡Œå¤§è§„æ¨¡æ•°æ®çš„æ¢å¤ï¼Œä¸”å¯¹äºæ•°æ®æ¢å¤çš„å®Œæ•´æ€§ä¸æ˜¯éå¸¸æ•æ„Ÿï¼Œé‚£ RDB æ–¹å¼è¦æ¯” AOF æ–¹å¼æ›´åŠ çš„é«˜æ•ˆã€‚</p>\n<p>ç¼ºç‚¹ï¼š RDB æ–‡ä»¶çš„è‡´å‘½ç¼ºç‚¹åœ¨äºå…¶æ•°æ®å¿«ç…§çš„æŒä¹…åŒ–æ–¹å¼å†³å®šäº†å¿…ç„¶åšä¸åˆ°å®æ—¶æŒä¹…åŒ–ï¼Œè€Œåœ¨æ•°æ®è¶Šæ¥è¶Šé‡è¦çš„ä»Šå¤©ï¼Œæ•°æ®çš„å¤§é‡ä¸¢å¤±å¾ˆå¤šæ—¶å€™æ˜¯æ— æ³•æ¥å—çš„ã€‚</p>\n<h3 id=\"aof-æŒä¹…åŒ–\"><a class=\"anchor\" href=\"#aof-æŒä¹…åŒ–\">#</a> AOF æŒä¹…åŒ–</h3>\n<p>AOFï¼Œè‹±æ–‡æ˜¯ Append Only Fileï¼Œå³åªå…è®¸è¿½åŠ ä¸å…è®¸æ”¹å†™çš„æ–‡ä»¶ã€‚</p>\n<p>å› ä¸ºé‡‡ç”¨äº†è¿½åŠ æ–¹å¼ï¼Œå¦‚æœä¸åšä»»ä½•å¤„ç†çš„è¯ï¼ŒAOF æ–‡ä»¶ä¼šå˜å¾—è¶Šæ¥è¶Šå¤§ï¼Œä¸ºæ­¤ï¼Œredis æä¾›äº† AOF æ–‡ä»¶é‡å†™ï¼ˆrewriteï¼‰æœºåˆ¶ï¼Œå³å½“ AOF æ–‡ä»¶çš„å¤§å°è¶…è¿‡æ‰€è®¾å®šçš„é˜ˆå€¼æ—¶ï¼Œredis å°±ä¼šå¯åŠ¨ AOF æ–‡ä»¶çš„å†…å®¹å‹ç¼©ï¼Œåªä¿ç•™å¯ä»¥æ¢å¤æ•°æ®çš„æœ€å°æŒ‡ä»¤é›†ã€‚<br />\nä¸ RDB æŒä¹…åŒ–ç›¸å¯¹åº”ï¼Œ AOF çš„ä¼˜ç‚¹åœ¨äºæ”¯æŒç§’çº§æŒä¹…åŒ–ã€å…¼å®¹æ€§å¥½ï¼Œç¼ºç‚¹æ˜¯æ–‡ä»¶å¤§ã€æ¢å¤é€Ÿåº¦æ…¢ã€å¯¹æ€§èƒ½å½±å“å¤§ã€‚</p>\n<h3 id=\"aof-é‡å†™\"><a class=\"anchor\" href=\"#aof-é‡å†™\">#</a> AOF é‡å†™</h3>\n<p>åœ¨é‡å†™å³å°†å¼€å§‹ä¹‹é™…ï¼Œredis ä¼šåˆ›å»ºï¼ˆforkï¼‰ä¸€ä¸ª â€œé‡å†™å­è¿›ç¨‹â€ï¼Œè¿™ä¸ªå­è¿›ç¨‹ä¼šé¦–å…ˆè¯»å–ç°æœ‰çš„ AOF æ–‡ä»¶ï¼Œå¹¶å°†å…¶åŒ…å«çš„æŒ‡ä»¤è¿›è¡Œåˆ†æå‹ç¼©å¹¶å†™å…¥åˆ°ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ä¸­ã€‚</p>\n<p>ä¸æ­¤åŒæ—¶ï¼Œä¸»å·¥ä½œè¿›ç¨‹ä¼šå°†æ–°æ¥æ”¶åˆ°çš„å†™æŒ‡ä»¤ä¸€è¾¹ç´¯ç§¯åˆ°å†…å­˜ç¼“å†²åŒºä¸­ï¼Œä¸€è¾¹ç»§ç»­å†™å…¥åˆ°åŸæœ‰çš„ AOF æ–‡ä»¶ä¸­ï¼Œè¿™æ ·åšæ˜¯ä¿è¯åŸæœ‰çš„ AOF æ–‡ä»¶çš„å¯ç”¨æ€§ï¼Œé¿å…åœ¨é‡å†™è¿‡ç¨‹ä¸­å‡ºç°æ„å¤–ã€‚</p>\n<p>å½“ â€œé‡å†™å­è¿›ç¨‹â€ å®Œæˆé‡å†™å·¥ä½œåï¼Œå®ƒä¼šç»™çˆ¶è¿›ç¨‹å‘ä¸€ä¸ªä¿¡å·ï¼Œçˆ¶è¿›ç¨‹æ”¶åˆ°ä¿¡å·åå°±ä¼šå°†å†…å­˜ä¸­ç¼“å­˜çš„å†™æŒ‡ä»¤è¿½åŠ åˆ°æ–° AOF æ–‡ä»¶ä¸­ã€‚</p>\n<p>å½“è¿½åŠ ç»“æŸåï¼Œredis å°±ä¼šç”¨æ–° AOF æ–‡ä»¶æ¥ä»£æ›¿æ—§ AOF æ–‡ä»¶ï¼Œä¹‹åå†æœ‰æ–°çš„å†™æŒ‡ä»¤ï¼Œå°±éƒ½ä¼šè¿½åŠ åˆ°æ–°çš„ AOF æ–‡ä»¶ä¸­äº†ã€‚</p>\n<h3 id=\"è¿‡æœŸé”®åˆ é™¤ç­–ç•¥\"><a class=\"anchor\" href=\"#è¿‡æœŸé”®åˆ é™¤ç­–ç•¥\">#</a> è¿‡æœŸé”®åˆ é™¤ç­–ç•¥</h3>\n<ul>\n<li><strong>å®šæ—¶åˆ é™¤</strong>ï¼šåœ¨è®¾ç½®é”®çš„è¿‡æœŸæ—¶é—´çš„åŒæ—¶ï¼Œåˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨ timerã€‚è®©å®šæ—¶å™¨åœ¨é”®çš„è¿‡æœŸæ—¶é—´æ¥ä¸´æ—¶ï¼Œç«‹å³æ‰§è¡Œå¯¹é”®çš„åˆ é™¤æ“ä½œã€‚</li>\n<li><strong>æƒ°æ€§åˆ é™¤</strong>ï¼šæ”¾ä»»é”®è¿‡æœŸä¸ç®¡ï¼Œä½†æ˜¯æ¯æ¬¡ä»é”®ç©ºé—´ä¸­è·å–é”®æ—¶ï¼Œéƒ½æ£€æŸ¥å–å¾—çš„é”®æ˜¯å¦è¿‡æœŸï¼Œå¦‚æœè¿‡æœŸçš„è¯ï¼Œå°±åˆ é™¤è¯¥é”®ã€‚å¦‚æœæ²¡æœ‰è¿‡æœŸï¼Œå°±è¿”å›è¯¥é”®ã€‚</li>\n<li><strong>å®šæœŸåˆ é™¤</strong>ï¼šæ¯éš”ä¸€æ®µæ—¶é—´ç¨‹åºå°±å¯¹æ•°æ®åº“è¿›è¡Œä¸€æ¬¡æ£€æŸ¥ï¼Œåˆ é™¤é‡Œé¢çš„è¿‡æœŸé”®ã€‚è‡³äºè¦åˆ é™¤å¤šå°‘è¿‡æœŸé”®ï¼Œä»¥åŠè¦æ£€æŸ¥å¤šå°‘ä¸ªæ•°æ®åº“ï¼Œåˆ™ç”±ç®—æ³•å†³å®šã€‚</li>\n</ul>\n<p>åœ¨ä¸Šè¿°çš„ä¸‰ç§ç­–ç•¥ä¸­å®šæ—¶åˆ é™¤å’Œå®šæœŸåˆ é™¤å±äºä¸åŒæ—¶é—´ç²’åº¦çš„ä¸»åŠ¨åˆ é™¤ï¼Œæƒ°æ€§åˆ é™¤å±äºè¢«åŠ¨åˆ é™¤ã€‚ä¸‰ç§ç­–ç•¥éƒ½æœ‰å„è‡ªçš„ä¼˜ç¼ºç‚¹ï¼š</p>\n<ul>\n<li>å®šæ—¶åˆ é™¤ å¯¹å†…å­˜ä½¿ç”¨ç‡æœ‰ä¼˜åŠ¿ï¼Œä½†æ˜¯å¯¹ CPU ä¸å‹å¥½ã€‚</li>\n<li>æƒ°æ€§åˆ é™¤ å¯¹å†…å­˜ä¸å‹å¥½ï¼Œå¦‚æœæŸäº›é”®å€¼å¯¹ä¸€ç›´ä¸è¢«ä½¿ç”¨ï¼Œé‚£ä¹ˆä¼šé€ æˆä¸€å®šé‡çš„å†…å­˜æµªè´¹ã€‚</li>\n<li>å®šæœŸåˆ é™¤ æ˜¯å®šæ—¶åˆ é™¤å’Œæƒ°æ€§åˆ é™¤çš„æŠ˜ä¸­ã€‚</li>\n</ul>\n<h4 id=\"redis-å®ç°\"><a class=\"anchor\" href=\"#redis-å®ç°\">#</a> Redis å®ç°</h4>\n<p>Reids é‡‡ç”¨çš„æ˜¯<strong>æƒ°æ€§åˆ é™¤</strong>å’Œ<strong>å®šæœŸåˆ é™¤</strong>çš„ç»“åˆï¼Œä¸€èˆ¬æ¥è¯´å¯ä»¥å€ŸåŠ©<strong>æœ€å°å †</strong>æ¥å®ç°å®šæ—¶å™¨ï¼Œä¸è¿‡ Redis çš„è®¾è®¡è€ƒè™‘åˆ°æ—¶é—´äº‹ä»¶çš„æœ‰é™ç§ç±»å’Œæ•°é‡ï¼Œä½¿ç”¨äº†æ— åºé“¾è¡¨å­˜å‚¨æ—¶é—´äº‹ä»¶ï¼Œè¿™æ ·å¦‚æœåœ¨æ­¤åŸºç¡€ä¸Šå®ç°å®šæ—¶åˆ é™¤ï¼Œå°±æ„å‘³ç€ O (N) éå†è·å–æœ€è¿‘éœ€è¦åˆ é™¤çš„æ•°æ®ã€‚</p>\n<h5 id=\"å®šæœŸåˆ é™¤ç­–ç•¥\"><a class=\"anchor\" href=\"#å®šæœŸåˆ é™¤ç­–ç•¥\">#</a> å®šæœŸåˆ é™¤ç­–ç•¥</h5>\n<p>Redis ä¼šå°†æ¯ä¸ªè®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„ key æ”¾å…¥åˆ°ä¸€ä¸ªç‹¬ç«‹çš„å­—å…¸ä¸­ï¼Œé»˜è®¤æ¯ 100ms è¿›è¡Œä¸€æ¬¡è¿‡æœŸæ‰«æï¼š</p>\n<ul>\n<li>å¯¹äºæ¯ä¸ªæ•°æ®åº“ï¼š\n<ul>\n<li>éšæœºæŠ½å– 20 æ¬¡ key</li>\n<li>åˆ é™¤è¿™ 20ï¼ˆå¯èƒ½å­˜åœ¨é‡å¤ï¼‰ ä¸ª key ä¸­è¿‡æœŸçš„ key</li>\n</ul>\n</li>\n<li>åˆ é™¤æœŸé—´è¾¾åˆ°æ—¶é—´é™åˆ¶ï¼Œç»“æŸæœ¬æ¬¡åˆ é™¤ã€‚</li>\n</ul>\n<p><strong>ä»åº“çš„è¿‡æœŸç­–ç•¥</strong><br />\nä»åº“ä¸ä¼šè¿›è¡Œè¿‡æœŸæ‰«æï¼Œä»åº“å¯¹è¿‡æœŸçš„å¤„ç†æ˜¯è¢«åŠ¨çš„ã€‚ä¸»åº“åœ¨ key åˆ°æœŸæ—¶ï¼Œä¼šåœ¨ AOF æ–‡ä»¶é‡Œå¢åŠ ä¸€æ¡ del æŒ‡ä»¤ï¼ŒåŒæ­¥åˆ°æ‰€æœ‰çš„ä»åº“ï¼Œä»åº“é€šè¿‡æ‰§è¡Œè¿™æ¡ del æŒ‡ä»¤æ¥åˆ é™¤è¿‡æœŸçš„ keyã€‚</p>\n<h3 id=\"å†…å­˜æ·˜æ±°ç­–ç•¥\"><a class=\"anchor\" href=\"#å†…å­˜æ·˜æ±°ç­–ç•¥\">#</a> å†…å­˜æ·˜æ±°ç­–ç•¥</h3>\n<ul>\n<li><strong>noeviction</strong>ï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œæ–°å†™å…¥æ“ä½œä¼šæŠ¥é”™ã€‚è¿™ä¸ªä¸€èˆ¬å¾ˆå°‘ç”¨ã€‚</li>\n<li><strong>allkeys-lru</strong>ï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œåœ¨é”®ç©ºé—´ä¸­ï¼Œç§»é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„ key ï¼Œè¿™ä¸ªæ˜¯æœ€å¸¸ç”¨çš„ã€‚</li>\n<li><strong>allkeys-random</strong>ï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œåœ¨é”®ç©ºé—´ä¸­ï¼Œéšæœºç§»é™¤æŸä¸ª key ã€‚</li>\n<li><strong>volatile-lru</strong>ï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œåœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ç©ºé—´ä¸­ï¼Œç§»é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„ key ã€‚</li>\n<li><strong>volatile-random</strong>ï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œåœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ç©ºé—´ä¸­ï¼Œéšæœºç§»é™¤æŸä¸ª key ã€‚</li>\n<li><strong>volatile-ttl</strong>ï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œåœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ç©ºé—´ä¸­ï¼Œæœ‰æ›´æ—©è¿‡æœŸæ—¶é—´çš„ key ä¼˜å…ˆç§»é™¤ã€‚</li>\n</ul>\n<p><strong>LRU ç®—æ³•</strong><br />\næ¨èä¸€ç¯‡æ–‡ç« ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly9qdWVqaW4uY24vcG9zdC83Mjg5NjYyNDc2NzM5ODA1MjQx\">ä¸ºä»€ä¹ˆ LRU ç®—æ³•åŸç†å’Œä»£ç å®ç°ä¸ä¸€æ ·ï¼Ÿ</span></p>\n<h2 id=\"æ•°æ®å­˜å‚¨\"><a class=\"anchor\" href=\"#æ•°æ®å­˜å‚¨\">#</a> æ•°æ®å­˜å‚¨</h2>\n<p>Redis æ•°æ®ç»“æ„</p>\n<ul>\n<li>å­—ç¬¦ä¸² String</li>\n<li>å­—å…¸ Hash</li>\n<li>åˆ—è¡¨ List</li>\n<li>é›†åˆ Set</li>\n<li>æœ‰åºé›†åˆ Zset</li>\n</ul>\n<h3 id=\"redis-å¯¹è±¡\"><a class=\"anchor\" href=\"#redis-å¯¹è±¡\">#</a> Redis å¯¹è±¡</h3>\n<p>Redis ä¸­çš„æ¯ä¸ªå¯¹è±¡éƒ½ç”±ä¸€ä¸ª redisObject ç»“æ„è¡¨ç¤ºï¼Œ è¯¥ç»“æ„ä¸­å’Œä¿å­˜æ•°æ®æœ‰å…³çš„ä¸‰ä¸ªå±æ€§åˆ†åˆ«æ˜¯ type å±æ€§ã€ encoding å±æ€§å’Œ ptr å±æ€§ï¼š</p>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">typedef</span> <span class=\"token keyword\">struct</span> <span class=\"token class-name\">redisObject</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">// ç±»å‹</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">unsigned</span> type<span class=\"token operator\">:</span><span class=\"token number\">4</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\">// ç¼–ç </span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">unsigned</span> encoding<span class=\"token operator\">:</span><span class=\"token number\">4</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\">// æŒ‡å‘åº•å±‚å®ç°æ•°æ®ç»“æ„çš„æŒ‡é’ˆ</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token operator\">*</span>ptr<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token comment\">// å¼•ç”¨è®¡æ•°</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">int</span> refcount<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token comment\">// ...</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span> robj<span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h4 id=\"å†…å­˜å›æ”¶\"><a class=\"anchor\" href=\"#å†…å­˜å›æ”¶\">#</a> å†…å­˜å›æ”¶</h4>\n<p>å› ä¸º C è¯­è¨€å¹¶ä¸å…·å¤‡è‡ªåŠ¨çš„å†…å­˜å›æ”¶åŠŸèƒ½ï¼Œ æ‰€ä»¥ Redis åœ¨è‡ªå·±çš„å¯¹è±¡ç³»ç»Ÿä¸­æ„å»ºäº†ä¸€ä¸ªå¼•ç”¨è®¡æ•°ï¼ˆreference countingï¼‰æŠ€æœ¯å®ç°çš„å†…å­˜å›æ”¶æœºåˆ¶ï¼Œ é€šè¿‡è¿™ä¸€æœºåˆ¶ï¼Œ ç¨‹åºå¯ä»¥é€šè¿‡è·Ÿè¸ªå¯¹è±¡çš„å¼•ç”¨è®¡æ•°ä¿¡æ¯ï¼Œ åœ¨é€‚å½“çš„æ—¶å€™è‡ªåŠ¨é‡Šæ”¾å¯¹è±¡å¹¶è¿›è¡Œå†…å­˜å›æ”¶ã€‚</p>\n<p>å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ä¿¡æ¯ä¼šéšç€å¯¹è±¡çš„ä½¿ç”¨çŠ¶æ€è€Œä¸æ–­å˜åŒ–ï¼š</p>\n<ul>\n<li>åœ¨åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡æ—¶ï¼Œ å¼•ç”¨è®¡æ•°çš„å€¼ä¼šè¢«åˆå§‹åŒ–ä¸º 1 ã€‚</li>\n<li>å½“å¯¹è±¡è¢«ä¸€ä¸ªæ–°ç¨‹åºä½¿ç”¨æ—¶ï¼Œ å®ƒçš„å¼•ç”¨è®¡æ•°å€¼ä¼šè¢«å¢ä¸€ã€‚</li>\n<li>å½“å¯¹è±¡ä¸å†è¢«ä¸€ä¸ªç¨‹åºä½¿ç”¨æ—¶ï¼Œ å®ƒçš„å¼•ç”¨è®¡æ•°å€¼ä¼šè¢«å‡ä¸€ã€‚</li>\n<li>å½“å¯¹è±¡çš„å¼•ç”¨è®¡æ•°å€¼å˜ä¸º 0 æ—¶ï¼Œ å¯¹è±¡æ‰€å ç”¨çš„å†…å­˜ä¼šè¢«é‡Šæ”¾ã€‚</li>\n</ul>\n<h3 id=\"å­—å…¸çš„å®ç°\"><a class=\"anchor\" href=\"#å­—å…¸çš„å®ç°\">#</a> å­—å…¸çš„å®ç°</h3>\n<p>Redis ä¸­çš„å­—å…¸ç”± dict.h/dict ç»“æ„è¡¨ç¤ºï¼š</p>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">typedef</span> <span class=\"token keyword\">struct</span> <span class=\"token class-name\">dict</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">// ç±»å‹ç‰¹å®šå‡½æ•°</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    dictType <span class=\"token operator\">*</span>type<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\">// ç§æœ‰æ•°æ®</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token operator\">*</span>privdata<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\">// å“ˆå¸Œè¡¨</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    dictht ht<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token comment\">//rehash ç´¢å¼•</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token comment\">// å½“ rehash ä¸åœ¨è¿›è¡Œæ—¶ï¼Œå€¼ä¸º -1</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">int</span> rehashidx<span class=\"token punctuation\">;</span> <span class=\"token comment\">/* rehashing not in progress if rehashidx == -1 */</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span> dict<span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>type å±æ€§å’Œ privdata å±æ€§æ˜¯é’ˆå¯¹ä¸åŒç±»å‹çš„é”®å€¼å¯¹ï¼Œ ä¸ºåˆ›å»ºå¤šæ€å­—å…¸è€Œè®¾ç½®çš„ï¼š</p>\n<ul>\n<li>type å±æ€§æ˜¯ä¸€ä¸ªæŒ‡å‘ dictType ç»“æ„çš„æŒ‡é’ˆï¼Œ æ¯ä¸ª dictType ç»“æ„ä¿å­˜äº†ä¸€ç°‡ç”¨äºæ“ä½œç‰¹å®šç±»å‹é”®å€¼å¯¹çš„å‡½æ•°ï¼Œ Redis ä¼šä¸ºç”¨é€”ä¸åŒçš„å­—å…¸è®¾ç½®ä¸åŒçš„ç±»å‹ç‰¹å®šå‡½æ•°ã€‚</li>\n<li>è€Œ privdata å±æ€§åˆ™ä¿å­˜äº†éœ€è¦ä¼ ç»™é‚£äº›ç±»å‹ç‰¹å®šå‡½æ•°çš„å¯é€‰å‚æ•°ã€‚</li>\n</ul>\n<figure class=\"highlight c\"><figcaption data-lang=\"c\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">typedef</span> <span class=\"token keyword\">struct</span> <span class=\"token class-name\">dictType</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">// è®¡ç®—å“ˆå¸Œå€¼çš„å‡½æ•°</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">int</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>hashFunction<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token keyword\">void</span> <span class=\"token operator\">*</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\">// å¤åˆ¶é”®çš„å‡½æ•°</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>keyDup<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span> <span class=\"token operator\">*</span>privdata<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> <span class=\"token keyword\">void</span> <span class=\"token operator\">*</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\">// å¤åˆ¶å€¼çš„å‡½æ•°</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token operator\">*</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>valDup<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span> <span class=\"token operator\">*</span>privdata<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> <span class=\"token keyword\">void</span> <span class=\"token operator\">*</span>obj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token comment\">// å¯¹æ¯”é”®çš„å‡½æ•°</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">int</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>keyCompare<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span> <span class=\"token operator\">*</span>privdata<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> <span class=\"token keyword\">void</span> <span class=\"token operator\">*</span>key1<span class=\"token punctuation\">,</span> <span class=\"token keyword\">const</span> <span class=\"token keyword\">void</span> <span class=\"token operator\">*</span>key2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token comment\">// é”€æ¯é”®çš„å‡½æ•°</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>keyDestructor<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span> <span class=\"token operator\">*</span>privdata<span class=\"token punctuation\">,</span> <span class=\"token keyword\">void</span> <span class=\"token operator\">*</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token comment\">// é”€æ¯å€¼çš„å‡½æ•°</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">void</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>valDestructor<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">void</span> <span class=\"token operator\">*</span>privdata<span class=\"token punctuation\">,</span> <span class=\"token keyword\">void</span> <span class=\"token operator\">*</span>obj<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span> dictType<span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>ht å±æ€§æ˜¯ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªé¡¹çš„æ•°ç»„ï¼Œ æ•°ç»„ä¸­çš„æ¯ä¸ªé¡¹éƒ½æ˜¯ä¸€ä¸ª dictht å“ˆå¸Œè¡¨ï¼Œ ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ å­—å…¸åªä½¿ç”¨ ht [0] å“ˆå¸Œè¡¨ï¼Œ ht [1] å“ˆå¸Œè¡¨åªä¼šåœ¨å¯¹ ht [0] å“ˆå¸Œè¡¨è¿›è¡Œ rehash æ—¶ä½¿ç”¨ã€‚</p>\n<p>é™¤äº† ht [1] ä¹‹å¤–ï¼Œ å¦ä¸€ä¸ªå’Œ rehash æœ‰å…³çš„å±æ€§å°±æ˜¯ rehashidx ï¼š å®ƒè®°å½•äº† rehash ç›®å‰çš„è¿›åº¦ï¼Œ å¦‚æœç›®å‰æ²¡æœ‰åœ¨è¿›è¡Œ rehash ï¼Œ é‚£ä¹ˆå®ƒçš„å€¼ä¸º -1 ã€‚<br />\n<img data-src=\"http://redisbook.com/_images/graphviz-e73003b166b90094c8c4b7abbc8d59f691f91e27.png\" alt=\"\" /></p>\n<h3 id=\"å“ˆå¸Œå†²çª\"><a class=\"anchor\" href=\"#å“ˆå¸Œå†²çª\">#</a> å“ˆå¸Œå†²çª</h3>\n<p>Redis é€šè¿‡<strong>é“¾å¼å“ˆå¸Œ</strong>è§£å†³å†²çªï¼Œä¹Ÿå°±æ˜¯åŒä¸€ä¸ªæ¡¶é‡Œé¢çš„å…ƒç´ ä½¿ç”¨<strong>å•å‘é“¾è¡¨</strong>ä¿å­˜ã€‚ä½†æ˜¯å½“é“¾è¡¨è¿‡é•¿å°±ä¼šå¯¼è‡´æŸ¥æ‰¾æ€§èƒ½å˜å·®å¯èƒ½ã€‚æ‰€ä»¥ Redis ä¸ºäº†è¿½æ±‚å—ï¼Œä½¿ç”¨äº†ä¸¤ä¸ªå…¨å±€å“ˆå¸Œè¡¨ã€‚ç”¨äº rehash æ“ä½œï¼Œå¢åŠ ç°æœ‰çš„å“ˆå¸Œæ¡¶æ•°é‡ï¼Œå‡å°‘å“ˆå¸Œå†²çªã€‚<br />\nå› ä¸º dictEntry èŠ‚ç‚¹ç»„æˆçš„é“¾è¡¨æ²¡æœ‰æŒ‡å‘é“¾è¡¨è¡¨å°¾çš„æŒ‡é’ˆï¼Œ æ‰€ä»¥ä¸ºäº†é€Ÿåº¦è€ƒè™‘ï¼Œ ç¨‹åºæ€»æ˜¯å°†æ–°èŠ‚ç‚¹æ·»åŠ åˆ°é“¾è¡¨çš„è¡¨å¤´ä½ç½®ï¼ˆå¤æ‚åº¦ä¸º O (1)ï¼‰ï¼Œ æ’åœ¨å…¶ä»–å·²æœ‰èŠ‚ç‚¹çš„å‰é¢ã€‚</p>\n<h3 id=\"æ‰©å®¹\"><a class=\"anchor\" href=\"#æ‰©å®¹\">#</a> æ‰©å®¹</h3>\n<p>å½“ä»¥ä¸‹æ¡ä»¶ä¸­çš„ä»»æ„ä¸€ä¸ªè¢«æ»¡è¶³æ—¶ï¼Œ ç¨‹åºä¼šè‡ªåŠ¨å¼€å§‹å¯¹å“ˆå¸Œè¡¨æ‰§è¡Œæ‰©å±•æ“ä½œï¼š</p>\n<p>æœåŠ¡å™¨ç›®å‰æ²¡æœ‰åœ¨æ‰§è¡Œ BGSAVE å‘½ä»¤æˆ–è€… BGREWRITEAOF å‘½ä»¤ï¼Œ å¹¶ä¸”å“ˆå¸Œè¡¨çš„è´Ÿè½½å› å­å¤§äºç­‰äº 1 ã€‚<br />\næœåŠ¡å™¨ç›®å‰æ­£åœ¨æ‰§è¡Œ BGSAVE å‘½ä»¤æˆ–è€… BGREWRITEAOF å‘½ä»¤ï¼Œ å¹¶ä¸”å“ˆå¸Œè¡¨çš„è´Ÿè½½å› å­å¤§äºç­‰äº 5 ã€‚<br />\nå…¶ä¸­å“ˆå¸Œè¡¨çš„è´Ÿè½½å› å­å¯ä»¥é€šè¿‡å…¬å¼ï¼š</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># è´Ÿè½½å› å­ = å“ˆå¸Œè¡¨å·²ä¿å­˜èŠ‚ç‚¹æ•°é‡ / å“ˆå¸Œè¡¨å¤§å°</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>load_factor <span class=\"token operator\">=</span> ht<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>used <span class=\"token operator\">/</span> ht<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>size</pre></td></tr></table></figure><h4 id=\"rehash\"><a class=\"anchor\" href=\"#rehash\">#</a> rehash</h4>\n<ul>\n<li>å®šæ—¶ä»»åŠ¡ï¼šRedis å®šæ—¶ä»»åŠ¡ serverCron ä¼šåœ¨æ¯ä¸ªå‘¨æœŸå†…æ‰§è¡Œ 1ms æ¸è¿›å¼ Rehash æ“ä½œã€‚</li>\n<li>é™„ç€äºå…¶ä»–æ“ä½œï¼šåœ¨ Redis æ‰§è¡Œ dictAddRaw, dictGenericDelete, dictFind, dictGetSomeKeys å’Œ dictGetRandomKey ç­‰æ“ä½œå‰ä¼šæ‰§è¡Œ Rehash æ“ä½œã€‚</li>\n</ul>\n<h4 id=\"æ¸è¿›å¼-rehash\"><a class=\"anchor\" href=\"#æ¸è¿›å¼-rehash\">#</a> æ¸è¿›å¼ rehash</h4>\n<p>æ‰©å±•æˆ–æ”¶ç¼©å“ˆå¸Œè¡¨éœ€è¦å°† ht [0] é‡Œé¢çš„æ‰€æœ‰é”®å€¼å¯¹ rehash åˆ° ht [1] é‡Œé¢ï¼Œ ä½†æ˜¯ï¼Œ è¿™ä¸ª rehash åŠ¨ä½œå¹¶ä¸æ˜¯ä¸€æ¬¡æ€§ã€é›†ä¸­å¼åœ°å®Œæˆçš„ï¼Œ è€Œæ˜¯åˆ†å¤šæ¬¡ã€æ¸è¿›å¼åœ°å®Œæˆçš„ã€‚</p>\n<p><strong>å“ˆå¸Œè¡¨æ¸è¿›å¼ rehash çš„è¯¦ç»†æ­¥éª¤ï¼š</strong></p>\n<ul>\n<li>ä¸º ht [1] åˆ†é…ç©ºé—´ï¼Œ è®©å­—å…¸åŒæ—¶æŒæœ‰ ht [0] å’Œ ht [1] ä¸¤ä¸ªå“ˆå¸Œè¡¨ã€‚</li>\n<li>åœ¨å­—å…¸ä¸­ç»´æŒä¸€ä¸ªç´¢å¼•è®¡æ•°å™¨å˜é‡ rehashidx ï¼Œ å¹¶å°†å®ƒçš„å€¼è®¾ç½®ä¸º 0 ï¼Œ è¡¨ç¤º rehash å·¥ä½œæ­£å¼å¼€å§‹ã€‚</li>\n<li>åœ¨ rehash è¿›è¡ŒæœŸé—´ï¼Œ æ¯æ¬¡å¯¹å­—å…¸æ‰§è¡Œæ·»åŠ ã€åˆ é™¤ã€æŸ¥æ‰¾æˆ–è€…æ›´æ–°æ“ä½œæ—¶ï¼Œ ç¨‹åºé™¤äº†æ‰§è¡ŒæŒ‡å®šçš„æ“ä½œä»¥å¤–ï¼Œ è¿˜ä¼šé¡ºå¸¦å°† ht [0] å“ˆå¸Œè¡¨åœ¨ rehashidx ç´¢å¼•ä¸Šçš„æ‰€æœ‰é”®å€¼å¯¹ rehash åˆ° ht [1] ï¼Œ å½“ rehash å·¥ä½œå®Œæˆä¹‹åï¼Œ ç¨‹åºå°† rehashidx å±æ€§çš„å€¼å¢ä¸€ã€‚</li>\n<li>éšç€å­—å…¸æ“ä½œçš„ä¸æ–­æ‰§è¡Œï¼Œ æœ€ç»ˆåœ¨æŸä¸ªæ—¶é—´ç‚¹ä¸Šï¼Œ ht [0] çš„æ‰€æœ‰é”®å€¼å¯¹éƒ½ä¼šè¢« rehash è‡³ ht [1] ï¼Œ è¿™æ—¶ç¨‹åºå°† rehashidx å±æ€§çš„å€¼è®¾ä¸º -1 ï¼Œ è¡¨ç¤º rehash æ“ä½œå·²å®Œæˆã€‚</li>\n</ul>\n<p><strong>æ¸è¿›å¼ rehash æ‰§è¡ŒæœŸé—´çš„å“ˆå¸Œè¡¨æ“ä½œ</strong><br />\nå› ä¸ºåœ¨è¿›è¡Œæ¸è¿›å¼ rehash çš„è¿‡ç¨‹ä¸­ï¼Œ å­—å…¸ä¼šåŒæ—¶ä½¿ç”¨ ht [0] å’Œ ht [1] ä¸¤ä¸ªå“ˆå¸Œè¡¨ï¼Œ æ‰€ä»¥åœ¨æ¸è¿›å¼ rehash è¿›è¡ŒæœŸé—´ï¼Œ å­—å…¸çš„åˆ é™¤ï¼ˆdeleteï¼‰ã€æŸ¥æ‰¾ï¼ˆfindï¼‰ã€æ›´æ–°ï¼ˆupdateï¼‰ç­‰æ“ä½œä¼šåœ¨ä¸¤ä¸ªå“ˆå¸Œè¡¨ä¸Šè¿›è¡Œï¼š æ¯”å¦‚è¯´ï¼Œ è¦åœ¨å­—å…¸é‡Œé¢æŸ¥æ‰¾ä¸€ä¸ªé”®çš„è¯ï¼Œ ç¨‹åºä¼šå…ˆåœ¨ ht [0] é‡Œé¢è¿›è¡ŒæŸ¥æ‰¾ï¼Œ å¦‚æœæ²¡æ‰¾åˆ°çš„è¯ï¼Œ å°±ä¼šç»§ç»­åˆ° ht [1] é‡Œé¢è¿›è¡ŒæŸ¥æ‰¾ï¼Œ è¯¸å¦‚æ­¤ç±»ã€‚</p>\n<p>å¦å¤–ï¼Œ åœ¨æ¸è¿›å¼ rehash æ‰§è¡ŒæœŸé—´ï¼Œ æ–°æ·»åŠ åˆ°å­—å…¸çš„é”®å€¼å¯¹ä¸€å¾‹ä¼šè¢«ä¿å­˜åˆ° ht [1] é‡Œé¢ï¼Œ è€Œ ht [0] åˆ™ä¸å†è¿›è¡Œä»»ä½•æ·»åŠ æ“ä½œï¼š è¿™ä¸€æªæ–½ä¿è¯äº† ht [0] åŒ…å«çš„é”®å€¼å¯¹æ•°é‡ä¼šåªå‡ä¸å¢ï¼Œ å¹¶éšç€ rehash æ“ä½œçš„æ‰§è¡Œè€Œæœ€ç»ˆå˜æˆç©ºè¡¨ã€‚</p>\n<h2 id=\"äº‹åŠ¡\"><a class=\"anchor\" href=\"#äº‹åŠ¡\">#</a> äº‹åŠ¡</h2>\n<p>Redis äº‹åŠ¡æ²¡æœ‰å›æ»šæœºåˆ¶<br />\n Redis é€šè¿‡ MULTIï¼ŒEXECï¼ŒWATCH ç­‰å‘½ä»¤æ¥å®ç°äº‹åŠ¡åŠŸèƒ½ã€‚<br />\näº‹åŠ¡é¦–å…ˆä»¥ä¸€ä¸ª MULTI å‘½ä»¤ å¼€å§‹ï¼Œç„¶åå°†å¤šä¸ªå‘½ä»¤æ”¾å…¥äº‹åŠ¡ä¸­ï¼Œæœ€åç”± EXEC å‘½ä»¤å°†è¿™ä¸ªäº‹åŠ¡æäº¤ç»™æœåŠ¡å™¨æ‰§è¡Œã€‚</p>\n<h3 id=\"äº‹åŠ¡çš„ä¸‰ä¸ªé˜¶æ®µ\"><a class=\"anchor\" href=\"#äº‹åŠ¡çš„ä¸‰ä¸ªé˜¶æ®µ\">#</a> äº‹åŠ¡çš„ä¸‰ä¸ªé˜¶æ®µ</h3>\n<ul>\n<li>äº‹åŠ¡å¼€å§‹</li>\n<li>å‘½ä»¤å…¥é˜Ÿ</li>\n<li>äº‹åŠ¡æ‰§è¡Œ</li>\n</ul>\n<p>å½“ä¸€ä¸ªå®¢æˆ·ç«¯åˆ‡æ¢åˆ°äº‹åŠ¡çŠ¶æ€ä¹‹åï¼ŒæœåŠ¡å™¨ä¼šæ ¹æ®è¿™ä¸ªå®¢æˆ·ç«¯å‘æ¥çš„ä¸åŒå‘½ä»¤æ‰§è¡Œä¸åŒçš„æ“ä½œï¼š</p>\n<p>å¦‚æœå®¢æˆ·ç«¯å‘é€çš„å‘½ä»¤ä¸º EXECã€DISCARDã€WATCHã€MULTI å››ä¸ªå‘½ä»¤çš„å…¶ä¸­ä¸€ä¸ªï¼Œé‚£ä¹ˆæœåŠ¡å™¨ç«‹å³æ‰§è¡Œè¿™ä¸ªå‘½ä»¤ã€‚<br />\nå¦‚æœå®¢æˆ·ç«¯å‘é€çš„å‘½ä»¤æ˜¯ EXECã€DISCARDã€WATCHã€MULTI å››ä¸ªå‘½ä»¤ ä»¥å¤–çš„ å…¶ä»–å‘½ä»¤ï¼Œé‚£ä¹ˆæœåŠ¡å™¨ å¹¶ä¸ç«‹å³æ‰§è¡Œ è¿™ä¸ªå‘½ä»¤ï¼Œè€Œæ˜¯å°† è¿™ä¸ªå‘½ä»¤ æ”¾å…¥ ä¸€ä¸ªäº‹åŠ¡é˜Ÿåˆ—é‡Œé¢ï¼Œç„¶å å‘å®¢æˆ·ç«¯è¿”å› QUEUED å›å¤ã€‚</p>\n<p>MULTIã€EXECã€DISCARDã€WATCH è¿™å››ä¸ªæŒ‡ä»¤æ„æˆäº† redis äº‹åŠ¡å¤„ç†çš„åŸºç¡€ã€‚</p>\n<ul>\n<li><strong>MULTI</strong> ç”¨æ¥ç»„è£…ä¸€ä¸ªäº‹åŠ¡ã€‚</li>\n<li><strong>EXEC</strong> ç”¨æ¥æ‰§è¡Œä¸€ä¸ªäº‹åŠ¡ã€‚</li>\n<li><strong>DISCARD</strong> ç”¨æ¥å–æ¶ˆä¸€ä¸ªäº‹åŠ¡ã€‚</li>\n<li><strong>WATCH</strong> ç”¨æ¥ç›‘è§†ä¸€äº› keyï¼Œä¸€æ—¦è¿™äº› key åœ¨äº‹åŠ¡æ‰§è¡Œä¹‹å‰è¢«æ”¹å˜ï¼Œåˆ™å–æ¶ˆäº‹åŠ¡çš„æ‰§è¡Œã€‚</li>\n</ul>\n<h3 id=\"ä¸€è‡´æ€§\"><a class=\"anchor\" href=\"#ä¸€è‡´æ€§\">#</a> ä¸€è‡´æ€§</h3>\n<p><strong>å…¥é˜Ÿé”™è¯¯</strong></p>\n<ul>\n<li>å¦‚æœä¸€ä¸ªäº‹åŠ¡åœ¨å…¥é˜Ÿå‘½ä»¤çš„è¿‡ç¨‹ä¸­ï¼Œå‡ºç°äº†å‘½ä»¤ä¸å­˜åœ¨ï¼Œæˆ–è€…å‘½ä»¤çš„æ ¼å¼ä¸æ­£ç¡®ç­‰æƒ… å†µï¼Œé‚£ä¹ˆ Redis å°†æ‹’ç»æ‰§è¡Œè¿™ä¸ªäº‹åŠ¡ã€‚</li>\n</ul>\n<p><strong>æ‰§è¡Œé”™è¯¯</strong><br />\né™¤äº†å…¥é˜Ÿæ—¶å¯èƒ½å‘ç”Ÿé”™è¯¯ä»¥å¤–ï¼Œäº‹åŠ¡è¿˜å¯èƒ½åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ã€‚ å…³äºè¿™ç§é”™è¯¯æœ‰ä¸¤ä¸ªéœ€è¦è¯´æ˜çš„åœ°æ–¹ï¼š</p>\n<ul>\n<li>æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿçš„é”™è¯¯éƒ½æ˜¯ä¸€äº›ä¸èƒ½åœ¨å…¥é˜Ÿæ—¶è¢«æœåŠ¡å™¨å‘ç°çš„é”™è¯¯ï¼Œè¿™äº›é”™è¯¯åªä¼šåœ¨å‘½ä»¤å®é™…æ‰§è¡Œæ—¶è¢«è§¦å‘ã€‚</li>\n<li>å³ä½¿åœ¨äº‹åŠ¡çš„æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿäº†é”™è¯¯ï¼ŒæœåŠ¡å™¨ä¹Ÿä¸ä¼šä¸­æ–­äº‹åŠ¡çš„æ‰§è¡Œï¼Œå®ƒä¼šç»§ç»­æ‰§ è¡Œäº‹åŠ¡ä¸­ä½™ä¸‹çš„å…¶ä»–å‘½ä»¤ï¼Œå¹¶ä¸”å·²æ‰§è¡Œçš„å‘½ä»¤ï¼ˆåŒ…æ‹¬æ‰§è¡Œå‘½ä»¤æ‰€äº§ç”Ÿçš„ç»“æœï¼‰ä¸ä¼š è¢«å‡ºé”™çš„å‘½ä»¤å½±å“ã€‚</li>\n</ul>\n<h3 id=\"redis-å¦‚ä½•ä¿è¯åŸå­æ€§\"><a class=\"anchor\" href=\"#redis-å¦‚ä½•ä¿è¯åŸå­æ€§\">#</a> Redis å¦‚ä½•ä¿è¯åŸå­æ€§</h3>\n<ul>\n<li>Redis æ˜¯å•çº¿ç¨‹çš„ï¼Œæ‰€ä»¥ Redis æä¾›çš„ API ä¹Ÿæ˜¯åŸå­æ“ä½œã€‚</li>\n<li>ä¸šåŠ¡ä¸­å¸¸å¸¸æœ‰å…ˆ get å set çš„ä¸šåŠ¡å¸¸è§ï¼Œåœ¨å¹¶å‘ä¸‹ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚\n<ul>\n<li>ä½¿ç”¨ incrã€decrã€setnx ç­‰åŸå­æ“ä½œ</li>\n<li>ä½¿ç”¨äº‹åŠ¡</li>\n<li>ä½¿ç”¨ Lua è„šæœ¬å®ç° CAS æ“ä½œ</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"watch-å‘½ä»¤\"><a class=\"anchor\" href=\"#watch-å‘½ä»¤\">#</a> watch å‘½ä»¤</h3>\n<p>å¾ˆå¤šæ—¶å€™ï¼Œè¦ç¡®ä¿äº‹åŠ¡ä¸­çš„æ•°æ®æ²¡æœ‰è¢«å…¶ä»–å®¢æˆ·ç«¯ä¿®æ”¹æ‰æ‰§è¡Œè¯¥äº‹åŠ¡ã€‚Redis æä¾›äº† watch å‘½ä»¤æ¥è§£å†³è¿™ç±»é—®é¢˜ï¼Œè¿™æ˜¯ä¸€ç§ä¹è§‚é”çš„æœºåˆ¶ã€‚å®¢æˆ·ç«¯é€šè¿‡ watch å‘½ä»¤ï¼Œè¦æ±‚æœåŠ¡å™¨å¯¹ä¸€ä¸ªæˆ–å¤šä¸ª key è¿›è¡Œç›‘è§†ï¼Œå¦‚æœåœ¨å®¢æˆ·ç«¯æ‰§è¡Œäº‹åŠ¡ä¹‹å‰ï¼Œè¿™äº› key å‘ç”Ÿäº†å˜åŒ–ï¼Œåˆ™æœåŠ¡å™¨å°†æ‹’ç»æ‰§è¡Œå®¢æˆ·ç«¯æäº¤çš„äº‹åŠ¡ï¼Œå¹¶å‘å®ƒè¿”å›ä¸€ä¸ªç©ºå€¼ã€‚</p>\n<h2 id=\"ç¼“å­˜\"><a class=\"anchor\" href=\"#ç¼“å­˜\">#</a> ç¼“å­˜</h2>\n<h3 id=\"å¦‚ä½•è®¾è®¡-redis-çš„è¿‡æœŸæ—¶é—´\"><a class=\"anchor\" href=\"#å¦‚ä½•è®¾è®¡-redis-çš„è¿‡æœŸæ—¶é—´\">#</a> å¦‚ä½•è®¾è®¡ Redis çš„è¿‡æœŸæ—¶é—´</h3>\n<ul>\n<li>çƒ­ç‚¹æ•°æ®ä¸è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œä½¿å…¶è¾¾åˆ°ã€Œç‰©ç†ã€ä¸Šçš„æ°¸ä¸è¿‡æœŸï¼Œå¯ä»¥é¿å…ç¼“å­˜å‡»ç©¿é—®é¢˜ã€‚</li>\n<li>åœ¨è®¾ç½®è¿‡æœŸæ—¶é—´æ—¶ï¼Œå¯ä»¥é™„åŠ ä¸€ä¸ªéšæœºæ•°ï¼Œé¿å…å¤§é‡çš„ key åŒæ—¶è¿‡æœŸï¼Œå¯¼è‡´ç¼“å­˜é›ªå´©ã€‚</li>\n</ul>\n<h3 id=\"ç¼“å­˜é”™è¯¯\"><a class=\"anchor\" href=\"#ç¼“å­˜é”™è¯¯\">#</a> ç¼“å­˜é”™è¯¯</h3>\n<h4 id=\"ç¼“å­˜ç©¿é€\"><a class=\"anchor\" href=\"#ç¼“å­˜ç©¿é€\">#</a> ç¼“å­˜ç©¿é€</h4>\n<p><strong>é—®é¢˜æè¿°</strong><br />\nå®¢æˆ·ç«¯æŸ¥è¯¢æ ¹æœ¬ä¸å­˜åœ¨çš„æ•°æ®ï¼Œä½¿å¾—è¯·æ±‚ç›´è¾¾å­˜å‚¨å±‚ï¼Œå¯¼è‡´å…¶è´Ÿè½½è¿‡å¤§ï¼Œç”šè‡³å®•æœºã€‚å‡ºç°è¿™ç§æƒ…å†µçš„åŸå› ï¼Œå¯èƒ½æ˜¯ä¸šåŠ¡å±‚è¯¯å°†ç¼“å­˜å’Œåº“ä¸­çš„æ•°æ®åˆ é™¤äº†ï¼Œä¹Ÿå¯èƒ½æ˜¯æœ‰äººæ¶æ„æ”»å‡»ï¼Œä¸“é—¨è®¿é—®åº“ä¸­ä¸å­˜åœ¨çš„æ•°æ®ã€‚<br />\n<strong>è§£å†³æ–¹æ¡ˆ</strong></p>\n<ul>\n<li><strong>ç¼“å­˜ç©ºå¯¹è±¡</strong>ï¼šå­˜å‚¨å±‚æœªå‘½ä¸­åï¼Œä»ç„¶å°†ç©ºå€¼å­˜å…¥ç¼“å­˜å±‚ï¼Œå®¢æˆ·ç«¯å†æ¬¡è®¿é—®æ•°æ®æ—¶ï¼Œç¼“å­˜å±‚ä¼šç›´æ¥è¿”å›ç©ºå€¼ã€‚</li>\n<li><strong>å¸ƒéš†è¿‡æ»¤å™¨</strong>ï¼šå°†æ•°æ®å­˜å…¥å¸ƒéš†è¿‡æ»¤å™¨ï¼Œè®¿é—®ç¼“å­˜ä¹‹å‰ä»¥è¿‡æ»¤å™¨æ‹¦æˆªï¼Œè‹¥è¯·æ±‚çš„æ•°æ®ä¸å­˜åœ¨åˆ™ç›´æ¥è¿”å›ç©ºå€¼ã€‚</li>\n</ul>\n<h4 id=\"ç¼“å­˜å‡»ç©¿\"><a class=\"anchor\" href=\"#ç¼“å­˜å‡»ç©¿\">#</a> ç¼“å­˜å‡»ç©¿</h4>\n<p><strong>é—®é¢˜æè¿°</strong><br />\nä¸€ä»½çƒ­ç‚¹æ•°æ®ï¼Œå®ƒçš„è®¿é—®é‡éå¸¸å¤§ã€‚åœ¨å…¶ç¼“å­˜å¤±æ•ˆçš„ç¬é—´ï¼Œå¤§é‡è¯·æ±‚ç›´è¾¾å­˜å‚¨å±‚ï¼Œå¯¼è‡´æœåŠ¡å´©æºƒã€‚<br />\n<strong>è§£å†³æ–¹æ¡ˆ</strong></p>\n<ul>\n<li><strong>æ°¸ä¸è¿‡æœŸ</strong>ï¼šçƒ­ç‚¹æ•°æ®ä¸è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°ä¸Šè¿°é—®é¢˜ï¼Œè¿™æ˜¯ â€œç‰©ç†â€ ä¸Šçš„æ°¸ä¸è¿‡æœŸã€‚æˆ–è€…ä¸ºæ¯ä¸ªæ•°æ®è®¾ç½®é€»è¾‘è¿‡æœŸæ—¶é—´ï¼Œå½“å‘ç°è¯¥æ•°æ®é€»è¾‘è¿‡æœŸæ—¶ï¼Œä½¿ç”¨å•ç‹¬çš„çº¿ç¨‹é‡å»ºç¼“å­˜ã€‚</li>\n<li><strong>åŠ äº’æ–¥é”</strong>ï¼šå¯¹æ•°æ®çš„è®¿é—®åŠ äº’æ–¥é”ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®è¯¥æ•°æ®æ—¶ï¼Œå…¶ä»–çº¿ç¨‹åªèƒ½ç­‰å¾…ã€‚è¿™ä¸ªçº¿ç¨‹è®¿é—®è¿‡åï¼Œç¼“å­˜ä¸­çš„æ•°æ®å°†è¢«é‡å»ºï¼Œå±Šæ—¶å…¶ä»–çº¿ç¨‹å°±å¯ä»¥ç›´æ¥ä»ç¼“å­˜ä¸­å–å€¼ã€‚</li>\n</ul>\n<h4 id=\"ç¼“å­˜é›ªå´©\"><a class=\"anchor\" href=\"#ç¼“å­˜é›ªå´©\">#</a> ç¼“å­˜é›ªå´©</h4>\n<p><strong>é—®é¢˜æè¿°</strong><br />\nåœ¨æŸä¸€æ—¶åˆ»ï¼Œç¼“å­˜å±‚æ— æ³•ç»§ç»­æä¾›æœåŠ¡ï¼Œå¯¼è‡´æ‰€æœ‰çš„è¯·æ±‚ç›´è¾¾å­˜å‚¨å±‚ï¼Œé€ æˆæ•°æ®åº“å®•æœºã€‚å¯èƒ½æ˜¯ç¼“å­˜ä¸­æœ‰å¤§é‡æ•°æ®åŒæ—¶è¿‡æœŸï¼Œä¹Ÿå¯èƒ½æ˜¯ Redis èŠ‚ç‚¹å‘ç”Ÿæ•…éšœï¼Œå¯¼è‡´å¤§é‡è¯·æ±‚æ— æ³•å¾—åˆ°å¤„ç†ã€‚<br />\n<strong>è§£å†³æ–¹æ¡ˆ</strong></p>\n<ul>\n<li>é¿å…æ•°æ®åŒæ—¶è¿‡æœŸï¼šè®¾ç½®è¿‡æœŸæ—¶é—´æ—¶ï¼Œé™„åŠ ä¸€ä¸ªéšæœºæ•°ï¼Œé¿å…å¤§é‡çš„ key åŒæ—¶è¿‡æœŸã€‚</li>\n<li>å¯ç”¨é™çº§å’Œç†”æ–­æªæ–½ï¼šåœ¨å‘ç”Ÿé›ªå´©æ—¶ï¼Œè‹¥åº”ç”¨è®¿é—®çš„ä¸æ˜¯æ ¸å¿ƒæ•°æ®ï¼Œåˆ™ç›´æ¥è¿”å›é¢„å®šä¹‰ä¿¡æ¯ / ç©ºå€¼ / é”™è¯¯ä¿¡æ¯ã€‚æˆ–è€…åœ¨å‘ç”Ÿé›ªå´©æ—¶ï¼Œå¯¹äºè®¿é—®ç¼“å­˜æ¥å£çš„è¯·æ±‚ï¼Œå®¢æˆ·ç«¯å¹¶ä¸ä¼šæŠŠè¯·æ±‚å‘ç»™ Redis ï¼Œè€Œæ˜¯ç›´æ¥è¿”å›ã€‚</li>\n<li>æ„å»ºé«˜å¯ç”¨çš„ Redis æœåŠ¡ï¼šé‡‡ç”¨å“¨å…µæˆ–é›†ç¾¤æ¨¡å¼ï¼Œéƒ¨ç½²å¤šä¸ª Redis å®ä¾‹ï¼Œä¸ªåˆ«èŠ‚ç‚¹å®•æœºï¼Œä¾ç„¶å¯ä»¥ä¿æŒæœåŠ¡çš„æ•´ä½“å¯ç”¨ã€‚</li>\n</ul>\n<h2 id=\"åˆ†å¸ƒå¼é”\"><a class=\"anchor\" href=\"#åˆ†å¸ƒå¼é”\">#</a> åˆ†å¸ƒå¼é”</h2>\n<h3 id=\"åŸºæœ¬å¯ç”¨çš„é”å®ç°\"><a class=\"anchor\" href=\"#åŸºæœ¬å¯ç”¨çš„é”å®ç°\">#</a> åŸºæœ¬å¯ç”¨çš„é”å®ç°</h3>\n<p><strong>åŠ é”ä»£ç </strong></p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">acquire_lock</span><span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">,</span> lockname<span class=\"token punctuation\">,</span> acquire_timeout<span class=\"token operator\">=</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span> lock_timeout<span class=\"token operator\">=</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    identifier <span class=\"token operator\">=</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">(</span>uuid<span class=\"token punctuation\">.</span>uuid4<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    lockname <span class=\"token operator\">=</span> <span class=\"token string\">\"lock:\"</span> <span class=\"token operator\">+</span> lockname</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    end <span class=\"token operator\">=</span> time<span class=\"token punctuation\">.</span>time<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> acquire_timeout</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">while</span> time<span class=\"token punctuation\">.</span>time<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> end<span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token keyword\">if</span> conn<span class=\"token punctuation\">.</span><span class=\"token builtin\">set</span><span class=\"token punctuation\">(</span>lockname<span class=\"token punctuation\">,</span> identifier<span class=\"token punctuation\">,</span> ex<span class=\"token operator\">=</span>lock_timeout<span class=\"token punctuation\">,</span> nx<span class=\"token operator\">=</span><span class=\"token boolean\">True</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token keyword\">return</span> identifier</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        time<span class=\"token punctuation\">.</span>sleep<span class=\"token punctuation\">(</span><span class=\"token number\">0.001</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token boolean\">False</span></pre></td></tr></table></figure><p><strong>å®ç°é”çš„å…³é”®æŒ‡ä»¤</strong><br />\n <code>SET key value [EX seconds] [PX milliseconds] [NX|XX]</code> <br />\n ç”Ÿå­˜æ—¶é—´ï¼ˆTTLï¼Œä»¥ç§’ä¸ºå•ä½ï¼‰<br />\nRedis 2.6.12 ç‰ˆæœ¬å¼€å§‹ï¼šï¼ˆç­‰åŒ SETNX ã€ SETEX å’Œ PSETEX)<br />\n EX second ï¼šè®¾ç½®é”®çš„è¿‡æœŸæ—¶é—´ä¸º second ç§’ã€‚ SET key value EX second æ•ˆæœç­‰åŒäº SETEX key second value ã€‚<br />\nPX millisecond ï¼šè®¾ç½®é”®çš„è¿‡æœŸæ—¶é—´ä¸º millisecond æ¯«ç§’ã€‚ SET key value PX millisecond æ•ˆæœç­‰åŒäº PSETEX key millisecond value ã€‚<br />\nNX ï¼šåªåœ¨é”®ä¸å­˜åœ¨æ—¶ï¼Œæ‰å¯¹é”®è¿›è¡Œè®¾ç½®æ“ä½œã€‚ SET key value NX æ•ˆæœç­‰åŒäº SETNX key value ã€‚<br />\nXX ï¼šåªåœ¨é”®å·²ç»å­˜åœ¨æ—¶ï¼Œæ‰å¯¹é”®è¿›è¡Œè®¾ç½®æ“ä½œã€‚</p>\n<p>ç”±äº NX å‘½ä»¤çš„ç‰¹æ®Šæ€§ï¼Œå¯ä»¥å®ç° CAS çš„åŸå­æ“ä½œã€‚</p>\n<p><strong>ä¸ºä»€ä¹ˆè¦è®¾ç½®é”çš„è¿‡æœŸæ—¶é—´</strong><br />\nä¸€ä¸ªä¸šåŠ¡è¿›ç¨‹ A è·å–é”ä¹‹åï¼Œå¦‚æœåœ¨é‡Šæ”¾é”ä¹‹å‰å®•æœºï¼Œé‚£ä¹ˆåœ¨æœåŠ¡ç«¯ä¼šè®¤ä¸ºè¿›ç¨‹ A ä¸€ç›´åœ¨æŒæœ‰è€…è¿™æŠŠé”ï¼Œå…¶å®ƒè¿›ç¨‹å°†æ°¸è¿œè·å–ä¸åˆ°è¿™æŠŠé”ï¼Œå¯¼è‡´æ­»é”ã€‚è®¾ç½®è¿‡æœŸæ—¶é—´åï¼Œå³ä½¿åŠ é”çš„è¿›ç¨‹å®•æœºï¼ŒRedis æœåŠ¡å™¨ä¹Ÿèƒ½åœ¨è¿‡æœŸæ—¶é—´åˆ°è¾¾æ—¶è‡ªåŠ¨é‡Šæ”¾é”ã€‚</p>\n<p><strong>å¦‚æœé”çš„è¿‡æœŸæ—¶é—´å·²ç»åˆ°è¾¾ï¼Œä¸šåŠ¡è¿›ç¨‹è¿˜æ²¡æœ‰å®Œæˆä¸šåŠ¡æ“ä½œï¼Ÿ</strong><br />\né”çš„è¿‡æœŸæ—¶é—´ä¸€èˆ¬è¦è®¾ç½®ä¸ºä¸šåŠ¡æ“ä½œæ—¶é•¿çš„ä¸¤å€ï¼Œå½“å¦‚æœè¿˜æ˜¯æœ‰ä¸ªåˆ«ä¸šåŠ¡æ—¶éœ€æ—¶é—´è¾ƒé•¿å°±éœ€è¦æˆ‘ä»¬ä¸»åŠ¨ç»­æœŸã€‚åœ¨åŠ é”ä¹‹åå°†é”æ”¾å…¥è¿›ç¨‹å¯¹åº”çš„ä¸€ä¸ªé”é˜Ÿåˆ—ï¼Œå¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ç›‘æµ‹é”çš„è¿‡æœŸæ—¶é—´ï¼Œåœ¨é”å³å°†è¿‡æœŸæ—¶ä¸ºé”è‡ªåŠ¨å»¶ç»­è¿‡æœŸæ—¶é—´ã€‚è¿™ç§çº¿ç¨‹ä¸€èˆ¬è¢«å«åšã€Œçœ‹é—¨ç‹—ã€çº¿ç¨‹ã€‚</p>\n<p><strong>ä¸»ä»ç»“æ„é”ä¸¢å¤±</strong><br />\näº‹å®ä¸Šè¿™ç±»çæœ€å¤§çš„ç¼ºç‚¹å°±æ˜¯å®ƒåŠ é”æ—¶åªä½œç”¨åœ¨ä¸€ä¸ª Redis èŠ‚ç‚¹ä¸Šï¼Œå³ä½¿ Redis é€šè¿‡ sentinel ä¿è¯é«˜å¯ç”¨ï¼Œå¦‚æœè¿™ä¸ª master èŠ‚ç‚¹ç”±äºæŸäº›åŸå› å‘ç”Ÿäº†ä¸»ä»åˆ‡æ¢ï¼Œé‚£ä¹ˆå°±ä¼šå‡ºç°é”ä¸¢å¤±çš„æƒ…å†µï¼š</p>\n<ul>\n<li>åœ¨ Redis çš„ master èŠ‚ç‚¹ä¸Šæ‹¿åˆ°äº†é”ã€‚</li>\n<li>ä½†æ˜¯è¿™ä¸ªåŠ é”çš„ key è¿˜æ²¡æœ‰åŒæ­¥åˆ° slave èŠ‚ç‚¹ã€‚</li>\n<li>master æ•…éšœï¼Œå‘ç”Ÿæ•…éšœè½¬ç§»ï¼Œslave èŠ‚ç‚¹å‡çº§ä¸º master èŠ‚ç‚¹ã€‚</li>\n<li>å¯¼è‡´é”ä¸¢å¤±ã€‚</li>\n</ul>\n<p>æ­£å› ä¸ºå¦‚æ­¤ï¼ŒRedis ä½œè€… antirez åŸºäºåˆ†å¸ƒå¼ç¯å¢ƒä¸‹æå‡ºäº†ä¸€ç§æ›´é«˜çº§çš„åˆ†å¸ƒå¼é”çš„å®ç°æ–¹å¼ï¼šRedlockã€‚</p>\n<p><strong>é‡Šæ”¾é”ä»£ç </strong></p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">release_lock</span><span class=\"token punctuation\">(</span>conn<span class=\"token punctuation\">,</span> lockname<span class=\"token punctuation\">,</span> identifier<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">with</span> conn<span class=\"token punctuation\">.</span>pipeline<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> pipe<span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        lockname <span class=\"token operator\">=</span> <span class=\"token string\">'lock:'</span> <span class=\"token operator\">+</span> lockname</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">while</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>                pipe<span class=\"token punctuation\">.</span>watch<span class=\"token punctuation\">(</span>lockname<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                <span class=\"token keyword\">if</span> pipe<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>lockname<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> identifier<span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                    pipe<span class=\"token punctuation\">.</span>multi<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                    pipe<span class=\"token punctuation\">.</span>delete<span class=\"token punctuation\">(</span>lockname<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                    pipe<span class=\"token punctuation\">.</span>execute<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                    <span class=\"token keyword\">return</span> <span class=\"token boolean\">True</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                pipe<span class=\"token punctuation\">.</span>unwatch<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                <span class=\"token keyword\">break</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token keyword\">except</span> WatchError<span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                <span class=\"token keyword\">pass</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token boolean\">False</span></pre></td></tr></table></figure><h3 id=\"redlock-å®ç°\"><a class=\"anchor\" href=\"#redlock-å®ç°\">#</a> Redlock å®ç°</h3>\n<p>antirez æå‡ºçš„ redlock ç®—æ³•å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š</p>\n<p>åœ¨ Redis çš„åˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬å‡è®¾æœ‰ N ä¸ª Redis masterã€‚è¿™äº›èŠ‚ç‚¹<strong>å®Œå…¨äº’ç›¸ç‹¬ç«‹ï¼Œä¸å­˜åœ¨ä¸»ä»å¤åˆ¶æˆ–è€…å…¶ä»–é›†ç¾¤åè°ƒæœºåˆ¶</strong>ã€‚æˆ‘ä»¬ç¡®ä¿å°†åœ¨ N ä¸ªå®ä¾‹ä¸Šä½¿ç”¨ä¸åœ¨ Redis å•å®ä¾‹ä¸‹ç›¸åŒæ–¹æ³•è·å–å’Œé‡Šæ”¾é”ã€‚ç°åœ¨æˆ‘ä»¬å‡è®¾æœ‰ 5 ä¸ª Redis master èŠ‚ç‚¹ï¼ŒåŒæ—¶æˆ‘ä»¬éœ€è¦åœ¨ 5 å°æœåŠ¡å™¨ä¸Šé¢è¿è¡Œè¿™äº› Redis å®ä¾‹ï¼Œè¿™æ ·ä¿è¯ä»–ä»¬ä¸ä¼šåŒæ—¶éƒ½å®•æ‰ã€‚</p>\n<p>ä¸ºäº†å–åˆ°é”ï¼Œå®¢æˆ·ç«¯åº”è¯¥æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p>\n<ul>\n<li>è·å–å½“å‰ Unix æ—¶é—´ï¼Œä»¥æ¯«ç§’ä¸ºå•ä½ã€‚</li>\n<li>ä¾æ¬¡å°è¯•ä» 5 ä¸ªå®ä¾‹ï¼Œä½¿ç”¨ç›¸åŒçš„ key å’Œå…·æœ‰å”¯ä¸€æ€§çš„ valueï¼ˆä¾‹å¦‚ UUIDï¼‰è·å–é”ã€‚å½“å‘ Redis è¯·æ±‚è·å–é”æ—¶ï¼Œå®¢æˆ·ç«¯åº”è¯¥è®¾ç½®ä¸€ä¸ªç½‘ç»œè¿æ¥å’Œå“åº”è¶…æ—¶æ—¶é—´ï¼Œè¿™ä¸ªè¶…æ—¶æ—¶é—´åº”è¯¥å°äºé”çš„å¤±æ•ˆæ—¶é—´ã€‚ä¾‹å¦‚ä½ çš„é”è‡ªåŠ¨å¤±æ•ˆæ—¶é—´ä¸º 10 ç§’ï¼Œåˆ™è¶…æ—¶æ—¶é—´åº”è¯¥åœ¨ 5-50 æ¯«ç§’ä¹‹é—´ã€‚è¿™æ ·å¯ä»¥é¿å…æœåŠ¡å™¨ç«¯ Redis å·²ç»æŒ‚æ‰çš„æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯è¿˜åœ¨æ­»æ­»åœ°ç­‰å¾…å“åº”ç»“æœã€‚å¦‚æœæœåŠ¡å™¨ç«¯æ²¡æœ‰åœ¨è§„å®šæ—¶é—´å†…å“åº”ï¼Œå®¢æˆ·ç«¯åº”è¯¥å°½å¿«å°è¯•å»å¦å¤–ä¸€ä¸ª Redis å®ä¾‹è¯·æ±‚è·å–é”ã€‚</li>\n<li>å®¢æˆ·ç«¯ä½¿ç”¨å½“å‰æ—¶é—´å‡å»å¼€å§‹è·å–é”æ—¶é—´ï¼ˆæ­¥éª¤ 1 è®°å½•çš„æ—¶é—´ï¼‰å°±å¾—åˆ°è·å–é”ä½¿ç”¨çš„æ—¶é—´ã€‚å½“ä¸”ä»…å½“ä»å¤§å¤šæ•°ï¼ˆN/2+1ï¼Œè¿™é‡Œæ˜¯ 3 ä¸ªèŠ‚ç‚¹ï¼‰çš„ Redis èŠ‚ç‚¹éƒ½å–åˆ°é”ï¼Œå¹¶ä¸”ä½¿ç”¨çš„æ—¶é—´å°äºé”å¤±æ•ˆæ—¶é—´æ—¶ï¼Œé”æ‰ç®—è·å–æˆåŠŸã€‚<br />\nå¦‚æœå–åˆ°äº†é”ï¼Œkey çš„çœŸæ­£æœ‰æ•ˆæ—¶é—´ç­‰äºæœ‰æ•ˆæ—¶é—´å‡å»è·å–é”æ‰€ä½¿ç”¨çš„æ—¶é—´ï¼ˆæ­¥éª¤ 3 è®¡ç®—çš„ç»“æœï¼‰ã€‚</li>\n<li>å¦‚æœå› ä¸ºæŸäº›åŸå› ï¼Œè·å–é”å¤±è´¥ï¼ˆæ²¡æœ‰åœ¨è‡³å°‘ N/2+1 ä¸ª Redis å®ä¾‹å–åˆ°é”æˆ–è€…å–é”æ—¶é—´å·²ç»è¶…è¿‡äº†æœ‰æ•ˆæ—¶é—´ï¼‰ï¼Œå®¢æˆ·ç«¯åº”è¯¥åœ¨æ‰€æœ‰çš„ Redis å®ä¾‹ä¸Šè¿›è¡Œè§£é”ï¼ˆå³ä¾¿æŸäº› Redis å®ä¾‹æ ¹æœ¬å°±æ²¡æœ‰åŠ é”æˆåŠŸï¼Œé˜²æ­¢æŸäº›èŠ‚ç‚¹è·å–åˆ°é”ä½†æ˜¯å®¢æˆ·ç«¯æ²¡æœ‰å¾—åˆ°å“åº”è€Œå¯¼è‡´æ¥ä¸‹æ¥çš„ä¸€æ®µæ—¶é—´ä¸èƒ½è¢«é‡æ–°è·å–é”ï¼‰ã€‚</li>\n</ul>\n<h2 id=\"é«˜å¯ç”¨\"><a class=\"anchor\" href=\"#é«˜å¯ç”¨\">#</a> é«˜å¯ç”¨</h2>\n<p>æ‰€è°“çš„é«˜å¯ç”¨ï¼Œä¹Ÿå« HAï¼ˆHigh Availabilityï¼‰ï¼Œæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿæ¶æ„è®¾è®¡ä¸­å¿…é¡»è€ƒè™‘çš„å› ç´ ä¹‹ä¸€ï¼Œå®ƒé€šå¸¸æ˜¯æŒ‡ï¼Œé€šè¿‡è®¾è®¡å‡å°‘ç³»ç»Ÿä¸èƒ½æä¾›æœåŠ¡çš„æ—¶é—´ã€‚</p>\n<h3 id=\"ä¸»ä»æ¨¡å¼\"><a class=\"anchor\" href=\"#ä¸»ä»æ¨¡å¼\">#</a> ä¸»ä»æ¨¡å¼</h3>\n<p>ä¸€èˆ¬ï¼Œç³»ç»Ÿçš„é«˜å¯ç”¨éƒ½æ˜¯é€šè¿‡éƒ¨ç½²å¤šå°æœºå™¨å®ç°çš„ã€‚redis ä¸ºäº†é¿å…å•ç‚¹æ•…éšœï¼Œä¹Ÿéœ€è¦éƒ¨ç½²å¤šå°æœºå™¨ã€‚</p>\n<p>å› ä¸ºéƒ¨ç½²äº†å¤šå°æœºå™¨ï¼Œæ‰€ä»¥å°±ä¼šæ¶‰åŠåˆ°ä¸åŒæœºå™¨çš„çš„æ•°æ®åŒæ­¥é—®é¢˜ã€‚</p>\n<p>ä¸ºæ­¤ï¼Œredis æä¾›äº† Redis æä¾›äº†å¤åˆ¶ (replication) åŠŸèƒ½ï¼Œå½“ä¸€å° redis æ•°æ®åº“ä¸­çš„æ•°æ®å‘ç”Ÿäº†å˜åŒ–ï¼Œè¿™ä¸ªå˜åŒ–ä¼šè¢«è‡ªåŠ¨çš„åŒæ­¥åˆ°å…¶ä»–çš„ redis æœºå™¨ä¸Šå»ã€‚</p>\n<p>redis å¤šæœºå™¨éƒ¨ç½²æ—¶ï¼Œè¿™äº›æœºå™¨èŠ‚ç‚¹ä¼šè¢«åˆ†æˆä¸¤ç±»ï¼Œä¸€ç±»æ˜¯ä¸»èŠ‚ç‚¹ï¼ˆmaster èŠ‚ç‚¹ï¼‰ï¼Œä¸€ç±»æ˜¯ä»èŠ‚ç‚¹ï¼ˆslave èŠ‚ç‚¹ï¼‰ã€‚ä¸€èˆ¬ä¸»èŠ‚ç‚¹å¯ä»¥è¿›è¡Œè¯»ã€å†™æ“ä½œï¼Œè€Œä»èŠ‚ç‚¹åªèƒ½è¿›è¡Œè¯»æ“ä½œã€‚åŒæ—¶ç”±äºä¸»èŠ‚ç‚¹å¯ä»¥å†™ï¼Œæ•°æ®ä¼šå‘ç”Ÿå˜åŒ–ï¼Œå½“ä¸»èŠ‚ç‚¹çš„æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šå°†å˜åŒ–çš„æ•°æ®åŒæ­¥ç»™ä»èŠ‚ç‚¹ï¼Œè¿™æ ·ä»èŠ‚ç‚¹çš„æ•°æ®å°±å¯ä»¥å’Œä¸»èŠ‚ç‚¹çš„æ•°æ®ä¿æŒä¸€è‡´äº†ã€‚ä¸€ä¸ªä¸»èŠ‚ç‚¹å¯ä»¥æœ‰å¤šä¸ªä»èŠ‚ç‚¹ï¼Œä½†æ˜¯ä¸€ä¸ªä»èŠ‚ç‚¹ä¼šåªä¼šæœ‰ä¸€ä¸ªä¸»èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„ä¸€ä¸»å¤šä»ç»“æ„ã€‚</p>\n<h4 id=\"å¤åˆ¶æœºåˆ¶\"><a class=\"anchor\" href=\"#å¤åˆ¶æœºåˆ¶\">#</a> å¤åˆ¶æœºåˆ¶</h4>\n<ul>\n<li>ä»æ•°æ®åº“è¿æ¥ä¸»æ•°æ®åº“ï¼Œå‘é€ SYNC å‘½ä»¤ã€‚</li>\n<li>ä¸»æ•°æ®åº“æ¥æ”¶åˆ° SYNC å‘½ä»¤åï¼Œå¯ä»¥æ‰§è¡Œ BGSAVE å‘½ä»¤ç”Ÿæˆ RDB æ–‡ä»¶å¹¶ä½¿ç”¨ç¼“å†²åŒºè®°å½•æ­¤åæ‰§è¡Œçš„æ‰€æœ‰å†™å‘½ä»¤ã€‚</li>\n<li>ä¸»æ•°æ®åº“ BGSAVE æ‰§è¡Œå®Œåï¼Œå‘æ‰€æœ‰ä»æ•°æ®åº“å‘é€å¿«ç…§æ–‡ä»¶ï¼Œå¹¶åœ¨å‘é€æœŸé—´ç»§ç»­è®°å½•è¢«æ‰§è¡Œçš„å†™å‘½ä»¤ã€‚</li>\n<li>ä»æ•°æ®åº“æ”¶åˆ°å¿«ç…§æ–‡ä»¶åä¸¢å¼ƒæ‰€æœ‰æ—§æ•°æ®ï¼Œè½½å…¥æ”¶åˆ°çš„å¿«ç…§ã€‚</li>\n<li>ä¸»æ•°æ®åº“å¿«ç…§å‘é€å®Œæ¯•åå¼€å§‹å‘ä»æ•°æ®åº“å‘é€ç¼“å†²åŒºä¸­çš„å†™å‘½ä»¤ã€‚</li>\n<li>ä»æ•°æ®åº“å®Œæˆå¯¹å¿«ç…§çš„è½½å…¥ï¼Œå¼€å§‹æ¥å—å‘½ä»¤è¯·æ±‚ï¼Œå¹¶æ‰§è¡Œæ¥è‡ªä¸»æ•°æ®åº“ç¼“å†²åŒºçš„å†™å‘½ä»¤ã€‚ï¼ˆä»æ•°æ®åº“åˆå§‹åŒ–å®Œæˆï¼‰</li>\n<li>ä¸»æ•°æ®åº“æ¯æ‰§è¡Œä¸€ä¸ªå†™å‘½ä»¤å°±ä¼šå‘ä»æ•°æ®åº“å‘é€ç›¸åŒçš„å†™å‘½ä»¤ï¼Œä»æ•°æ®åº“æ¥æ”¶å¹¶æ‰§è¡Œæ”¶åˆ°çš„å†™å‘½ä»¤ï¼ˆä»æ•°æ®åº“åˆå§‹åŒ–å®Œæˆåçš„æ“ä½œï¼‰</li>\n<li>å‡ºç°æ–­å¼€é‡è¿åï¼Œ2.8 ä¹‹åçš„ç‰ˆæœ¬ä¼šå°†æ–­çº¿æœŸé—´çš„å‘½ä»¤ä¼ ç»™ä»æ•°æ®åº“ï¼Œå¢é‡å¤åˆ¶ã€‚</li>\n<li>** ä¸»ä»åˆšåˆšè¿æ¥çš„æ—¶å€™ï¼Œè¿›è¡Œå…¨é‡åŒæ­¥ã€‚å…¨åŒæ­¥ç»“æŸåï¼Œè¿›è¡Œå¢é‡åŒæ­¥ã€‚** å½“ç„¶ï¼Œå¦‚æœæœ‰éœ€è¦ï¼Œslave åœ¨ä»»ä½•æ—¶å€™éƒ½å¯ä»¥å‘èµ·å…¨é‡åŒæ­¥ã€‚Redis çš„ç­–ç•¥æ˜¯ï¼Œæ— è®ºå¦‚ä½•ï¼Œé¦–å…ˆä¼šå°è¯•è¿›è¡Œå¢é‡åŒæ­¥ï¼Œå¦‚ä¸æˆåŠŸï¼Œè¦æ±‚ä»æœºè¿›è¡Œå…¨é‡åŒæ­¥ã€‚</li>\n</ul>\n<h3 id=\"å“¨å…µæ¨¡å¼\"><a class=\"anchor\" href=\"#å“¨å…µæ¨¡å¼\">#</a> å“¨å…µæ¨¡å¼</h3>\n<p>ä¸»ä»æ¨¡å¼ä¸‹ï¼Œå½“ä¸»æœåŠ¡å™¨å®•æœºåï¼Œéœ€è¦æ‰‹åŠ¨æŠŠä¸€å°ä»æœåŠ¡å™¨åˆ‡æ¢ä¸ºä¸»æœåŠ¡å™¨ï¼Œè¿™å°±éœ€è¦äººå·¥å¹²é¢„ï¼Œè´¹äº‹è´¹åŠ›ï¼Œè¿˜ä¼šé€ æˆä¸€æ®µæ—¶é—´å†…æœåŠ¡ä¸å¯ç”¨ã€‚è¿™ç§æ–¹å¼å¹¶ä¸æ¨èï¼Œå®é™…ç”Ÿäº§ä¸­ï¼Œæˆ‘ä»¬ä¼˜å…ˆè€ƒè™‘å“¨å…µæ¨¡å¼ã€‚è¿™ç§æ¨¡å¼ä¸‹ï¼Œmaster å®•æœºï¼Œå“¨å…µä¼šè‡ªåŠ¨é€‰ä¸¾ master å¹¶å°†å…¶ä»–çš„ slave æŒ‡å‘æ–°çš„ masterã€‚</p>\n<p>åœ¨ä¸»ä»æ¨¡å¼ä¸‹ï¼Œredis åŒæ—¶æä¾›äº†å“¨å…µå‘½ä»¤ redis-sentinelï¼Œå“¨å…µæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹ï¼Œä½œä¸ºè¿›ç¨‹ï¼Œå®ƒä¼šç‹¬ç«‹è¿è¡Œã€‚å…¶åŸç†æ˜¯å“¨å…µè¿›ç¨‹å‘æ‰€æœ‰çš„ redis æœºå™¨å‘é€å‘½ä»¤ï¼Œç­‰å¾… Redis æœåŠ¡å™¨å“åº”ï¼Œä»è€Œç›‘æ§è¿è¡Œçš„å¤šä¸ª Redis å®ä¾‹ã€‚</p>\n<p>å“¨å…µå¯ä»¥æœ‰å¤šä¸ªï¼Œä¸€èˆ¬ä¸ºäº†ä¾¿äºå†³ç­–é€‰ä¸¾ï¼Œä½¿ç”¨å¥‡æ•°ä¸ªå“¨å…µã€‚å“¨å…µå¯ä»¥å’Œ redis æœºå™¨éƒ¨ç½²åœ¨ä¸€èµ·ï¼Œä¹Ÿå¯ä»¥éƒ¨ç½²åœ¨å…¶ä»–çš„æœºå™¨ä¸Šã€‚å¤šä¸ªå“¨å…µæ„æˆä¸€ä¸ªå“¨å…µé›†ç¾¤ï¼Œå“¨å…µç›´æ¥ä¹Ÿä¼šç›¸äº’é€šä¿¡ï¼Œæ£€æŸ¥å“¨å…µæ˜¯å¦æ­£å¸¸è¿è¡Œï¼ŒåŒæ—¶å‘ç° master å®•æœºå“¨å…µä¹‹é—´ä¼šè¿›è¡Œå†³ç­–é€‰ä¸¾æ–°çš„ masterã€‚</p>\n<p>å“¨å…µé›†ç¾¤ä¸­å“¨å…µå®ä¾‹ä¹‹é—´å¯ä»¥ç›¸äº’å‘ç°ï¼ŒåŸºäº Redis æä¾›çš„å‘å¸ƒ / è®¢é˜…æœºåˆ¶ï¼ˆpub/sub æœºåˆ¶ï¼‰,</p>\n<p>å“¨å…µå¯ä»¥åœ¨ä¸»åº“ä¸­å‘å¸ƒ / è®¢é˜…æ¶ˆæ¯ï¼Œåœ¨ä¸»åº“ä¸Šæœ‰ä¸€ä¸ªåä¸º <code>\\__sentinel__:hello</code>  çš„é¢‘é“ï¼Œä¸åŒå“¨å…µå°±æ˜¯é€šè¿‡å®ƒæ¥ç›¸äº’å‘ç°ï¼Œå®ç°äº’ç›¸é€šä¿¡çš„ï¼Œè€Œä¸”åªæœ‰è®¢é˜…äº†åŒä¸€ä¸ªé¢‘é“çš„åº”ç”¨ï¼Œæ‰èƒ½é€šè¿‡å‘å¸ƒçš„æ¶ˆæ¯è¿›è¡Œä¿¡æ¯äº¤æ¢ã€‚</p>\n<p><img data-src=\"https://cdn.jsdelivr.net/gh/haust-Kevin/static@master//images/202311011140245.png\" alt=\"\" /></p>\n<h4 id=\"å“¨å…µæ¨¡å¼çš„ä½œç”¨\"><a class=\"anchor\" href=\"#å“¨å…µæ¨¡å¼çš„ä½œç”¨\">#</a> å“¨å…µæ¨¡å¼çš„ä½œç”¨</h4>\n<ul>\n<li>é€šè¿‡å‘é€å‘½ä»¤ï¼Œè®© Redis æœåŠ¡å™¨è¿”å›ç›‘æ§å…¶è¿è¡ŒçŠ¶æ€ï¼ŒåŒ…æ‹¬ä¸»æœåŠ¡å™¨å’Œä»æœåŠ¡å™¨ã€‚</li>\n<li>å½“å“¨å…µç›‘æµ‹åˆ° master å®•æœºï¼Œä¼šè‡ªåŠ¨å°† slave åˆ‡æ¢åˆ° masterï¼Œç„¶åé€šè¿‡å‘å¸ƒè®¢é˜…æ¨¡å¼é€šè¿‡å…¶ä»–çš„ä»æœåŠ¡å™¨ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œè®©å®ƒä»¬åˆ‡æ¢ä¸»æœºã€‚</li>\n<li>ç„¶è€Œä¸€ä¸ªå“¨å…µè¿›ç¨‹å¯¹ Redis æœåŠ¡å™¨è¿›è¡Œç›‘æ§ï¼Œä¹Ÿå¯èƒ½ä¼šå‡ºç°é—®é¢˜ï¼Œä¸ºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¤šä¸ªå“¨å…µè¿›è¡Œç›‘æ§ã€‚å„ä¸ªå“¨å…µä¹‹é—´è¿˜ä¼šè¿›è¡Œç›‘æ§ï¼Œè¿™æ ·å°±å½¢æˆäº†å¤šå“¨å…µæ¨¡å¼ã€‚</li>\n</ul>\n<h4 id=\"å“¨å…µæ¨¡å¼çš„å·¥ä½œæœºåˆ¶\"><a class=\"anchor\" href=\"#å“¨å…µæ¨¡å¼çš„å·¥ä½œæœºåˆ¶\">#</a> å“¨å…µæ¨¡å¼çš„å·¥ä½œæœºåˆ¶</h4>\n<ul>\n<li>æ¯ä¸ª Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹ä»¥æ¯ç§’é’Ÿä¸€æ¬¡çš„é¢‘ç‡å‘æ•´ä¸ªé›†ç¾¤ä¸­çš„ Master ä¸»æœåŠ¡å™¨ï¼ŒSlave ä»æœåŠ¡å™¨ä»¥åŠå…¶ä»– Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹å‘é€ä¸€ä¸ª PING å‘½ä»¤ã€‚</li>\n<li>å¦‚æœä¸€ä¸ªå®ä¾‹ï¼ˆinstanceï¼‰è·ç¦»æœ€åä¸€æ¬¡æœ‰æ•ˆå›å¤ PING å‘½ä»¤çš„æ—¶é—´è¶…è¿‡ down-after-milliseconds é€‰é¡¹æ‰€æŒ‡å®šçš„å€¼ï¼Œ åˆ™è¿™ä¸ªå®ä¾‹ä¼šè¢« Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹æ ‡è®°ä¸ºä¸»è§‚ä¸‹çº¿ï¼ˆSDOWNï¼‰</li>\n<li>å¦‚æœä¸€ä¸ª Master ä¸»æœåŠ¡å™¨è¢«æ ‡è®°ä¸ºä¸»è§‚ä¸‹çº¿ï¼ˆSDOWNï¼‰ï¼Œåˆ™æ­£åœ¨ç›‘è§†è¿™ä¸ª Master ä¸»æœåŠ¡å™¨çš„æ‰€æœ‰ Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹è¦ä»¥æ¯ç§’ä¸€æ¬¡çš„é¢‘ç‡ç¡®è®¤ Master ä¸»æœåŠ¡å™¨çš„ç¡®è¿›å…¥äº†ä¸»è§‚ä¸‹çº¿çŠ¶æ€</li>\n<li>å½“æœ‰è¶³å¤Ÿæ•°é‡çš„ Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹ï¼ˆå¤§äºç­‰äºé…ç½®æ–‡ä»¶æŒ‡å®šçš„å€¼ï¼‰åœ¨æŒ‡å®šçš„æ—¶é—´èŒƒå›´å†…ç¡®è®¤ Master ä¸»æœåŠ¡å™¨è¿›å…¥äº†ä¸»è§‚ä¸‹çº¿çŠ¶æ€ï¼ˆSDOWNï¼‰ï¼Œ åˆ™ Master ä¸»æœåŠ¡å™¨ä¼šè¢«æ ‡è®°ä¸ºå®¢è§‚ä¸‹çº¿ï¼ˆODOWNï¼‰</li>\n<li>åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ æ¯ä¸ª Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹ä¼šä»¥æ¯ 10 ç§’ä¸€æ¬¡çš„é¢‘ç‡å‘é›†ç¾¤ä¸­çš„æ‰€æœ‰ Master ä¸»æœåŠ¡å™¨ã€Slave ä»æœåŠ¡å™¨å‘é€ INFO å‘½ä»¤ã€‚</li>\n<li>å½“ Master ä¸»æœåŠ¡å™¨è¢« Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹æ ‡è®°ä¸ºå®¢è§‚ä¸‹çº¿ï¼ˆODOWNï¼‰æ—¶ï¼ŒSentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹å‘ä¸‹çº¿çš„ Master ä¸»æœåŠ¡å™¨çš„æ‰€æœ‰ Slave ä»æœåŠ¡å™¨å‘é€ INFO å‘½ä»¤çš„é¢‘ç‡ä¼šä» 10 ç§’ä¸€æ¬¡æ”¹ä¸ºæ¯ç§’ä¸€æ¬¡ã€‚</li>\n<li>è‹¥æ²¡æœ‰è¶³å¤Ÿæ•°é‡çš„ Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹åŒæ„ Master ä¸»æœåŠ¡å™¨ä¸‹çº¿ï¼Œ Master ä¸»æœåŠ¡å™¨çš„å®¢è§‚ä¸‹çº¿çŠ¶æ€å°±ä¼šè¢«ç§»é™¤ã€‚è‹¥ Master ä¸»æœåŠ¡å™¨é‡æ–°å‘ Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹å‘é€ PING å‘½ä»¤è¿”å›æœ‰æ•ˆå›å¤ï¼ŒMaster ä¸»æœåŠ¡å™¨çš„ä¸»è§‚ä¸‹çº¿çŠ¶æ€å°±ä¼šè¢«ç§»é™¤ã€‚</li>\n</ul>\n<h3 id=\"é›†ç¾¤æ¨¡å¼\"><a class=\"anchor\" href=\"#é›†ç¾¤æ¨¡å¼\">#</a> é›†ç¾¤æ¨¡å¼</h3>\n<p>Redis çš„å“¨å…µæ¨¡å¼åŸºæœ¬å·²ç»å¯ä»¥å®ç°é«˜å¯ç”¨ï¼Œè¯»å†™åˆ†ç¦» ï¼Œä½†æ˜¯åœ¨è¿™ç§æ¨¡å¼ä¸‹æ¯å° Redis æœåŠ¡å™¨éƒ½å­˜å‚¨ç›¸åŒçš„æ•°æ®ï¼Œå¾ˆæµªè´¹å†…å­˜ï¼Œæ‰€ä»¥åœ¨ redis3.0 ä¸ŠåŠ å…¥äº† Cluster é›†ç¾¤æ¨¡å¼ï¼Œå®ç°äº† Redis çš„åˆ†å¸ƒå¼å­˜å‚¨ï¼Œå¯¹æ•°æ®è¿›è¡Œåˆ†ç‰‡ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯å° Redis èŠ‚ç‚¹ä¸Šå­˜å‚¨ä¸åŒçš„å†…å®¹ã€‚</p>\n<p>redis é›†ç¾¤æ˜¯ä¸€ä¸ªç”±å¤šä¸ªä¸»ä»èŠ‚ç‚¹ç¾¤ç»„æˆçš„åˆ†å¸ƒå¼æœåŠ¡å™¨ç¾¤ï¼Œå®ƒå…·æœ‰å¤åˆ¶ã€é«˜å¯ç”¨å’Œåˆ†ç‰‡ç‰¹æ€§ã€‚Redis é›†ç¾¤ä¸éœ€ è¦ sentinel å“¨å…µâˆ™ä¹Ÿèƒ½å®ŒæˆèŠ‚ç‚¹ç§»é™¤å’Œæ•…éšœè½¬ç§»çš„åŠŸèƒ½ã€‚éœ€è¦å°†æ¯ä¸ªèŠ‚ç‚¹è®¾ç½®æˆé›†ç¾¤æ¨¡å¼ï¼Œè¿™ç§é›†ç¾¤æ¨¡å¼æ²¡æœ‰ä¸­å¿ƒèŠ‚ç‚¹ï¼Œå¯æ°´å¹³æ‰©å±•ï¼Œæ®å®˜æ–¹æ–‡æ¡£ç§°å¯ä»¥çº¿æ€§æ‰©å±•åˆ°ä¸Šä¸‡ä¸ªèŠ‚ç‚¹ (å®˜æ–¹æ¨èä¸è¶…è¿‡ 1000 ä¸ªèŠ‚ç‚¹)ã€‚</p>\n<p>æ ¹æ®å®˜æ–¹æ¨èï¼Œé›†ç¾¤éƒ¨ç½²è‡³å°‘è¦ 3 å°ä»¥ä¸Šçš„ master èŠ‚ç‚¹ï¼Œæœ€å¥½ä½¿ç”¨ 3 ä¸» 3 ä»å…­ä¸ªèŠ‚ç‚¹çš„æ¨¡å¼ ã€‚</p>\n<p><img data-src=\"https://cdn.jsdelivr.net/gh/haust-Kevin/static@master//images/202311011141538.jpg\" alt=\"\" /></p>\n<h4 id=\"è¿è¡Œæœºåˆ¶\"><a class=\"anchor\" href=\"#è¿è¡Œæœºåˆ¶\">#</a> è¿è¡Œæœºåˆ¶</h4>\n<ul>\n<li>åœ¨ Redis çš„æ¯ä¸€ä¸ªèŠ‚ç‚¹ä¸Šï¼Œéƒ½æœ‰è¿™ä¹ˆä¸¤ä¸ªä¸œè¥¿ï¼Œä¸€ä¸ªæ˜¯æ’æ§½ï¼ˆslotï¼‰ï¼Œå®ƒçš„çš„å–å€¼èŒƒå›´æ˜¯ï¼š0-16383ï¼Œå¯ä»¥ä»ä¸Šé¢ redis-trib.rb æ‰§è¡Œçš„ç»“æœçœ‹åˆ°è¿™ 16383 ä¸ª slot åœ¨ä¸‰ä¸ª master ä¸Šçš„åˆ†å¸ƒã€‚è¿˜æœ‰ä¸€ä¸ªå°±æ˜¯ clusterï¼Œå¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ä¸ªé›†ç¾¤ç®¡ç†çš„æ’ä»¶ï¼Œç±»ä¼¼çš„å“¨å…µã€‚</li>\n<li>å½“æˆ‘ä»¬çš„å­˜å–çš„ Key åˆ°è¾¾çš„æ—¶å€™ï¼ŒRedis ä¼šæ ¹æ® crc16 çš„ç®—æ³•å¯¹è®¡ç®—åå¾—å‡ºä¸€ä¸ªç»“æœï¼Œç„¶åæŠŠç»“æœå’Œ 16384 æ±‚ä½™æ•°ï¼Œè¿™æ ·æ¯ä¸ª key éƒ½ä¼šå¯¹åº”ä¸€ä¸ªç¼–å·åœ¨ 0-16383 ä¹‹é—´çš„å“ˆå¸Œæ§½ï¼Œé€šè¿‡è¿™ä¸ªå€¼ï¼Œå»æ‰¾åˆ°å¯¹åº”çš„æ’æ§½æ‰€å¯¹åº”çš„èŠ‚ç‚¹ï¼Œç„¶åç›´æ¥è‡ªåŠ¨è·³è½¬åˆ°è¿™ä¸ªå¯¹åº”çš„èŠ‚ç‚¹ä¸Šè¿›è¡Œå­˜å–æ“ä½œã€‚</li>\n<li>å½“æ•°æ®å†™å…¥åˆ°å¯¹åº”çš„ master èŠ‚ç‚¹åï¼Œè¿™ä¸ªæ•°æ®ä¼šåŒæ­¥ç»™è¿™ä¸ª master å¯¹åº”çš„æ‰€æœ‰ slave èŠ‚ç‚¹ã€‚</li>\n<li>ä¸ºäº†ä¿è¯é«˜å¯ç”¨ï¼Œredis-cluster é›†ç¾¤å¼•å…¥äº†ä¸»ä»æ¨¡å¼ï¼Œä¸€ä¸ªä¸»èŠ‚ç‚¹å¯¹åº”ä¸€ä¸ªæˆ–è€…å¤šä¸ªä»èŠ‚ç‚¹ã€‚å½“å…¶å®ƒä¸»èŠ‚ç‚¹ ping ä¸»èŠ‚ç‚¹ master 1 æ—¶ï¼Œå¦‚æœåŠæ•°ä»¥ä¸Šçš„ä¸»èŠ‚ç‚¹ä¸ master 1 é€šä¿¡è¶…æ—¶ï¼Œé‚£ä¹ˆè®¤ä¸º master 1 å®•æœºäº†ï¼Œå°±ä¼šå¯ç”¨ master 1 çš„ä»èŠ‚ç‚¹ slave 1ï¼Œå°† slave 1 å˜æˆä¸»èŠ‚ç‚¹ç»§ç»­æä¾›æœåŠ¡ã€‚</li>\n<li>å¦‚æœ master 1 å’Œå®ƒçš„ä»èŠ‚ç‚¹ slave 1 éƒ½å®•æœºäº†ï¼Œæ•´ä¸ªé›†ç¾¤å°±ä¼šè¿›å…¥ fail çŠ¶æ€ï¼Œå› ä¸ºé›†ç¾¤çš„ slot æ˜ å°„ä¸å®Œæ•´ã€‚å¦‚æœé›†ç¾¤è¶…è¿‡åŠæ•°ä»¥ä¸Šçš„ master æŒ‚æ‰ï¼Œæ— è®ºæ˜¯å¦æœ‰ slaveï¼Œé›†ç¾¤éƒ½ä¼šè¿›å…¥ fail çŠ¶æ€ã€‚</li>\n<li>redis-cluster é‡‡ç”¨å»ä¸­å¿ƒåŒ–çš„æ€æƒ³ï¼Œæ²¡æœ‰ä¸­å¿ƒèŠ‚ç‚¹çš„è¯´æ³•ï¼Œå®¢æˆ·ç«¯ä¸ Redis èŠ‚ç‚¹ç›´è¿ï¼Œä¸éœ€è¦ä¸­é—´ä»£ç†å±‚ï¼Œå®¢æˆ·ç«¯ä¸éœ€è¦è¿æ¥é›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹ï¼Œè¿æ¥é›†ç¾¤ä¸­ä»»ä½•ä¸€ä¸ªå¯ç”¨èŠ‚ç‚¹å³å¯ã€‚</li>\n</ul>\n",
            "tags": [
                "é¢è¯•æŒ‡åŒ—",
                "æ•°æ®åº“",
                "å…«è‚¡æ–‡",
                "æ•°æ®åº“",
                "Redis"
            ]
        },
        {
            "id": "https://haust-kevin.github.io/2023/10/28/2023-10-interview-db-mysql/",
            "url": "https://haust-kevin.github.io/2023/10/28/2023-10-interview-db-mysql/",
            "title": "é¢è¯•æŒ‡åŒ—ï¼šMySQL æ•°æ®åº“",
            "date_published": "2023-10-28T06:47:35.000Z",
            "content_html": "<h2 id=\"äº‹åŠ¡\"><a class=\"anchor\" href=\"#äº‹åŠ¡\">#</a> äº‹åŠ¡</h2>\n<p>æ•°æ®åº“ä¸­çš„äº‹åŠ¡æ˜¯æŒ‡å¯¹æ•°æ®åº“æ‰§è¡Œä¸€æ‰¹æ“ä½œï¼Œåœ¨åŒä¸€ä¸ªäº‹åŠ¡å½“ä¸­ï¼Œè¿™äº›æ“ä½œæœ€ç»ˆè¦ä¹ˆå…¨éƒ¨æ‰§è¡ŒæˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ï¼Œä¸ä¼šå­˜åœ¨éƒ¨åˆ†æˆåŠŸçš„æƒ…å†µã€‚</p>\n<h3 id=\"acid\"><a class=\"anchor\" href=\"#acid\">#</a> ACID</h3>\n<p>äº‹åŠ¡å…·æœ‰å››ä¸ªç‰¹å¾ï¼šåŸå­æ€§ï¼ˆ Atomicity ï¼‰ã€ä¸€è‡´æ€§ï¼ˆ Consistency ï¼‰ã€éš”ç¦»æ€§ï¼ˆ Isolation ï¼‰å’ŒæŒä¹…æ€§ï¼ˆ Durability ï¼‰ã€‚è¿™å››ä¸ªç‰¹æ€§ç®€ç§°ä¸º ACID ç‰¹æ€§ã€‚</p>\n<ul>\n<li><strong>åŸå­æ€§ï¼ˆAtomicityï¼‰</strong>ï¼šä¸€ä¸ªäº‹åŠ¡ä¸­çš„å¤šç»„æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚åœ¨äº‹åŠ¡æäº¤ï¼ˆcommitï¼‰æˆåŠŸä¹‹åï¼Œæ‰€æœ‰çš„æ“ä½œéƒ½ç”Ÿæ•ˆï¼Œæäº¤å¤±è´¥ï¼Œæ‰€æœ‰çš„æ“ä½œéƒ½ä¼šå›æ»šã€‚</li>\n<li><strong>ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰</strong>ï¼šä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œä¹‹å‰å’Œæ‰§è¡Œä¹‹åæ•°æ®åº“éƒ½å¿…é¡»å¤„äºä¸€è‡´æ€§çŠ¶æ€ã€‚åœ¨äº‹åŠ¡æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œåªè¦äº‹åŠ¡æœªæäº¤ï¼Œå°±ä¸ä¼šæ”¹å˜æ•°æ®åº“çš„çŠ¶æ€ã€‚æäº¤ä¹‹åäº‹åŠ¡å·²å®Œæˆï¼Œæ­¤æ—¶æ•°æ®åº“çŠ¶æ€å‘ç”Ÿå˜åŒ–ã€‚</li>\n<li><strong>éš”ç¦»æ€§ï¼ˆIsolationï¼‰</strong>ï¼šäº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæ˜¯ä¸å¤–ç•Œå®Œå…¨éš”ç¦»çš„ï¼Œå³ä½¿æ•°æ®åº“å‘ç”Ÿäº†å˜æ›´ï¼Œäº‹åŠ¡ä¸­ä¹Ÿè·å–ä¸åˆ°ã€‚A äº‹åŠ¡å¯¹æ•°æ®åº“åšçš„å˜æ›´ï¼Œåœ¨äº‹åŠ¡æœªæäº¤ä¹‹é—´ï¼Œæ•°æ®åº“ä¸­ä¹Ÿçœ‹ä¸åˆ°ï¼ŒB äº‹åŠ¡ä¸­ä¹Ÿçœ‹ä¸åˆ°ã€‚</li>\n<li><strong>æŒä¹…æ€§ï¼ˆDurabilityï¼‰</strong>ï¼šäº‹åŠ¡ä¸€æ—¦æäº¤ï¼Œå¯¹æ•°æ®åº“çš„å˜æ›´å°±ä¼šæŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œå³ä½¿æ•°æ®åº“å‘ç”Ÿå¼‚å¸¸é‡å¯ï¼Œæ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚</li>\n</ul>\n<h3 id=\"éš”ç¦»çº§åˆ«\"><a class=\"anchor\" href=\"#éš”ç¦»çº§åˆ«\">#</a> éš”ç¦»çº§åˆ«</h3>\n<p>SQL æ ‡å‡†å®šä¹‰äº† 4 ç±»éš”ç¦»çº§åˆ«ï¼ŒåŒ…æ‹¬äº†ä¸€äº›å…·ä½“è§„åˆ™ï¼Œç”¨æ¥é™å®šäº‹åŠ¡å†…å¤–çš„å“ªäº›æ”¹å˜æ˜¯å¯è§çš„ï¼Œå“ªäº›æ˜¯ä¸å¯è§çš„ã€‚ä½çº§åˆ«çš„éš”ç¦»çº§ä¸€èˆ¬æ”¯æŒæ›´é«˜çš„å¹¶å‘å¤„ç†ï¼Œå¹¶æ‹¥æœ‰æ›´ä½çš„ç³»ç»Ÿå¼€é”€ã€‚</p>\n<ul>\n<li><strong>READ UNCOMMITTEDï¼ˆæœªæäº¤è¯»ï¼‰</strong>ï¼šäº‹åŠ¡çš„ä¿®æ”¹ï¼Œå³ä½¿æ²¡æœ‰æäº¤ï¼Œå¯¹å…¶ä»–äº‹ç‰©ä¹Ÿéƒ½æ˜¯å¯è§çš„ã€‚ä¼šå­˜åœ¨è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»çš„é—®é¢˜ã€‚</li>\n<li><strong>READ COMMITTEDï¼ˆæäº¤è¯»ï¼‰</strong>ï¼šä¸€ä¸ªäº‹åŠ¡ä»å¼€å§‹ç›´åˆ°æäº¤ä¹‹å‰ï¼Œæ‰€åšçš„ä»»ä½•ä¿®æ”¹å¯¹å…¶å®ƒäº‹ç‰©éƒ½æ˜¯ä¸å¯è§çš„ã€‚å¯ä»¥é¿å…è„è¯»é—®é¢˜ï¼Œä½†å¯èƒ½å­˜åœ¨ä¸å¯é‡å¤è¯»å’Œå¹»è¯»é—®é¢˜ã€‚</li>\n<li><strong>REPEATABLE READï¼ˆå¯é‡å¤è¯»ï¼‰</strong>ï¼šåŒä¸€ä¸ªäº‹åŠ¡ä¸­å¤šæ¬¡è¯»å–åŒæ ·è®°å½•çš„ç»“æœæ˜¯ä¸€è‡´çš„ã€‚é¿å…äº†è„è¯»å’Œä¸å¯é‡å¤è¯»é—®é¢˜ï¼Œä½†å¯èƒ½å­˜åœ¨å¹»è¯»é—®é¢˜ã€‚Repeatable Read æ˜¯ MySQL é»˜è®¤éš”ç¦»çº§åˆ«ã€‚</li>\n<li><strong>SERIALIZABLEï¼ˆå¯ä¸²è¡ŒåŒ–ï¼‰</strong>ï¼šæœ€é«˜çº§åˆ«çš„éš”ç¦»æ€§ï¼Œäº‹åŠ¡ä¸²è¡Œæ‰§è¡Œï¼Œé¿å…äº†æ‰€æœ‰å¹¶å‘é—®é¢˜ï¼Œå¯èƒ½å¯¼è‡´å¤§é‡çš„è¶…æ—¶ç°è±¡å’Œé”ç«äº‰ï¼Œé€šå¸¸ä¸ä¼šç”¨è¿™ä¸ªéš”ç¦»çº§åˆ«ã€‚</li>\n</ul>\n<h3 id=\"å¹¶å‘é—®é¢˜\"><a class=\"anchor\" href=\"#å¹¶å‘é—®é¢˜\">#</a> å¹¶å‘é—®é¢˜</h3>\n<p>å¦‚æœå¤šä¸ªäº‹åŠ¡è¦æ˜¯å¯¹ç¼“å­˜é‡Œçš„åŒä¸€æ¡æ•°æ®åŒæ—¶è¿›è¡Œæ›´æ–°æˆ–è€…æŸ¥è¯¢ï¼Œæ­¤æ—¶ä¼šæ¶‰åŠåˆ°è„å†™ã€è„è¯»ã€ä¸å¯é‡å¤è¯»ã€å¹»è¯»ç­‰é—®é¢˜ã€‚<br />\n<strong>è„å†™</strong>ï¼šä¸€ä¸ªäº‹åŠ¡å»æ›´æ–°äº†å¦å¤–ä¸€ä¸ªè¿˜æ²¡æäº¤çš„äº‹åŠ¡æ›´æ–°è¿‡çš„æ•°æ®ã€‚<br />\n<strong>è„è¯»</strong>ï¼šä¸€ä¸ªäº‹åŠ¡å»æŸ¥è¯¢äº†å¦å¤–ä¸€ä¸ªè¿˜æ²¡æäº¤çš„äº‹åŠ¡æ›´æ–°è¿‡çš„æ•°æ®ã€‚<br />\n<strong>ä¸å¯é‡å¤è¯»</strong>ï¼šåœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œå¯¹äºåŒä¸€ç»„æ•°æ®è¯»å–åˆ°çš„ç»“æœä¸ä¸€è‡´ã€‚æ¯”å¦‚ï¼Œäº‹åŠ¡ B åœ¨äº‹åŠ¡ A æäº¤å‰è¯»åˆ°çš„ç»“æœï¼Œå’Œåœ¨äº‹åŠ¡ A æäº¤åè¯»åˆ°çš„ç»“æœå¯èƒ½ä¸åŒã€‚<br />\n<strong>å¹»è¯»</strong>ï¼šå½“æŸä¸ªäº‹ç‰©åœ¨è¯»å–æŸä¸ªèŒƒå›´å†…çš„è®°å½•æ—¶ï¼Œå¦å¤–ä¸€ä¸ªäº‹åŠ¡åˆåœ¨è¯¥èŒƒå›´å†…æ’å…¥äº†æ–°çš„è®°å½•ï¼Œå½“ä¹‹å‰çš„äº‹åŠ¡å†æ¬¡è¯»å–è¯¥èŒƒå›´çš„è®°å½•æ—¶ï¼Œä¼šäº§ç”Ÿå¹»è¡Œã€‚</p>\n<h3 id=\"æ­»é”\"><a class=\"anchor\" href=\"#æ­»é”\">#</a> æ­»é”</h3>\n<p>æ­»é”æ˜¯ä¸¤ä¸ªæˆ–å¤šä¸ªäº‹åŠ¡åœ¨åŒä¸€èµ„æºç›¸äº’å ç”¨ï¼Œå¹¶è¯·æ±‚é”å®šå¯¹æ–¹å ç”¨çš„èµ„æºï¼Œä»è€Œå¯¼è‡´æ¶æ€§å¾ªç¯çš„ç°è±¡ã€‚å½“å¤šä¸ªäº‹åŠ¡è¯•å›¾ä»¥ä¸åŒçš„é¡ºåºé”å®šèµ„æºæ—¶ï¼Œå°±å¯èƒ½ä¼šäº§ç”Ÿæ­»é”ã€‚<br />\n<strong>è§£å†³</strong>ï¼šä¸ºäº†è§£å†³è¿™ç§é—®é¢˜ï¼Œæ•°æ®åº“ç³»ç»Ÿå®ç°äº†å„ç§æ­»é”æ£€æµ‹å’Œè¶…æ—¶æœºåˆ¶ã€‚ä¸€èˆ¬ä¼šåœ¨æ£€æµ‹åˆ°æ­»é”åç«‹å³è¿”å›ä¸€ä¸ªé”™è¯¯ã€‚<br />\næ­»é”çš„å‡ºç°æœ‰æ—¶å€™æ˜¯ç”±äºå­˜å‚¨å¼•æ“å¯¼è‡´çš„ï¼Œè€Œæœ‰çš„åˆ™æ˜¯ä¸šåŠ¡ä¸­çœŸæ­£çš„æ•°æ®å†²çªï¼Œè€Œä¸”åŸºæœ¬æ— æ³•é¿å…ã€‚æ­»é”å‘ç”Ÿååªæœ‰å›æ»šå…¶ä¸­çš„ä¸€ä¸ªäº‹åŠ¡æ‰èƒ½æ‰“ç ´æ­»é”ã€‚æ‰€ä»¥ç¨‹åºè®¾è®¡çš„æ—¶å€™å¿…é¡»è€ƒè™‘å¦‚ä½•å¤„ç†æ­»é”ã€‚</p>\n<h3 id=\"mvcc\"><a class=\"anchor\" href=\"#mvcc\">#</a> MVCC</h3>\n<p>MVCC åªåœ¨  <code>READ COMMITTED</code>  å’Œ  <code>REPEATABLE READ</code>  ä¸¤ä¸ªéš”ç¦»çº§åˆ«ä¸‹å·¥ä½œã€‚å…¶ä»–ä¸¤ä¸ªéš”ç¦»çº§åˆ«å¤Ÿå’Œ MVCC ä¸å…¼å®¹ï¼Œå› ä¸º  <code>READ UNCOMMITTED</code>  æ€»æ˜¯è¯»å–æœ€æ–°çš„æ•°æ®è¡Œï¼Œè€Œä¸æ˜¯ç¬¦åˆå½“å‰äº‹åŠ¡ç‰ˆæœ¬çš„æ•°æ®è¡Œã€‚è€Œ  <code>SERIALIZABLE</code>  åˆ™ä¼šå¯¹æ‰€æœ‰è¯»å–çš„è¡Œéƒ½åŠ é”ã€‚</p>\n<h4 id=\"mvcc-ä¸‹çš„-sql-æ“ä½œ\"><a class=\"anchor\" href=\"#mvcc-ä¸‹çš„-sql-æ“ä½œ\">#</a> MVCC ä¸‹çš„ SQL æ“ä½œ</h4>\n<p>InnoDB çš„ MVCC ï¼Œæ˜¯é€šè¿‡åœ¨æ¯è¡Œçºªå½•åé¢ä¿å­˜ä¸¤ä¸ªéšè—çš„åˆ—æ¥å®ç°çš„ã€‚è¿™ä¸¤ä¸ªåˆ—ï¼Œä¸€ä¸ªä¿å­˜äº†è¡Œçš„åˆ›å»ºæ—¶é—´ï¼Œä¸€ä¸ªä¿å­˜äº†è¡Œçš„è¿‡æœŸæ—¶é—´ï¼ˆæˆ–åˆ é™¤æ—¶é—´ï¼‰ï¼Œå½“ç„¶å­˜å‚¨çš„å¹¶ä¸æ˜¯å®é™…çš„æ—¶é—´å€¼ï¼Œè€Œæ˜¯ç³»ç»Ÿç‰ˆæœ¬å·ï¼ˆå¯ä»¥ç†è§£ä¸ºäº‹åŠ¡çš„ ID ï¼‰ã€‚æ¯å¼€å§‹ä¸€ä¸ªæ–°çš„äº‹åŠ¡ï¼Œç³»ç»Ÿç‰ˆæœ¬å·éƒ½ä¼šè‡ªåŠ¨é€’å¢ã€‚äº‹åŠ¡å¼€å§‹æ—¶åˆ»çš„ç³»ç»Ÿç‰ˆæœ¬å·ä¼šä½œä¸ºäº‹åŠ¡çš„ç‰ˆæœ¬å·ï¼Œç”¨æ¥å’ŒæŸ¥è¯¢åˆ°çš„æ¯è¡Œçºªå½•çš„ç‰ˆæœ¬å·è¿›è¡Œæ¯”è¾ƒã€‚åœ¨  <code>REPEATABLE READ</code>  éš”ç¦»çº§åˆ«ä¸‹ï¼Œ MVCC å…·ä½“çš„æ“ä½œå¦‚ä¸‹ï¼š<br />\n<strong>SELECT</strong><br />\nInnoDB ä¼šæ ¹æ®ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶æ£€æŸ¥æ¯è¡Œçºªå½•ï¼š</p>\n<ul>\n<li>InnoDB åªæŸ¥æ‰¾ç‰ˆæœ¬æ—©äºå½“å‰äº‹åŠ¡ç‰ˆæœ¬çš„æ•°æ®è¡Œï¼Œå³ï¼Œè¡Œçš„ç³»ç»Ÿç‰ˆæœ¬å·å°äºæˆ–ç­‰äºäº‹åŠ¡çš„ç³»ç»Ÿç‰ˆæœ¬å·ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿äº‹åŠ¡è¯»å–çš„è¡Œï¼Œè¦ä¹ˆæ˜¯åœ¨äº‹åŠ¡å¼€å§‹å‰å·²ç»å­˜åœ¨çš„ï¼Œè¦ä¹ˆæ˜¯äº‹åŠ¡è‡ªèº«æ’å…¥æˆ–è€…ä¿®æ”¹è¿‡çš„ã€‚</li>\n<li>è¡Œçš„åˆ é™¤ç‰ˆæœ¬ï¼Œè¦ä¹ˆæœªå®šä¹‰ï¼Œè¦ä¹ˆå¤§äºå½“å‰äº‹åŠ¡ç‰ˆæœ¬å·ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿äº‹åŠ¡è¯»å–åˆ°çš„è¡Œï¼Œåœ¨äº‹åŠ¡å¼€å§‹ä¹‹å‰æœªè¢«åˆ é™¤ã€‚</li>\n</ul>\n<p>åªæœ‰ç¬¦åˆä¸Šè¿°ä¸¤ä¸ªæ¡ä»¶çš„çºªå½•ï¼Œæ‰èƒ½ä½œä¸ºæŸ¥è¯¢ç»“æœè¿”å›ã€‚</p>\n<p><strong>INSERT</strong><br />\nInnoDB ä¸ºæ’å…¥çš„æ¯ä¸€è¡Œä¿å­˜å½“å‰ç³»ç»Ÿç‰ˆæœ¬å·ä½œä¸ºè¡Œç‰ˆæœ¬å·ã€‚</p>\n<p><strong>DELETE</strong><br />\nInnoDB ä¸ºåˆ é™¤çš„æ¯ä¸€è¡Œä¿å­˜å½“å‰ç³»ç»Ÿç‰ˆæœ¬å·ä½œä¸ºè¡Œåˆ é™¤æ ‡è¯†ã€‚</p>\n<p><strong>UPDATE</strong><br />\nInnoDB ä¸ºæ’å…¥ä¸€è¡Œæ–°çºªå½•ï¼Œä¿å­˜å½“å‰ç³»ç»Ÿç‰ˆæœ¬å·ä½œä¸ºè¡Œç‰ˆæœ¬å·ï¼ŒåŒæ—¶ï¼Œä¿å­˜å½“å‰ç³»ç»Ÿç‰ˆæœ¬å·åˆ°åŸæ¥çš„è¡Œä½œä¸ºè¡Œåˆ é™¤æ ‡è¯†ã€‚</p>\n<h4 id=\"ç‰ˆæœ¬é“¾\"><a class=\"anchor\" href=\"#ç‰ˆæœ¬é“¾\">#</a> ç‰ˆæœ¬é“¾</h4>\n<p>åœ¨ InnoDB å¼•æ“è¡¨ä¸­ï¼Œå®ƒçš„èšç°‡ç´¢å¼•è®°å½•ä¸­æœ‰ä¸¤ä¸ªå¿…è¦çš„éšè—åˆ—ï¼š</p>\n<ul>\n<li><strong>trx_id</strong>ï¼š è¿™ä¸ª id ç”¨æ¥å­˜å‚¨çš„æ¯æ¬¡å¯¹æŸæ¡èšç°‡ç´¢å¼•è®°å½•è¿›è¡Œä¿®æ”¹çš„æ—¶å€™çš„äº‹åŠ¡ idã€‚</li>\n<li><strong>roll_pointer</strong>ï¼šæ¯æ¬¡å¯¹å“ªæ¡èšç°‡ç´¢å¼•è®°å½•æœ‰ä¿®æ”¹çš„æ—¶å€™ï¼Œéƒ½ä¼šæŠŠè€ç‰ˆæœ¬å†™å…¥ undo log ä¸­ã€‚è¿™ä¸ª roll_pointer å°±æ˜¯å­˜äº†ä¸€ä¸ªæŒ‡é’ˆï¼Œå®ƒæŒ‡å‘è¿™æ¡èšç°‡ç´¢å¼•è®°å½•çš„ä¸Šä¸€ä¸ªç‰ˆæœ¬çš„ä½ç½®ï¼Œé€šè¿‡å®ƒæ¥è·å¾—ä¸Šä¸€ä¸ªç‰ˆæœ¬çš„è®°å½•ä¿¡æ¯ã€‚ï¼ˆæ³¨æ„æ’å…¥æ“ä½œçš„ undo log æ²¡æœ‰è¿™ä¸ªå±æ€§ï¼Œå› ä¸ºå®ƒæ²¡æœ‰è€ç‰ˆæœ¬ï¼‰<br />\n<img data-src=\"https://cdn.jsdelivr.net/gh/haust-Kevin/static@master//images/202310281653207.png\" alt=\"\" /></li>\n</ul>\n<h4 id=\"readview\"><a class=\"anchor\" href=\"#readview\">#</a> ReadView</h4>\n<p>å½“æˆ‘ä»¬ç”¨ select è¯»å–æ•°æ®æ—¶ï¼Œè¿™ä¸€æ—¶åˆ»çš„æ•°æ®ä¼šæœ‰å¾ˆå¤šä¸ªç‰ˆæœ¬ï¼ˆä¾‹å¦‚ä¸Šå›¾æœ‰å››ä¸ªç‰ˆæœ¬ï¼‰ï¼Œä½†æˆ‘ä»¬å¹¶ä¸çŸ¥é“è¯»å–å“ªä¸ªç‰ˆæœ¬ï¼Œè¿™æ—¶å°±é  readview æ¥å¯¹æˆ‘ä»¬è¿›è¡Œè¯»å–ç‰ˆæœ¬çš„é™åˆ¶ï¼Œé€šè¿‡ readview æˆ‘ä»¬æ‰çŸ¥é“è‡ªå·±èƒ½å¤Ÿè¯»å–å“ªä¸ªç‰ˆæœ¬ã€‚</p>\n<h5 id=\"read-view-å‡ ä¸ªå±æ€§\"><a class=\"anchor\" href=\"#read-view-å‡ ä¸ªå±æ€§\">#</a> Read View å‡ ä¸ªå±æ€§</h5>\n<ul>\n<li>trx_ids: å½“å‰ç³»ç»Ÿæ´»è·ƒï¼ˆæœªæäº¤ï¼‰äº‹åŠ¡ç‰ˆæœ¬å·é›†åˆã€‚</li>\n<li>low_limit_id: åˆ›å»ºå½“å‰ read view æ—¶ â€œå½“å‰ç³»ç»Ÿæœ€å¤§äº‹åŠ¡ç‰ˆæœ¬å· + 1â€ã€‚</li>\n<li>up_limit_id: åˆ›å»ºå½“å‰ read view æ—¶ â€œç³»ç»Ÿæ­£å¤„äºæ´»è·ƒäº‹åŠ¡æœ€å°ç‰ˆæœ¬å·â€</li>\n<li>creator_trx_id: åˆ›å»ºå½“å‰ read view çš„äº‹åŠ¡ç‰ˆæœ¬å·ï¼›</li>\n</ul>\n<h5 id=\"mvcc-å¦‚ä½•å®ç°-rc-å’Œ-rr-çš„éš”ç¦»çº§åˆ«\"><a class=\"anchor\" href=\"#mvcc-å¦‚ä½•å®ç°-rc-å’Œ-rr-çš„éš”ç¦»çº§åˆ«\">#</a> mvcc å¦‚ä½•å®ç° RC å’Œ RR çš„éš”ç¦»çº§åˆ«</h5>\n<ul>\n<li>RC çš„éš”ç¦»çº§åˆ«ä¸‹ï¼Œæ¯ä¸ªå¿«ç…§è¯»éƒ½ä¼šç”Ÿæˆå¹¶è·å–æœ€æ–°çš„ readviewã€‚</li>\n<li>RR çš„éš”ç¦»çº§åˆ«ä¸‹ï¼Œåªæœ‰åœ¨åŒä¸€ä¸ªäº‹åŠ¡çš„ç¬¬ä¸€ä¸ªå¿«ç…§è¯»æ‰ä¼šåˆ›å»º readviewï¼Œä¹‹åçš„æ¯æ¬¡å¿«ç…§è¯»éƒ½ä½¿ç”¨çš„åŒä¸€ä¸ª readviewï¼Œæ‰€ä»¥æ¯æ¬¡çš„æŸ¥è¯¢ç»“æœéƒ½æ˜¯ä¸€æ ·çš„ã€‚</li>\n</ul>\n<h2 id=\"ç´¢å¼•\"><a class=\"anchor\" href=\"#ç´¢å¼•\">#</a> ç´¢å¼•</h2>\n<p>ç´¢å¼•å°±æ˜¯æ ¹æ®è¡¨ä¸­çš„ä¸€åˆ—æˆ–è‹¥å¹²åˆ—æŒ‰ç…§ä¸€å®šé¡ºåºå»ºç«‹çš„åˆ—å€¼ä¸è®°å½•è¡Œä¹‹é—´çš„å¯¹åº”å…³ç³»è¡¨ï¼Œå®è´¨ä¸Šæ˜¯ä¸€å¼ æè¿°ç´¢å¼•åˆ—çš„åˆ—å€¼ä¸åŸè¡¨ä¸­è®°å½•è¡Œä¹‹é—´ä¸€ ä¸€å¯¹åº”å…³ç³»çš„æœ‰åºè¡¨ã€‚</p>\n<p>ç´¢å¼•çš„ä¼˜ç‚¹ï¼š</p>\n<ul>\n<li>é€šè¿‡åˆ›å»ºå”¯ä¸€ç´¢å¼•ï¼Œå¯ä»¥ä¿è¯æ•°æ®åº“è¡¨ä¸­æ¯ä¸€è¡Œæ•°æ®çš„å”¯ä¸€æ€§ã€‚</li>\n<li>å¯ä»¥å¤§å¤§åŠ å¿«æ•°æ®çš„æŸ¥è¯¢é€Ÿåº¦ï¼Œè¿™ä¹Ÿæ˜¯åˆ›å»ºç´¢å¼•çš„ä¸»è¦åŸå› ã€‚</li>\n<li>åœ¨å®ç°æ•°æ®çš„å‚è€ƒå®Œæ•´æ€§æ–¹é¢ï¼Œå¯ä»¥åŠ é€Ÿè¡¨å’Œè¡¨ä¹‹é—´çš„è¿æ¥ã€‚</li>\n<li>åœ¨ä½¿ç”¨åˆ†ç»„å’Œæ’åºå­å¥è¿›è¡Œæ•°æ®æŸ¥è¯¢æ—¶ï¼Œä¹Ÿå¯ä»¥æ˜¾è‘—å‡å°‘æŸ¥è¯¢ä¸­åˆ†ç»„å’Œæ’åºçš„æ—¶é—´ã€‚</li>\n</ul>\n<p>ç´¢å¼•çš„ç¼ºç‚¹ï¼š</p>\n<ul>\n<li>åˆ›å»ºç´¢å¼•å’Œç»´æŠ¤ç´¢å¼•è¦è€—è´¹æ—¶é—´ï¼Œå¹¶ä¸”éšç€æ•°æ®é‡çš„å¢åŠ æ‰€è€—è´¹çš„æ—¶é—´ä¹Ÿä¼šå¢åŠ ã€‚</li>\n<li>ç´¢å¼•éœ€è¦å ç£ç›˜ç©ºé—´ï¼Œé™¤äº†æ•°æ®è¡¨å æ•°æ®ç©ºé—´ä¹‹å¤–ï¼Œæ¯ä¸€ä¸ªç´¢å¼•è¿˜è¦å ä¸€å®šçš„ç‰©ç†ç©ºé—´ï¼Œå¦‚æœæœ‰å¤§é‡çš„ç´¢å¼•ï¼Œç´¢å¼•æ–‡ä»¶å¯èƒ½æ¯”æ•°æ®æ–‡ä»¶æ›´å¿«è¾¾åˆ°æœ€å¤§æ–‡ä»¶å°ºå¯¸ã€‚</li>\n<li>å½“å¯¹è¡¨ä¸­çš„æ•°æ®è¿›è¡Œå¢åŠ ã€åˆ é™¤å’Œä¿®æ”¹çš„æ—¶å€™ï¼Œç´¢å¼•ä¹Ÿè¦åŠ¨æ€åœ°ç»´æŠ¤ï¼Œè¿™æ ·å°±é™ä½äº†æ•°æ®çš„ç»´æŠ¤é€Ÿåº¦ã€‚</li>\n</ul>\n<p>ç´¢å¼•å¯ä»¥æé«˜æŸ¥è¯¢é€Ÿåº¦ï¼Œä½†æ˜¯ä¼šå½±å“æ’å…¥è®°å½•çš„é€Ÿåº¦ã€‚å› ä¸ºï¼Œå‘æœ‰ç´¢å¼•çš„è¡¨ä¸­æ’å…¥è®°å½•æ—¶ï¼Œæ•°æ®åº“ç³»ç»Ÿä¼šæŒ‰ç…§ç´¢å¼•è¿›è¡Œæ’åºï¼Œè¿™æ ·å°±é™ä½äº†æ’å…¥è®°å½•çš„é€Ÿåº¦ï¼Œæ’å…¥å¤§é‡è®°å½•æ—¶çš„é€Ÿåº¦å½±å“ä¼šæ›´åŠ æ˜æ˜¾ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæœ€å¥½çš„åŠæ³•æ˜¯å…ˆåˆ é™¤è¡¨ä¸­çš„ç´¢å¼•ï¼Œç„¶åæ’å…¥æ•°æ®ï¼Œæ’å…¥å®Œæˆåï¼Œå†åˆ›å»ºç´¢å¼•ã€‚</p>\n<h3 id=\"ç´¢å¼•ç»“æ„\"><a class=\"anchor\" href=\"#ç´¢å¼•ç»“æ„\">#</a> ç´¢å¼•ç»“æ„</h3>\n<h4 id=\"hash\"><a class=\"anchor\" href=\"#hash\">#</a> Hash</h4>\n<p>MySQL ä¸­ï¼Œåªæœ‰ Memory å­˜å‚¨å¼•æ“æ”¯æŒ Hash ç´¢å¼•ï¼Œæ˜¯ Memory è¡¨çš„é»˜è®¤ç´¢å¼•ç±»å‹ã€‚hash ç´¢å¼•æŠŠæ•°æ®çš„ç´¢å¼•ä»¥ hash å€¼å½¢å¼ç»„ç»‡èµ·æ¥ï¼Œå› æ­¤æ£€ç´¢æ•ˆç‡éå¸¸é«˜ï¼Œå¯ä»¥ä¸€æ¬¡å®šä½ï¼Œä¸åƒ B+Tree ç´¢å¼•éœ€è¦è¿›è¡Œä»æ ¹èŠ‚ç‚¹åˆ°å¶èŠ‚ç‚¹çš„å¤šæ¬¡ IO æ“ä½œã€‚</p>\n<h4 id=\"btree\"><a class=\"anchor\" href=\"#btree\">#</a> B+Tree</h4>\n<p>B+Tree æ˜¯ MySQL ä½¿ç”¨æœ€é¢‘ç¹çš„ä¸€ä¸ªç´¢å¼•æ•°æ®ç»“æ„ï¼Œæ˜¯ Innodb å’Œ Myisam å­˜å‚¨å¼•æ“æ¨¡å¼çš„ç´¢å¼•ç±»å‹ã€‚ç›¸å¯¹ Hash ç´¢å¼•ï¼ŒB+Tree åœ¨æŸ¥æ‰¾å•æ¡è®°å½•çš„é€Ÿåº¦æ¯”ä¸ä¸Š Hash ç´¢å¼•ï¼Œä½†æ˜¯æ›´é€‚åˆæ’åºç­‰æ“ä½œã€‚</p>\n<h4 id=\"b-tree-btree\"><a class=\"anchor\" href=\"#b-tree-btree\">#</a> B-Tree &amp; B+Tree</h4>\n<p>B+ æ ‘å¶æ˜¯ m å‰æœç´¢æ ‘ï¼Œåœ¨ B æ ‘çš„åŸºç¡€ä¸Šï¼Œåšäº†ä¸€äº›æ”¹è¿›ï¼š</p>\n<ul>\n<li>éå¶å­èŠ‚ç‚¹ä¸å†å­˜å‚¨æ•°æ®ï¼Œæ•°æ®åªå­˜å‚¨åœ¨åŒä¸€å±‚çš„å¶å­èŠ‚ç‚¹ä¸Šï¼›</li>\n<li>å¶å­ä¹‹é—´ï¼Œå¢åŠ äº†é“¾è¡¨ï¼Œè·å–æ‰€æœ‰èŠ‚ç‚¹ï¼Œä¸å†éœ€è¦ä¸­åºéå†ï¼›</li>\n<li>å¶å­èŠ‚ç‚¹å­˜å‚¨å®é™…è®°å½•è¡Œï¼Œè®°å½•è¡Œç›¸å¯¹æ¯”è¾ƒç´§å¯†çš„å­˜å‚¨ï¼Œé€‚åˆå¤§æ•°æ®é‡ç£ç›˜å­˜å‚¨ï¼›- éå¶å­èŠ‚ç‚¹å­˜å‚¨è®°å½•çš„ä¸»é”®ï¼Œç”¨äºæŸ¥è¯¢åŠ é€Ÿï¼Œé€‚åˆå†…å­˜å­˜å‚¨ï¼›</li>\n<li>éå¶å­èŠ‚ç‚¹ï¼Œä¸å­˜å‚¨å®é™…è®°å½•ï¼Œè€Œåªå­˜å‚¨è®°å½•çš„ KEY çš„è¯ï¼Œé‚£ä¹ˆåœ¨ç›¸åŒå†…å­˜çš„æƒ…å†µä¸‹ï¼ŒB+ æ ‘èƒ½å¤Ÿå­˜å‚¨æ›´å¤šç´¢å¼•ï¼›</li>\n</ul>\n<h3 id=\"myisam-ç´¢å¼•\"><a class=\"anchor\" href=\"#myisam-ç´¢å¼•\">#</a> MyISAM ç´¢å¼•</h3>\n<p>MyISAM å¼•æ“ä½¿ç”¨ B+Tree ä½œä¸ºç´¢å¼•ç»“æ„ï¼Œå¶èŠ‚ç‚¹çš„ data åŸŸå­˜æ”¾çš„æ˜¯æ•°æ®è®°å½•çš„åœ°å€ï¼ŒMyISAM ç´¢å¼•çš„åŸç†å›¾å¦‚ä¸‹ã€‚è¿™é‡Œå‡è®¾è¡¨ä¸€å…±æœ‰ä¸‰åˆ—ï¼Œå‡è®¾æˆ‘ä»¬ä»¥ Col1 ä¸ºä¸»é”®ï¼Œåˆ™ä¸Šå›¾æ˜¯ä¸€ä¸ª MyISAM è¡¨çš„ä¸»ç´¢å¼•ï¼ˆPrimary keyï¼‰ç¤ºæ„ã€‚å¯ä»¥çœ‹å‡º MyISAM çš„ç´¢å¼•æ–‡ä»¶ä»…ä»…ä¿å­˜æ•°æ®è®°å½•çš„åœ°å€ã€‚åœ¨ MyISAM ä¸­ï¼Œä¸»ç´¢å¼•å’Œè¾…åŠ©ç´¢å¼•ï¼ˆSecondary keyï¼‰åœ¨ç»“æ„ä¸Šæ²¡æœ‰ä»»ä½•åŒºåˆ«ï¼Œåªæ˜¯ä¸»ç´¢å¼•è¦æ±‚ key æ˜¯å”¯ä¸€çš„ï¼Œè€Œè¾…åŠ©ç´¢å¼•çš„ key å¯ä»¥é‡å¤ã€‚<br />\n<img data-src=\"https://cdn.jsdelivr.net/gh/haust-Kevin/static@master//images/202310281816878.png\" alt=\"\" /><br />\nå¦‚æœæˆ‘ä»¬åœ¨ Col2 ä¸Šå»ºç«‹ä¸€ä¸ªè¾…åŠ©ç´¢å¼•ï¼Œåˆ™æ­¤ç´¢å¼•çš„ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚åŒæ ·ä¹Ÿæ˜¯ä¸€é¢— B+Tree ï¼Œ data åŸŸä¿å­˜æ•°æ®è®°å½•çš„åœ°å€ã€‚å› æ­¤ï¼Œ MyISAM ä¸­ç´¢å¼•æ£€ç´¢çš„ç®—æ³•ä¸ºé¦–å…ˆæŒ‰ç…§ B+Tree æœç´¢ç®—æ³•æœç´¢ç´¢å¼•ï¼Œå¦‚æœæŒ‡å®šçš„ Key å­˜åœ¨ï¼Œåˆ™å–å‡ºå…¶ data åŸŸçš„å€¼ï¼Œç„¶åä»¥ data åŸŸçš„å€¼ä¸ºåœ°å€ï¼Œè¯»å–ç›¸åº”æ•°æ®è®°å½•ã€‚<br />\n<img data-src=\"https://cdn.jsdelivr.net/gh/haust-Kevin/static@master//images/202310281817570.png\" alt=\"\" /></p>\n<h3 id=\"innodb-ç´¢å¼•\"><a class=\"anchor\" href=\"#innodb-ç´¢å¼•\">#</a> InnoDB ç´¢å¼•</h3>\n<p>è™½ç„¶ InnoDB ä¹Ÿä½¿ç”¨ B+Tree ä½œä¸ºç´¢å¼•ç»“æ„ï¼Œä½†å…·ä½“å®ç°æ–¹å¼å´ä¸ MyISAM æˆªç„¶ä¸åŒã€‚</p>\n<p>ç¬¬ä¸€ä¸ªé‡å¤§åŒºåˆ«æ˜¯ InnoDB çš„æ•°æ®æ–‡ä»¶æœ¬èº«å°±æ˜¯ç´¢å¼•æ–‡ä»¶ã€‚ä»ä¸Šæ–‡çŸ¥é“ï¼Œ MyISAM ç´¢å¼•æ–‡ä»¶å’Œæ•°æ®æ–‡ä»¶æ˜¯åˆ†ç¦»çš„ï¼Œç´¢å¼•æ–‡ä»¶ä»…ä¿å­˜æ•°æ®è®°å½•çš„åœ°å€ã€‚è€Œåœ¨ InnoDB ä¸­ï¼Œè¡¨æ•°æ®æ–‡ä»¶æœ¬èº«å°±æ˜¯æŒ‰ B+Tree ç»„ç»‡çš„ä¸€ä¸ªç´¢å¼•ç»“æ„ï¼Œè¿™æ£µæ ‘çš„å¶èŠ‚ç‚¹ data åŸŸä¿å­˜äº†å®Œæ•´çš„æ•°æ®è®°å½•ã€‚è¿™ä¸ªç´¢å¼•çš„ key æ˜¯æ•°æ®è¡¨çš„ä¸»é”®ï¼Œå› æ­¤ InnoDB è¡¨æ•°æ®æ–‡ä»¶æœ¬èº«å°±æ˜¯ä¸»ç´¢å¼•ã€‚</p>\n<p>ä¸‹å›¾æ˜¯ InnoDB ä¸»ç´¢å¼•ï¼ˆåŒæ—¶ä¹Ÿæ˜¯æ•°æ®æ–‡ä»¶ï¼‰çš„ç¤ºæ„å›¾ï¼Œå¯ä»¥çœ‹åˆ°å¶èŠ‚ç‚¹åŒ…å«äº†å®Œæ•´çš„æ•°æ®è®°å½•ã€‚è¿™ç§ç´¢å¼•å«åš<strong>èšé›†ç´¢å¼•</strong>ã€‚å› ä¸º InnoDB çš„æ•°æ®æ–‡ä»¶æœ¬èº«è¦æŒ‰ä¸»é”®èšé›†ï¼Œæ‰€ä»¥ InnoDB è¦æ±‚è¡¨å¿…é¡»æœ‰ä¸»é”®ï¼ˆ MyISAM å¯ä»¥æ²¡æœ‰ï¼‰ï¼Œå¦‚æœæ²¡æœ‰æ˜¾å¼æŒ‡å®šï¼Œåˆ™ MySQL ç³»ç»Ÿä¼šè‡ªåŠ¨é€‰æ‹©ä¸€ä¸ªå¯ä»¥å”¯ä¸€æ ‡è¯†æ•°æ®è®°å½•çš„åˆ—ä½œä¸ºä¸»é”®ï¼Œå¦‚æœä¸å­˜åœ¨è¿™ç§åˆ—ï¼Œåˆ™ MySQL è‡ªåŠ¨ä¸º InnoDB è¡¨ç”Ÿæˆä¸€ä¸ªéšå«å­—æ®µä½œä¸ºä¸»é”®ï¼Œè¿™ä¸ªå­—æ®µé•¿åº¦ä¸º 6 ä¸ªå­—èŠ‚ï¼Œç±»å‹ä¸ºé•¿æ•´å½¢ã€‚<br />\n<img data-src=\"https://cdn.jsdelivr.net/gh/haust-Kevin/static@master//images/202310281820436.png\" alt=\"\" /><br />\nç¬¬äºŒä¸ªä¸ MyISAM ç´¢å¼•çš„ä¸åŒæ˜¯ InnoDB çš„è¾…åŠ©ç´¢å¼• data åŸŸå­˜å‚¨ç›¸åº”è®°å½•ä¸»é”®çš„å€¼è€Œä¸æ˜¯åœ°å€ã€‚æ¢å¥è¯è¯´ï¼Œ InnoDB çš„æ‰€æœ‰è¾…åŠ©ç´¢å¼•éƒ½å¼•ç”¨ä¸»é”®ä½œä¸º data åŸŸã€‚ä¸‹å›¾ä¸ºå®šä¹‰åœ¨ Col3 ä¸Šçš„ä¸€ä¸ªè¾…åŠ©ç´¢å¼•ã€‚è¿™é‡Œä»¥è‹±æ–‡å­—ç¬¦çš„ ASCII ç ä½œä¸ºæ¯”è¾ƒå‡†åˆ™ã€‚èšé›†ç´¢å¼•è¿™ç§å®ç°æ–¹å¼ä½¿å¾—æŒ‰ä¸»é”®çš„æœç´¢ååˆ†é«˜æ•ˆï¼Œä½†æ˜¯è¾…åŠ©ç´¢å¼•æœç´¢éœ€è¦æ£€ç´¢ä¸¤éç´¢å¼•ï¼šé¦–å…ˆæ£€ç´¢è¾…åŠ©ç´¢å¼•è·å¾—ä¸»é”®ï¼Œç„¶åç”¨ä¸»é”®åˆ°ä¸»ç´¢å¼•ä¸­æ£€ç´¢è·å¾—è®°å½•ã€‚<br />\n<img data-src=\"https://cdn.jsdelivr.net/gh/haust-Kevin/static@master//images/202310281821389.png\" alt=\"\" /></p>\n<h3 id=\"åˆ›å»ºç´¢å¼•å‡†åˆ™\"><a class=\"anchor\" href=\"#åˆ›å»ºç´¢å¼•å‡†åˆ™\">#</a> åˆ›å»ºç´¢å¼•å‡†åˆ™</h3>\n<h4 id=\"åº”è¯¥åˆ›å»ºç´¢å¼•çš„åˆ—\"><a class=\"anchor\" href=\"#åº”è¯¥åˆ›å»ºç´¢å¼•çš„åˆ—\">#</a> åº”è¯¥åˆ›å»ºç´¢å¼•çš„åˆ—</h4>\n<ul>\n<li>åœ¨ç»å¸¸éœ€è¦æœç´¢çš„åˆ—ä¸Šï¼Œå¯ä»¥åŠ å¿«æœç´¢çš„é€Ÿåº¦</li>\n<li>åœ¨ä½œä¸ºä¸»é”®çš„åˆ—ä¸Šï¼Œå¼ºåˆ¶è¯¥åˆ—çš„å”¯ä¸€æ€§å’Œç»„ç»‡è¡¨ä¸­æ•°æ®çš„æ’åˆ—ç»“æ„</li>\n<li>åœ¨ç»å¸¸ç”¨åœ¨è¿æ¥ï¼ˆJOINï¼‰çš„åˆ—ä¸Šï¼Œè¿™äº›åˆ—ä¸»è¦æ˜¯ä¸€å¤–é”®ï¼Œå¯ä»¥åŠ å¿«è¿æ¥çš„é€Ÿåº¦</li>\n<li>åœ¨ç»å¸¸éœ€è¦æ ¹æ®èŒƒå›´ï¼ˆ&lt;ï¼Œ&lt;=ï¼Œ=ï¼Œ&gt;ï¼Œ&gt;=ï¼ŒBETWEENï¼ŒINï¼‰è¿›è¡Œæœç´¢çš„åˆ—ä¸Šåˆ›å»ºç´¢å¼•ï¼Œå› ä¸ºç´¢å¼•å·²ç»æ’åºï¼Œå…¶æŒ‡å®šçš„èŒƒå›´æ˜¯è¿ç»­çš„</li>\n<li>åœ¨ç»å¸¸éœ€è¦æ’åºï¼ˆorder byï¼‰çš„åˆ—ä¸Šåˆ›å»ºç´¢å¼•ï¼Œå› ä¸ºç´¢å¼•å·²ç»æ’åºï¼Œè¿™æ ·æŸ¥è¯¢å¯ä»¥åˆ©ç”¨ç´¢å¼•çš„æ’åºï¼ŒåŠ å¿«æ’åºæŸ¥è¯¢æ—¶é—´ï¼›</li>\n<li>åœ¨ç»å¸¸ä½¿ç”¨åœ¨ WHERE å­å¥ä¸­çš„åˆ—ä¸Šé¢åˆ›å»ºç´¢å¼•ï¼ŒåŠ å¿«æ¡ä»¶çš„åˆ¤æ–­é€Ÿåº¦ã€‚</li>\n</ul>\n<h4 id=\"ä¸è¯¥åˆ›å»ºç´¢å¼•çš„åˆ—\"><a class=\"anchor\" href=\"#ä¸è¯¥åˆ›å»ºç´¢å¼•çš„åˆ—\">#</a> ä¸è¯¥åˆ›å»ºç´¢å¼•çš„åˆ—</h4>\n<ul>\n<li>åœ¨ WHERE ä¸­ä½¿ç”¨ä¸åˆ°çš„å­—æ®µï¼Œä¸è¦è®¾ç½®ç´¢å¼•ã€‚</li>\n<li>é¢‘ç¹æ›´æ–°çš„å­—æ®µä¸é€‚åˆå»ºç«‹ç´¢å¼•ã€‚</li>\n<li>æ•°æ®æ¯”è¾ƒå°‘çš„è¡¨ä¸éœ€è¦å»ºç´¢å¼•ã€‚</li>\n<li>æ•°æ®é‡å¤ä¸”åˆ†å¸ƒæ¯”è¾ƒå‡åŒ€çš„çš„å­—æ®µä¸é€‚åˆå»ºç´¢å¼•ï¼Œä¾‹å¦‚æ€§åˆ«ã€çœŸå‡å€¼ã€‚</li>\n<li>å‚ä¸åˆ—è®¡ç®—çš„åˆ—ä¸é€‚åˆå»ºç´¢å¼•ã€‚</li>\n</ul>\n<h3 id=\"ç´¢å¼•å¤±æ•ˆ\"><a class=\"anchor\" href=\"#ç´¢å¼•å¤±æ•ˆ\">#</a> ç´¢å¼•å¤±æ•ˆ</h3>\n<ul>\n<li>æ¨¡ç³ŠæŸ¥è¯¢ like ä»¥  <code>%</code>  å¼€å¤´ï¼›</li>\n<li>åœ¨ç´¢å¼•å­—æ®µå­—æ®µä¸Šä½¿ç”¨å‡½æ•°</li>\n<li>åœ¨ç´¢å¼•å­—æ®µä¸Šè¿›è¡Œï¼ˆ+ï¼Œ-ï¼Œ*ï¼Œ/ï¼Œ!, !=, &lt;&gt;ï¼‰ç­‰è¿ç®—ï¼Œä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆã€‚</li>\n<li>æ•°æ®ç±»å‹éšå¼è½¬æ¢ã€‚<br />\nMySQL åœ¨é‡åˆ°å­—ç¬¦ä¸²å’Œæ•°å­—æ¯”è¾ƒçš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨æŠŠå­—ç¬¦ä¸²è½¬ä¸ºæ•°å­—ï¼Œç„¶åå†è¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœå­—ç¬¦ä¸²æ˜¯ç´¢å¼•åˆ—ï¼Œè€Œæ¡ä»¶è¯­å¥ä¸­çš„è¾“å…¥å‚æ•°æ˜¯æ•°å­—çš„è¯ï¼Œé‚£ä¹ˆç´¢å¼•åˆ—ä¼šå‘ç”Ÿéšå¼ç±»å‹è½¬æ¢ï¼Œç”±äºéšå¼ç±»å‹è½¬æ¢æ˜¯é€šè¿‡ CAST å‡½æ•°å®ç°çš„ï¼Œç­‰åŒäºå¯¹ç´¢å¼•åˆ—ä½¿ç”¨äº†å‡½æ•°ï¼Œæ‰€ä»¥å°±ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆã€‚</li>\n<li>è”åˆç´¢å¼•æ²¡æœ‰éµå¾ªæœ€å·¦åŒ¹é…åŸåˆ™ã€‚</li>\n<li>åœ¨ WHERE å­å¥ä¸­ï¼Œ <code>OR</code>  å‰åæ²¡æœ‰åŒæ—¶ä½¿ç”¨ç´¢å¼•ã€‚</li>\n<li>ä¼˜åŒ–å™¨é€‰é”™ç´¢å¼•</li>\n</ul>\n",
            "tags": [
                "é¢è¯•æŒ‡åŒ—",
                "æ•°æ®åº“",
                "å…«è‚¡æ–‡",
                "æ•°æ®åº“",
                "MySQL"
            ]
        },
        {
            "id": "https://haust-kevin.github.io/2023/10/26/2023-10-interview-jvm/",
            "url": "https://haust-kevin.github.io/2023/10/26/2023-10-interview-jvm/",
            "title": "é¢è¯•æŒ‡åŒ—ï¼šJava è™šæ‹Ÿæœº",
            "date_published": "2023-10-26T07:39:09.000Z",
            "content_html": "<h2 id=\"å†…å­˜åŒºåŸŸ\"><a class=\"anchor\" href=\"#å†…å­˜åŒºåŸŸ\">#</a> å†…å­˜åŒºåŸŸ</h2>\n<h3 id=\"java-å†…å­˜åŒºåŸŸåˆ’åˆ†\"><a class=\"anchor\" href=\"#java-å†…å­˜åŒºåŸŸåˆ’åˆ†\">#</a> Java å†…å­˜åŒºåŸŸåˆ’åˆ†</h3>\n<p>Java è™šæ‹Ÿæœºè§„èŒƒè§„å®šçš„åŒºåŸŸåˆ†ä¸ºä»¥ä¸‹ 5 ä¸ªéƒ¨åˆ†ï¼š</p>\n<ul>\n<li><strong>ç¨‹åºè®¡æ•°å™¨ï¼ˆProgram Counter Registerï¼‰</strong>ï¼šå½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨ï¼Œå­—èŠ‚ç è§£æå™¨çš„å·¥ä½œæ˜¯é€šè¿‡æ”¹å˜è¿™ä¸ªè®¡æ•°å™¨çš„å€¼ï¼Œæ¥é€‰å–ä¸‹ä¸€æ¡éœ€è¦æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤ï¼Œåˆ†æ”¯ã€å¾ªç¯ã€è·³è½¬ã€å¼‚å¸¸å¤„ç†ã€çº¿ç¨‹æ¢å¤ç­‰åŸºç¡€åŠŸèƒ½ï¼Œéƒ½éœ€è¦ä¾èµ–è¿™ä¸ªè®¡æ•°å™¨æ¥å®Œæˆï¼›</li>\n<li><strong>Java è™šæ‹Ÿæœºæ ˆï¼ˆJava Virtual Machine Stacksï¼‰</strong>ï¼šç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£ç­‰ä¿¡æ¯ï¼›</li>\n<li><strong>æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative Method Stackï¼‰</strong>ï¼šä¸è™šæ‹Ÿæœºæ ˆçš„ä½œç”¨æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡è™šæ‹Ÿæœºæ ˆæ˜¯æœåŠ¡ Java æ–¹æ³•çš„ï¼Œè€Œæœ¬åœ°æ–¹æ³•æ ˆæ˜¯ä¸ºè™šæ‹Ÿæœºè°ƒç”¨ Native æ–¹æ³•æœåŠ¡çš„ï¼›</li>\n<li><strong>Java å †ï¼ˆJava Heapï¼‰</strong>ï¼šJava è™šæ‹Ÿæœºä¸­å†…å­˜æœ€å¤§çš„ä¸€å—ï¼Œæ˜¯è¢«æ‰€æœ‰çº¿ç¨‹å…±äº«çš„ï¼Œå‡ ä¹æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹éƒ½åœ¨è¿™é‡Œåˆ†é…å†…å­˜ï¼›</li>\n<li><strong>æ–¹æ³•åŒºï¼ˆMethed Areaï¼‰</strong>ï¼šç”¨äºå­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘åçš„ä»£ç ç­‰æ•°æ®ã€‚<br />\n<img data-src=\"https://uploadfiles.nowcoder.com/images/20220224/4107856_1645690687338/9602C6323C6B86C4EDA164DB052D8420\" alt=\"\" /></li>\n</ul>\n<h4 id=\"æœ¬åœ°å†…å­˜\"><a class=\"anchor\" href=\"#æœ¬åœ°å†…å­˜\">#</a> æœ¬åœ°å†…å­˜</h4>\n<p>Java è™šæ‹Ÿæœºåœ¨æ‰§è¡Œçš„æ—¶å€™ä¼šæŠŠç®¡ç†çš„å†…å­˜åˆ†é…æˆä¸åŒçš„åŒºåŸŸï¼Œè¿™äº›åŒºåŸŸè¢«ç§°ä¸ºè™šæ‹Ÿæœºå†…å­˜ï¼ŒåŒæ—¶ï¼Œå¯¹äºè™šæ‹Ÿæœºæ²¡æœ‰ç›´æ¥ç®¡ç†çš„ç‰©ç†å†…å­˜ï¼Œä¹Ÿæœ‰ä¸€å®šçš„åˆ©ç”¨ï¼Œè¿™äº›è¢«åˆ©ç”¨å´ä¸åœ¨è™šæ‹Ÿæœºå†…å­˜æ•°æ®åŒºçš„å†…å­˜ï¼Œæˆ‘ä»¬ç§°å®ƒä¸ºæœ¬åœ°å†…å­˜ã€‚<br />\næœ¬åœ°å†…å­˜ä¸å—è™šæ‹Ÿæœºå†…å­˜å‚æ•°çš„é™åˆ¶ï¼Œåªå—ç‰©ç†å†…å­˜å®¹é‡çš„é™åˆ¶ã€‚<br />\nè™½ç„¶ä¸å—å‚æ•°çš„é™åˆ¶ï¼Œä½†æ˜¯å¦‚æœå†…å­˜çš„å ç”¨è¶…å‡ºç‰©ç†å†…å­˜çš„å¤§å°ï¼ŒåŒæ ·ä¹Ÿä¼šæŠ¥ OOMã€‚</p>\n<p><strong>å…ƒç©ºé—´</strong><br />\nåœ¨ Java1.8 ä¸­ï¼ŒHotSpot è™šæ‹Ÿæœºå·²ç»å°†æ–¹æ³•åŒºï¼ˆæ°¸ä¹…å¸¦ï¼‰ç§»é™¤ï¼Œå–è€Œä»£ä¹‹çš„å°±æ˜¯å…ƒç©ºé—´ã€‚å…ƒç©ºé—´ä¸æ°¸ä¹…ä»£ä¹‹é—´æœ€å¤§çš„åŒºåˆ«åœ¨äºï¼šå…ƒç©ºé—´å¹¶ä¸åœ¨è™šæ‹Ÿæœºä¸­ï¼Œè€Œæ˜¯ä½¿ç”¨æœ¬åœ°å†…å­˜ã€‚</p>\n<p><strong>ç›´æ¥å†…å­˜</strong></p>\n<ul>\n<li>ç›´æ¥å†…å­˜ä¸æ˜¯è™šæ‹Ÿæœºè¿è¡Œæ—¶æ•°æ®åŒºçš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿä¸æ˜¯ã€ŠJava è™šæ‹Ÿæœºè§„èŒƒã€‹ä¸­å®šä¹‰çš„å†…å­˜åŒºåŸŸã€‚</li>\n<li>ç›´æ¥å†…å­˜æ˜¯åœ¨ Java å †å¤–çš„ã€ç›´æ¥å‘ç³»ç»Ÿç”³è¯·çš„å†…å­˜ç©ºé—´ã€‚</li>\n<li>æ¥æºäº NIO ï¼Œé€šè¿‡å­˜åœ¨å †ä¸­çš„ DirectByteBuffer æ“ä½œ Native å†…å­˜ã€‚</li>\n<li>é€šå¸¸ï¼Œè®¿é—®ç›´æ¥å†…å­˜çš„é€Ÿåº¦ä¼šä¼˜äº Java å †ï¼Œå³è¯»å†™æ€§èƒ½é«˜ã€‚å› æ­¤å¤„äºæ€§èƒ½è€ƒè™‘ï¼Œè¯»å†™é¢‘ç¹çš„åœºåˆå¯èƒ½ä¼šè€ƒè™‘ä½¿ç”¨ç›´æ¥å†…å­˜ã€‚Java çš„ NIO åº“å…è®¸ Java ç¨‹åºä½¿ç”¨ç›´æ¥å†…å­˜ï¼Œç”¨äºæ•°æ®ç¼“å†²åŒºã€‚</li>\n</ul>\n<h4 id=\"ä¸»å†…å­˜å’Œæœ¬åœ°å†…å­˜çš„å…³ç³»\"><a class=\"anchor\" href=\"#ä¸»å†…å­˜å’Œæœ¬åœ°å†…å­˜çš„å…³ç³»\">#</a> ä¸»å†…å­˜å’Œæœ¬åœ°å†…å­˜çš„å…³ç³»</h4>\n<p>JMM è§„å®šçš„ä¸»å†…å­˜å’Œæœ¬åœ°å†…å­˜çš„å…³ç³»</p>\n<ul>\n<li>æ‰€æœ‰çš„å˜é‡éƒ½å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­ï¼ŒåŒæ—¶æ¯ä¸ªçº¿ç¨‹ä¹Ÿæœ‰è‡ªå·±ç‹¬ç«‹çš„å·¥ä½œå†…å­˜ï¼Œå·¥ä½œå†…å­˜ä¸­æ‰€æœ‰çš„å˜é‡å†…å®¹éƒ½æ˜¯ä¸»å†…å­˜çš„æ‹·è´ã€‚</li>\n<li>çº¿ç¨‹ä¸èƒ½ç›´æ¥è¯»å†™ä¸»å†…å­˜ä¸­çš„å˜é‡ï¼Œè€Œæ˜¯åªèƒ½æ“ä½œè‡ªå·±å·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œå†åŒæ­¥åˆ°ä¸»å†…å­˜ä¸­ã€‚å³åœ¨ä¿®æ”¹å˜é‡ä¹‹å‰ï¼Œè¦å…ˆæ‰§è¡Œç¬¬ä¸€æ­¥è§„å®šçš„ï¼ŒæŠŠæ•°æ®æ‹·è´åˆ°å·¥ä½œå†…å­˜ä¸­å†ä¿®æ”¹ï¼Œå†åŒæ­¥ã€‚</li>\n<li>ä¸»å†…å­˜æ˜¯å¤šä¸ªçº¿ç¨‹å…±äº«çš„ï¼Œä½†çº¿ç¨‹é—´ä¸å…±äº«å·¥ä½œå†…å­˜ï¼Œå¦‚æœçº¿ç¨‹é—´éœ€è¦é€šä¿¡ï¼Œå¿…é¡»å€ŸåŠ©ä¸»å†…å­˜ä¸­è½¬æ¥å®Œæˆã€‚</li>\n</ul>\n<p><strong>æ€»ç»“</strong>ï¼šæ‰€æœ‰çš„å…±äº«å˜é‡ï¼Œæ˜¯å­˜åœ¨äºä¸»å†…å­˜ä¸­çš„ï¼Œæ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„æœ¬åœ°å†…å­˜ï¼Œè€Œä¸”çº¿ç¨‹è¯»å†™å…±äº«æ•°æ®ä¹Ÿæ˜¯é€šè¿‡æœ¬åœ°å†…å­˜äº¤æ¢çš„ï¼Œæ­£æ˜¯ç”±äºæœ‰äº¤æ¢çš„è¿‡ç¨‹ï¼Œå¹¶ä¸”è¿™ä¸ªäº¤æ¢ä¸æ˜¯å®æ—¶çš„ï¼Œæ‰€ä»¥æ‰å¯¼è‡´äº†å¯è§æ€§çš„é—®é¢˜ã€‚<strong>volatile</strong> å˜é‡ï¼Œç”¨æ¥ç¡®ä¿å°†å˜é‡çš„æ›´æ–°æ“ä½œé€šçŸ¥åˆ°å…¶ä»–çº¿ç¨‹ã€‚å½“æŠŠå˜é‡å£°æ˜ä¸º volatile ç±»å‹åï¼Œç¼–è¯‘å™¨ä¸è¿è¡Œæ—¶éƒ½ä¼šæ³¨æ„åˆ°è¿™ä¸ªå˜é‡æ˜¯å…±äº«çš„ï¼Œå› æ­¤ä¸ä¼šå°†è¯¥å˜é‡ä¸Šçš„æ“ä½œä¸å…¶ä»–å†…å­˜æ“ä½œä¸€èµ·é‡æ’åºã€‚volatile å˜é‡ä¸ä¼šè¢«ç¼“å­˜åœ¨å¯„å­˜å™¨æˆ–è€…å¯¹å…¶ä»–å¤„ç†å™¨ä¸å¯è§çš„åœ°æ–¹ï¼Œå› æ­¤åœ¨è¯»å– volatile ç±»å‹çš„å˜é‡æ—¶æ€»ä¼šè¿”å›æœ€æ–°å†™å…¥çš„å€¼ã€‚</p>\n<h3 id=\"å¯¹è±¡å†…å­˜å¸ƒå±€\"><a class=\"anchor\" href=\"#å¯¹è±¡å†…å­˜å¸ƒå±€\">#</a> å¯¹è±¡å†…å­˜å¸ƒå±€</h3>\n<p>Java å¯¹è±¡ä¿å­˜åœ¨å †ä¸­æ—¶ï¼Œç”±ä»¥ä¸‹ä¸‰éƒ¨åˆ†ç»„æˆï¼š</p>\n<ul>\n<li><strong>å¯¹è±¡å¤´ï¼ˆobject headerï¼‰</strong>ï¼šåŒ…æ‹¬äº†å…³äºå †å¯¹è±¡çš„å¸ƒå±€ã€ç±»å‹ã€GC çŠ¶æ€ã€åŒæ­¥çŠ¶æ€å’Œæ ‡è¯†å“ˆå¸Œç çš„åŸºæœ¬ä¿¡æ¯ã€‚Java å¯¹è±¡å’Œ vm å†…éƒ¨å¯¹è±¡éƒ½æœ‰ä¸€ä¸ªå…±åŒçš„å¯¹è±¡å¤´æ ¼å¼ã€‚</li>\n<li><strong>å®ä¾‹æ•°æ®ï¼ˆInstance Dataï¼‰</strong>ï¼šä¸»è¦æ˜¯å­˜æ”¾ç±»çš„æ•°æ®ä¿¡æ¯ï¼Œçˆ¶ç±»çš„ä¿¡æ¯ï¼Œå¯¹è±¡å­—æ®µå±æ€§ä¿¡æ¯ã€‚</li>\n<li><strong>å¯¹é½å¡«å……ï¼ˆPaddingï¼‰</strong>ï¼šä¸ºäº†å­—èŠ‚å¯¹é½ï¼Œå¡«å……çš„æ•°æ®ï¼Œä¸æ˜¯å¿…é¡»çš„ã€‚</li>\n</ul>\n<p>å¯¹è±¡å¤´åŒ…æ‹¬ä¸¤éƒ¨åˆ†ï¼š<strong>Mark Word</strong>, <strong>Klass pointer</strong></p>\n<h4 id=\"mark-word\"><a class=\"anchor\" href=\"#mark-word\">#</a> Mark Word</h4>\n<p>ç”¨äºå­˜å‚¨å¯¹è±¡è‡ªèº«çš„è¿è¡Œæ—¶æ•°æ®ï¼Œå¦‚å“ˆå¸Œç ï¼ˆHashCodeï¼‰ã€GC åˆ†ä»£å¹´é¾„ã€é”çŠ¶æ€æ ‡å¿—ã€çº¿ç¨‹æŒæœ‰çš„é”ã€åå‘çº¿ç¨‹ IDã€åå‘æ—¶é—´æˆ³ç­‰ç­‰ã€‚</p>\n<p>Mark Word åœ¨ä¸åŒçš„é”çŠ¶æ€ä¸‹å­˜å‚¨çš„å†…å®¹ä¸åŒï¼Œåœ¨ 64 ä½ JVM ä¸­æ˜¯è¿™ä¹ˆå­˜çš„<br />\n<img data-src=\"https://cdn.jsdelivr.net/gh/haust-Kevin/static@master//images/202310261655824.png\" alt=\"\" /></p>\n<p><strong>é”æ ‡å¿—ä½ï¼ˆlockï¼‰</strong>ï¼šåŒºåˆ†é”çŠ¶æ€ï¼Œ11 æ—¶è¡¨ç¤ºå¯¹è±¡å¾… GC å›æ”¶çŠ¶æ€ï¼Œåªæœ‰æœ€å 2 ä½é”æ ‡è¯† (11) æœ‰æ•ˆã€‚<br />\n<strong>æ˜¯å¦åå‘ï¼ˆbiased_lockï¼‰</strong>ï¼šæ˜¯å¦åå‘é”ï¼Œç”±äºæ— é”å’Œåå‘é”çš„é”æ ‡è¯†éƒ½æ˜¯ 01ï¼Œæ²¡åŠæ³•åŒºåˆ†ï¼Œè¿™é‡Œå¼•å…¥ä¸€ä½çš„åå‘é”æ ‡è¯†ä½ã€‚<br />\n<strong>åˆ†ä»£å¹´é¾„ï¼ˆageï¼‰</strong>ï¼šè¡¨ç¤ºå¯¹è±¡è¢« GC çš„æ¬¡æ•°ï¼Œå½“è¯¥æ¬¡æ•°åˆ°è¾¾é˜ˆå€¼çš„æ—¶å€™ï¼Œå¯¹è±¡å°±ä¼šè½¬ç§»åˆ°è€å¹´ä»£ã€‚<br />\n<strong>å¯¹è±¡çš„ hashcodeï¼ˆhashï¼‰</strong>ï¼šè¿è¡ŒæœŸé—´è°ƒç”¨ System.identityHashCode () æ¥è®¡ç®—ï¼Œå»¶è¿Ÿè®¡ç®—ï¼Œå¹¶æŠŠç»“æœèµ‹å€¼åˆ°è¿™é‡Œã€‚å½“å¯¹è±¡åŠ é”åï¼Œè®¡ç®—çš„ç»“æœ 31 ä½ä¸å¤Ÿè¡¨ç¤ºï¼Œåœ¨åå‘é”ï¼Œè½»é‡é”ï¼Œé‡é‡é”ï¼Œhashcode ä¼šè¢«è½¬ç§»åˆ° Monitor ä¸­ã€‚<br />\n<strong>åå‘é”çš„çº¿ç¨‹ IDï¼ˆJavaThreadï¼‰</strong>ï¼šåå‘æ¨¡å¼çš„æ—¶å€™ï¼Œå½“æŸä¸ªçº¿ç¨‹æŒæœ‰å¯¹è±¡çš„æ—¶å€™ï¼Œå¯¹è±¡è¿™é‡Œå°±ä¼šè¢«ç½®ä¸ºè¯¥çº¿ç¨‹çš„ IDã€‚ åœ¨åé¢çš„æ“ä½œä¸­ï¼Œå°±æ— éœ€å†è¿›è¡Œå°è¯•è·å–é”çš„åŠ¨ä½œã€‚<br />\n<strong>epoch</strong>ï¼šåå‘é”çš„æ—¶é—´æˆ³ã€‚<br />\n<strong>ptr_to_lock_record</strong>ï¼šè½»é‡çº§é”çŠ¶æ€ä¸‹ï¼ŒæŒ‡å‘æ ˆä¸­é”è®°å½•çš„æŒ‡é’ˆã€‚é”è®°å½•å­˜å‚¨çš„æ˜¯æ‰€ä¹‹å‰é”å¯¹è±¡çš„ Mark Word çš„æ‹·è´ã€‚<br />\n<strong>ptr_to_heavyweight_monitor</strong>ï¼šé‡é‡çº§é”çŠ¶æ€ä¸‹ï¼ŒæŒ‡å‘å¯¹è±¡ç›‘è§†å™¨ Monitor çš„æŒ‡é’ˆã€‚å¦‚æœä¸¤ä¸ªä¸åŒçš„çº¿ç¨‹åŒæ—¶åœ¨åŒä¸€ä¸ªå¯¹è±¡ä¸Šç«äº‰ï¼Œåˆ™å¿…é¡»å°†è½»é‡çº§é”å®šå‡çº§åˆ° Monitor ä»¥ç®¡ç†ç­‰å¾…çš„çº¿ç¨‹ã€‚åœ¨é‡é‡çº§é”å®šçš„æƒ…å†µä¸‹ï¼ŒJVM åœ¨å¯¹è±¡çš„ ptr_to_heavyweight_monitor è®¾ç½®æŒ‡å‘ Monitor çš„æŒ‡é’ˆã€‚</p>\n<h4 id=\"æ•°æ®å¯¹é½\"><a class=\"anchor\" href=\"#æ•°æ®å¯¹é½\">#</a> æ•°æ®å¯¹é½</h4>\n<p>å­—æ®µå†…å­˜å¯¹é½çš„å…¶ä¸­ä¸€ä¸ªåŸå› ï¼Œæ˜¯è®©å­—æ®µåªå‡ºç°åœ¨åŒä¸€ CPU çš„ç¼“å­˜è¡Œä¸­ã€‚å¦‚æœå­—æ®µä¸æ˜¯å¯¹é½çš„ï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½å‡ºç°è·¨ç¼“å­˜è¡Œçš„å­—æ®µã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¯¥å­—æ®µçš„è¯»å–å¯èƒ½éœ€è¦æ›¿æ¢ä¸¤ä¸ªç¼“å­˜è¡Œï¼Œè€Œè¯¥å­—æ®µçš„å­˜å‚¨ä¹Ÿä¼šåŒæ—¶æ±¡æŸ“ä¸¤ä¸ªç¼“å­˜è¡Œã€‚è¿™ä¸¤ç§æƒ…å†µå¯¹ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡è€Œè¨€éƒ½æ˜¯ä¸åˆ©çš„ã€‚å…¶å®å¯¹å…¶å¡«å……çš„æœ€ç»ˆç›®çš„æ˜¯ä¸ºäº†è®¡ç®—æœºé«˜æ•ˆå¯»å€ã€‚</p>\n<h3 id=\"åå‘é”\"><a class=\"anchor\" href=\"#åå‘é”\">#</a> åå‘é”</h3>\n<h4 id=\"é”æ’¤é”€\"><a class=\"anchor\" href=\"#é”æ’¤é”€\">#</a> é”æ’¤é”€</h4>\n<p>æ’¤é”€åå‘é”å°±æ˜¯å°†é”å¯¹è±¡ oop çš„å¯¹è±¡å¤´æ¢å¤æˆæ— é”çŠ¶æ€æˆ–è€…è†¨èƒ€æˆè½»é‡çº§é”çŠ¶æ€ï¼Œæ‰§è¡Œæ’¤é”€åŠ¨ä½œçš„å‰ææ˜¯é”å¯¹è±¡ oop çš„å¯¹è±¡å¤´å¤„äºåå‘é”çŠ¶æ€ã€‚<br />\n<strong>é”æ’¤é”€è¿‡ç¨‹</strong><br />\nå°è¯•è·å–æŸä¸ªåå‘é”ï¼Œå¦‚æœè¯¥åå‘é”è¢«æŸä¸ªçº¿ç¨‹å ç”¨äº†ï¼Œä½†æ˜¯æ²¡æœ‰å…³è”çš„ BasicObjectLock ï¼Œå³å®é™…å ç”¨è¯¥åå‘é”çš„æ–¹æ³•å·²ç»é€€å‡ºäº†ï¼Œåˆ™ä¼šå°†å…¶æ¢å¤æˆæ— é”çŠ¶æ€ï¼Œç„¶åè†¨èƒ€æˆè½»é‡çº§é”ï¼Œä½†æ˜¯åœ¨æ’¤é”€ä¸€å®šæ¬¡æ•°åè§¦å‘æ‰¹é‡é‡åå‘ï¼ˆrebasicï¼‰çš„æƒ…å½¢ä¸‹ä¹Ÿå¯èƒ½é‡æ–°è·å–è¯¥åå‘é”ã€‚å¦‚æœè¯¥åå‘é”æ­£åœ¨è¢«æŸä¸ªæ–¹æ³•æ‰€ä½¿ç”¨ï¼Œå³å­˜åœ¨å¯¹åº”çš„ BasicObjectLock ï¼Œåˆ™ç›´æ¥å°†è¯¥åå‘é”è†¨èƒ€æˆè½»é‡çº§é”ã€‚</p>\n<p>åœ¨å·²åå‘åè°ƒç”¨ Object.hashCode () æ–¹æ³•æ—¶ï¼Œé”å®šçŠ¶æ€ä¸‹ï¼Œé”è†¨èƒ€ä¸ºé‡é‡çº§é”ï¼›éé”å®šçŠ¶æ€ä¸‹ï¼Œé”ä¼šæ¢å¤ä¸ºæ— é”çŠ¶æ€ã€‚</p>\n<h4 id=\"æ‰¹é‡é‡åå‘\"><a class=\"anchor\" href=\"#æ‰¹é‡é‡åå‘\">#</a> æ‰¹é‡é‡åå‘</h4>\n<p>é¿å…çŸ­æ—¶é—´å†…å¤§é‡åå‘é”çš„æ’¤é”€ã€‚ä¾‹å¦‚ä¸€ä¸ªçº¿ç¨‹åˆ›å»ºäº†å¤§é‡å¯¹è±¡å¹¶æ‰§è¡Œäº†åˆå§‹çš„åŒæ­¥æ“ä½œï¼Œåæ¥å¦ä¸€ä¸ªçº¿ç¨‹ä¹Ÿæ¥å°†è¿™äº›å¯¹è±¡ä½œä¸ºé”å¯¹è±¡è¿›è¡Œæ“ä½œï¼Œè¿™æ ·ä¼šå¯¼è‡´å¤§é‡çš„åå‘é”æ’¤é”€æ“ä½œã€‚å½“æ‰§è¡Œæ‰¹é‡é‡åå‘åï¼Œå¦‚æœåŸåå‘é”æŒæœ‰è€…çº¿ç¨‹ä¸å†æ‰§è¡ŒåŒæ­¥å—ï¼Œåˆ™é”å¯ä»¥åå‘äºæ–°çº¿ç¨‹ã€‚<br />\nä»¥ class ä¸ºå•ä½ï¼Œä¸ºæ¯ä¸ª class ç»´æŠ¤ä¸€ä¸ªåå‘é”æ’¤é”€è®¡æ•°å™¨ï¼Œæ¯ä¸€æ¬¡è¯¥ class çš„å¯¹è±¡å‘ç”Ÿåå‘æ’¤é”€æ“ä½œæ—¶ï¼Œè¯¥è®¡æ•°å™¨ +1ï¼Œå½“è¿™ä¸ªå€¼è¾¾åˆ°é‡åå‘é˜ˆå€¼ï¼ˆé»˜è®¤ 20 ï¼‰æ—¶ï¼Œ JVM å°±è®¤ä¸ºè¯¥ class çš„åå‘é”æœ‰é—®é¢˜ï¼Œå› æ­¤ä¼šè¿›è¡Œæ‰¹é‡é‡åå‘ã€‚æ¯ä¸ª class å¯¹è±¡ä¼šæœ‰ä¸€ä¸ªå¯¹åº”çš„ epoch å­—æ®µï¼Œæ¯ä¸ªå¤„äºåå‘é”çŠ¶æ€å¯¹è±¡çš„ mark word ä¸­ä¹Ÿæœ‰è¯¥å­—æ®µï¼Œå…¶åˆå§‹å€¼ä¸ºåˆ›å»ºè¯¥å¯¹è±¡æ—¶ï¼Œclass ä¸­çš„ epoch çš„å€¼ã€‚æ¯æ¬¡å‘ç”Ÿæ‰¹é‡é‡åå‘æ—¶ï¼Œå°±å°†è¯¥å€¼ +1ï¼ŒåŒæ—¶éå† JVM ä¸­æ‰€æœ‰çº¿ç¨‹çš„æ ˆï¼Œæ‰¾åˆ°è¯¥ class æ‰€æœ‰æ­£å¤„äºåŠ é”çŠ¶æ€çš„åå‘é”ï¼Œå°†å…¶ epoch å­—æ®µæ”¹ä¸ºæ–°å€¼ã€‚ä¸‹æ¬¡è·å¾—é”æ—¶ï¼Œå‘ç°å½“å‰å¯¹è±¡çš„ epoch å€¼å’Œ class çš„ epoch ä¸ç›¸ç­‰ï¼Œé‚£å°±ç®—å½“å‰å·²ç»åå‘äº†å…¶ä»–çº¿ç¨‹ï¼Œä¹Ÿä¸ä¼šæ‰§è¡Œæ’¤é”€æ“ä½œï¼Œè€Œæ˜¯ç›´æ¥é€šè¿‡ CAS æ“ä½œå°†å…¶ mark word çš„ Thread Id æ”¹æˆå½“å‰çº¿ç¨‹ Idã€‚</p>\n<h4 id=\"æ‰¹é‡é”æ’¤é”€\"><a class=\"anchor\" href=\"#æ‰¹é‡é”æ’¤é”€\">#</a> æ‰¹é‡é”æ’¤é”€</h4>\n<p>å½“ä¸€ä¸ªåå‘é”å¦‚æœæ’¤é”€æ¬¡æ•°åˆ°è¾¾ 40 çš„æ—¶å€™å°±è®¤ä¸ºè¿™ä¸ªå¯¹è±¡è®¾è®¡çš„æœ‰é—®é¢˜ï¼›é‚£ä¹ˆ JVM ä¼šæŠŠè¿™ä¸ªå¯¹è±¡æ‰€å¯¹åº”çš„ç±»æ‰€æœ‰çš„å¯¹è±¡éƒ½æ’¤é”€åå‘é”ï¼›å¹¶ä¸”æ–°å®ä¾‹åŒ–çš„å¯¹è±¡ä¹Ÿæ˜¯ä¸å¯åå‘çš„ã€‚</p>\n<h4 id=\"å¯¹è±¡è®¡ç®—è¿‡å“ˆå¸Œå€¼ä¹‹åè¿˜èƒ½è¿›å…¥åå‘é”çŠ¶æ€å—\"><a class=\"anchor\" href=\"#å¯¹è±¡è®¡ç®—è¿‡å“ˆå¸Œå€¼ä¹‹åè¿˜èƒ½è¿›å…¥åå‘é”çŠ¶æ€å—\">#</a> å¯¹è±¡è®¡ç®—è¿‡å“ˆå¸Œå€¼ä¹‹åè¿˜èƒ½è¿›å…¥åå‘é”çŠ¶æ€å—</h4>\n<ul>\n<li>å½“ä¸€ä¸ªå¯¹è±¡å·²ç»è®¡ç®—è¿‡ identity hashcodeï¼Œå®ƒå°±æ— æ³•è¿›å…¥åå‘é”çŠ¶æ€ï¼›</li>\n<li>å½“ä¸€ä¸ªå¯¹è±¡å½“å‰æ­£å¤„äºåå‘é”çŠ¶æ€ï¼Œå¹¶ä¸”éœ€è¦è®¡ç®—å…¶ identity hashcode çš„è¯ï¼Œåˆ™å®ƒçš„åå‘é”ä¼šè¢«æ’¤é”€ï¼Œå¹¶ä¸”é”ä¼šè†¨èƒ€ä¸ºé‡é‡é”ï¼›</li>\n<li>é‡é‡é”çš„å®ç°ä¸­ï¼ŒObjectMonitor ç±»é‡Œæœ‰å­—æ®µå¯ä»¥è®°å½•éåŠ é”çŠ¶æ€ä¸‹çš„ mark word ï¼Œå…¶ä¸­å¯ä»¥å­˜å‚¨ identity hash code çš„å€¼ã€‚æˆ–è€…ç®€å•è¯´å°±æ˜¯é‡é‡é”å¯ä»¥å­˜ä¸‹ identity hash codeã€‚</li>\n</ul>\n<p>Identity hash code æ˜¯æœªè¢«è¦†å†™çš„ java.lang.Object.hashCode ()</p>\n<h2 id=\"ç±»æ–‡ä»¶ç»“æ„\"><a class=\"anchor\" href=\"#ç±»æ–‡ä»¶ç»“æ„\">#</a> ç±»æ–‡ä»¶ç»“æ„</h2>\n<p><strong>class æ–‡ä»¶æ ¼å¼</strong></p>\n<table>\n<thead>\n<tr>\n<th>ç±»å‹</th>\n<th>åç§°</th>\n<th>æ•°é‡</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>u4</td>\n<td>magic</td>\n<td>1</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>minor_version</td>\n<td>1</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>major_version</td>\n<td>1</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>constant_pool_count</td>\n<td>1</td>\n</tr>\n<tr>\n<td>cp_info</td>\n<td>constant_pool</td>\n<td>constant_pool_count  - 1</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>access_flags</td>\n<td>1</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>this_class</td>\n<td>1</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>super_class</td>\n<td>1</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>interfaces_count</td>\n<td>1</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>interfaces</td>\n<td>interfaces_count</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>fields_count</td>\n<td>1</td>\n</tr>\n<tr>\n<td>field_info</td>\n<td>fields</td>\n<td>fields_count</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>methods_count</td>\n<td>1</td>\n</tr>\n<tr>\n<td>method_info</td>\n<td>methods</td>\n<td>methods_count</td>\n</tr>\n<tr>\n<td>u2</td>\n<td>attribute_count</td>\n<td>1</td>\n</tr>\n<tr>\n<td>attribute_info</td>\n<td>attributes</td>\n<td>attributes_count</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"ç±»åŠ è½½æœºåˆ¶\"><a class=\"anchor\" href=\"#ç±»åŠ è½½æœºåˆ¶\">#</a> ç±»åŠ è½½æœºåˆ¶</h2>\n<h3 id=\"ç±»çš„ç”Ÿå‘½å‘¨æœŸ\"><a class=\"anchor\" href=\"#ç±»çš„ç”Ÿå‘½å‘¨æœŸ\">#</a> ç±»çš„ç”Ÿå‘½å‘¨æœŸ</h3>\n<p>ç±»ä»è¢«åŠ è½½åˆ°è™šæ‹Ÿæœºå†…å­˜ä¸­å¼€å§‹åˆ°å¸è½½å‡ºå†…å­˜ä¸ºæ­¢ï¼Œå®ƒçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå¯ä»¥ç®€å•æ¦‚æ‹¬ä¸º 7 ä¸ªé˜¶æ®µï¼šåŠ è½½ï¼ˆLoadingï¼‰ã€éªŒè¯ï¼ˆVerificationï¼‰ã€å‡†å¤‡ï¼ˆPreparationï¼‰ã€è§£æï¼ˆResolutionï¼‰ã€åˆå§‹åŒ–ï¼ˆInitializationï¼‰ã€ä½¿ç”¨ï¼ˆUsingï¼‰å’Œå¸è½½ï¼ˆUnloadingï¼‰ã€‚å…¶ä¸­ï¼ŒéªŒè¯ã€å‡†å¤‡å’Œè§£æè¿™ä¸‰ä¸ªé˜¶æ®µå¯ä»¥ç»Ÿç§°ä¸ºè¿æ¥ï¼ˆLinkingï¼‰ã€‚<br />\n<img data-src=\"https://cdn.jsdelivr.net/gh/haust-Kevin/static@master//images/202310271600947.png\" alt=\"ç±»çš„ç”Ÿå‘½å‘¨æœŸ\" /></p>\n<h3 id=\"ç±»åŠ è½½æ—¶æœŸ\"><a class=\"anchor\" href=\"#ç±»åŠ è½½æ—¶æœŸ\">#</a> ç±»åŠ è½½æ—¶æœŸ</h3>\n<p>åœ¨ä»€ä¹ˆæƒ…å†µä¸‹éœ€è¦å¼€å§‹ç±»åŠ è½½è¿‡ç¨‹çš„ç¬¬ä¸€ä¸ªé˜¶æ®µã€ŒåŠ è½½ã€ï¼Œã€ŠJava è™šæ‹Ÿæœºè§„èŒƒã€‹ä¸­å¹¶æ²¡æœ‰è¿›è¡Œå¼ºåˆ¶çº¦æŸï¼Œè¿™ç‚¹å¯ä»¥äº¤ç»™è™šæ‹Ÿæœºçš„å…·ä½“å®ç°æ¥è‡ªç”±æŠŠæ¡ã€‚<br />\n<strong>ç±»åˆå§‹åŒ–æ—¶æœŸ</strong><br />\nå¯¹äºåˆå§‹åŒ–é˜¶æ®µï¼Œã€ŠJava è™šæ‹Ÿæœºè§„èŒƒã€‹åˆ™æ˜¯ä¸¥æ ¼è§„å®šäº†æœ‰ä¸”åªæœ‰å…­ç§æƒ…å†µå¿…é¡»ç«‹å³å¯¹ç±»è¿›è¡Œã€Œåˆå§‹åŒ–ã€ï¼ˆè€ŒåŠ è½½ã€éªŒè¯ã€å‡†å¤‡è‡ªç„¶éœ€è¦åœ¨æ­¤ä¹‹å‰å¼€å§‹ï¼‰ï¼š</p>\n<ol>\n<li>é‡åˆ° newï¼ˆç”¨ new å®ä¾‹å¯¹è±¡ï¼‰ï¼ŒgetStaticï¼ˆè¯»å–ä¸€ä¸ªé™æ€å­—æ®µï¼‰ï¼Œputstaticï¼ˆè®¾ç½®ä¸€ä¸ªé™æ€å­—æ®µï¼‰ï¼ŒinvokeStaticï¼ˆè°ƒç”¨ä¸€ä¸ªç±»çš„é™æ€æ–¹æ³•ï¼‰è¿™å››æ¡æŒ‡ä»¤å­—èŠ‚ç å‘½ä»¤æ—¶ã€‚</li>\n<li>ä½¿ç”¨ java.lang.reflect åŒ…çš„æ–¹æ³•å¯¹ç±»å‹è¿›è¡Œåå°„è°ƒç”¨çš„æ—¶å€™ï¼Œå¦‚æœç±»å‹æ²¡æœ‰è¿›è¡Œè¿‡åˆå§‹åŒ–ï¼Œåˆ™éœ€è¦å…ˆè§¦å‘å…¶åˆå§‹åŒ–ã€‚</li>\n<li>å½“åˆå§‹åŒ–ç±»çš„æ—¶å€™ï¼Œå¦‚æœå‘ç°å…¶çˆ¶ç±»è¿˜æ²¡æœ‰è¿›è¡Œè¿‡åˆå§‹åŒ–ï¼Œåˆ™éœ€è¦å…ˆè§¦å‘å…¶çˆ¶ç±»çš„åˆå§‹åŒ–ã€‚</li>\n<li>å½“è™šæ‹Ÿæœºå¯åŠ¨æ—¶ï¼Œç”¨æˆ·éœ€è¦æŒ‡å®šä¸€ä¸ªè¦æ‰§è¡Œçš„ä¸»ç±»ï¼ˆåŒ…å« main () æ–¹æ³•çš„é‚£ä¸ªç±»ï¼‰ï¼Œè™šæ‹Ÿæœºä¼šå…ˆåˆå§‹åŒ–è¿™ä¸ªä¸»ç±»ã€‚</li>\n<li>å½“ä½¿ç”¨ JDK 7 æ–°åŠ å…¥çš„åŠ¨æ€è¯­è¨€æ”¯æŒæ—¶ï¼Œå¦‚æœä¸€ä¸ª java.lang.invoke.MethodHandle å®ä¾‹æœ€åçš„è§£æç»“æœ ä¸º REF_getStaticã€REF_putStaticã€REF_invokeStaticã€REF_newInvokeSpecial å››ç§ç±»å‹çš„æ–¹æ³•å¥æŸ„ï¼Œå¹¶ä¸”è¿™ä¸ªæ–¹æ³•å¥æŸ„å¯¹åº”çš„ç±»æ²¡æœ‰è¿›è¡Œè¿‡åˆå§‹åŒ–ï¼Œåˆ™éœ€è¦å…ˆè§¦å‘å…¶åˆå§‹åŒ–ã€‚</li>\n<li>å½“ä¸€ä¸ªæ¥å£ä¸­å®šä¹‰äº† JDK 8 æ–°åŠ å…¥çš„é»˜è®¤æ–¹æ³•ï¼ˆè¢« default å…³é”®å­—ä¿®é¥°çš„æ¥å£æ–¹æ³•ï¼‰æ—¶ï¼Œå¦‚æœæœ‰è¿™ä¸ªæ¥å£çš„å®ç°ç±»å‘ç”Ÿäº†åˆå§‹åŒ–ï¼Œé‚£è¯¥æ¥å£è¦åœ¨å…¶ä¹‹å‰è¢«åˆå§‹åŒ–ã€‚</li>\n</ol>\n<p><strong>ä¸‹é¢è¿™å‡ ç§æƒ…å†µå°±ä¸ä¼šè§¦å‘ç±»åˆå§‹åŒ–ï¼š</strong></p>\n<ul>\n<li>é€šè¿‡å­ç±»è°ƒç”¨çˆ¶ç±»çš„é™æ€å­—æ®µã€‚æ­¤æ—¶çˆ¶ç±»ç¬¦åˆæƒ…å†µä¸€ï¼Œè€Œå­ç±»ä¸ç¬¦åˆä»»ä½•æƒ…å†µã€‚æ‰€ä»¥åªæœ‰çˆ¶ç±»è¢«åˆå§‹åŒ–ã€‚</li>\n<li>é€šè¿‡æ•°ç»„æ¥å¼•ç”¨ç±»ï¼Œä¸ä¼šè§¦å‘ç±»çš„åˆå§‹åŒ–ã€‚å› ä¸º new çš„æ˜¯æ•°ç»„ï¼Œè€Œä¸æ˜¯ç±»ã€‚</li>\n<li>è°ƒç”¨ç±»çš„é™æ€å¸¸é‡ä¸ä¼šè§¦å‘ç±»çš„åˆå§‹åŒ–ï¼Œå› ä¸ºé™æ€å¸¸é‡åœ¨ç¼–è¯‘é˜¶æ®µå°±ä¼šè¢«å­˜å…¥è°ƒç”¨ç±»çš„å¸¸é‡æ± ä¸­ï¼Œä¸ä¼šå¼•ç”¨åˆ°å®šä¹‰å¸¸é‡çš„ç±»ã€‚</li>\n</ul>\n<h3 id=\"ç±»åŠ è½½å™¨\"><a class=\"anchor\" href=\"#ç±»åŠ è½½å™¨\">#</a> ç±»åŠ è½½å™¨</h3>\n<p>åœ¨ JDK1.8 åŠä¹‹å‰çš„ç‰ˆæœ¬ä¸­ä¸­ï¼Œç±»åŠ è½½å™¨ä¸»è¦æœ‰ä¸‹é¢å››ç§ï¼š<br />\nBootstrapClassLoaderï¼šå¯åŠ¨ç±»åŠ è½½å™¨ï¼Œä½¿ç”¨ C++ å®ç°ï¼›<br />\nExtClassLoaderï¼šæ‰©å±•ç±»åŠ è½½å™¨ï¼Œä½¿ç”¨ Java å®ç°ï¼›<br />\nAppClassLoaderï¼šåº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ï¼ŒåŠ è½½å½“å‰åº”ç”¨çš„ classpath çš„æ‰€æœ‰ç±»ï¼›<br />\nUserDefinedClassLoaderï¼šç”¨æˆ·è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼›</p>\n<h3 id=\"åŒäº²å§”æ´¾\"><a class=\"anchor\" href=\"#åŒäº²å§”æ´¾\">#</a> åŒäº²å§”æ´¾</h3>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">protected</span> <span class=\"token class-name\">Class</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">loadClass</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> name<span class=\"token punctuation\">,</span> <span class=\"token keyword\">boolean</span> resolve<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">throws</span> <span class=\"token class-name\">ClassNotFoundException</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token comment\">// First, check if the class has already been loaded</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token class-name\">Class</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span> c <span class=\"token operator\">=</span> <span class=\"token function\">findLoadedClass</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>c <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token keyword\">try</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>                <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>parent <span class=\"token operator\">!=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                    c <span class=\"token operator\">=</span> parent<span class=\"token punctuation\">.</span><span class=\"token function\">loadClass</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                    c <span class=\"token operator\">=</span> <span class=\"token function\">findBootstrapClassOrNull</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">ClassNotFoundException</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                <span class=\"token comment\">// ClassNotFoundException thrown if class not found</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                <span class=\"token comment\">// from the non-null parent class loader</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>c <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                <span class=\"token comment\">// If still not found, then invoke findClass in order</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                <span class=\"token comment\">// to find the class.</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                c <span class=\"token operator\">=</span> <span class=\"token function\">findClass</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token keyword\">return</span> c<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h4 id=\"ä¸ºä»€ä¹ˆè¦åŒäº²å§”æ´¾\"><a class=\"anchor\" href=\"#ä¸ºä»€ä¹ˆè¦åŒäº²å§”æ´¾\">#</a> ä¸ºä»€ä¹ˆè¦åŒäº²å§”æ´¾</h4>\n<ul>\n<li><strong>é¿å…é‡å¤åŠ è½½</strong>ï¼šä½¿ç”¨åŒäº²å§”æ´¾æ¨¡å‹ä¹Ÿå¯ä»¥é¿å…ä¸€ä¸ªç±»è¢«é‡å¤åŠ è½½ï¼Œå½“ä¸€ä¸ªç±»è¢«åŠ è½½ä¹‹åï¼Œå› ä¸ºä½¿ç”¨çš„åŒäº²å§”æ´¾æ¨¡å‹ï¼Œè¿™æ ·ä¸ä¼šå‡ºç°å¤šä¸ªç±»åŠ è½½å™¨éƒ½å°†åŒä¸€ä¸ªç±»é‡å¤åŠ è½½çš„æƒ…å†µäº†ã€‚</li>\n<li><strong>å®‰å…¨</strong>ï¼šå½“ä½¿ç”¨åŒäº²å§”æ´¾æ¨¡å‹æ—¶ï¼Œç”¨æˆ·å°±ä¸èƒ½ä¼ªé€ ä¸€äº›ä¸å®‰å…¨çš„ç³»ç»Ÿç±»äº†ï¼Œæ¯”å¦‚ jre é‡Œé¢å·²ç»æä¾›äº† String ç±»åœ¨å¯åŠ¨ç±»åŠ è½½æ—¶åŠ è½½ï¼Œé‚£ä¹ˆç”¨æˆ·è‡ªå®šä¹‰å†è‡ªå®šä¹‰ä¸€ä¸ªä¸å®‰å…¨çš„ String ç±»æ—¶ï¼ŒæŒ‰ç…§åŒäº²å§”æ´¾æ¨¡å‹å°±ä¸ä¼šå†åŠ è½½ç”¨æˆ·å®šä¹‰çš„é‚£ä¸ªä¸å®‰å…¨çš„ String ç±»äº†ï¼Œè¿™æ ·å°±å¯ä»¥é¿å…éå®‰å…¨é—®é¢˜çš„å‘ç”Ÿäº†ã€‚</li>\n</ul>\n<h4 id=\"ç ´ååŒäº²æ¨¡å‹\"><a class=\"anchor\" href=\"#ç ´ååŒäº²æ¨¡å‹\">#</a> ç ´ååŒäº²æ¨¡å‹</h4>\n<p>åŒäº²å§”æ´¾æ¨¡å‹å¹¶ä¸æ˜¯ä¸€ä¸ªå…·æœ‰å¼ºåˆ¶æ€§çº¦æŸçš„æ¨¡å‹ï¼Œè€Œæ˜¯ Java è®¾è®¡è€…æ¨èç»™å¼€å‘è€…ä»¬çš„ç±»åŠ è½½å™¨å®ç°æ–¹å¼ã€‚è¿™ä¸ªå§”æ´¾å’ŒåŠ è½½é¡ºåºå®Œå…¨æ˜¯å¯ä»¥è¢«ç ´åçš„ã€‚<br />\nå¦‚æœæƒ³è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼Œå°±éœ€è¦ç»§æ‰¿ ClassLoader ï¼Œå¹¶é‡å†™ findClass ï¼Œå¦‚æœæƒ³ä¸éµå¾ªåŒäº²å§”æ´¾çš„ç±»åŠ è½½é¡ºåºï¼Œè¿˜éœ€è¦é‡å†™ loadClass ã€‚<br />\n<strong>JDBC æ‰“ç ´åŒäº²æ¨¡å‹</strong><br />\nåœ¨åŒäº²å§”æ‰˜æ¨¡å‹ä¸‹ï¼Œç±»åŠ è½½å™¨æ˜¯ç”±ä¸‹è‡³ä¸Šçš„ï¼Œå³ä¸‹å±‚çš„ç±»åŠ è½½å™¨ä¼šå§”æ‰˜ä¸Šå±‚è¿›è¡ŒåŠ è½½ã€‚ä½†æ˜¯å¯¹äº SPI æ¥è¯´ï¼Œæœ‰äº›æ¥å£æ˜¯ JAVA æ ¸å¿ƒåº“æä¾›çš„ï¼Œè€Œ Java æ ¸å¿ƒåº“æ˜¯ç”±å¯åŠ¨ç±»åŠ è½½å™¨æ¥åŠ è½½çš„ï¼Œè€Œè¿™äº›æ¥å£çš„å®ç°å´æ¥è‡ªäºä¸åŒçš„ jar åŒ…ï¼ˆå‚å•†æä¾›ï¼‰ï¼Œ Java çš„å¯åŠ¨ç±»åŠ è½½å™¨æ˜¯ä¸ä¼šåŠ è½½å…¶ä»–æ¥æºçš„ jar åŒ…ï¼Œè¿™æ ·ä¼ ç»Ÿçš„åŒäº²å§”æ‰˜æ¨¡å‹å°±æ— æ³•æ»¡è¶³ SPI çš„è¦æ±‚ã€‚è€Œé€šè¿‡ç»™å½“å‰çº¿ç¨‹è®¾ç½®ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ï¼Œå°±å¯ä»¥é€šè¿‡è®¾ç½®çš„ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨æ¥å®ç°å¯¹äºæ¥å£å®ç°ç±»çš„åŠ è½½ã€‚<br />\nçº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨æ˜¯ä» jdk1.2 å¼€å§‹å¼•å…¥çš„ï¼Œç±» Thread ä¸­çš„ getContextClassLoader () ä¸ setContextClassLoader (ClassLoader c1)ï¼Œåˆ†åˆ«ç”¨æ¥è·å–å’Œè®¾ç½®ç±»åŠ è½½å™¨ã€‚</p>\n<h2 id=\"è‡ªåŠ¨å†…å­˜ç®¡ç†å—\"><a class=\"anchor\" href=\"#è‡ªåŠ¨å†…å­˜ç®¡ç†å—\">#</a> è‡ªåŠ¨å†…å­˜ç®¡ç†å—</h2>\n<h3 id=\"å¯¹è±¡ä½•æ—¶æ­»äº¡\"><a class=\"anchor\" href=\"#å¯¹è±¡ä½•æ—¶æ­»äº¡\">#</a> å¯¹è±¡ä½•æ—¶æ­»äº¡</h3>\n<h4 id=\"å¼•ç”¨è®¡æ•°ç®—æ³•\"><a class=\"anchor\" href=\"#å¼•ç”¨è®¡æ•°ç®—æ³•\">#</a> å¼•ç”¨è®¡æ•°ç®—æ³•</h4>\n<p>ç®—æ³•ä¼šåœ¨æ¯ä¸€ä¸ªå¯¹è±¡ä¸Šè®°å½•è¿™ä¸ªå¯¹è±¡è¢«å¼•ç”¨çš„æ¬¡æ•°ï¼Œåªè¦æœ‰ä»»ä½•ä¸€ä¸ªå¯¹è±¡å¼•ç”¨äº†æ¬¡å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡çš„è®¡æ•°å™¨å°± +1 ï¼Œå–æ¶ˆå¯¹è¿™ä¸ªå¯¹è±¡çš„å¼•ç”¨æ—¶ï¼Œè®¡æ•°å™¨å°± -1 ã€‚ä»»ä½•ä¸€ä¸ªæ—¶åˆ»ï¼Œå¦‚æœè¯¥å¯¹è±¡çš„è®¡æ•°å™¨ä¸º 0 ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡å°±æ˜¯å¯ä»¥å›æ”¶çš„ã€‚<br />\n<strong>ç¼ºç‚¹</strong>ï¼š1. æ— æ³•å¤„ç†å¾ªç¯å¼•ç”¨çš„æƒ…å†µï¼›2. å †å†…å¯¹è±¡çš„æ¯ä¸€æ¬¡å¼•ç”¨èµ‹å€¼å’Œæ¯ä¸€æ¬¡å¼•ç”¨æ¸…é™¤ï¼Œéƒ½ä¼´éšç€åŠ å‡æ³•çš„æ“ä½œï¼Œä¼šå¸¦æ¥ä¸€å®šçš„æ€§èƒ½å¼€é”€ã€‚</p>\n<h4 id=\"å¯è¾¾æ€§åˆ†æç®—æ³•\"><a class=\"anchor\" href=\"#å¯è¾¾æ€§åˆ†æç®—æ³•\">#</a> å¯è¾¾æ€§åˆ†æç®—æ³•</h4>\n<p>ç°ä»£è™šæ‹ŸæœºåŸºæœ¬éƒ½æ˜¯é‡‡ç”¨å¯è¾¾æ€§åˆ†æç®—æ³•æ¥åˆ¤æ–­å¯¹è±¡æ˜¯å¦å­˜æ´»ï¼Œå¯è¾¾æ€§ç®—æ³•çš„åŸç†æ˜¯ä»¥ä¸€ç³»åˆ—å«åš  GC Root  çš„å¯¹è±¡ä¸ºèµ·ç‚¹å‡ºå‘ï¼Œå¼•å‡ºå®ƒä»¬æŒ‡å‘çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå†ä»¥ä¸‹ä¸ªèŠ‚ç‚¹ä¸ºèµ·ç‚¹ï¼Œå¼•å‡ºæ­¤èŠ‚ç‚¹æŒ‡å‘çš„ä¸‹ä¸€ä¸ªç»“ç‚¹ã€‚è¿™æ ·é€šè¿‡ GC Root ä¸²æˆçš„ä¸€æ¡çº¿å°±å«å¼•ç”¨é“¾ï¼‰ï¼Œç›´åˆ°æ‰€æœ‰çš„ç»“ç‚¹éƒ½éå†å®Œæ¯•ï¼Œå¦‚æœç›¸å…³å¯¹è±¡ä¸åœ¨ä»»æ„ä¸€ä¸ªä»¥ GC Root ä¸ºèµ·ç‚¹çš„å¼•ç”¨é“¾ä¸­ï¼Œåˆ™è¿™äº›å¯¹è±¡ä¼šè¢«åˆ¤æ–­ä¸ºåƒåœ¾å¯¹è±¡ï¼Œä¼šè¢« GC å›æ”¶ã€‚<br />\n<img data-src=\"https://cdn.jsdelivr.net/gh/haust-Kevin/static@master//images/202310271720872.png\" alt=\"å¯è¾¾æ€§åˆ†æç®—æ³•\" /></p>\n<h4 id=\"å‚æ­»æŒ£æ‰\"><a class=\"anchor\" href=\"#å‚æ­»æŒ£æ‰\">#</a> å‚æ­»æŒ£æ‰</h4>\n<p><strong>å¯¹è±¡å¯å›æ”¶ï¼Œå°±ä¸€å®šä¼šè¢«å›æ”¶å—</strong><br />\nå¯¹è±¡çš„ finalize æ–¹æ³•ç»™äº†å¯¹è±¡ä¸€æ¬¡å‚æ­»æŒ£æ‰çš„æœºä¼šï¼Œå½“å¯¹è±¡ä¸å¯è¾¾ï¼ˆå¯å›æ”¶ï¼‰æ—¶ï¼Œå½“å‘ç”Ÿ GC æ—¶ï¼Œä¼šå…ˆåˆ¤æ–­å¯¹è±¡æ˜¯å¦æ‰§è¡Œäº† finalize æ–¹æ³•ï¼Œå¦‚æœæœªæ‰§è¡Œï¼Œåˆ™ä¼šå…ˆæ‰§è¡Œ finalize æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ­¤æ–¹æ³•é‡Œå°†å½“å‰å¯¹è±¡ä¸ GC Roots å…³è”ï¼Œè¿™æ ·æ‰§è¡Œ finalize æ–¹æ³•ä¹‹åï¼ŒGC ä¼šå†æ¬¡åˆ¤æ–­å¯¹è±¡æ˜¯å¦å¯è¾¾ï¼Œå¦‚æœä¸å¯è¾¾ï¼Œåˆ™ä¼šè¢«å›æ”¶ï¼Œå¦‚æœå¯è¾¾ï¼Œåˆ™ä¸å›æ”¶ï¼<br />\nfinalize æ–¹æ³•åªä¼šè¢«æ‰§è¡Œä¸€æ¬¡ï¼Œå¦‚æœç¬¬ä¸€æ¬¡æ‰§è¡Œ finalize æ–¹æ³•æ­¤å¯¹è±¡å˜æˆäº†å¯è¾¾ç¡®å®ä¸ä¼šå›æ”¶ï¼Œä½†å¦‚æœå¯¹è±¡å†æ¬¡è¢« GCï¼Œåˆ™ä¼šå¿½ç•¥ finalize æ–¹æ³•ï¼Œå¯¹è±¡ä¼šè¢«å›æ”¶ï¼è¿™ä¸€ç‚¹åˆ‡è®°ï¼</p>\n<h4 id=\"gc-roots\"><a class=\"anchor\" href=\"#gc-roots\">#</a> GC Roots</h4>\n<p><strong>å¯ä»¥ä½œä¸º GC Roots çš„å¯¹è±¡</strong></p>\n<ol>\n<li>è™šæ‹Ÿæœºæ ˆï¼ˆæ ˆå¸§ä¸­çš„æœ¬åœ°å˜é‡è¡¨ï¼‰ä¸­å¼•ç”¨çš„å¯¹è±¡ï¼›å„ä¸ªçº¿ç¨‹è°ƒç”¨æ–¹æ³•å †æ ˆä¸­ä½¿ç”¨åˆ°çš„å‚æ•°ã€å±€éƒ¨å˜é‡ã€ä¸´æ—¶å˜é‡ç­‰ã€‚</li>\n<li>æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡ï¼›java ç±»çš„å¼•ç”¨ç±»å‹é™æ€å˜é‡ã€‚</li>\n<li>æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡ï¼›æ¯”å¦‚ï¼šå­—ç¬¦ä¸²å¸¸é‡æ± é‡Œçš„å¼•ç”¨ã€‚</li>\n<li>æœ¬åœ°æ–¹æ³•æ ˆä¸­ JNIï¼ˆå³ä¸€èˆ¬è¯´çš„ Native æ–¹æ³•ï¼‰å¼•ç”¨çš„å¯¹è±¡ã€‚</li>\n<li>JVM çš„å†…éƒ¨å¼•ç”¨ï¼ˆclass å¯¹è±¡ã€å¼‚å¸¸å¯¹è±¡ NullPointExceptionã€OutofMemoryErrorï¼Œç³»ç»Ÿç±»åŠ è½½å™¨ï¼‰ã€‚ï¼ˆéé‡ç‚¹ï¼‰</li>\n<li>æ‰€æœ‰è¢«åŒæ­¥é” (synchronized å…³é”®ï¼‰æŒæœ‰çš„å¯¹è±¡ã€‚ï¼ˆéé‡ç‚¹ï¼‰</li>\n<li>JVM å†…éƒ¨çš„ JMXBeanã€JVMTI ä¸­æ³¨å†Œçš„å›è°ƒã€æœ¬åœ°ä»£ç ç¼“å­˜ç­‰ã€‚ï¼ˆéé‡ç‚¹ï¼‰</li>\n<li>JVM å®ç°ä¸­çš„ã€Œä¸´æ—¶æ€§ã€å¯¹è±¡ï¼Œè·¨ä»£å¼•ç”¨çš„å¯¹è±¡ï¼ˆåœ¨ä½¿ç”¨åˆ†ä»£æ¨¡å‹å›æ”¶åªå›æ”¶éƒ¨åˆ†ä»£çš„å¯¹è±¡ï¼‰ã€‚ï¼ˆéé‡ç‚¹ï¼‰</li>\n</ol>\n<h3 id=\"åƒåœ¾æ”¶é›†ç®—æ³•\"><a class=\"anchor\" href=\"#åƒåœ¾æ”¶é›†ç®—æ³•\">#</a> åƒåœ¾æ”¶é›†ç®—æ³•</h3>\n<h4 id=\"åˆ†ä»£æ”¶é›†ç†è®º\"><a class=\"anchor\" href=\"#åˆ†ä»£æ”¶é›†ç†è®º\">#</a> åˆ†ä»£æ”¶é›†ç†è®º</h4>\n<p><strong>å¼±åˆ†ä»£å‡è¯´</strong>ï¼šç»å¤§å¤šæ•°å¯¹è±¡ï¼Œåœ¨ç¬¬ä¸€æ¬¡åƒåœ¾æ”¶é›†æ—¶å°±ä¼šè¢«å›æ”¶ã€‚<br />\n<strong>å¼ºåˆ†ä»£å‡è¯´</strong>ï¼šç†¬è¿‡è¶Šå¤šæ¬¡æ”¶é›†è¿‡ç¨‹çš„å¯¹è±¡è¶Šéš¾ä»¥æ¶ˆäº¡ã€‚<br />\nè¿™ä¸¤ç§å‡è¯´ç»™æˆ‘ä»¬æä¾›äº†ä¸€ç§è®¾è®¡æ€æƒ³å°±æ˜¯å°† java å †åˆ’åˆ†å‡ºä¸åŒçš„åŒºåŸŸï¼Œåˆ«æ€¥æˆ‘ä»¬æ…¢æ…¢æ¥è¯´æ˜ä¸€ä¸‹ï¼šæ ¹æ®å¼±åˆ†ä»£ç†è®ºå‘¢ï¼Œå¦‚æœæœ‰ä¸“é—¨ä¸€å—åŒºåŸŸçš„ç»å¤§å¤šæ•°å¯¹è±¡éƒ½æ˜¯ã€Œè„†å¼±ã€çš„ï¼Œé‚£æ¯æ¬¡å›æ”¶æ—¶å°±åªå…³æ³¨å°‘é‡å­˜æ´»å°±å¥½äº†ï¼Œå°±å¯ä»¥ä»¥è¾ƒå°‘çš„ä»£ä»·å›æ”¶åˆ°å¤§é‡ç©ºé—´ã€‚é‚£æ ¹æ®å¼ºç†è®ºå‘¢ï¼Œå¦‚æœæœ‰ä¸“é—¨ä¸€å—åŒºåŸŸçš„ç»å¤§å¤šæ•°å¯¹è±¡éƒ½æ˜¯ã€Œé¡½å›ºã€çš„ï¼Œé‚£è™šæ‹Ÿæœºå°±å¯ä»¥ä»¥è¾ƒä½çš„é¢‘ç‡è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œè¿™å°±æé«˜äº†å†…å­˜çš„åˆ©ç”¨ç‡ã€‚</p>\n<p><strong>è·¨ä»£å¼•ç”¨å‡è¯´</strong>ï¼šè·¨ä»£å¼•ç”¨ç›¸å¯¹äºåŒä»£å¼•ç”¨æ¥è¯´ä»…å æå°‘æ•°ã€‚<br />\nè¯¥å‡è¯´è®¤ä¸ºåªä¼šå­˜åœ¨å¾ˆå°‘çš„è·¨ä»£å¼•ç”¨ã€‚å› ä¸ºåªè¦ç»è¿‡ä¸€äº›æ¬¡æ•°çš„åƒåœ¾æ”¶é›†ï¼Œå³ä½¿è¿˜å­˜åœ¨è·¨ä»£å¼•ç”¨ï¼Œæ–°ç”Ÿä»£ä¼šå˜æˆè€å¹´ä»£ï¼Œè·¨ä»£å¼•ç”¨ä¹Ÿå°±è‡ªç„¶æ¶ˆå¤±äº†ï¼Œæ‰€ä»¥è·¨ä»£å¼•ç”¨çš„æ•°é‡ä¸ä¼šå¤šã€‚åœ¨å¯¹æ–°ç”Ÿä»£å¯¹è±¡è¿›è¡Œæ”¶é›†æ—¶ï¼Œç”±äºå¯èƒ½å­˜åœ¨è€å¹´ä»£å¯¹è±¡å¼•ç”¨äº†è¯¥å¯¹è±¡ï¼Œé‚£ä¹ˆï¼Œéœ€è¦æ‰¾åˆ°è¿™äº›è€å¹´ä»£å¯¹è±¡ã€‚æ ¹æ®è·¨ä»£å¼•ç”¨å‡è¯´ï¼Œè¿™äº›è·¨ä»£å¼•ç”¨çš„æ•°é‡ä¸ä¼šå¤ªå¤šï¼Œç›¸æ¯”äºå¯¹è€å¹´ä»£è¿›è¡Œæ‰«æï¼Œåœ¨æ–°ç”Ÿä»£å»ºç«‹ä¸€ä¸ªå…¨å±€æ•°æ®ç»“æ„ï¼Œè®°å½•å“ªä¸€å—è€å¹´ä»£å†…å­˜ä¼šå­˜åœ¨è·¨ä»£å¼•ç”¨ï¼Œè™½ç„¶ç»´æŠ¤è¿™ä¸ªæ•°æ®ç»“æ„ï¼Œä¹Ÿéœ€è¦å°‘é‡çš„å¼€é”€ã€‚ä½†ä»ç„¶æ˜¾å¾—æ›´åŠ åˆç®—ã€‚</p>\n<p>åŸºäºè¿™ä¸ªåˆ†ä»£å‡è®¾ï¼Œä¸€èˆ¬çš„åƒåœ¾å›æ”¶å™¨æŠŠå†…å­˜åˆ†æˆä¸‰ç±»ï¼šEden (E), Suvivor (S) å’Œ Old (O), å…¶ä¸­ Eden å’Œ Survivor éƒ½å±äºå¹´è½»ä»£ï¼Œ Old å±äºè€å¹´ä»£ï¼Œæ–°å¯¹è±¡å§‹ç»ˆåˆ†é…åœ¨ Eden é‡Œé¢ï¼Œç†¬è¿‡ä¸€æ¬¡åƒåœ¾å›æ”¶çš„å¯¹è±¡å°±è¢«ç§»åŠ¨åˆ° Survivor åŒºäº†ï¼Œç»è¿‡æ•°æ¬¡åƒåœ¾å›æ”¶ä¹‹åè¿˜æ´»ç€çš„å¯¹è±¡ä¼šè¢«ç§»åˆ° Old åŒºã€‚<br />\n<img data-src=\"https://cdn.jsdelivr.net/gh/haust-Kevin/static@master//images/202310272158264.png\" alt=\"\" /></p>\n<p><strong>æ”¶é›†æ–¹å¼</strong><br />\n Java å †åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œé’ˆå¯¹æ”¶é›†å¯¹è±¡å¤„äºå“ªä¸€ä»£ï¼Œä¸€å…±æœ‰ä»¥ä¸‹å››ç§æ”¶é›†æ–¹å¼ã€‚</p>\n<ul>\n<li>éƒ¨åˆ†æ”¶é›†\n<ul>\n<li>æ–°ç”Ÿä»£æ”¶é›† (Minor GC / Young GC)ï¼Œåªæ”¶é›†æ–°ç”Ÿä»£åƒåœ¾å¯¹è±¡</li>\n<li>è€å¹´ä»£æ”¶é›† (Major GC / Old GC)ï¼Œåªæ”¶é›†è€å¹´ä»£åƒåœ¾å¯¹è±¡ï¼Œç›®å‰åªæœ‰ CMS æ”¶é›†å™¨ä¼šå•ç‹¬æ”¶é›†è€å¹´ä»£å¯¹è±¡ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒMajor GCï¼Œç›®å‰è¿™ä¸ªè¯´æ³•æœ‰ç‚¹æ··æ·†ï¼Œæœ‰æ—¶å€™ä¸“æŒ‡è€å¹´ä»£æ”¶é›†ï¼Œæœ‰æ—¶å€™æŒ‡çš„æ˜¯æ•´å †æ”¶é›†ï¼ˆFull GCï¼‰ã€‚</li>\n<li>æ··åˆæ”¶é›† (Mixed GC)ï¼Œæ”¶é›†æ¥è‡ªæ•´ä¸ªæ–°ç”Ÿä»£ä»¥åŠéƒ¨åˆ†è€å¹´ä»£ä¸­çš„åƒåœ¾å¯¹è±¡ã€‚ç›®å‰åªæœ‰ G1 ä¼šæœ‰è¿™ç§è¡Œä¸ºã€‚</li>\n</ul>\n</li>\n<li>æ•´å †æ”¶é›†ï¼ˆFull GCï¼‰ï¼šæ”¶é›†æ•´ä¸ª Java å †å’Œæ–¹æ³•åŒºçš„åƒåœ¾æ”¶é›†ã€‚</li>\n</ul>\n<h4 id=\"æ ‡è®°-æ¸…é™¤ç®—æ³•\"><a class=\"anchor\" href=\"#æ ‡è®°-æ¸…é™¤ç®—æ³•\">#</a> æ ‡è®° - æ¸…é™¤ç®—æ³•</h4>\n<p><img data-src=\"https://cdn.jsdelivr.net/gh/haust-Kevin/static@master//images/202310272226947.png\" alt=\"\" /><br />\n<strong>åŸç†</strong>ï¼šåˆ†ä¸ºæ ‡è®°å’Œæ¸…é™¤ä¸¤ä¸ªé˜¶æ®µï¼šæ ‡è®°é˜¶æ®µå’Œæ¸…é™¤é˜¶æ®µã€‚æ ‡è®°è¿‡ç¨‹ä¸­ï¼Œå°†æ´»åŠ¨å¯¹è±¡çš„æ ‡è®°ä½è®¾ç½®ä¸ºæœ‰æ•ˆçŠ¶æ€ï¼Œè¡¨ç¤ºè¿™äº›å¯¹è±¡æ˜¯å¯è¾¾çš„ï¼Œä¸ä¼šè¢«å›æ”¶ã€‚å°†æœªè¢«æ ‡è®°çš„å¯¹è±¡è§†ä¸ºåƒåœ¾å¯¹è±¡ï¼Œå°†å…¶æ‰€å ç”¨çš„å†…å­˜ç©ºé—´é‡Šæ”¾ï¼Œä»¥ä¾¿ä¸‹æ¬¡åˆ†é…ç»™æ–°çš„å¯¹è±¡ä½¿ç”¨ã€‚<br />\n<strong>ç¼ºç‚¹</strong>ï¼š</p>\n<ol>\n<li>ä¼šäº§ç”Ÿå¤§é‡å†…å­˜ç¢ç‰‡ï¼Œç©ºé—´ä¸è¿ç»­åé¢æœ‰å¤§å¯¹è±¡æ—¶æ— æ³•ä½¿ç”¨ï¼Œå¯èƒ½ä¼šå¼•èµ·ä¸€æ¬¡åƒåœ¾å›æ”¶</li>\n<li>æ ‡è®°å’Œæ¸…é™¤ä¸¤ä¸ªè¿‡ç¨‹éƒ½æ¯”è¾ƒè€—æ—¶ï¼Œæ•ˆç‡ä¸é«˜</li>\n</ol>\n<h4 id=\"æ ‡è®°-å¤åˆ¶ç®—æ³•\"><a class=\"anchor\" href=\"#æ ‡è®°-å¤åˆ¶ç®—æ³•\">#</a> æ ‡è®° - å¤åˆ¶ç®—æ³•</h4>\n<p><img data-src=\"https://cdn.jsdelivr.net/gh/haust-Kevin/static@master//images/202310272227689.png\" alt=\"\" /><br />\n<strong>åŸç†</strong>ï¼šå°†å¯ç”¨å†…å­˜æŒ‰å®¹é‡åˆ’åˆ†ä¸ºå¤§å°ç›¸ç­‰çš„ä¸¤å—ï¼Œæ¯æ¬¡åªä½¿ç”¨å…¶ä¸­çš„ä¸€å—ã€‚å½“è¿™ä¸€å—çš„å†…å­˜ç”¨å®Œäº†ï¼Œå°±å°†è¿˜å­˜æ´»ç€çš„å¯¹è±¡å¤åˆ¶åˆ°å¦å¤–ä¸€å—ä¸Šé¢ï¼Œç„¶åå†æŠŠå·²ä½¿ç”¨çš„å†…å­˜ç©ºé—´ä¸€æ¬¡æ¸…ç†æ‰ï¼Œè¿™æ ·ä¸€æ¥å°±ä¸å®¹æ˜“å‡ºç°å†…å­˜ç¢ç‰‡çš„é—®é¢˜ã€‚<br />\n<strong>ç¼ºç‚¹</strong>ï¼š</p>\n<ol>\n<li>è§£å†³äº†æ ‡è®° - æ¸…é™¤ç®—æ³•ä¸­æ¸…é™¤æ…¢çš„é—®é¢˜ï¼Œä½†æ˜¯ç©ºé—´åˆ©ç”¨ç‡ä½ã€‚</li>\n<li>åœ¨å¯¹è±¡å­˜æ´»ç‡è¾ƒé«˜æ—¶å°±è¦è¿›è¡Œè¾ƒå¤šçš„å¤åˆ¶æ“ä½œï¼Œæ•ˆç‡å°†ä¼šå˜ä½ã€‚æ›´å…³é”®çš„æ˜¯å¦‚æœä¸æƒ³æµªè´¹ 50% çš„ç©ºé—´ï¼Œå°±éœ€è¦æœ‰é¢å¤–çš„ç©ºé—´è¿›è¡Œåˆ†é…æ‹…ä¿ï¼Œä»¥åº”å¯¹è¢«ä½¿ç”¨çš„å†…å­˜ä¸­æ‰€æœ‰å¯¹è±¡éƒ½æœ‰ 100% å­˜æ´»çš„æç«¯æƒ…å†µã€‚</li>\n</ol>\n<h4 id=\"æ ‡è®°-æ•´ç†ç®—æ³•\"><a class=\"anchor\" href=\"#æ ‡è®°-æ•´ç†ç®—æ³•\">#</a> æ ‡è®° - æ•´ç†ç®—æ³•</h4>\n<p><img data-src=\"https://cdn.jsdelivr.net/gh/haust-Kevin/static@master//images/202310272228578.png\" alt=\"\" /><br />\n<strong>åŸç†</strong>ï¼šè¯¥ç®—æ³•æ ‡è®°é˜¶æ®µå’Œ Mark-Sweep ä¸€æ ·ï¼Œä½†æ˜¯åœ¨å®Œæˆæ ‡è®°ä¹‹åï¼Œå®ƒä¸æ˜¯ç›´æ¥æ¸…ç†å¯å›æ”¶å¯¹è±¡ï¼Œè€Œæ˜¯å°†å­˜æ´»å¯¹è±¡éƒ½å‘ä¸€ç«¯ç§»åŠ¨ï¼Œç„¶åæ¸…ç†æ‰ç«¯è¾¹ç•Œä»¥å¤–çš„å†…å­˜ã€‚<br />\n<strong>ç¼ºç‚¹</strong>ï¼šåŒæ ‡è®°å¤åˆ¶ç®—æ³•ï¼Œç”±äºæ•´ç†ç‰µæ‰¯åˆ°äº†å¯¹è±¡çš„ç§»åŠ¨ï¼Œæ•ˆç‡ä¼šå˜å¾—è¾ƒä½ã€‚</p>\n<h4 id=\"å¹¶å‘çš„å¯è¾¾æ€§åˆ†æ\"><a class=\"anchor\" href=\"#å¹¶å‘çš„å¯è¾¾æ€§åˆ†æ\">#</a> å¹¶å‘çš„å¯è¾¾æ€§åˆ†æ</h4>\n<ul>\n<li>ç™½è‰²ï¼š\n<ul>\n<li>è¡¨ç¤ºå¯¹è±¡å°šæœªè¢«åƒåœ¾æ”¶é›†å™¨è®¿é—®è¿‡ã€‚</li>\n<li>å¯è¾¾æ€§åˆ†æå¼€å§‹å‰ï¼Œæ‰€æœ‰å¯¹è±¡éƒ½æ˜¯ç™½è‰²çš„ï¼Œå¦‚æœåˆ†æç»“æŸåï¼Œä¾ç„¶æ˜¯ç™½è‰²çš„å¯¹è±¡ï¼Œæ„å‘³ç€å®ƒæ˜¯ä¸å¯è¾¾çš„ï¼Œå°†ä¼šè¢«å›æ”¶ã€‚</li>\n</ul>\n</li>\n<li>é»‘è‰²ï¼š\n<ul>\n<li>è¡¨ç¤ºå¯¹è±¡å·²ç»è¢«åƒåœ¾æ”¶é›†å™¨è®¿é—®è¿‡ï¼Œè€Œä¸”å¯¹è±¡çš„å¼•ç”¨é“¾å·²ç»éå†å®Œæˆã€‚</li>\n<li>é»‘è‰²çš„å¯¹è±¡ï¼Œæ„å‘³ç€å®ƒæ˜¯å¯è¾¾çš„ï¼Œä¸ä¼šè¢«å›æ”¶ã€‚</li>\n<li>å¦‚æœè¢«å…¶ä»–å¯¹è±¡å¼•ç”¨ï¼Œä¸éœ€è¦é‡æ–°éå†ä¸€éã€‚</li>\n<li>é»‘è‰²çš„å¯¹è±¡ä¸å¯èƒ½ç›´æ¥ï¼ˆä¸ç»è¿‡ç°è‰²çš„å¯¹è±¡ï¼‰æŒ‡å‘æŸä¸ªç™½è‰²çš„å¯¹è±¡ã€‚</li>\n</ul>\n</li>\n<li>ç°è‰²ï¼š\n<ul>\n<li>è¡¨ç¤ºå¯¹è±¡å·²ç»è¢«åƒåœ¾å›æ”¶å™¨è®¿é—®è¿‡ï¼Œä½†æ˜¯å¯¹è±¡çš„å¼•ç”¨é“¾æ²¡æœ‰éå†å®Œæˆã€‚</li>\n<li>ç°è‰²çš„å¯¹è±¡åœ¨é»‘è‰²çš„å¯¹è±¡å’Œç™½è‰²çš„å¯¹è±¡ä¹‹é—´ã€‚</li>\n</ul>\n</li>\n</ul>\n<h5 id=\"æµ®åŠ¨åƒåœ¾\"><a class=\"anchor\" href=\"#æµ®åŠ¨åƒåœ¾\">#</a> æµ®åŠ¨åƒåœ¾</h5>\n<p>å¹¶å‘æ ‡è®°çš„è¿‡ç¨‹ä¸­ï¼Œè‹¥ä¸€ä¸ªå·²ç»è¢«æ ‡è®°æˆé»‘è‰²æˆ–è€…ç°è‰²çš„å¯¹è±¡ï¼Œçªç„¶å˜æˆäº†åƒåœ¾ï¼Œç”±äºä¸ä¼šå†å¯¹é»‘è‰²æ ‡è®°è¿‡çš„å¯¹è±¡é‡æ–°æ‰«æï¼Œæ‰€ä»¥ä¸ä¼šè¢«å‘ç°ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡ä¸æ˜¯ç™½è‰²çš„ä½†æ˜¯ä¸ä¼šè¢«æ¸…é™¤ï¼Œé‡æ–°æ ‡è®°ä¹Ÿä¸èƒ½ä» GC Root ä¸­å»æ‰¾åˆ°ï¼Œæ‰€ä»¥æˆä¸ºäº†æµ®åŠ¨åƒåœ¾ï¼Œæµ®åŠ¨åƒåœ¾å¯¹ç³»ç»Ÿçš„å½±å“ä¸å¤§ï¼Œç•™ç»™ä¸‹ä¸€æ¬¡ GC è¿›è¡Œå¤„ç†å³å¯ã€‚</p>\n<h5 id=\"å¯¹è±¡ä¸¢å¤±\"><a class=\"anchor\" href=\"#å¯¹è±¡ä¸¢å¤±\">#</a> å¯¹è±¡ä¸¢å¤±</h5>\n<p><strong>å¯¹è±¡æ¶ˆå¤±éœ€è¦æ»¡è¶³çš„æ¡ä»¶</strong>ï¼š</p>\n<ul>\n<li>æ’å…¥ä¸€æ¡æˆ–å¤šæ¡ä»é»‘è‰²å¯¹è±¡åˆ°ç™½è‰²å¯¹è±¡çš„æ–°å¼•ç”¨</li>\n<li>åˆ é™¤å…¨éƒ¨ä»ç°è‰²å¯¹è±¡åˆ°è¯¥ç™½è‰²å¯¹è±¡çš„ç›´æ¥æˆ–é—´æ¥å¼•ç”¨</li>\n</ul>\n<p><strong>å¯¹è±¡æ¶ˆå¤±ç¤ºæ„å›¾</strong><br />\n<img data-src=\"https://cdn.jsdelivr.net/gh/haust-Kevin/static@master//images/202310271901281.png\" alt=\"\" /><br />\n<strong>è§£å†³æ–¹æ¡ˆ</strong><br />\nè§£å†³å¹¶å‘æ‰«ææ—¶çš„å¯¹è±¡æ¶ˆå¤±é—®é¢˜ï¼Œåªéœ€è¦ç ´åŒ–ä»¥ä¸Šä¸¤ä¸ªæ¡ä»¶çš„å…¶ä¸­ä¸€ä¸ªå³å¯ã€‚å› æ­¤äº§ç”Ÿä¸¤ç§è§£å†³æ–¹æ¡ˆï¼š</p>\n<ul>\n<li><strong>å¢é‡æ›´æ–°</strong>ï¼šç ´åçš„æ˜¯ç¬¬ä¸€ä¸ªæ¡ä»¶ï¼Œå½“é»‘è‰²å¯¹è±¡æ’å…¥æ–°çš„æŒ‡å‘ç™½è‰²å¯¹è±¡çš„å¼•ç”¨å…³ç³»æ—¶ï¼Œå°±å°†è¿™ä¸ªæ–°æ’å…¥çš„å¼•ç”¨è®°å½•ä¸‹æ¥ï¼Œç­‰å¹¶å‘æ‰«æç»“æŸä¹‹åï¼Œå†å°†è¿™äº›è®°å½•è¿‡çš„å¼•ç”¨å…³ç³»ä¸­çš„é»‘è‰²å¯¹è±¡ä¸ºæ ¹ï¼Œé‡æ–°æ‰«æä¸€æ¬¡ã€‚</li>\n<li><strong>åŸå§‹å¿«ç…§</strong>ï¼šç ´åŒ–çš„æ˜¯ç¬¬äºŒä¸ªæ¡ä»¶ï¼Œå½“ç°è‰²å¯¹è±¡è¦åˆ é™¤æŒ‡å‘ç™½è‰²å¯¹è±¡çš„å¼•ç”¨å…³ç³»æ—¶ï¼Œå°±å°†è¿™ä¸ªè¦åˆ é™¤çš„å¼•ç”¨è®°å½•ä¸‹æ¥ï¼Œåœ¨å¹¶å‘æ‰«æç»“æŸåï¼Œå†å°†è¿™äº›è®°å½•è¿‡çš„å¼•ç”¨å…³ç³»ä¸­çš„ç°è‰²å¯¹è±¡ä¸ºæ ¹ï¼Œé‡æ–°æ‰«æä¸€æ¬¡ã€‚</li>\n</ul>\n<p>ä»¥ä¸Šæ— è®ºæ˜¯å¯¹å¼•ç”¨å…³ç³»è®°å½•çš„æ’å…¥è¿˜æ˜¯åˆ é™¤ï¼Œè™šæ‹Ÿæœºçš„è®°å½•æ“ä½œéƒ½æ˜¯é€šè¿‡å†™å±éšœå®ç°çš„ï¼Œä¸”ä»¥ä¸Šä¸¤ç§æ–¹æ¡ˆåœ¨åƒåœ¾æ”¶é›†å™¨ä¸­éƒ½æœ‰å®é™…ä½¿ç”¨å¦‚ï¼šCMS æ˜¯åŸºäºå¢é‡æ›´æ–°æ¥åšå¹¶å‘æ ‡è®°ï¼›G1ã€Shenandoah åˆ™æ˜¯ä½¿ç”¨åŸå§‹å¿«ç…§æ¥å®ç°çš„ã€‚</p>\n<h3 id=\"ç»å…¸åƒåœ¾æ”¶é›†å™¨\"><a class=\"anchor\" href=\"#ç»å…¸åƒåœ¾æ”¶é›†å™¨\">#</a> ç»å…¸åƒåœ¾æ”¶é›†å™¨</h3>\n<h4 id=\"cms\"><a class=\"anchor\" href=\"#cms\">#</a> CMS</h4>\n<p>Concurrent Mark Sweepï¼Œé‡‡ç”¨æ ‡è®° - æ¸…é™¤ç®—æ³•ï¼Œç”¨äºè€å¹´ä»£ï¼Œå¸¸ä¸ ParNew ååŒå·¥ä½œã€‚ä¼˜ç‚¹åœ¨äºå¹¶å‘æ”¶é›†ä¸ä½åœé¡¿ã€‚<br />\n<img data-src=\"https://cdn.jsdelivr.net/gh/haust-Kevin/static@master//images/202310272053797.png\" alt=\"\" /></p>\n<h5 id=\"æ­¥éª¤\"><a class=\"anchor\" href=\"#æ­¥éª¤\">#</a> æ­¥éª¤</h5>\n<p><strong>åˆå§‹æ ‡è®°</strong>ï¼šè¿™ä¸ªè¿‡ç¨‹ååˆ†å¿«é€Ÿï¼Œéœ€è¦ stop the worldï¼Œéå†æ‰€æœ‰çš„å¯¹è±¡å¹¶ä¸”æ ‡è®°åˆå§‹çš„ GC Rootsã€‚<br />\n<strong>å¹¶å‘æ ‡è®°</strong>ï¼šè¿™ä¸ªè¿‡ç¨‹å¯ä»¥å’Œç”¨æˆ·çº¿ç¨‹ä¸€èµ·å¹¶å‘å®Œæˆï¼Œæ‰€ä»¥å¯¹äºç³»ç»Ÿè¿›ç¨‹çš„å½±å“è¾ƒå°ï¼Œä¸»è¦çš„å·¥ä½œä¸ºåœ¨ç³»ç»Ÿçº¿ç¨‹è¿è¡Œçš„æ—¶å€™é€šè¿‡ GC Roots å¯¹äºå¯¹è±¡è¿›è¡Œæ ¹èŠ‚ç‚¹æšä¸¾çš„æ“ä½œï¼Œæ ‡è®°å¯¹è±¡æ˜¯å¦å­˜æ´»ï¼Œæ³¨æ„è¿™é‡Œçš„æ ‡è®°ä¹Ÿæ˜¯è¾ƒä¸ºè¿…é€Ÿå’Œç®€å•çš„ï¼Œå› ä¸ºä¸‹ä¸€æ­¥è¿˜éœ€è¦é‡æ–°æ ‡è®°ã€‚<br />\n<strong>é‡æ–°æ ‡è®°</strong>ï¼šéœ€è¦ stop the worldï¼Œç”¨æ¥å¤„ç†å‰ä¸€ä¸ªé˜¶æ®µå› ä¸ºå¼•ç”¨å…³ç³»æ”¹å˜å¯¼è‡´æ²¡æœ‰æ ‡è®°åˆ°çš„å­˜æ´»å¯¹è±¡ï¼ˆä½¿ç”¨å¢é‡æ›´æ–°æ–¹å¼ï¼‰ï¼Œæ—¶é—´çŸ­ã€‚<br />\n<strong>å¹¶å‘æ¸…ç†</strong>ï¼šå’Œç”¨æˆ·çº¿ç¨‹ä¸€èµ·å¹¶å‘ï¼Œæ¸…é™¤é‚£äº›æ²¡æœ‰æ ‡è®°çš„å¯¹è±¡å¹¶ä¸”å›æ”¶ç©ºé—´ã€‚<br />\nCMS ä½¿ç”¨ å¢é‡æ›´æ–°çš„æ–¹å¼è§£å†³ã€Œå¯¹è±¡æ¶ˆå¤±ã€çš„é—®é¢˜ã€‚</p>\n<h5 id=\"ç¼ºç‚¹\"><a class=\"anchor\" href=\"#ç¼ºç‚¹\">#</a> ç¼ºç‚¹</h5>\n<ul>\n<li>å¯¹ CPU èµ„æºå¤ªæ•æ„Ÿï¼Œè™½ç„¶åœ¨å¹¶å‘æ ‡è®°é˜¶æ®µç”¨æˆ·çº¿ç¨‹æ²¡æœ‰æš‚åœï¼Œä½†æ˜¯ç”±äºæ”¶é›†å™¨å ç”¨äº†ä¸€éƒ¨åˆ† CPU èµ„æºï¼Œå¯¼è‡´ç¨‹åºçš„å“åº”é€Ÿåº¦å˜æ…¢ã€‚</li>\n<li>æ— æ³•å¤„ç†æµ®åŠ¨åƒåœ¾ã€‚åŸå› åœ¨äº CMS æ˜¯ä»¥è·å–æœ€çŸ­åœé¡¿æ—¶é—´ä¸ºç›®æ ‡çš„ï¼Œè‡ªç„¶ä¸å¯èƒ½åœ¨ä¸€æ¬¡åƒåœ¾å¤„ç†è¿‡ç¨‹ä¸­èŠ±è´¹å¤ªå¤šæ—¶é—´ï¼Œåªå¥½åœ¨ä¸‹ä¸€æ¬¡ GC çš„æ—¶å€™å¤„ç†ã€‚æœ‰å¯èƒ½å‡ºç°ã€ŒCon-current Mode Failureã€å¤±è´¥è¿›è€Œå¯¼è‡´å¦ä¸€æ¬¡å®Œå…¨ã€ŒStop The Worldã€çš„ Full GC çš„äº§ç”Ÿã€‚</li>\n<li>ç”±äº CMS æ”¶é›†å™¨æ˜¯åŸºäºã€Œæ ‡è®° - æ¸…é™¤ã€ç®—æ³•çš„ï¼Œå‰é¢è¯´è¿‡è¿™ä¸ªç®—æ³•ä¼šå¯¼è‡´å¤§é‡çš„ç©ºé—´ç¢ç‰‡çš„äº§ç”Ÿï¼Œä¸€æ—¦ç©ºé—´ç¢ç‰‡è¿‡å¤šï¼Œå¤§å¯¹è±¡å°±æ²¡åŠæ³•ç»™å…¶åˆ†é…å†…å­˜ï¼Œé‚£ä¹ˆå³ä½¿å†…å­˜è¿˜æœ‰å‰©ä½™ç©ºé—´å®¹çº³è¿™ä¸ªå¤§å¯¹è±¡ï¼Œä½†æ˜¯å´æ²¡æœ‰è¿ç»­çš„è¶³å¤Ÿå¤§çš„ç©ºé—´æ”¾ä¸‹è¿™ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥è™šæ‹Ÿæœºå°±ä¼šè§¦å‘ä¸€æ¬¡ Full GCã€‚Full GC ä¼šè¿›è¡Œä¸€æ¬¡ç¢ç‰‡æ•´ç†ã€‚</li>\n</ul>\n<h4 id=\"g1-garbage-first\"><a class=\"anchor\" href=\"#g1-garbage-first\">#</a> G1 (Garbage First)</h4>\n<p>é€šè¿‡æŠŠ Java å †åˆ†æˆå¤§å°ç›¸ç­‰çš„å¤šä¸ªç‹¬ç«‹åŒºåŸŸï¼Œå›æ”¶æ—¶è®¡ç®—å‡ºæ¯ä¸ªåŒºåŸŸå›æ”¶æ‰€è·å¾—çš„ç©ºé—´ä»¥åŠæ‰€éœ€æ—¶é—´çš„ç»éªŒå€¼ï¼Œæ ¹æ®è®°å½•ä¸¤ä¸ªå€¼æ¥åˆ¤æ–­å“ªä¸ªåŒºåŸŸæœ€å…·æœ‰å›æ”¶ä»·å€¼ï¼Œæ‰€ä»¥å« Garbage Firstï¼ˆåƒåœ¾ä¼˜å…ˆï¼‰ã€‚G1 æ”¶é›†å™¨ä¸ä¹‹å‰çš„æ”¶é›†å™¨æœ€å¤§çš„ä¸åŒå°±åœ¨äºå †å†…å­˜çš„åˆ’åˆ†ï¼Œä¹‹å‰çš„æ”¶é›†å™¨åªåŒºåˆ†æ–°ç”Ÿä»£ä¸è€å¹´ä»£ï¼Œè€Œ G1 æ”¶é›†å™¨åˆ™æ˜¯æŠŠå †å†…å­˜åˆ’åˆ†æˆå¤šä¸ªç‹¬ç«‹çš„ Region ã€‚<br />\n<img data-src=\"https://cdn.jsdelivr.net/gh/haust-Kevin/static@master//images/202310272109199.png\" alt=\"\" /></p>\n<h5 id=\"æ­¥éª¤-2\"><a class=\"anchor\" href=\"#æ­¥éª¤-2\">#</a> æ­¥éª¤</h5>\n<p><strong>åˆå§‹æ ‡è®°</strong>ï¼šè¿™ä¸ªé˜¶æ®µæ˜¯ STW (Stop the World) çš„ï¼Œæ‰€æœ‰åº”ç”¨çº¿ç¨‹ä¼šè¢«æš‚åœï¼Œæ ‡è®°å‡ºä» GC Root å¼€å§‹ç›´æ¥å¯è¾¾çš„å¯¹è±¡ã€‚</p>\n<p><strong>å¹¶å‘æ ‡è®°</strong>ï¼šä» GC Roots å¼€å§‹ï¼Œå¯¹å †ä¸­å¯¹è±¡è¿›è¡Œå¯è¾¾æ€§åˆ†æï¼Œæ‰¾å‡ºå­˜æ´»å¯¹è±¡ï¼Œè€—æ—¶è¾ƒé•¿ã€‚<br />\n<strong>æœ€ç»ˆæ ‡è®°</strong>ï¼šæ ‡è®°é‚£äº›åœ¨å¹¶å‘æ ‡è®°é˜¶æ®µå‘ç”Ÿå˜åŒ–çš„å¯¹è±¡ï¼ˆä½¿ç”¨åŸå§‹å¿«ç…§æ–¹å¼ï¼‰ï¼Œå°†è¢«å›æ”¶ã€‚<br />\n<strong>ç­›é€‰å›æ”¶</strong>ï¼šé¦–å…ˆï¼Œå¯¹å„ä¸ª Regin çš„å›æ”¶ä»·å€¼å’Œæˆæœ¬è¿›è¡Œæ’åºï¼Œæ ¹æ®ç”¨æˆ·æ‰€æœŸå¾…çš„ GC åœé¡¿æ—¶é—´ï¼Œæ¥æŒ‡å®šå›æ”¶è®¡åˆ’ï¼Œå›æ”¶ä¸€éƒ¨åˆ† Region ã€‚</p>\n<p>G1 ä¸­æä¾›äº† Young GCã€Mixed GC ä¸¤ç§åƒåœ¾å›æ”¶æ¨¡å¼ï¼Œè¿™ä¸¤ç§åƒåœ¾å›æ”¶æ¨¡å¼ï¼Œéƒ½æ˜¯ Stop The World (STW) çš„ã€‚</p>\n<h5 id=\"å›æ”¶æ¨¡å¼\"><a class=\"anchor\" href=\"#å›æ”¶æ¨¡å¼\">#</a> å›æ”¶æ¨¡å¼</h5>\n<p><strong>Young GC</strong><br />\n åœ¨åˆ†é…ä¸€èˆ¬å¯¹è±¡ï¼ˆéå·¨å‹å¯¹è±¡ï¼‰æ—¶ï¼Œå½“æ‰€æœ‰ eden region ä½¿ç”¨è¾¾åˆ°æœ€å¤§é˜€å€¼ã€å¹¶ä¸”æ— æ³•ç”³è¯·è¶³å¤Ÿå†…å­˜æ—¶ï¼Œä¼šè§¦å‘ä¸€æ¬¡ YoungGC ã€‚<br />\næ¯æ¬¡ young gc ä¼šå›æ”¶æ‰€æœ‰ Eden ã€ä»¥åŠ Survivor åŒºï¼Œå¹¶ä¸”å°†å­˜æ´»å¯¹è±¡å¤åˆ¶åˆ° Old åŒºä»¥åŠå¦ä¸€éƒ¨åˆ†çš„ Survivor åŒºã€‚</p>\n<p><strong>Mixed GC</strong><br />\n å½“è¶Šæ¥è¶Šå¤šçš„å¯¹è±¡æ™‹å‡åˆ°è€å¹´ä»£ old region æ—¶ï¼Œä¸ºäº†é¿å…å †å†…å­˜è¢«è€—å°½ï¼Œè™šæ‹Ÿæœºä¼šè§¦å‘ä¸€ä¸ªæ··åˆçš„åƒåœ¾æ”¶é›†ï¼Œå³ mixed gc ï¼Œè¯¥ç®—æ³•å¹¶ä¸æ˜¯ä¸€ä¸ª old gc ï¼Œé™¤äº†å›æ”¶æ•´ä¸ª young region ï¼Œè¿˜ä¼šå›æ”¶ä¸€éƒ¨åˆ†çš„ old region ã€‚</p>\n<p><strong>å·¨å‹å¯¹è±¡</strong><br />\n G1 åƒåœ¾æ”¶é›†å™¨è¿˜å¢åŠ äº†ä¸€ç§æ–°çš„å†…å­˜åŒºåŸŸï¼Œå«åš Humongous å†…å­˜åŒºåŸŸï¼Œä¸»è¦ç”¨äºå­˜å‚¨å¤§å¯¹è±¡ï¼Œå¦‚æœè¶…è¿‡ 1.5 ä¸ª region , å°±æ”¾åˆ° Humongous åŒºåŸŸã€‚</p>\n<h5 id=\"ç‰¹ç‚¹\"><a class=\"anchor\" href=\"#ç‰¹ç‚¹\">#</a> ç‰¹ç‚¹</h5>\n<p>G1 çš„ä¸€ä¸ªæ˜¾è‘—ç‰¹ç‚¹ä»–èƒ½å¤Ÿè®©ç”¨æˆ·è®¾ç½®åº”ç”¨çš„æš‚åœæ—¶é—´ï¼ŒG1 å›æ”¶çš„ç¬¬ 4 æ­¥ï¼Œå®ƒæ˜¯ã€Œé€‰æ‹©ä¸€äº›å†…å­˜å—ã€ï¼Œè€Œä¸æ˜¯æ•´ä»£å†…å­˜æ¥å›æ”¶ï¼Œè¿™æ˜¯ G1 è·Ÿå…¶å®ƒ GC éå¸¸ä¸åŒçš„ä¸€ç‚¹ï¼Œå…¶å®ƒ GC æ¯æ¬¡å›æ”¶éƒ½ä¼šå›æ”¶æ•´ä¸ª Generation çš„å†…å­˜ (Eden, Old), è€Œå›æ”¶å†…å­˜æ‰€éœ€çš„æ—¶é—´å°±å–å†³äºå†…å­˜çš„å¤§å°ï¼Œä»¥åŠå®é™…åƒåœ¾çš„å¤šå°‘ï¼Œæ‰€ä»¥åƒåœ¾å›æ”¶æ—¶é—´æ˜¯ä¸å¯æ§çš„ï¼›è€Œ G1 æ¯æ¬¡å¹¶ä¸ä¼šå›æ”¶æ•´ä»£å†…å­˜ï¼Œåˆ°åº•å›æ”¶å¤šå°‘å†…å­˜å°±çœ‹ç”¨æˆ·é…ç½®çš„æš‚åœæ—¶é—´ï¼Œé…ç½®çš„æ—¶é—´çŸ­å°±å°‘å›æ”¶ç‚¹ï¼Œé…ç½®çš„æ—¶é—´é•¿å°±å¤šå›æ”¶ç‚¹ï¼Œä¼¸ç¼©è‡ªå¦‚ã€‚</p>\n",
            "tags": [
                "é¢è¯•æŒ‡åŒ—",
                "Java",
                "å…«è‚¡æ–‡",
                "Java",
                "JVM"
            ]
        },
        {
            "id": "https://haust-kevin.github.io/2023/10/25/2023-10-interview-Java-basic/",
            "url": "https://haust-kevin.github.io/2023/10/25/2023-10-interview-Java-basic/",
            "title": "é¢è¯•æŒ‡åŒ—ï¼šJava åŸºç¡€",
            "date_published": "2023-10-25T11:34:51.000Z",
            "content_html": "<h2 id=\"é¢å‘å¯¹è±¡\"><a class=\"anchor\" href=\"#é¢å‘å¯¹è±¡\">#</a> é¢å‘å¯¹è±¡</h2>\n<h3 id=\"é¢å‘å¯¹è±¡çš„ä¸‰å¤§ç‰¹å¾\"><a class=\"anchor\" href=\"#é¢å‘å¯¹è±¡çš„ä¸‰å¤§ç‰¹å¾\">#</a> é¢å‘å¯¹è±¡çš„ä¸‰å¤§ç‰¹å¾</h3>\n<p>é¢å‘å¯¹è±¡çš„ç¨‹åºè®¾è®¡æ–¹æ³•å…·æœ‰ä¸‰ä¸ªåŸºæœ¬ç‰¹å¾ï¼šå°è£…ã€ç»§æ‰¿ã€å¤šæ€ã€‚<br />\n<strong>å°è£…</strong>æŒ‡çš„æ˜¯å°†å¯¹è±¡çš„å®ç°ç»†èŠ‚éšè—èµ·æ¥ï¼Œç„¶åé€šè¿‡ä¸€äº›å…¬ç”¨æ–¹æ³•æ¥æš´éœ²è¯¥å¯¹è±¡çš„åŠŸèƒ½ï¼›<br />\n<strong>ç»§æ‰¿</strong>æ˜¯é¢å‘å¯¹è±¡å®ç°è½¯ä»¶å¤ç”¨çš„é‡è¦æ‰‹æ®µï¼Œå½“å­ç±»ç»§æ‰¿çˆ¶ç±»åï¼Œå­ç±»ä½œä¸ºä¸€ç§ç‰¹æ®Šçš„çˆ¶ç±»ï¼Œå°†ç›´æ¥è·å¾—çˆ¶ç±»çš„å±æ€§å’Œæ–¹æ³•ï¼›<br />\n<strong>å¤šæ€</strong>æŒ‡çš„æ˜¯å­ç±»å¯¹è±¡å¯ä»¥ç›´æ¥èµ‹ç»™çˆ¶ç±»å˜é‡ï¼Œä½†è¿è¡Œæ—¶ä¾ç„¶è¡¨ç°å‡ºå­ç±»çš„è¡Œä¸ºç‰¹å¾ï¼Œè¿™æ„å‘³ç€åŒä¸€ä¸ªç±»å‹çš„å¯¹è±¡åœ¨æ‰§è¡ŒåŒä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œå¯èƒ½è¡¨ç°å‡ºå¤šç§è¡Œä¸ºç‰¹å¾ã€‚</p>\n<h2 id=\"java-åŸºç¡€\"><a class=\"anchor\" href=\"#java-åŸºç¡€\">#</a> Java åŸºç¡€</h2>\n<h3 id=\"string-stringbuilder-stringbuffer\"><a class=\"anchor\" href=\"#string-stringbuilder-stringbuffer\">#</a> String &amp; StringBuilder &amp; StringBuffer</h3>\n<p><code>String</code>  ç±»æ˜¯ä¸å¯å˜ç±»ï¼Œå³ä¸€æ—¦ä¸€ä¸ª <code>String</code>  å¯¹è±¡è¢«åˆ›å»ºä»¥åï¼ŒåŒ…å«åœ¨è¿™ä¸ªå¯¹è±¡ä¸­çš„å­—ç¬¦åºåˆ—æ˜¯ä¸å¯æ”¹å˜çš„ï¼Œç›´è‡³è¿™ä¸ªå¯¹è±¡è¢«é”€æ¯ã€‚<br />\n <code>StringBuffer</code> ã€ <code>StringBuilder</code>  éƒ½ä»£è¡¨å¯å˜çš„å­—ç¬¦ä¸²å¯¹è±¡ï¼Œå®ƒä»¬æœ‰å…±åŒçš„çˆ¶ç±»  <code>AbstractStringBuilder</code> ï¼Œå¹¶ä¸”ä¸¤ä¸ªç±»çš„æ„é€ æ–¹æ³•å’Œæˆå‘˜æ–¹æ³•ä¹ŸåŸºæœ¬ç›¸åŒã€‚ä¸åŒçš„æ˜¯ï¼Œ <code>StringBuffer</code>  æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè€Œ <code>StringBuilder</code>  æ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œæ‰€ä»¥ <code>StringBuilder</code>  æ€§èƒ½ç•¥é«˜ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè¦åˆ›å»ºä¸€ä¸ªå†…å®¹å¯å˜çš„å­—ç¬¦ä¸²ï¼Œå»ºè®®ä¼˜å…ˆè€ƒè™‘ <code>StringBuilder</code>  ç±»ã€‚</p>\n<h3 id=\"java-ä¸­str-helloå’Œstr-new-stringhelloä¸¤ç§åˆ›å»ºå­—ç¬¦ä¸²çš„åŒºåˆ«\"><a class=\"anchor\" href=\"#java-ä¸­str-helloå’Œstr-new-stringhelloä¸¤ç§åˆ›å»ºå­—ç¬¦ä¸²çš„åŒºåˆ«\">#</a> Java ä¸­ <code>str = &quot;hello&quot;</code>  å’Œ <code>str = new String(&quot;hello')</code>  ä¸¤ç§åˆ›å»ºå­—ç¬¦ä¸²çš„åŒºåˆ«</h3>\n<p>å½“ Java ç¨‹åºç›´æ¥ä½¿ç”¨  <code>&quot;hello&quot;</code>  çš„å­—ç¬¦ä¸²ç›´æ¥é‡æ—¶ï¼ŒJVM ä¼šä½¿ç”¨å¸¸é‡æ± æ¥ç®¡ç†å­—ç¬¦ä¸²ç›´æ¥é‡ ï¼ˆåœ¨æ‰§è¡Œè¿™å¥è¯æ—¶ï¼ŒJVM ä¼šå…ˆæ£€æŸ¥å¸¸é‡æ± ä¸­æ˜¯å¦å·²ç»å­˜æœ‰  <code>&quot;hello&quot;</code> ï¼Œè‹¥æ²¡æœ‰åˆ™å°†  <code>&quot;hello&quot;</code>  å­˜å…¥å¸¸é‡æ± ï¼Œå¦åˆ™å°±å¤ç”¨å¸¸é‡æ± ä¸­å·²æœ‰çš„  <code>&quot;hello&quot;</code> ï¼Œå°†å…¶å¼•ç”¨èµ‹å€¼ç»™å˜é‡ strã€‚ï¼‰ã€‚</p>\n<p>å½“ä½¿ç”¨  <code>new String(&quot;hello&quot;)</code>  æ—¶ï¼ŒJVM ä¼šå…ˆä½¿ç”¨å¸¸é‡æ± æ¥ç®¡ç†  <code>&quot;hello&quot;</code>  å­—ç¬¦ä¸²ç›´æ¥é‡ï¼Œå†è°ƒç”¨ String ç±»çš„æ„é€ å™¨æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ String å¯¹è±¡ï¼Œæ–°åˆ›å»ºçš„ String å¯¹è±¡è¢«ä¿å­˜åœ¨å †å†…å­˜ä¸­ã€‚å¹¶ä¸”ï¼Œå †ä¸­å¯¹è±¡çš„æ•°æ®ä¼šæŒ‡å‘å¸¸é‡æ± ä¸­çš„ç›´æ¥é‡ã€‚</p>\n<h3 id=\"java-åˆ›å»ºå¯¹è±¡çš„æ–¹å¼\"><a class=\"anchor\" href=\"#java-åˆ›å»ºå¯¹è±¡çš„æ–¹å¼\">#</a> Java åˆ›å»ºå¯¹è±¡çš„æ–¹å¼</h3>\n<ol>\n<li>ä½¿ç”¨ new å…³é”®å­—</li>\n<li>ä½¿ç”¨ Class ç±»çš„ newInstance () æ–¹æ³•ï¼š\n<ol>\n<li>ä½¿ç”¨ Class ç±»çš„ forName () æ–¹æ³•</li>\n<li>ä½¿ç”¨ ClassLoader ç±»çš„ loadClass () æ–¹æ³•</li>\n</ol>\n</li>\n<li>ä½¿ç”¨ Constructor ç±»çš„ newInstance () æ–¹æ³•</li>\n<li>ä½¿ç”¨ clone () æ–¹æ³•</li>\n<li>ä½¿ç”¨ååºåˆ—åŒ–</li>\n</ol>\n<h3 id=\"ä¸¤ä¸ªå­—ç¬¦ä¸²ç›¸åŠ çš„åº•å±‚å®ç°\"><a class=\"anchor\" href=\"#ä¸¤ä¸ªå­—ç¬¦ä¸²ç›¸åŠ çš„åº•å±‚å®ç°\">#</a> ä¸¤ä¸ªå­—ç¬¦ä¸²ç›¸åŠ çš„åº•å±‚å®ç°</h3>\n<p>å¦‚æœæ‹¼æ¥çš„éƒ½æ˜¯å­—ç¬¦ä¸²ç›´æ¥é‡ï¼Œåˆ™åœ¨ç¼–è¯‘æ—¶ç¼–è¯‘å™¨ä¼šå°†å…¶ç›´æ¥ä¼˜åŒ–ä¸ºä¸€ä¸ªå®Œæ•´çš„å­—ç¬¦ä¸²ï¼Œå’Œä½ ç›´æ¥å†™ä¸€ä¸ªå®Œæ•´çš„å­—ç¬¦ä¸²æ˜¯ä¸€æ ·çš„ã€‚<br />\nå¦‚æœæ‹¼æ¥çš„å­—ç¬¦ä¸²ä¸­åŒ…å«å˜é‡ï¼Œåˆ™åœ¨ç¼–è¯‘æ—¶ç¼–è¯‘å™¨é‡‡ç”¨ StringBuilder å¯¹å…¶è¿›è¡Œä¼˜åŒ–ï¼Œå³è‡ªåŠ¨åˆ›å»º StringBuilder å®ä¾‹å¹¶è°ƒç”¨å…¶ append () æ–¹æ³•ï¼Œå°†è¿™äº›å­—ç¬¦ä¸²æ‹¼æ¥åœ¨ä¸€èµ·ã€‚</p>\n<h3 id=\"java-çš„å¼‚å¸¸æ¥å£\"><a class=\"anchor\" href=\"#java-çš„å¼‚å¸¸æ¥å£\">#</a> Java çš„å¼‚å¸¸æ¥å£</h3>\n<p>Throwable æ˜¯å¼‚å¸¸çš„é¡¶å±‚çˆ¶ç±»ï¼Œä»£è¡¨æ‰€æœ‰çš„éæ­£å¸¸æƒ…å†µã€‚å®ƒæœ‰ä¸¤ä¸ªç›´æ¥å­ç±»ï¼Œåˆ†åˆ«æ˜¯ Errorã€Exceptionã€‚</p>\n<ul>\n<li><code>Error</code>  æ˜¯é”™è¯¯ï¼Œä¸€èˆ¬æ˜¯æŒ‡ä¸è™šæ‹Ÿæœºç›¸å…³çš„é—®é¢˜ï¼Œå¦‚ç³»ç»Ÿå´©æºƒã€è™šæ‹Ÿæœºé”™è¯¯ã€åŠ¨æ€é“¾æ¥å¤±è´¥ç­‰ï¼Œè¿™ç§é”™è¯¯æ— æ³•æ¢å¤æˆ–ä¸å¯èƒ½æ•è·ï¼Œå°†å¯¼è‡´åº”ç”¨ç¨‹åºä¸­æ–­ã€‚é€šå¸¸åº”ç”¨ç¨‹åºæ— æ³•å¤„ç†è¿™äº›é”™è¯¯ï¼Œå› æ­¤åº”ç”¨ç¨‹åºä¸åº”è¯¥è¯•å›¾ä½¿ç”¨ catch å—æ¥æ•è· Error å¯¹è±¡ã€‚åœ¨å®šä¹‰æ–¹æ³•æ—¶ï¼Œä¹Ÿæ— é¡»åœ¨å…¶ throws å­å¥ä¸­å£°æ˜è¯¥æ–¹æ³•å¯èƒ½æŠ›å‡º Error åŠå…¶ä»»ä½•å­ç±»ã€‚</li>\n<li><code>Exception</code>  æ˜¯å¼‚å¸¸ï¼Œå®ƒè¢«åˆ†ä¸ºä¸¤å¤§ç±»ï¼Œåˆ†åˆ«æ˜¯ Checked å¼‚å¸¸å’Œ Runtime å¼‚å¸¸ã€‚\n<ul>\n<li><code>RuntimeException</code>  ï¼ˆä¸å—æ£€å¼‚å¸¸ï¼‰ï¼š RuntimeException ç±»åŠå…¶å­ç±»è¡¨ç¤º JVM åœ¨è¿è¡ŒæœŸé—´å¯èƒ½å‡ºç°çš„é”™è¯¯ã€‚ç¼–è¯‘å™¨ä¸ä¼šæ£€æŸ¥æ­¤ç±»å¼‚å¸¸ï¼Œå¹¶ä¸”ä¸è¦æ±‚å¤„ç†å¼‚å¸¸ï¼Œæ¯”å¦‚ç”¨ç©ºå€¼å¯¹è±¡çš„å¼•ç”¨ï¼ˆNullPointerExceptionï¼‰ã€æ•°ç»„ä¸‹æ ‡è¶Šç•Œï¼ˆArrayIndexOutBoundExceptionï¼‰ã€‚æ­¤ç±»å¼‚å¸¸å±äºä¸å¯æŸ¥å¼‚å¸¸ï¼Œä¸€èˆ¬æ˜¯ç”±ç¨‹åºé€»è¾‘é”™è¯¯å¼•èµ·çš„ï¼Œåœ¨ç¨‹åºä¸­å¯ä»¥é€‰æ‹©æ•è·å¤„ç†ï¼Œä¹Ÿå¯ä»¥ä¸å¤„ç†ã€‚</li>\n<li><code>CheckedException</code>  ï¼ˆå—æ£€å¼‚å¸¸ï¼‰ï¼š Exception ä¸­é™¤ RuntimeException åŠå…¶å­ç±»ä¹‹å¤–çš„å¼‚å¸¸ã€‚ç¼–è¯‘å™¨ä¼šæ£€æŸ¥æ­¤ç±»å¼‚å¸¸ï¼Œå¦‚æœç¨‹åºä¸­å‡ºç°æ­¤ç±»å¼‚å¸¸ï¼Œæ¯”å¦‚è¯´ IOException ï¼Œå¿…é¡»å¯¹è¯¥å¼‚å¸¸è¿›è¡Œå¤„ç†ï¼Œè¦ä¹ˆä½¿ç”¨ <code>try-catch</code>  æ•è·ï¼Œè¦ä¹ˆä½¿ç”¨ throws è¯­å¥æŠ›å‡ºï¼Œå¦åˆ™ç¼–è¯‘ä¸é€šè¿‡ã€‚</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"java-å¯¹è±¡çš„å››ç§å¼•ç”¨æ–¹å¼\"><a class=\"anchor\" href=\"#java-å¯¹è±¡çš„å››ç§å¼•ç”¨æ–¹å¼\">#</a> Java å¯¹è±¡çš„å››ç§å¼•ç”¨æ–¹å¼</h3>\n<p>Java å¯¹è±¡çš„å››ç§å¼•ç”¨æ–¹å¼åˆ†åˆ«æ˜¯å¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨ï¼Œå…·ä½“å«ä¹‰å¦‚ä¸‹ï¼š</p>\n<ul>\n<li><strong>å¼ºå¼•ç”¨</strong>ï¼šè¿™æ˜¯ Java ç¨‹åºä¸­æœ€å¸¸è§çš„å¼•ç”¨æ–¹å¼ï¼Œå³ç¨‹åºåˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶æŠŠè¿™ä¸ªå¯¹è±¡èµ‹ç»™ä¸€ä¸ªå¼•ç”¨å˜é‡ï¼Œç¨‹åºé€šè¿‡è¯¥å¼•ç”¨å˜é‡æ¥æ“ä½œå®é™…çš„å¯¹è±¡ã€‚å½“ä¸€ä¸ªå¯¹è±¡è¢«ä¸€ä¸ªæˆ–ä¸€ä¸ªä»¥ä¸Šçš„å¼•ç”¨å˜é‡æ‰€å¼•ç”¨æ—¶ï¼Œå®ƒå¤„äºå¯è¾¾çŠ¶æ€ï¼Œä¸å¯èƒ½è¢«ç³»ç»Ÿåƒåœ¾å›æ”¶æœºåˆ¶å›æ”¶ã€‚</li>\n<li><strong>è½¯å¼•ç”¨</strong>ï¼šå½“ä¸€ä¸ªå¯¹è±¡åªæœ‰è½¯å¼•ç”¨æ—¶ï¼Œå®ƒæœ‰å¯èƒ½è¢«åƒåœ¾å›æ”¶æœºåˆ¶å›æ”¶ã€‚å¯¹äºåªæœ‰è½¯å¼•ç”¨çš„å¯¹è±¡è€Œè¨€ï¼Œå½“ç³»ç»Ÿå†…å­˜ç©ºé—´è¶³å¤Ÿæ—¶ï¼Œå®ƒä¸ä¼šè¢«ç³»ç»Ÿå›æ”¶ï¼Œç¨‹åºä¹Ÿå¯ä½¿ç”¨è¯¥å¯¹è±¡ã€‚å½“ç³»ç»Ÿå†…å­˜ç©ºé—´ä¸è¶³æ—¶ï¼Œç³»ç»Ÿå¯èƒ½ä¼šå›æ”¶å®ƒã€‚è½¯å¼•ç”¨é€šå¸¸ç”¨äºå¯¹å†…å­˜æ•æ„Ÿçš„ç¨‹åºä¸­ã€‚</li>\n<li><strong>å¼±å¼•ç”¨</strong>ï¼šå¼±å¼•ç”¨å’Œè½¯å¼•ç”¨å¾ˆåƒï¼Œä½†å¼±å¼•ç”¨çš„å¼•ç”¨çº§åˆ«æ›´ä½ã€‚å¯¹äºåªæœ‰å¼±å¼•ç”¨çš„å¯¹è±¡è€Œè¨€ï¼Œå½“ç³»ç»Ÿåƒåœ¾å›æ”¶æœºåˆ¶è¿è¡Œæ—¶ï¼Œä¸ç®¡ç³»ç»Ÿå†…å­˜æ˜¯å¦è¶³å¤Ÿï¼Œæ€»ä¼šå›æ”¶è¯¥å¯¹è±¡æ‰€å ç”¨çš„å†…å­˜ã€‚å½“ç„¶ï¼Œå¹¶ä¸æ˜¯è¯´å½“ä¸€ä¸ªå¯¹è±¡åªæœ‰å¼±å¼•ç”¨æ—¶ï¼Œå®ƒå°±ä¼šç«‹å³è¢«å›æ”¶ï¼Œæ­£å¦‚é‚£äº›å¤±å»å¼•ç”¨çš„å¯¹è±¡ä¸€æ ·ï¼Œå¿…é¡»ç­‰åˆ°ç³»ç»Ÿåƒåœ¾å›æ”¶æœºåˆ¶è¿è¡Œæ—¶æ‰ä¼šè¢«å›æ”¶ã€‚</li>\n<li><strong>è™šå¼•ç”¨</strong>ï¼šè™šå¼•ç”¨å®Œå…¨ç±»ä¼¼äºæ²¡æœ‰å¼•ç”¨ã€‚è™šå¼•ç”¨å¯¹å¯¹è±¡æœ¬èº«æ²¡æœ‰å¤ªå¤§å½±å“ï¼Œå¯¹è±¡ç”šè‡³æ„Ÿè§‰ä¸åˆ°è™šå¼•ç”¨çš„å­˜åœ¨ã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡åªæœ‰ä¸€ä¸ªè™šå¼•ç”¨æ—¶ï¼Œé‚£ä¹ˆå®ƒå’Œæ²¡æœ‰å¼•ç”¨çš„æ•ˆæœå¤§è‡´ç›¸åŒã€‚è™šå¼•ç”¨ä¸»è¦ç”¨äºè·Ÿè¸ªå¯¹è±¡è¢«åƒåœ¾å›æ”¶çš„çŠ¶æ€ï¼Œè™šå¼•ç”¨ä¸èƒ½å•ç‹¬ä½¿ç”¨ï¼Œè™šå¼•ç”¨å¿…é¡»å’Œå¼•ç”¨é˜Ÿåˆ—è”åˆä½¿ç”¨ã€‚</li>\n</ul>\n<h2 id=\"å®¹å™¨ç±»å‹\"><a class=\"anchor\" href=\"#å®¹å™¨ç±»å‹\">#</a> å®¹å™¨ç±»å‹</h2>\n<h3 id=\"java-ä¸­æœ‰å“ªäº›å®¹å™¨\"><a class=\"anchor\" href=\"#java-ä¸­æœ‰å“ªäº›å®¹å™¨\">#</a> Java ä¸­æœ‰å“ªäº›å®¹å™¨</h3>\n<p>Java ä¸­çš„é›†åˆç±»ä¸»è¦ç”± <code>Collection</code>  å’Œ <code>Map</code>  è¿™ä¸¤ä¸ªæ¥å£æ´¾ç”Ÿè€Œå‡ºï¼Œå…¶ä¸­ <code>Collection</code>  æ¥å£åˆæ´¾ç”Ÿå‡ºä¸‰ä¸ªå­æ¥å£ï¼Œåˆ†åˆ«æ˜¯ <code>Set</code> ã€ <code>List</code> ã€ <code>Queue</code> ã€‚æ‰€æœ‰çš„ Java é›†åˆç±»ï¼Œéƒ½æ˜¯ <code>Set</code> ã€ <code>List</code> ã€ <code>Queue</code> ã€ <code>Map</code>  è¿™å››ä¸ªæ¥å£çš„å®ç°ç±»ï¼Œè¿™å››ä¸ªæ¥å£å°†é›†åˆåˆ†æˆäº†å››å¤§ç±»ï¼Œå…¶ä¸­</p>\n<ul>\n<li><code>Set</code>  ä»£è¡¨æ— åºçš„ï¼Œå…ƒç´ ä¸å¯é‡å¤çš„é›†åˆï¼›</li>\n<li><code>List</code>  ä»£è¡¨æœ‰åºçš„ï¼Œå…ƒç´ å¯ä»¥é‡å¤çš„é›†åˆï¼›</li>\n<li><code>Queue</code>  ä»£è¡¨å…ˆè¿›å…ˆå‡ºï¼ˆFIFOï¼‰çš„é˜Ÿåˆ—ï¼›</li>\n<li><code>Map</code>  ä»£è¡¨å…·æœ‰æ˜ å°„å…³ç³»ï¼ˆkey-valueï¼‰çš„é›†åˆã€‚</li>\n</ul>\n<h3 id=\"java-ä¸­å®¹å™¨çš„çº¿ç¨‹å®‰å…¨æ€§\"><a class=\"anchor\" href=\"#java-ä¸­å®¹å™¨çš„çº¿ç¨‹å®‰å…¨æ€§\">#</a> Java ä¸­å®¹å™¨çš„çº¿ç¨‹å®‰å…¨æ€§</h3>\n<p>java.util åŒ…ä¸‹çš„é›†åˆç±»å¤§éƒ¨åˆ†éƒ½æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼Œä¾‹å¦‚æˆ‘ä»¬å¸¸ç”¨çš„ HashSetã€TreeSetã€ArrayListã€LinkedListã€ArrayDequeã€HashMapã€TreeMapï¼Œè¿™äº›éƒ½æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„é›†åˆç±»ï¼Œä½†æ˜¯å®ƒä»¬çš„ä¼˜ç‚¹æ˜¯æ€§èƒ½å¥½ã€‚å¦‚æœéœ€è¦ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„é›†åˆç±»ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ <code>Collections</code>  å·¥å…·ç±»æä¾›çš„ <code>synchronizedXxx()</code>  æ–¹æ³•ï¼Œå°†è¿™äº›é›†åˆç±»åŒ…è£…æˆçº¿ç¨‹å®‰å…¨çš„é›†åˆç±»ã€‚</p>\n<p>java.util åŒ…ä¸‹ä¹Ÿæœ‰çº¿ç¨‹å®‰å…¨çš„é›†åˆç±»ï¼Œä¾‹å¦‚ Vectorã€Hashtable ã€‚è¿™äº›é›†åˆç±»éƒ½æ˜¯æ¯”è¾ƒå¤è€çš„ API ï¼Œè™½ç„¶å®ç°äº†çº¿ç¨‹å®‰å…¨ï¼Œä½†æ˜¯æ€§èƒ½å¾ˆå·®ã€‚æ‰€ä»¥å³ä¾¿æ˜¯éœ€è¦ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„é›†åˆç±»ï¼Œä¹Ÿå»ºè®®å°†çº¿ç¨‹ä¸å®‰å…¨çš„é›†åˆç±»åŒ…è£…æˆçº¿ç¨‹å®‰å…¨é›†åˆç±»çš„æ–¹å¼ï¼Œè€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨è¿™äº›å¤è€çš„ API ã€‚</p>\n<p>ä» Java5 å¼€å§‹ï¼ŒJava åœ¨ java.util.concurrent åŒ…ä¸‹æä¾›äº†å¤§é‡æ”¯æŒé«˜æ•ˆå¹¶å‘è®¿é—®çš„é›†åˆç±»ï¼Œå®ƒä»¬æ—¢èƒ½ä¿è¯è‰¯å¥½çš„è®¿é—®æ€§èƒ½ï¼Œåˆèƒ½ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚è¿™äº›é›†åˆç±»å¯ä»¥åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼Œå®ƒä»¬çš„ç‰¹å¾å¦‚ä¸‹ï¼š</p>\n<ul>\n<li>ä»¥ Concurrent å¼€å¤´çš„é›†åˆç±»ï¼š<br />\nä»¥ Concurrent å¼€å¤´çš„é›†åˆç±»ä»£è¡¨äº†æ”¯æŒå¹¶å‘è®¿é—®çš„é›†åˆï¼Œå®ƒä»¬å¯ä»¥æ”¯æŒå¤šä¸ªçº¿ç¨‹å¹¶å‘å†™å…¥è®¿é—®ï¼Œè¿™äº›å†™å…¥çº¿ç¨‹çš„æ‰€æœ‰æ“ä½œéƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†è¯»å–æ“ä½œä¸å¿…é”å®šã€‚ä»¥ Concurrent å¼€å¤´çš„é›†åˆç±»é‡‡ç”¨äº†æ›´å¤æ‚çš„ç®—æ³•æ¥ä¿è¯æ°¸è¿œä¸ä¼šé”ä½æ•´ä¸ªé›†åˆï¼Œå› æ­¤åœ¨å¹¶å‘å†™å…¥æ—¶æœ‰è¾ƒå¥½çš„æ€§èƒ½ã€‚</li>\n<li>ä»¥ CopyOnWrite å¼€å¤´çš„é›†åˆç±»ï¼š<br />\nä»¥ CopyOnWrite å¼€å¤´çš„é›†åˆç±»é‡‡ç”¨å¤åˆ¶åº•å±‚æ•°ç»„çš„æ–¹å¼æ¥å®ç°å†™æ“ä½œã€‚å½“çº¿ç¨‹å¯¹æ­¤ç±»é›†åˆæ‰§è¡Œè¯»å–æ“ä½œæ—¶ï¼Œçº¿ç¨‹å°†ä¼šç›´æ¥è¯»å–é›†åˆæœ¬èº«ï¼Œæ— é¡»åŠ é”ä¸é˜»å¡ã€‚å½“çº¿ç¨‹å¯¹æ­¤ç±»é›†åˆæ‰§è¡Œå†™å…¥æ“ä½œæ—¶ï¼Œé›†åˆä¼šåœ¨åº•å±‚å¤åˆ¶ä¸€ä»½æ–°çš„æ•°ç»„ï¼Œæ¥ä¸‹æ¥å¯¹æ–°çš„æ•°ç»„æ‰§è¡Œå†™å…¥æ“ä½œã€‚ç”±äºå¯¹é›†åˆçš„å†™å…¥æ“ä½œéƒ½æ˜¯å¯¹æ•°ç»„çš„å‰¯æœ¬æ‰§è¡Œæ“ä½œï¼Œå› æ­¤å®ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</li>\n</ul>\n<h3 id=\"hashmap\"><a class=\"anchor\" href=\"#hashmap\">#</a> HashMap</h3>\n<h4 id=\"hashmap-ä¸ºä»€ä¹ˆåœ¨è·å–-hash-å€¼æ—¶è¦è¿›è¡Œä½è¿ç®—\"><a class=\"anchor\" href=\"#hashmap-ä¸ºä»€ä¹ˆåœ¨è·å–-hash-å€¼æ—¶è¦è¿›è¡Œä½è¿ç®—\">#</a> HashMap ä¸ºä»€ä¹ˆåœ¨è·å– hash å€¼æ—¶è¦è¿›è¡Œä½è¿ç®—</h4>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">static</span> <span class=\"token keyword\">final</span> <span class=\"token keyword\">int</span> <span class=\"token function\">hash</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Object</span> key<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">int</span> h<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>key <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token number\">0</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>h <span class=\"token operator\">=</span> key<span class=\"token punctuation\">.</span><span class=\"token function\">hashCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">^</span> <span class=\"token punctuation\">(</span>h <span class=\"token operator\">>>></span> <span class=\"token number\">16</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ol>\n<li>å¦‚æœä½¿ç”¨ç›´æ¥ä½¿ç”¨ hashCode å¯¹æ•°ç»„å¤§å°å–ä½™ï¼Œé‚£ä¹ˆç›¸å½“äºå‚ä¸è¿ç®—çš„åªæœ‰ hashCode çš„ä½ä½ï¼Œé«˜ä½æ˜¯æ²¡æœ‰èµ·åˆ°ä»»ä½•ä½œç”¨çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„æ€è·¯å°±æ˜¯è®© hashCode å–å€¼å‡ºçš„é«˜ä½ä¹Ÿå‚ä¸è¿ç®—ï¼Œè¿›ä¸€æ­¥é™ä½ hash ç¢°æ’çš„æ¦‚ç‡ï¼Œä½¿å¾—æ•°æ®åˆ†å¸ƒæ›´å¹³å‡ï¼Œæˆ‘ä»¬æŠŠè¿™æ ·çš„æ“ä½œç§°ä¸ºæ‰°åŠ¨ã€‚</li>\n<li>è€Œè¿™ä¹ˆæ¥çœ‹ hashCode è¢«æ•£åˆ— ï¼ˆå¼‚æˆ–ï¼‰ çš„æ˜¯ä½ 16 ä½ï¼Œè€Œ HashMap æ•°ç»„é•¿åº¦ä¸€èˆ¬ä¸ä¼šè¶…è¿‡ 2 çš„ 16 æ¬¡å¹‚ï¼Œé‚£ä¹ˆé«˜ 16 ä½åœ¨å¤§å¤šæ•°æƒ…å†µæ˜¯ç”¨ä¸åˆ°çš„ï¼Œæ‰€ä»¥åªéœ€è¦æ‹¿ key çš„ HashCode å’Œå®ƒçš„é«˜ 16 ä½åšå¼‚æˆ–å³å¯åˆ©ç”¨é«˜ä½çš„ hash å€¼ï¼Œé™ä½å“ˆå¸Œç¢°æ’æ¦‚ç‡ä¹Ÿä½¿æ•°æ®åˆ†å¸ƒæ›´åŠ å‡åŒ€ã€‚</li>\n</ol>\n<p><strong>ä¸ºä»€ä¹ˆç”¨å¼‚æˆ–</strong><br />\nä¿è¯äº†å¯¹è±¡çš„ hashCode çš„ 32 ä½å€¼åªè¦æœ‰ä¸€ä½å‘ç”Ÿæ”¹å˜ï¼Œæ•´ä¸ª hash () è¿”å›å€¼å°±ä¼šæ”¹å˜ã€‚å°½å¯èƒ½çš„å‡å°‘ç¢°æ’ã€‚</p>\n<h4 id=\"jdk7-å’Œ-jdk8-ä¸­-hashmap-çš„åŒºåˆ«\"><a class=\"anchor\" href=\"#jdk7-å’Œ-jdk8-ä¸­-hashmap-çš„åŒºåˆ«\">#</a> JDK7 å’Œ JDK8 ä¸­ HashMap çš„åŒºåˆ«</h4>\n<p>JDK7 ä¸­çš„ HashMap ï¼Œæ˜¯åŸºäºæ•°ç»„ + é“¾è¡¨æ¥å®ç°çš„ï¼Œå®ƒçš„åº•å±‚ç»´æŠ¤ä¸€ä¸ª Entry æ•°ç»„ã€‚å®ƒä¼šæ ¹æ®è®¡ç®—çš„ hashCode å°†å¯¹åº”çš„ KV é”®å€¼å¯¹å­˜å‚¨åˆ°è¯¥æ•°ç»„ä¸­ï¼Œä¸€æ—¦å‘ç”Ÿ hashCode å†²çªï¼Œé‚£ä¹ˆå°±ä¼šå°†è¯¥ KV é”®å€¼å¯¹æ”¾åˆ°å¯¹åº”çš„å·²æœ‰å…ƒç´ çš„åé¢ï¼Œ æ­¤æ—¶ä¾¿å½¢æˆäº†ä¸€ä¸ªé“¾è¡¨å¼çš„å­˜å‚¨ç»“æ„ã€‚JDK7 ä¸­ HashMap çš„å®ç°æ–¹æ¡ˆæœ‰ä¸€ä¸ªæ˜æ˜¾çš„ç¼ºç‚¹ï¼Œå³å½“ Hash å†²çªä¸¥é‡æ—¶ï¼Œåœ¨æ¡¶ä¸Šå½¢æˆçš„é“¾è¡¨ä¼šå˜å¾—è¶Šæ¥è¶Šé•¿ï¼Œè¿™æ ·åœ¨æŸ¥è¯¢æ—¶çš„æ•ˆç‡å°±ä¼šè¶Šæ¥è¶Šä½ï¼Œå…¶æ—¶é—´å¤æ‚åº¦ä¸º O (N) ã€‚</p>\n<p>JDK8 ä¸­çš„ HashMap ï¼Œæ˜¯åŸºäºæ•°ç»„ + é“¾è¡¨ + çº¢é»‘æ ‘æ¥å®ç°çš„ï¼Œå®ƒçš„åº•å±‚ç»´æŠ¤ä¸€ä¸ª Node æ•°ç»„ã€‚å½“é“¾è¡¨çš„å­˜å‚¨çš„æ•°æ®ä¸ªæ•°å¤§äºç­‰äº 8 çš„æ—¶å€™ï¼Œä¸å†é‡‡ç”¨é“¾è¡¨å­˜å‚¨ï¼Œè€Œé‡‡ç”¨äº†çº¢é»‘æ ‘å­˜å‚¨ç»“æ„ã€‚è¿™ä¹ˆåšä¸»è¦æ˜¯åœ¨æŸ¥è¯¢çš„æ—¶é—´å¤æ‚åº¦ä¸Šè¿›è¡Œä¼˜åŒ–ï¼Œé“¾è¡¨ä¸º O (N) ï¼Œè€Œçº¢é»‘æ ‘ä¸€ç›´æ˜¯ O (logN) ï¼Œå¯ä»¥å¤§å¤§çš„æé«˜æŸ¥æ‰¾æ€§èƒ½ã€‚</p>\n<h4 id=\"hashmap-æ‰©å®¹\"><a class=\"anchor\" href=\"#hashmap-æ‰©å®¹\">#</a> HashMap æ‰©å®¹</h4>\n<p><strong>JDK1.7 æ‰©å®¹</strong><br />\n JDK1.7 å‘ç”Ÿæ‰©å®¹çš„æ¡ä»¶å¿…é¡»åŒæ—¶æ»¡è¶³ä¸¤ç‚¹ï¼š</p>\n<ul>\n<li>å½“å‰å­˜å‚¨çš„æ•°é‡å¤§äºç­‰äºé˜ˆå€¼</li>\n<li>å‘ç”Ÿ hash ç¢°æ’</li>\n</ul>\n<p><strong>ç‰¹ç‚¹</strong>ï¼šå…ˆæ‰©å®¹ï¼Œå†æ·»åŠ ï¼ˆæ‰©å®¹ä½¿ç”¨çš„å¤´æ’æ³•ï¼‰<br />\n<strong>ç¼ºç‚¹</strong>ï¼šå¤´æ’æ³•ä¼šä½¿é“¾è¡¨å‘ç”Ÿåè½¬ï¼Œå¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¯èƒ½ä¼šæ­»å¾ªç¯<br />\n<strong>æ‰©å®¹ç»“æœ</strong>ï¼štable å®¹é‡å˜ä¸º 2 å€ï¼Œæ‰€æœ‰çš„å…ƒç´ ä¸‹æ ‡éœ€è¦é‡æ–°è®¡ç®—ï¼ŒnewIndex = hash ï¼ˆæ‰°åŠ¨åï¼‰ &amp; ï¼ˆnewLength - 1ï¼‰</p>\n<p><strong>JDK1.8 æ‰©å®¹</strong><br />\n JDK1.8 å‘ç”Ÿæ‰©å®¹çš„æ¡ä»¶éœ€æ»¡è¶³å…¶ä¸­ä¸€é¡¹ï¼š</p>\n<ul>\n<li>å½“å‰å­˜å‚¨çš„æ•°é‡å¤§äºç­‰äºé˜ˆå€¼</li>\n<li>å½“æŸä¸ªé“¾è¡¨é•¿åº¦ &gt;=8ï¼Œä½†æ˜¯æ•°ç»„å­˜å‚¨çš„ç»“ç‚¹æ•° size () &lt; 64 æ—¶</li>\n</ul>\n<p><strong>ç‰¹ç‚¹</strong>ï¼šå…ˆæ’ååˆ¤æ–­æ˜¯å¦éœ€è¦æ‰©å®¹ï¼ˆæ‰©å®¹æ—¶æ˜¯å°¾æ’æ³•ï¼‰<br />\n<strong>ç¼ºç‚¹</strong>ï¼šå¤šçº¿ç¨‹ä¸‹ï¼Œ1.8 ä¼šæœ‰æ•°æ®è¦†ç›–<br />\n table å®¹é‡å˜ä¸º 2 å€ï¼Œä½†æ˜¯ä¸éœ€è¦åƒä¹‹å‰ä¸€æ ·è®¡ç®—ä¸‹æ ‡ï¼Œåªéœ€è¦å°† hash å€¼å’Œæ—§æ•°ç»„é•¿åº¦ç›¸ä¸å³å¯ç¡®å®šä½ç½®ã€‚</p>\n<ul>\n<li>å¦‚æœ Node æ¡¶çš„æ•°æ®ç»“æ„æ˜¯é“¾è¡¨ä¼šç”Ÿæˆ low å’Œ high ä¸¤æ¡é“¾è¡¨ï¼Œæ˜¯çº¢é»‘æ ‘åˆ™ç”Ÿæˆ low å’Œ high ä¸¤é¢—çº¢é»‘æ ‘</li>\n<li>ä¾é  (hash &amp; oldCap) == 0 åˆ¤æ–­ Node ä¸­çš„æ¯ä¸ªç»“ç‚¹å½’å±äº low è¿˜æ˜¯ highã€‚</li>\n<li>æŠŠ low æ’å…¥åˆ° æ–°æ•°ç»„ä¸­ å½“å‰æ•°ç»„ä¸‹æ ‡çš„ä½ç½®ï¼ŒæŠŠ high é“¾è¡¨æ’å…¥åˆ° æ–°æ•°ç»„ä¸­ [å½“å‰æ•°ç»„ä¸‹æ ‡ + æ—§æ•°ç»„é•¿åº¦] çš„ä½ç½®</li>\n<li>å¦‚æœç”Ÿæˆçš„ lowï¼Œhigh æ ‘ä¸­å…ƒç´ ä¸ªæ•°å°äºç­‰äº 6 é€€åŒ–æˆé“¾è¡¨å†æ’å…¥åˆ°æ–°æ•°ç»„çš„ç›¸åº”ä¸‹æ ‡çš„ä½ç½®</li>\n</ul>\n<h4 id=\"é“¾è¡¨å‡çº§æˆçº¢é»‘æ ‘çš„æ¡ä»¶\"><a class=\"anchor\" href=\"#é“¾è¡¨å‡çº§æˆçº¢é»‘æ ‘çš„æ¡ä»¶\">#</a> é“¾è¡¨å‡çº§æˆçº¢é»‘æ ‘çš„æ¡ä»¶</h4>\n<p>é“¾è¡¨é•¿åº¦å¤§äº 8 æ—¶æ‰ä¼šè€ƒè™‘å‡çº§æˆçº¢é»‘æ ‘ï¼Œæ˜¯æœ‰ä¸€ä¸ªæ¡ä»¶æ˜¯ HashMap çš„ Node æ•°ç»„é•¿åº¦å¤§äºç­‰äº 64ï¼ˆä¸æ»¡è¶³åˆ™ä¼šè¿›è¡Œä¸€æ¬¡æ‰©å®¹æ›¿ä»£å‡çº§ï¼‰ã€‚</p>\n<h4 id=\"çº¢é»‘æ ‘é€€åŒ–æˆé“¾è¡¨çš„æ¡ä»¶\"><a class=\"anchor\" href=\"#çº¢é»‘æ ‘é€€åŒ–æˆé“¾è¡¨çš„æ¡ä»¶\">#</a> çº¢é»‘æ ‘é€€åŒ–æˆé“¾è¡¨çš„æ¡ä»¶</h4>\n<ul>\n<li>æ‰©å®¹ resize ( ) æ—¶ï¼Œçº¢é»‘æ ‘æ‹†åˆ†æˆçš„ æ ‘çš„ç»“ç‚¹æ•°å°äºç­‰äºä¸´ç•Œå€¼ 6 ä¸ªï¼Œåˆ™é€€åŒ–æˆé“¾è¡¨ã€‚</li>\n<li>åˆ é™¤å…ƒç´  remove () æ—¶ï¼Œåœ¨ removeTreeNode () æ–¹æ³•ä¼šæ£€æŸ¥çº¢é»‘æ ‘æ˜¯å¦æ»¡è¶³é€€åŒ–æ¡ä»¶ï¼Œä¸ç»“ç‚¹æ•°æ— å…³ã€‚å¦‚æœçº¢é»‘æ ‘æ ¹ root ä¸ºç©ºï¼Œæˆ–è€… root çš„å·¦å­æ ‘ / å³å­æ ‘ä¸ºç©ºï¼Œæˆ–è€… æ ¹çš„å·¦å­æ ‘çš„å·¦å­æ ‘ä¸ºç©ºï¼Œéƒ½ä¼šå‘ç”Ÿçº¢é»‘æ ‘é€€åŒ–æˆé“¾è¡¨ã€‚<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>root <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">||</span> root<span class=\"token punctuation\">.</span>right <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">||</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token punctuation\">(</span>rl <span class=\"token operator\">=</span> root<span class=\"token punctuation\">.</span>left<span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">||</span> rl<span class=\"token punctuation\">.</span>left <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    tab<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> first<span class=\"token punctuation\">.</span><span class=\"token function\">untreeify</span><span class=\"token punctuation\">(</span>map<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// too small</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n</ul>\n<h3 id=\"concurrenthashmap\"><a class=\"anchor\" href=\"#concurrenthashmap\">#</a> ConcurrentHashMap</h3>\n<h4 id=\"jdk-17-ä¸­çš„å®ç°\"><a class=\"anchor\" href=\"#jdk-17-ä¸­çš„å®ç°\">#</a> JDK 1.7 ä¸­çš„å®ç°ï¼š</h4>\n<p>åœ¨ jdk 1.7 ä¸­ï¼ŒConcurrentHashMap æ˜¯ç”± Segment æ•°æ®ç»“æ„å’Œ HashEntry æ•°ç»„ç»“æ„æ„æˆï¼Œé‡‡å–åˆ†æ®µé”æ¥ä¿è¯å®‰å…¨æ€§ã€‚Segment æ˜¯ ReentrantLock é‡å…¥é”ï¼Œåœ¨ ConcurrentHashMap ä¸­æ‰®æ¼”é”çš„è§’è‰²ï¼ŒHashEntry åˆ™ç”¨äºå­˜å‚¨é”®å€¼å¯¹æ•°æ®ã€‚ä¸€ä¸ª ConcurrentHashMap é‡ŒåŒ…å«ä¸€ä¸ª Segment æ•°ç»„ï¼Œä¸€ä¸ª Segment é‡ŒåŒ…å«ä¸€ä¸ª HashEntry æ•°ç»„ï¼ŒSegment çš„ç»“æ„å’Œ HashMap ç±»ä¼¼ï¼Œæ˜¯ä¸€ä¸ªæ•°ç»„å’Œé“¾è¡¨ç»“æ„ã€‚<br />\n<img data-src=\"https://uploadfiles.nowcoder.com/images/20220224/4107856_1645689003626/A064CF0DD49D1B3694548913C28728DB\" alt=\"ConcurrentHashMap-jdk1.7\" /><br />\nJDK1.7 ä¸­çš„å¹¶å‘æ–¹å¼åªæ˜¯ç›¸å½“äºåœ¨ä¸€ä¸ª HashMap ä¸­åŒ…å«å¤šä¸ª HashMap ï¼Œåœ¨å¯¹ä¸åŒ HashMap çš„è®¿é—®ä¸Šèƒ½å¤Ÿæä¾›å¹¶å‘ï¼Œå¹¶å‘åº¦å–å†³äº Segment æ•°ç»„çš„é•¿åº¦ã€‚</p>\n<h4 id=\"jdk-18-ä¸­çš„å®ç°\"><a class=\"anchor\" href=\"#jdk-18-ä¸­çš„å®ç°\">#</a> JDK 1.8 ä¸­çš„å®ç°ï¼š</h4>\n<p>JDK1.8 çš„å®ç°å·²ç»æ‘’å¼ƒäº† Segment çš„æ¦‚å¿µï¼Œè€Œæ˜¯ç›´æ¥ç”¨ Node æ•°ç»„ + é“¾è¡¨ + çº¢é»‘æ ‘çš„æ•°æ®ç»“æ„æ¥å®ç°ï¼Œå¹¶å‘æ§åˆ¶ä½¿ç”¨ Synchronized å’Œ CAS æ¥æ“ä½œï¼Œæ•´ä¸ªçœ‹èµ·æ¥å°±åƒæ˜¯ä¼˜åŒ–è¿‡ä¸”çº¿ç¨‹å®‰å…¨çš„ HashMapï¼Œè™½ç„¶åœ¨ JDK1.8 ä¸­è¿˜èƒ½çœ‹åˆ° Segment çš„æ•°æ®ç»“æ„ï¼Œä½†æ˜¯å·²ç»ç®€åŒ–äº†å±æ€§ï¼Œåªæ˜¯ä¸ºäº†å…¼å®¹æ—§ç‰ˆæœ¬ã€‚<br />\n<img data-src=\"https://uploadfiles.nowcoder.com/images/20220224/4107856_1645689024609/9C8ABF1CD3475339A49DE3B9E1696FE7\" alt=\"ConcurrentHashMap-jdk1.8\" /></p>\n<h3 id=\"linkedhashmap\"><a class=\"anchor\" href=\"#linkedhashmap\">#</a> LinkedHashMap</h3>\n<ul>\n<li>LinkedHashMap ä½¿ç”¨åŒå‘é“¾è¡¨æ¥ç»´æŠ¤ key-value å¯¹çš„é¡ºåºï¼ˆå…¶å®åªéœ€è¦è€ƒè™‘ key çš„é¡ºåºï¼‰ï¼Œè¯¥é“¾è¡¨è´Ÿè´£ç»´æŠ¤ Map çš„è¿­ä»£é¡ºåºï¼Œè¿­ä»£é¡ºåºä¸ key-value å¯¹çš„æ’å…¥é¡ºåºä¿æŒä¸€è‡´ã€‚åœ¨å®ç°ä¸Šï¼ŒLinkedHashMap å¾ˆå¤šæ–¹æ³•ç›´æ¥ç»§æ‰¿è‡ª HashMapï¼Œä»…ä¸ºç»´æŠ¤åŒå‘é“¾è¡¨é‡å†™äº†éƒ¨åˆ†æ–¹æ³•ã€‚</li>\n<li>LinkedHashMap å¯ä»¥é¿å…å¯¹ HashMap ã€Hashtable é‡Œçš„ key-value å¯¹è¿›è¡Œæ’åºï¼ˆåªè¦æ’å…¥ key-value å¯¹æ—¶ä¿æŒé¡ºåºå³å¯ï¼‰ï¼ŒåŒæ—¶åˆå¯é¿å…ä½¿ç”¨ TreeMap æ‰€å¢åŠ çš„æˆæœ¬ã€‚</li>\n<li>LinkedHashMap éœ€è¦ç»´æŠ¤å…ƒç´ çš„æ’å…¥é¡ºåºï¼Œå› æ­¤æ€§èƒ½ç•¥ä½äº HashMap çš„æ€§èƒ½ã€‚ä½†å› ä¸ºå®ƒä»¥é“¾è¡¨æ¥ç»´æŠ¤å†…éƒ¨é¡ºåºï¼Œæ‰€ä»¥åœ¨è¿­ä»£è®¿é—® Map é‡Œçš„å…¨éƒ¨å…ƒç´ æ—¶å°†æœ‰è¾ƒå¥½çš„æ€§èƒ½ã€‚</li>\n</ul>\n<h3 id=\"copyonwritearraylist\"><a class=\"anchor\" href=\"#copyonwritearraylist\">#</a> CopyOnWriteArrayList</h3>\n<p>CopyOnWriteArrayList å…è®¸çº¿ç¨‹å¹¶å‘è®¿é—®è¯»æ“ä½œï¼Œè¿™ä¸ªæ—¶å€™æ˜¯æ²¡æœ‰åŠ é”é™åˆ¶çš„ï¼Œæ€§èƒ½è¾ƒé«˜ã€‚è€Œå†™æ“ä½œçš„æ—¶å€™ï¼Œåˆ™é¦–å…ˆå°†å®¹å™¨å¤åˆ¶ä¸€ä»½ï¼Œç„¶ååœ¨æ–°çš„å‰¯æœ¬ä¸Šæ‰§è¡Œå†™æ“ä½œï¼Œè¿™ä¸ªæ—¶å€™å†™æ“ä½œæ˜¯ä¸Šé”çš„ã€‚ç»“æŸä¹‹åå†å°†åŸå®¹å™¨çš„å¼•ç”¨æŒ‡å‘æ–°å®¹å™¨ã€‚æ³¨æ„ï¼Œåœ¨ä¸Šé”æ‰§è¡Œå†™æ“ä½œçš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæœ‰éœ€è¦è¯»æ“ä½œï¼Œä¼šä½œç”¨åœ¨åŸå®¹å™¨ä¸Šã€‚å› æ­¤ä¸Šé”çš„å†™æ“ä½œä¸ä¼šå½±å“åˆ°å¹¶å‘è®¿é—®çš„è¯»æ“ä½œã€‚</p>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">private</span> <span class=\"token class-name\">E</span> <span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Object</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> a<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> index<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">E</span><span class=\"token punctuation\">)</span> a<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token keyword\">boolean</span> <span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">E</span> e<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">synchronized</span> <span class=\"token punctuation\">(</span>lock<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token class-name\">Object</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> elements <span class=\"token operator\">=</span> <span class=\"token function\">getArray</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token keyword\">int</span> len <span class=\"token operator\">=</span> elements<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token class-name\">Object</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> newElements <span class=\"token operator\">=</span> <span class=\"token class-name\">Arrays</span><span class=\"token punctuation\">.</span><span class=\"token function\">copyOf</span><span class=\"token punctuation\">(</span>elements<span class=\"token punctuation\">,</span> len <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            newElements<span class=\"token punctuation\">[</span>len<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> e<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token function\">setArray</span><span class=\"token punctuation\">(</span>newElements<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token keyword\">return</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">public</span> <span class=\"token class-name\">E</span> <span class=\"token function\">remove</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> index<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token keyword\">synchronized</span> <span class=\"token punctuation\">(</span>lock<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token class-name\">Object</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> elements <span class=\"token operator\">=</span> <span class=\"token function\">getArray</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token keyword\">int</span> len <span class=\"token operator\">=</span> elements<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token class-name\">E</span> oldValue <span class=\"token operator\">=</span> <span class=\"token function\">get</span><span class=\"token punctuation\">(</span>elements<span class=\"token punctuation\">,</span> index<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token keyword\">int</span> numMoved <span class=\"token operator\">=</span> len <span class=\"token operator\">-</span> index <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>numMoved <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                <span class=\"token function\">setArray</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Arrays</span><span class=\"token punctuation\">.</span><span class=\"token function\">copyOf</span><span class=\"token punctuation\">(</span>elements<span class=\"token punctuation\">,</span> len <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                <span class=\"token class-name\">Object</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> newElements <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Object</span><span class=\"token punctuation\">[</span>len <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">arraycopy</span><span class=\"token punctuation\">(</span>elements<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> newElements<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> index<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span><span class=\"token function\">arraycopy</span><span class=\"token punctuation\">(</span>elements<span class=\"token punctuation\">,</span> index <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> newElements<span class=\"token punctuation\">,</span> index<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>                                 numMoved<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>                <span class=\"token function\">setArray</span><span class=\"token punctuation\">(</span>newElements<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            <span class=\"token keyword\">return</span> oldValue<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"blockingqueue\"><a class=\"anchor\" href=\"#blockingqueue\">#</a> BlockingQueue</h3>\n<table>\n<thead>\n<tr>\n<th>å®ç°ç±»</th>\n<th>åŠŸèƒ½</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>ArrayBlockingQueue</td>\n<td>åŸºäºæ•°ç»„çš„é˜»å¡é˜Ÿåˆ—ï¼Œä½¿ç”¨æ•°ç»„å­˜å‚¨æ•°æ®ï¼Œå¹¶éœ€è¦æŒ‡å®šå…¶é•¿åº¦ï¼Œæ‰€ä»¥æ˜¯ä¸€ä¸ªæœ‰ç•Œé˜Ÿåˆ—</td>\n</tr>\n<tr>\n<td>LinkedBlockingQueue</td>\n<td>åŸºäºé“¾è¡¨çš„é˜»å¡é˜Ÿåˆ—ï¼Œä½¿ç”¨é“¾è¡¨å­˜å‚¨æ•°æ®ï¼Œé»˜è®¤æ˜¯ä¸€ä¸ªæ— ç•Œé˜Ÿåˆ—ï¼›ä¹Ÿå¯ä»¥é€šè¿‡æ„é€ æ–¹æ³•ä¸­çš„ capacity è®¾ç½®æœ€å¤§å…ƒç´ æ•°é‡ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥ä½œä¸ºæœ‰ç•Œé˜Ÿåˆ—</td>\n</tr>\n<tr>\n<td>SynchronousQueue</td>\n<td>ä¸€ç§æ²¡æœ‰ç¼“å†²çš„é˜Ÿåˆ—ï¼Œç”Ÿäº§è€…äº§ç”Ÿçš„æ•°æ®ç›´æ¥ä¼šè¢«æ¶ˆè´¹è€…è·å–å¹¶ä¸”ç«‹åˆ»æ¶ˆè´¹</td>\n</tr>\n<tr>\n<td>PriorityBlockingQueue</td>\n<td>åŸºäºä¼˜å…ˆçº§åˆ«çš„é˜»å¡é˜Ÿåˆ—ï¼Œåº•å±‚åŸºäºæ•°ç»„å®ç°ï¼Œæ˜¯ä¸€ä¸ªæ— ç•Œé˜Ÿåˆ— DelayQueue å»¶è¿Ÿé˜Ÿåˆ—ï¼Œå…¶ä¸­çš„å…ƒç´ åªæœ‰åˆ°äº†å…¶æŒ‡å®šçš„å»¶è¿Ÿæ—¶é—´ï¼Œæ‰èƒ½å¤Ÿä»é˜Ÿåˆ—ä¸­å‡ºé˜Ÿ</td>\n</tr>\n</tbody>\n</table>\n<p>å£°æ˜ä¸€ä¸ª SynchronousQueue æœ‰ä¸¤ç§ä¸åŒçš„æ–¹å¼ï¼Œå®ƒä»¬ä¹‹é—´æœ‰ç€ä¸å¤ªä¸€æ ·çš„è¡Œä¸ºã€‚å…¬å¹³æ¨¡å¼å’Œéå…¬å¹³æ¨¡å¼çš„åŒºåˆ«ï¼šå¦‚æœé‡‡ç”¨å…¬å¹³æ¨¡å¼ï¼šSynchronousQueue ä¼šé‡‡ç”¨å…¬å¹³é”ï¼Œå¹¶é…åˆä¸€ä¸ª TransferQueue æ¥é˜»å¡å¤šä½™çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ï¼Œä»è€Œä½“ç³»æ•´ä½“çš„å…¬å¹³ç­–ç•¥ï¼›ä½†å¦‚æœæ˜¯éå…¬å¹³æ¨¡å¼ï¼ˆSynchronousQueue é»˜è®¤ï¼‰ï¼šSynchronousQueue é‡‡ç”¨éå…¬å¹³é”ï¼ŒåŒæ—¶é…åˆä¸€ä¸ª TransferStack æ¥ç®¡ç†å¤šä½™çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ï¼Œè€Œåä¸€ç§æ¨¡å¼ï¼Œå¦‚æœç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„å¤„ç†é€Ÿåº¦æœ‰å·®è·ï¼Œåˆ™å¾ˆå®¹æ˜“å‡ºç°é¥¥æ¸´çš„æƒ…å†µï¼Œå³å¯èƒ½æœ‰æŸäº›ç”Ÿäº§è€…æˆ–è€…æ˜¯æ¶ˆè´¹è€…çš„æ•°æ®æ°¸è¿œéƒ½å¾—ä¸åˆ°å¤„ç†ã€‚</p>\n<h2 id=\"thread\"><a class=\"anchor\" href=\"#thread\">#</a> Thread</h2>\n<h3 id=\"è¿›ç¨‹ä¸çº¿ç¨‹çš„åŒºåˆ«\"><a class=\"anchor\" href=\"#è¿›ç¨‹ä¸çº¿ç¨‹çš„åŒºåˆ«\">#</a> è¿›ç¨‹ä¸çº¿ç¨‹çš„åŒºåˆ«</h3>\n<p><strong>æ ¹æœ¬åŒºåˆ«</strong>ï¼šè¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿèµ„æºåˆ†é…çš„åŸºæœ¬å•ä½ï¼Œè€Œçº¿ç¨‹æ˜¯å¤„ç†å™¨ä»»åŠ¡è°ƒåº¦å’Œæ‰§è¡Œçš„åŸºæœ¬å•ä½ã€‚<br />\n<strong>èµ„æºå¼€é”€</strong>ï¼šæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ç‹¬ç«‹çš„ä»£ç å’Œæ•°æ®ç©ºé—´ï¼ˆç¨‹åºä¸Šä¸‹æ–‡ï¼‰ï¼Œç¨‹åºä¹‹é—´çš„åˆ‡æ¢ä¼šæœ‰è¾ƒå¤§çš„å¼€é”€ï¼›çº¿ç¨‹å¯ä»¥çœ‹åšè½»é‡çº§çš„è¿›ç¨‹ï¼ŒåŒä¸€ç±»çº¿ç¨‹å…±äº«ä»£ç å’Œæ•°æ®ç©ºé—´ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„è¿è¡Œæ ˆå’Œç¨‹åºè®¡æ•°å™¨ï¼ˆPCï¼‰ï¼Œçº¿ç¨‹ä¹‹é—´åˆ‡æ¢çš„å¼€é”€å°ã€‚<br />\n<strong>åŒ…å«å…³ç³»</strong>ï¼šå¦‚æœä¸€ä¸ªè¿›ç¨‹å†…æœ‰å¤šä¸ªçº¿ç¨‹ï¼Œåˆ™æ‰§è¡Œè¿‡ç¨‹ä¸æ˜¯ä¸€æ¡çº¿çš„ï¼Œè€Œæ˜¯å¤šæ¡çº¿ï¼ˆçº¿ç¨‹ï¼‰å…±åŒå®Œæˆçš„ï¼›çº¿ç¨‹æ˜¯è¿›ç¨‹çš„ä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥çº¿ç¨‹ä¹Ÿè¢«ç§°ä¸ºè½»æƒè¿›ç¨‹æˆ–è€…è½»é‡çº§è¿›ç¨‹ã€‚<br />\n<strong>å†…å­˜åˆ†é…</strong>ï¼šåŒä¸€è¿›ç¨‹çš„çº¿ç¨‹å…±äº«æœ¬è¿›ç¨‹çš„åœ°å€ç©ºé—´å’Œèµ„æºï¼Œè€Œè¿›ç¨‹ä¹‹é—´çš„åœ°å€ç©ºé—´å’Œèµ„æºæ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚<br />\n<strong>å½±å“å…³ç³»</strong>ï¼šä¸€ä¸ªè¿›ç¨‹å´©æºƒåï¼Œåœ¨ä¿æŠ¤æ¨¡å¼ä¸‹ä¸ä¼šå¯¹å…¶ä»–è¿›ç¨‹äº§ç”Ÿå½±å“ï¼Œä½†æ˜¯ä¸€ä¸ªçº¿ç¨‹å´©æºƒæ•´ä¸ªè¿›ç¨‹éƒ½æ­»æ‰ã€‚æ‰€ä»¥å¤šè¿›ç¨‹è¦æ¯”å¤šçº¿ç¨‹å¥å£®ã€‚<br />\n<strong>æ‰§è¡Œè¿‡ç¨‹</strong>ï¼šæ¯ä¸ªç‹¬ç«‹çš„è¿›ç¨‹æœ‰ç¨‹åºè¿è¡Œçš„å…¥å£ã€é¡ºåºæ‰§è¡Œåºåˆ—å’Œç¨‹åºå‡ºå£ã€‚ä½†æ˜¯çº¿ç¨‹ä¸èƒ½ç‹¬ç«‹æ‰§è¡Œï¼Œå¿…é¡»ä¾å­˜åœ¨åº”ç”¨ç¨‹åºä¸­ï¼Œç”±åº”ç”¨ç¨‹åºæä¾›å¤šä¸ªçº¿ç¨‹æ‰§è¡Œæ§åˆ¶ï¼Œä¸¤è€…å‡å¯å¹¶å‘æ‰§è¡Œã€‚</p>\n<h3 id=\"åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼\"><a class=\"anchor\" href=\"#åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼\">#</a> åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼</h3>\n<p>åˆ›å»ºçº¿ç¨‹æœ‰ä¸‰ç§æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯ç»§æ‰¿ Thread ç±»ã€å®ç° Runnable æ¥å£ã€å®ç° Callable æ¥å£ã€‚</p>\n<ul>\n<li>é€šè¿‡ç»§æ‰¿ Thread ç±»æ¥åˆ›å»ºå¹¶å¯åŠ¨çº¿ç¨‹çš„æ­¥éª¤å¦‚ä¸‹ï¼š\n<ul>\n<li>å®šä¹‰ Thread ç±»çš„å­ç±»ï¼Œå¹¶é‡å†™è¯¥ç±»çš„ run () æ–¹æ³•ï¼Œè¯¥ run () æ–¹æ³•å°†ä½œä¸ºçº¿ç¨‹æ‰§è¡Œä½“ã€‚</li>\n<li>åˆ›å»º Thread å­ç±»çš„å®ä¾‹ï¼Œå³åˆ›å»ºäº†çº¿ç¨‹å¯¹è±¡ã€‚</li>\n<li>è°ƒç”¨çº¿ç¨‹å¯¹è±¡çš„ start () æ–¹æ³•æ¥å¯åŠ¨è¯¥çº¿ç¨‹ã€‚</li>\n</ul>\n</li>\n<li>é€šè¿‡å®ç° Runnable æ¥å£æ¥åˆ›å»ºå¹¶å¯åŠ¨çº¿ç¨‹çš„æ­¥éª¤å¦‚ä¸‹ï¼š\n<ul>\n<li>å®šä¹‰ Runnable æ¥å£çš„å®ç°ç±»ï¼Œå¹¶å®ç°è¯¥æ¥å£çš„ run () æ–¹æ³•ï¼Œè¯¥ run () æ–¹æ³•å°†ä½œä¸ºçº¿ç¨‹æ‰§è¡Œä½“ã€‚</li>\n<li>åˆ›å»º Runnable å®ç°ç±»çš„å®ä¾‹ï¼Œå¹¶å°†å…¶ä½œä¸º Thread çš„ target æ¥åˆ›å»º Threa d å¯¹è±¡ï¼ŒThread å¯¹è±¡ä¸ºçº¿ç¨‹å¯¹è±¡ã€‚</li>\n<li>è°ƒç”¨çº¿ç¨‹å¯¹è±¡çš„ start () æ–¹æ³•æ¥å¯åŠ¨è¯¥çº¿ç¨‹ã€‚</li>\n</ul>\n</li>\n<li>é€šè¿‡å®ç° Callable æ¥å£æ¥åˆ›å»ºå¹¶å¯åŠ¨çº¿ç¨‹çš„æ­¥éª¤å¦‚ä¸‹ï¼š\n<ul>\n<li>åˆ›å»º Callable æ¥å£çš„å®ç°ç±»ï¼Œå¹¶å®ç° call () æ–¹æ³•ï¼Œè¯¥ call () æ–¹æ³•å°†ä½œä¸ºçº¿ç¨‹æ‰§è¡Œä½“ï¼Œä¸”è¯¥ call () æ–¹æ³•æœ‰è¿”å›å€¼ã€‚ç„¶åå†åˆ›å»º Callable å®ç°ç±»çš„å®ä¾‹ã€‚</li>\n<li>ä½¿ç”¨ FutureTask ç±»æ¥åŒ…è£… Callable å¯¹è±¡ï¼Œè¯¥ FutureTask å¯¹è±¡å°è£…äº†è¯¥ Callable å¯¹è±¡çš„ call () æ–¹æ³•çš„è¿”å›å€¼ã€‚</li>\n<li>ä½¿ç”¨ FutureTask å¯¹è±¡ä½œä¸º Thread å¯¹è±¡çš„ target åˆ›å»ºå¹¶å¯åŠ¨æ–°çº¿ç¨‹ã€‚</li>\n<li>è°ƒç”¨ FutureTask å¯¹è±¡çš„ get () æ–¹æ³•æ¥è·å¾—å­çº¿ç¨‹æ‰§è¡Œç»“æŸåçš„è¿”å›å€¼ã€‚</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"run-start\"><a class=\"anchor\" href=\"#run-start\">#</a> run() &amp; start()</h3>\n<p>run () æ–¹æ³•è¢«ç§°ä¸ºçº¿ç¨‹æ‰§è¡Œä½“ï¼Œå®ƒçš„æ–¹æ³•ä½“ä»£è¡¨äº†çº¿ç¨‹éœ€è¦å®Œæˆçš„ä»»åŠ¡ï¼Œè€Œ start () æ–¹æ³•ç”¨æ¥å¯åŠ¨çº¿ç¨‹ã€‚<br />\nstart () æ–¹æ³•ç”¨äºå¯åŠ¨çº¿ç¨‹ï¼Œrun () æ–¹æ³•ç”¨äºæ‰§è¡Œçº¿ç¨‹çš„è¿è¡Œæ—¶ä»£ç ã€‚ä½†å¦‚æœç›´æ¥è°ƒç”¨çº¿ç¨‹å¯¹è±¡çš„ run () æ–¹æ³•ï¼Œåˆ™ run () æ–¹æ³•ç«‹å³å°±ä¼šè¢«æ‰§è¡Œï¼Œè€Œä¸”åœ¨ run () æ–¹æ³•è¿”å›ä¹‹å‰å…¶ä»–çº¿ç¨‹æ— æ³•å¹¶å‘æ‰§è¡Œã€‚run () å¯ä»¥é‡å¤è°ƒç”¨ï¼Œè€Œ start () åªèƒ½è°ƒç”¨ä¸€æ¬¡ã€‚</p>\n<h3 id=\"thread-æ˜¯å¦èƒ½é‡æ–°å¯åŠ¨\"><a class=\"anchor\" href=\"#thread-æ˜¯å¦èƒ½é‡æ–°å¯åŠ¨\">#</a> Thread æ˜¯å¦èƒ½é‡æ–°å¯åŠ¨</h3>\n<p>åªèƒ½å¯¹å¤„äºæ–°å»ºçŠ¶æ€çš„çº¿ç¨‹è°ƒç”¨ start () æ–¹æ³•ï¼Œå¦åˆ™å°†å¼•å‘ IllegalThreadStateException å¼‚å¸¸ã€‚<br />\nå¦‚æœæƒ³é‡ç”¨ä¸€ä¸ªè¿‡ç¨‹ï¼Œå¯ä»¥æŠŠçº¿ç¨‹é€»è¾‘å®šä¹‰åœ¨ Runnable å¯¹è±¡é‡Œé¢ï¼Œé€šè¿‡æ–°å»º Thread å¯¹è±¡è¾¾åˆ°é‡æ–°å¯åŠ¨é€»è¾‘çš„æ•ˆæœã€‚</p>\n<h3 id=\"thread-çš„äº”ç§çŠ¶æ€\"><a class=\"anchor\" href=\"#thread-çš„äº”ç§çŠ¶æ€\">#</a> Thread çš„äº”ç§çŠ¶æ€</h3>\n<p>åœ¨çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œå®ƒè¦ç»è¿‡æ–°å»ºï¼ˆNewï¼‰ã€å°±ç»ªï¼ˆReadyï¼‰ã€è¿è¡Œï¼ˆRunningï¼‰ã€é˜»å¡ï¼ˆBlockedï¼‰å’Œæ­»äº¡ï¼ˆDeadï¼‰5 ç§çŠ¶æ€ã€‚<br />\n<img data-src=\"https://uploadfiles.nowcoder.com/images/20220224/4107856_1645689998870/B6700F052B8C52C28D140E41896513FE\" alt=\"çº¿ç¨‹ 5 ç§çŠ¶æ€çš„è½¬æ¢å…³ç³»\" /></p>\n<h3 id=\"äº§ç”Ÿæ­»é”çš„å››ä¸ªå¿…è¦æ¡ä»¶\"><a class=\"anchor\" href=\"#äº§ç”Ÿæ­»é”çš„å››ä¸ªå¿…è¦æ¡ä»¶\">#</a> äº§ç”Ÿæ­»é”çš„å››ä¸ªå¿…è¦æ¡ä»¶ï¼š</h3>\n<ul>\n<li><strong>äº’æ–¥æ¡ä»¶</strong>ï¼šä¸€ä¸ªèµ„æºæ¯æ¬¡åªèƒ½è¢«ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨ã€‚</li>\n<li><strong>è¯·æ±‚ä¸ä¿æŒæ¡ä»¶</strong>ï¼šä¸€ä¸ªè¿›ç¨‹å› è¯·æ±‚èµ„æºè€Œé˜»å¡æ—¶ï¼Œå¯¹å·²è·å¾—çš„èµ„æºä¿æŒä¸æ”¾ã€‚</li>\n<li><strong>ä¸å‰¥å¤ºæ¡ä»¶</strong>ï¼šè¿›ç¨‹å·²è·å¾—çš„èµ„æºï¼Œåœ¨æœ«ä½¿ç”¨å®Œä¹‹å‰ï¼Œä¸èƒ½å¼ºè¡Œå‰¥å¤ºã€‚</li>\n<li><strong>å¾ªç¯ç­‰å¾…æ¡ä»¶</strong>ï¼šè‹¥å¹²è¿›ç¨‹ä¹‹é—´å½¢æˆä¸€ç§å¤´å°¾ç›¸æ¥çš„å¾ªç¯ç­‰å¾…èµ„æºå…³ç³»ã€‚</li>\n</ul>\n<h3 id=\"sleep-å’Œ-wait-æœ‰ä»€ä¹ˆåŒºåˆ«\"><a class=\"anchor\" href=\"#sleep-å’Œ-wait-æœ‰ä»€ä¹ˆåŒºåˆ«\">#</a> sleep () å’Œ wait () æœ‰ä»€ä¹ˆåŒºåˆ«</h3>\n<ul>\n<li>ç±»çš„ä¸åŒï¼šsleep () æ¥è‡ª Threadï¼Œwait () æ¥è‡ª Objectã€‚</li>\n<li>é‡Šæ”¾é”ï¼šsleep () ä¸é‡Šæ”¾é”ï¼›wait () é‡Šæ”¾é”ã€‚</li>\n<li>ç”¨æ³•ä¸åŒï¼šsleep () æ—¶é—´åˆ°ä¼šè‡ªåŠ¨æ¢å¤ï¼›wait () å¯ä»¥ä½¿ç”¨ notify () /notifyAll () ç›´æ¥å”¤é†’ã€‚</li>\n</ul>\n<h3 id=\"é”å‡çº§\"><a class=\"anchor\" href=\"#é”å‡çº§\">#</a> é”å‡çº§</h3>\n<p>synchronized é”å‡çº§åŸç†ï¼šåœ¨é”å¯¹è±¡çš„å¯¹è±¡å¤´é‡Œé¢æœ‰ä¸€ä¸ª threadid å­—æ®µï¼Œåœ¨ç¬¬ä¸€æ¬¡è®¿é—®çš„æ—¶å€™ threadid ä¸ºç©ºï¼Œjvm è®©å…¶æŒæœ‰åå‘é”ï¼Œå¹¶å°† threadid è®¾ç½®ä¸ºå…¶çº¿ç¨‹ idï¼Œå†æ¬¡è¿›å…¥çš„æ—¶å€™ä¼šå…ˆåˆ¤æ–­ threadid æ˜¯å¦ä¸å…¶çº¿ç¨‹ id ä¸€è‡´ï¼Œå¦‚æœä¸€è‡´åˆ™å¯ä»¥ç›´æ¥ä½¿ç”¨æ­¤å¯¹è±¡ï¼Œå¦‚æœä¸ä¸€è‡´ï¼Œåˆ™å‡çº§åå‘é”ä¸ºè½»é‡çº§é”ï¼Œé€šè¿‡è‡ªæ—‹å¾ªç¯ä¸€å®šæ¬¡æ•°æ¥è·å–é”ï¼Œæ‰§è¡Œä¸€å®šæ¬¡æ•°ä¹‹åï¼Œå¦‚æœè¿˜æ²¡æœ‰æ­£å¸¸è·å–åˆ°è¦ä½¿ç”¨çš„å¯¹è±¡ï¼Œæ­¤æ—¶å°±ä¼šæŠŠé”ä»è½»é‡çº§å‡çº§ä¸ºé‡é‡çº§é”ï¼Œæ­¤è¿‡ç¨‹å°±æ„æˆäº† synchronized é”çš„å‡çº§ã€‚</p>\n<h2 id=\"threadpool\"><a class=\"anchor\" href=\"#threadpool\">#</a> ThreadPool</h2>\n<h3 id=\"çº¿ç¨‹æ± çš„å‚æ•°\"><a class=\"anchor\" href=\"#çº¿ç¨‹æ± çš„å‚æ•°\">#</a> çº¿ç¨‹æ± çš„å‚æ•°</h3>\n<figure class=\"highlight java\"><figcaption data-lang=\"java\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">public</span> <span class=\"token class-name\">ThreadPoolExecutor</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> corePoolSize<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>                            <span class=\"token keyword\">int</span> maximumPoolSize<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>                            <span class=\"token keyword\">long</span> keepAliveTime<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>                            <span class=\"token class-name\">TimeUnit</span> unit<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>                            <span class=\"token class-name\">BlockingQueue</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Runnable</span><span class=\"token punctuation\">></span></span> workQueue<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                            <span class=\"token class-name\">ThreadFactory</span> threadFactory<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                            <span class=\"token class-name\">RejectedExecutionHandler</span> handler<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>corePoolSize <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span> <span class=\"token operator\">||</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        maximumPoolSize <span class=\"token operator\">&lt;=</span> <span class=\"token number\">0</span> <span class=\"token operator\">||</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        maximumPoolSize <span class=\"token operator\">&lt;</span> corePoolSize <span class=\"token operator\">||</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        keepAliveTime <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalArgumentException</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>workQueue <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">||</span> threadFactory <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span> <span class=\"token operator\">||</span> handler <span class=\"token operator\">==</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">NullPointerException</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>corePoolSize <span class=\"token operator\">=</span> corePoolSize<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>maximumPoolSize <span class=\"token operator\">=</span> maximumPoolSize<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>workQueue <span class=\"token operator\">=</span> workQueue<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>keepAliveTime <span class=\"token operator\">=</span> unit<span class=\"token punctuation\">.</span><span class=\"token function\">toNanos</span><span class=\"token punctuation\">(</span>keepAliveTime<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>threadFactory <span class=\"token operator\">=</span> threadFactory<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>handler <span class=\"token operator\">=</span> handler<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li><strong>corePoolSize</strong>ï¼ˆæ ¸å¿ƒå·¥ä½œçº¿ç¨‹æ•°ï¼‰ï¼šå½“å‘çº¿ç¨‹æ± æäº¤ä¸€ä¸ªä»»åŠ¡æ—¶ï¼Œè‹¥çº¿ç¨‹æ± å·²åˆ›å»ºçš„çº¿ç¨‹æ•°å°äº corePoolSizeï¼Œå³ä¾¿æ­¤æ—¶å­˜åœ¨ç©ºé—²çº¿ç¨‹ï¼Œä¹Ÿä¼šé€šè¿‡åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹æ¥æ‰§è¡Œè¯¥ä»»åŠ¡ï¼Œç›´åˆ°å·²åˆ›å»ºçš„çº¿ç¨‹æ•°å¤§äºæˆ–ç­‰äº corePoolSize æ—¶ã€‚</li>\n<li><strong>maximumPoolSize</strong>ï¼ˆæœ€å¤§çº¿ç¨‹æ•°ï¼‰ï¼šçº¿ç¨‹æ± æ‰€å…è®¸çš„æœ€å¤§çº¿ç¨‹ä¸ªæ•°ã€‚å½“é˜Ÿåˆ—æ»¡äº†ï¼Œä¸”å·²åˆ›å»ºçš„çº¿ç¨‹æ•°å°äº maximumPoolSizeï¼Œåˆ™çº¿ç¨‹æ± ä¼šåˆ›å»ºæ–°çš„çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ã€‚å¦å¤–ï¼Œå¯¹äºæ— ç•Œé˜Ÿåˆ—ï¼Œå¯å¿½ç•¥è¯¥å‚æ•°ã€‚</li>\n<li><strong>keepAliveTime</strong>ï¼ˆå¤šä½™çº¿ç¨‹å­˜æ´»æ—¶é—´ï¼‰ï¼šå½“çº¿ç¨‹æ± ä¸­çº¿ç¨‹æ•°å¤§äºæ ¸å¿ƒçº¿ç¨‹æ•°æ—¶ï¼Œçº¿ç¨‹çš„ç©ºé—²æ—¶é—´å¦‚æœè¶…è¿‡çº¿ç¨‹å­˜æ´»æ—¶é—´ï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹å°±ä¼šè¢«é”€æ¯ï¼Œç›´åˆ°çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°å°äºç­‰äºæ ¸å¿ƒçº¿ç¨‹æ•°ã€‚</li>\n<li><strong>workQueue</strong>ï¼ˆé˜Ÿåˆ—ï¼‰ï¼šç”¨äºä¼ è¾“å’Œä¿å­˜ç­‰å¾…æ‰§è¡Œä»»åŠ¡çš„é˜»å¡é˜Ÿåˆ—ã€‚</li>\n<li><strong>threadFactory</strong>ï¼ˆçº¿ç¨‹åˆ›å»ºå·¥å‚ï¼‰ï¼šç”¨äºåˆ›å»ºæ–°çº¿ç¨‹ã€‚threadFactory åˆ›å»ºçš„çº¿ç¨‹ä¹Ÿæ˜¯é‡‡ç”¨ new Thread () æ–¹å¼ï¼ŒthreadFactory åˆ›å»ºçš„çº¿ç¨‹åéƒ½å…·æœ‰ç»Ÿä¸€çš„é£æ ¼ï¼špool-m-thread-nï¼ˆm ä¸ºçº¿ç¨‹æ± çš„ç¼–å·ï¼Œn ä¸ºçº¿ç¨‹æ± å†…çš„çº¿ç¨‹ç¼–å·ï¼‰ã€‚</li>\n<li><strong>handler</strong>ï¼ˆæ‹’ç»ç­–ç•¥ï¼‰ï¼šå½“çº¿ç¨‹æ± å’Œé˜Ÿåˆ—éƒ½æ»¡äº†ï¼Œå†åŠ å…¥çº¿ç¨‹ä¼šæ‰§è¡Œæ­¤ç­–ç•¥</li>\n</ul>\n<h3 id=\"é»˜è®¤çº¿ç¨‹æ± \"><a class=\"anchor\" href=\"#é»˜è®¤çº¿ç¨‹æ± \">#</a> é»˜è®¤çº¿ç¨‹æ± </h3>\n<table>\n<thead>\n<tr>\n<th>çº¿ç¨‹æ± åç§°</th>\n<th>ä½¿ç”¨é˜»å¡é˜Ÿåˆ—</th>\n<th>ç‰¹ç‚¹</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>newFixedThreadPool</td>\n<td>LinkedBlockingQueue()</td>\n<td>1ã€æ ¸å¿ƒçº¿ç¨‹æ•°å’Œæœ€å¤§çº¿ç¨‹æ•°ç›¸åŒã€‚2ã€ç”±äº keepAliveTime è®¾ç½®ä¸º 0 ï¼Œå½“çº¿ç¨‹åˆ›å»ºåä¼šä¸€ç›´å­˜åœ¨ã€‚3ã€ç”±äºç”¨çš„æ˜¯æ— ç•Œé˜Ÿåˆ—æ‰€ä»¥å¯èƒ½ä¼šå¯¼è‡´ OOMã€‚</td>\n</tr>\n<tr>\n<td>newSingleThreadExecutor</td>\n<td>LinkedBlockingQueue()</td>\n<td>1ã€æ ¸å¿ƒçº¿ç¨‹æ•°å’Œæœ€å¤§çº¿ç¨‹æ•°éƒ½ä¸º 1 ï¼Œå•çº¿ç¨‹ã€‚2ã€æ— ç•Œé˜Ÿåˆ—å¯èƒ½å¯¼è‡´ OOM ã€‚</td>\n</tr>\n<tr>\n<td>newCachedThreadPool</td>\n<td>SynchronousQueue()</td>\n<td>1ã€æ ¸å¿ƒçº¿ç¨‹æ•°ä¸º 0 ï¼Œæœ€å¤§çº¿ç¨‹æ•°ä¸º Integer.MAX_VALUE ã€‚2ã€å½“æ²¡ä»»åŠ¡æ—¶çº¿ç¨‹å­˜æ´»æ—¶é—´ä¸º 60 ç§’ã€‚3ã€ä½¿ç”¨çš„æ˜¯ 0 å¤§å°çš„é˜Ÿåˆ—ï¼Œæ‰€ä»¥ä¸å­˜å‚¨ä»»åŠ¡ï¼Œåªåšä»»åŠ¡è½¬å‘ã€‚4ã€æç«¯æƒ…å†µä¸‹ä¼šåˆ›å»ºè¿‡å¤šçš„çº¿ç¨‹ï¼Œè€—å°½ CPU å’Œå†…å­˜èµ„æºã€‚</td>\n</tr>\n<tr>\n<td>newScheduledThreadPool</td>\n<td>DelayedWorkQueue()</td>\n<td>1ã€æ‰§è¡Œå‘¨æœŸä»»åŠ¡ã€‚2ã€æ— ç•Œé˜Ÿåˆ—ï¼Œå¯èƒ½ä¼šå¯¼è‡´ OOM ã€‚</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"çº¿ç¨‹æ± å·¥ä½œåŸç†\"><a class=\"anchor\" href=\"#çº¿ç¨‹æ± å·¥ä½œåŸç†\">#</a> çº¿ç¨‹æ± å·¥ä½œåŸç†</h3>\n<p><img data-src=\"https://uploadfiles.nowcoder.com/images/20220224/4107856_1645690520076/70D6B0404AB5E9C7AF6699C94B4766BF\" alt=\"çº¿ç¨‹æ± å·¥ä½œåŸç†\" /></p>\n<h3 id=\"çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥\"><a class=\"anchor\" href=\"#çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥\">#</a> çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥</h3>\n<p>å½“çº¿ç¨‹æ± çš„ä»»åŠ¡ç¼“å­˜é˜Ÿåˆ—å·²æ»¡å¹¶ä¸”çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ç›®è¾¾åˆ° maximumPoolSizeï¼Œå¦‚æœè¿˜æœ‰ä»»åŠ¡åˆ°æ¥å°±ä¼šé‡‡å–ä»»åŠ¡æ‹’ç»ç­–ç•¥ï¼Œé€šå¸¸æœ‰ä»¥ä¸‹å››ç§ç­–ç•¥ï¼š</p>\n<ul>\n<li><strong>AbortPolicy</strong>ï¼šä¸¢å¼ƒä»»åŠ¡å¹¶æŠ›å‡º RejectedExecutionException å¼‚å¸¸ã€‚</li>\n<li><strong>DiscardPolicy</strong>ï¼šä¹Ÿæ˜¯ä¸¢å¼ƒä»»åŠ¡ï¼Œä½†æ˜¯ä¸æŠ›å‡ºå¼‚å¸¸ã€‚</li>\n<li><strong>DiscardOldestPolicy</strong>ï¼šä¸¢å¼ƒé˜Ÿåˆ—æœ€å‰é¢çš„ä»»åŠ¡ï¼Œç„¶åé‡æ–°å°è¯•æ‰§è¡Œä»»åŠ¡ï¼ˆé‡å¤è¯¥è¿‡ç¨‹ï¼‰ã€‚</li>\n<li><strong>CallerRunsPolicy</strong>ï¼šç”±è°ƒç”¨çº¿ç¨‹å¤„ç†è¯¥ä»»åŠ¡ã€‚</li>\n</ul>\n",
            "tags": [
                "é¢è¯•æŒ‡åŒ—",
                "Java",
                "å…«è‚¡æ–‡",
                "Java"
            ]
        },
        {
            "id": "https://haust-kevin.github.io/2023/10/24/2023-10-interview-network/",
            "url": "https://haust-kevin.github.io/2023/10/24/2023-10-interview-network/",
            "title": "é¢è¯•æŒ‡åŒ—ï¼šè®¡ç®—æœºç½‘ç»œ",
            "date_published": "2023-10-24T10:13:56.000Z",
            "content_html": "<h2 id=\"osi-ä¸ƒå±‚ç½‘ç»œæ¨¡å‹\"><a class=\"anchor\" href=\"#osi-ä¸ƒå±‚ç½‘ç»œæ¨¡å‹\">#</a> OSI ä¸ƒå±‚ç½‘ç»œæ¨¡å‹</h2>\n<p>OSI çš„ä¸ƒå±‚åè®®ä¸»è¦åŒ…æ‹¬ï¼šç‰©ç†å±‚ï¼ˆphysical layerï¼‰ã€æ•°æ®é“¾è·¯å±‚ï¼ˆdata link layerï¼‰ã€ç½‘ç»œå±‚ï¼ˆnetwork layerï¼‰ã€è¿è¾“å±‚ï¼ˆtransport layerï¼‰ã€ä¼šè¯å±‚ï¼ˆsession layerï¼‰ã€è¡¨ç¤ºå±‚ï¼ˆpresentation layerï¼‰ã€åº”ç”¨å±‚ï¼ˆapplication layerï¼‰ã€‚</p>\n<table>\n<thead>\n<tr>\n<th>OSI ä¸ƒå±‚ç½‘ç»œæ¨¡å‹</th>\n<th>åŠŸèƒ½</th>\n<th>å¸¸ç”¨ç½‘ç»œåè®®</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>åº”ç”¨å±‚</td>\n<td>åº”ç”¨å±‚æ˜¯ç½‘ç»œä½“ç³»ä¸­æœ€é«˜çš„ä¸€å±‚ï¼Œä¹Ÿæ˜¯å”¯ä¸€é¢å‘ç”¨æˆ·çš„ä¸€å±‚ï¼Œä¹Ÿå¯è§†ä¸ºä¸ºç”¨æˆ·æä¾›å¸¸ç”¨çš„åº”ç”¨ç¨‹åºï¼Œæ¯ä¸ªç½‘ç»œåº”ç”¨éƒ½å¯¹åº”ç€ä¸åŒçš„åè®®</td>\n<td>HTTPã€TFTP, FTP, NFS, WAISã€SMTP</td>\n</tr>\n<tr>\n<td>è¡¨ç¤ºå±‚</td>\n<td>ä¸»è¦è´Ÿè´£æ•°æ®æ ¼å¼çš„è½¬æ¢ï¼Œç¡®ä¿ä¸€ä¸ªç³»ç»Ÿçš„åº”ç”¨å±‚å‘é€çš„æ¶ˆæ¯å¯ä»¥è¢«å¦ä¸€ä¸ªç³»ç»Ÿçš„åº”ç”¨å±‚è¯»å–ï¼Œç¼–ç è½¬æ¢ï¼Œæ•°æ®è§£æï¼Œç®¡ç†æ•°æ®çš„è§£å¯†å’ŒåŠ å¯†ï¼ŒåŒæ—¶ä¹Ÿå¯¹åº”ç”¨å±‚çš„åè®®è¿›è¡Œç¿»è¯‘</td>\n<td>JPEGã€MPEGã€ASII</td>\n</tr>\n<tr>\n<td>ä¼šè¯å±‚</td>\n<td>è´Ÿè´£ç½‘ç»œä¸­ä¸¤èŠ‚ç‚¹çš„å»ºç«‹ï¼Œåœ¨æ•°æ®ä¼ è¾“ä¸­ç»´æŠ¤è®¡ç®—æœºç½‘ç»œä¸­ä¸¤å°è®¡ç®—æœºä¹‹é—´çš„é€šä¿¡è¿æ¥ï¼Œå¹¶å†³å®šä½•æ—¶ç»ˆæ­¢é€šä¿¡</td>\n<td>SMTP, DNS</td>\n</tr>\n<tr>\n<td>ä¼ è¾“å±‚</td>\n<td>æ˜¯æ•´ä¸ªç½‘ç»œå…³é”®çš„éƒ¨åˆ†ï¼Œæ˜¯å®ç°ä¸¤ä¸ªç”¨æˆ·è¿›ç¨‹é—´ç«¯åˆ°ç«¯çš„å¯é é€šä¿¡ï¼Œå¤„ç†æ•°æ®åŒ…çš„é”™è¯¯ç­‰ä¼ è¾“é—®é¢˜ã€‚æ˜¯å‘ä¸‹é€šä¿¡æœåŠ¡æœ€é«˜å±‚ï¼Œå‘ä¸Šç”¨æˆ·åŠŸèƒ½æœ€åº•å±‚ã€‚å³å‘ç½‘ç»œå±‚æä¾›æœåŠ¡ï¼Œå‘ä¼šè¯å±‚æä¾›ç‹¬ç«‹äºç½‘ç»œå±‚çš„ä¼ é€æœåŠ¡å’Œå¯é çš„é€æ˜æ•°æ®ä¼ è¾“</td>\n<td>TCP, UDP</td>\n</tr>\n<tr>\n<td>ç½‘ç»œå±‚</td>\n<td>å°†ä¼ è¾“å±‚ä¼ ä¸‹æ¥çš„æŠ¥æ–‡æ®µå°è£…æˆåˆ†ç»„ï¼Œé€‰æ‹©åˆé€‚çš„è·¯ç”±ï¼Œä½¿å¾—ä¼ è¾“å±‚ä¼ ä¸‹æ¥çš„åˆ†ç»„èƒ½å¤Ÿäº¤ä»˜åˆ°ç›®çš„ä¸»æœº</td>\n<td>IPã€ICMPã€ARPã€RARPã€OSPFã€IPXã€RIPã€IGRPï¼ˆäº¤æ¢æœºï¼‰</td>\n</tr>\n<tr>\n<td>æ•°æ®é“¾è·¯å±‚</td>\n<td>ç‰©ç†åœ°å€ï¼ˆMAC åœ°å€ï¼‰ï¼Œç½‘ç»œè®¾å¤‡çš„å”¯ä¸€èº«ä»½æ ‡è¯†ã€‚å»ºç«‹é€»è¾‘è¿æ¥ã€è¿›è¡Œç¡¬ä»¶åœ°å€å¯»å€ï¼Œç›¸é‚»çš„ä¸¤ä¸ªè®¾å¤‡é—´çš„äº’ç›¸é€šä¿¡</td>\n<td>PPPã€FRã€HDLCã€VLANã€MACï¼ˆç½‘æ¡¥ã€äº¤æ¢æœºï¼‰</td>\n</tr>\n<tr>\n<td>ç‰©ç†å±‚</td>\n<td>ä¸ƒå±‚æ¨¡å‹ä¸­çš„æœ€åº•å±‚ï¼Œä¸»è¦æ˜¯ç‰©ç†ä»‹è´¨ä¼ è¾“åª’ä»‹ï¼ˆç½‘çº¿æˆ–è€…æ˜¯æ— çº¿ï¼‰ï¼Œåœ¨ä¸åŒè®¾å¤‡ä¸­ä¼ è¾“æ¯”ç‰¹ï¼Œå°† 0/1 ä¿¡å·ä¸ç”µä¿¡å·æˆ–è€…å…‰ä¿¡å·äº’ç›¸è½¬åŒ–</td>\n<td>IEEE 802.1A, IEEE 802.2 åˆ° IEEE 802 ï¼ˆä¸­ç»§å™¨ã€é›†çº¿å™¨ï¼‰</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"ä¸‰æ¬¡æ¡æ‰‹-å››æ¬¡æŒ¥æ‰‹\"><a class=\"anchor\" href=\"#ä¸‰æ¬¡æ¡æ‰‹-å››æ¬¡æŒ¥æ‰‹\">#</a> ä¸‰æ¬¡æ¡æ‰‹ &amp; å››æ¬¡æŒ¥æ‰‹</h2>\n<h3 id=\"ä¸‰æ¬¡æ¡æ‰‹\"><a class=\"anchor\" href=\"#ä¸‰æ¬¡æ¡æ‰‹\">#</a> ä¸‰æ¬¡æ¡æ‰‹</h3>\n<h4 id=\"ä¸‰æ¬¡æ¡æ‰‹ç¤ºæ„å›¾\"><a class=\"anchor\" href=\"#ä¸‰æ¬¡æ¡æ‰‹ç¤ºæ„å›¾\">#</a> ä¸‰æ¬¡æ¡æ‰‹ç¤ºæ„å›¾</h4>\n<p><img data-src=\"https://uploadfiles.nowcoder.com/images/20220224/4107856_1645697608907/3A588F923BE7D29034DABEB3AB473BCE\" alt=\"ä¸‰æ¬¡æ¡æ‰‹\" /></p>\n<ul>\n<li>å®¢æˆ·ç«¯åœ¨éœ€è¦æ—¶ï¼Œå‘æœåŠ¡å™¨<strong>å‘èµ·è¯·æ±‚è¿æ¥æŠ¥æ–‡</strong>ï¼Œå‘å‡ºåçŠ¶æ€ä» CLOSED è½¬æ¢ä¸º SYN-SEND  åŒæ­¥ - å·²å‘é€çŠ¶æ€ã€‚</li>\n<li>æœåŠ¡å™¨ä¸€ç›´å¤„äº LISTEN çŠ¶æ€ï¼Œæ¥æ”¶åˆ°è¯·æ±‚åï¼Œ<strong>å¯¹å®¢æˆ·ç«¯çš„è¯·æ±‚è¿›è¡Œå›åº”</strong>ï¼Œè½¬æ¢ä¸º SYN-RCVDï¼ŒåŒæ­¥ - å·²æ”¶åˆ°çŠ¶æ€ã€‚</li>\n<li>å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„å›åº”åï¼ŒçŠ¶æ€è½¬æ¢ä¸º ESTABLISHEDï¼Œå¹¶ä¸”<strong>å†æ¬¡å‘æœåŠ¡å™¨å‘é€ç¡®è®¤</strong>ã€‚</li>\n<li>æœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯çš„ç¡®è®¤ä¹‹åï¼ŒæœåŠ¡å™¨ä¹Ÿè½¬æ¢ä¸º ESTABLISHED çŠ¶æ€ï¼Œå®Œæˆäº†è¿æ¥ã€‚</li>\n</ul>\n<h4 id=\"ä¸‰æ¬¡æ¡æ‰‹è¿‡ç¨‹\"><a class=\"anchor\" href=\"#ä¸‰æ¬¡æ¡æ‰‹è¿‡ç¨‹\">#</a> ä¸‰æ¬¡æ¡æ‰‹è¿‡ç¨‹</h4>\n<ol>\n<li>å®¢æˆ·ç«¯å‘é€ä¸€ä¸ª SYN0 ç»™æœåŠ¡å™¨ï¼ˆé€‰æ‹©åˆå§‹åºåˆ—å·ï¼Œä¸æºå¸¦ä»»ä½•æ•°æ®ï¼‰</li>\n<li>æœåŠ¡å™¨æ”¶åˆ° SYN0ï¼Œå›å¤ SYN1 å’Œ ACKï¼ˆæœåŠ¡å™¨åˆ†é…ç¼“å­˜ï¼Œé€‰æ‹©è‡ªå·±åˆå§‹åºåˆ—å·ï¼‰</li>\n<li>å®¢æˆ·ç«¯æ”¶åˆ° SYN1ã€ACKï¼Œå›å¤ ACKï¼ˆå¯ä»¥åŒ…å«æ•°æ®ï¼‰</li>\n</ol>\n<h4 id=\"ä¸ºä»€ä¹ˆè¦ä¸‰æ¬¡æ¡æ‰‹\"><a class=\"anchor\" href=\"#ä¸ºä»€ä¹ˆè¦ä¸‰æ¬¡æ¡æ‰‹\">#</a> ä¸ºä»€ä¹ˆè¦ä¸‰æ¬¡æ¡æ‰‹</h4>\n<p>å¦‚æœä¸æ˜¯ä¸‰æ¬¡æ¡æ‰‹ï¼Œåªæœ‰ä¸¤æ¬¡<br />\nå¦‚æœå®¢æˆ·ç«¯å‘å‡ºè¯·æ±‚è¿æ¥æ—¶ï¼ŒæŠ¥æ–‡å»¶æ—¶äº†ï¼Œäºæ˜¯å®¢æˆ·ç«¯é‡æ–°å‘é€äº†ä¸€æ¬¡è¿æ¥è¯·æ±‚æ¶ˆæ¯<br />\nåæ¥æ”¶åˆ°äº†ç¡®è®¤ï¼Œå»ºç«‹äº†è¿æ¥ï¼Œç„¶åå®Œæˆäº†æ•°æ®ä¼ è¾“ï¼Œå…³é—­äº†è¿æ¥<br />\næ­¤æ—¶ï¼ŒæœåŠ¡å™¨æ”¶åˆ°äº†é‚£ä¸ªè¿Ÿåˆ°çš„è¯·æ±‚æ¶ˆæ¯ï¼Œæ­¤æ—¶è¿™ä¸ªè¯·æ±‚ä¸åº”è¯¥å»ºç«‹åŒå‘çš„è¿æ¥ã€‚<br />\nä½†æ˜¯å¦‚æœåªæœ‰ä¸¤æ¬¡æ¡æ‰‹ï¼ŒæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚å°±å“åº”å»ºç«‹äº†è¿æ¥äº†<br />\nä½†æ˜¯å¦‚æœæ˜¯ä¸‰æ¬¡ï¼Œå®¢æˆ·ç«¯ä¸ä¼šå†æ¬¡ç¡®è®¤ï¼ŒæœåŠ¡å™¨ä¹Ÿå°±éšåçŸ¥é“äº†è¿™æ¶ˆæ¯æœ‰é—®é¢˜ï¼Œä¸ä¼šå»ºç«‹è¿æ¥</p>\n<h3 id=\"å››æ¬¡æŒ¥æ‰‹\"><a class=\"anchor\" href=\"#å››æ¬¡æŒ¥æ‰‹\">#</a> å››æ¬¡æŒ¥æ‰‹</h3>\n<h4 id=\"å››æ¬¡æŒ¥æ‰‹ç¤ºæ„å›¾\"><a class=\"anchor\" href=\"#å››æ¬¡æŒ¥æ‰‹ç¤ºæ„å›¾\">#</a> å››æ¬¡æŒ¥æ‰‹ç¤ºæ„å›¾</h4>\n<p><img data-src=\"https://uploadfiles.nowcoder.com/images/20220224/4107856_1645697582360/95BEBBEC5A8D1A75D8FE435BD5FDBA12\" alt=\"å››æ¬¡æŒ¥æ‰‹\" /></p>\n<ul>\n<li>\n<p>å®¢æˆ·ç«¯è¿›ç¨‹<strong>å‘å‡ºè¿æ¥é‡Šæ”¾æŠ¥æ–‡</strong>ï¼Œå¹¶ä¸”åœæ­¢å‘é€æ•°æ®ã€‚é‡Šæ”¾æ•°æ®æŠ¥æ–‡é¦–éƒ¨ï¼ŒFIN=1ï¼Œå…¶åºåˆ—å·ä¸º seq=uï¼ˆç­‰äºå‰é¢å·²ç»ä¼ é€è¿‡æ¥çš„æ•°æ®çš„æœ€åä¸€ä¸ªå­—èŠ‚çš„åºå·åŠ  1ï¼‰ï¼Œæ­¤æ—¶ï¼Œå®¢æˆ·ç«¯è¿›å…¥ FIN-WAIT-1ï¼ˆç»ˆæ­¢ç­‰å¾… 1ï¼‰çŠ¶æ€ã€‚ TCP è§„å®šï¼ŒFIN æŠ¥æ–‡æ®µå³ä½¿ä¸æºå¸¦æ•°æ®ï¼Œä¹Ÿè¦æ¶ˆè€—ä¸€ä¸ªåºå·ã€‚</p>\n</li>\n<li>\n<p>æœåŠ¡å™¨æ”¶åˆ°è¿æ¥é‡Šæ”¾æŠ¥æ–‡ï¼Œ<strong>å‘å‡ºç¡®è®¤æŠ¥æ–‡</strong>ï¼ŒACK=1ï¼Œack=u+1ï¼Œå¹¶ä¸”å¸¦ä¸Šè‡ªå·±çš„åºåˆ—å· seq=vï¼Œæ­¤æ—¶ï¼ŒæœåŠ¡ç«¯å°±è¿›å…¥äº† CLOSE-WAITï¼ˆå…³é—­ç­‰å¾…ï¼‰çŠ¶æ€ã€‚TCP æœåŠ¡å™¨é€šçŸ¥é«˜å±‚çš„åº”ç”¨è¿›ç¨‹ï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡å™¨çš„æ–¹å‘å°±é‡Šæ”¾äº†ï¼Œè¿™æ—¶å€™å¤„äºåŠå…³é—­çŠ¶æ€ï¼Œå³å®¢æˆ·ç«¯å·²ç»æ²¡æœ‰æ•°æ®è¦å‘é€äº†ï¼Œä½†æ˜¯æœåŠ¡å™¨è‹¥å‘é€æ•°æ®ï¼Œå®¢æˆ·ç«¯ä¾ç„¶è¦æ¥å—ã€‚è¿™ä¸ªçŠ¶æ€è¿˜è¦æŒç»­ä¸€æ®µæ—¶é—´ï¼Œä¹Ÿå°±æ˜¯æ•´ä¸ª CLOSE-WAIT çŠ¶æ€æŒç»­çš„æ—¶é—´ã€‚</p>\n</li>\n<li>\n<p>å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„ç¡®è®¤è¯·æ±‚åï¼Œæ­¤æ—¶ï¼Œå®¢æˆ·ç«¯å°±è¿›å…¥ FIN-WAIT-2ï¼ˆç»ˆæ­¢ç­‰å¾… 2ï¼‰çŠ¶æ€ï¼Œç­‰å¾…æœåŠ¡å™¨å‘é€è¿æ¥é‡Šæ”¾æŠ¥æ–‡ï¼ˆåœ¨è¿™ä¹‹å‰è¿˜éœ€è¦æ¥å—æœåŠ¡å™¨å‘é€çš„æœ€åçš„æ•°æ®ï¼‰ã€‚</p>\n</li>\n<li>\n<p>æœåŠ¡å™¨å°†æœ€åçš„æ•°æ®å‘é€å®Œæ¯•åï¼Œå°±å‘å®¢æˆ·ç«¯<strong>å‘é€è¿æ¥é‡Šæ”¾æŠ¥æ–‡</strong>ï¼ŒFIN=1ï¼Œack=u+1ï¼Œç”±äºåœ¨åŠå…³é—­çŠ¶æ€ï¼ŒæœåŠ¡å™¨å¾ˆå¯èƒ½åˆå‘é€äº†ä¸€äº›æ•°æ®ï¼Œå‡å®šæ­¤æ—¶çš„åºåˆ—å·ä¸º seq=wï¼Œæ­¤æ—¶ï¼ŒæœåŠ¡å™¨å°±è¿›å…¥äº† LAST-ACKï¼ˆæœ€åç¡®è®¤ï¼‰çŠ¶æ€ï¼Œç­‰å¾…å®¢æˆ·ç«¯çš„ç¡®è®¤ã€‚</p>\n</li>\n<li>\n<p>å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„è¿æ¥é‡Šæ”¾æŠ¥æ–‡åï¼Œ<strong>å¿…é¡»å‘å‡ºç¡®è®¤</strong>ï¼ŒACK=1ï¼Œack=w+1ï¼Œè€Œè‡ªå·±çš„åºåˆ—å·æ˜¯ seq=u+1ï¼Œæ­¤æ—¶ï¼Œå®¢æˆ·ç«¯å°±è¿›å…¥äº† TIME-WAITï¼ˆæ—¶é—´ç­‰å¾…ï¼‰çŠ¶æ€ã€‚æ³¨æ„æ­¤æ—¶ TCP è¿æ¥è¿˜æ²¡æœ‰é‡Šæ”¾ï¼Œå¿…é¡»ç»è¿‡ 2âˆ—âˆ—MSLï¼ˆæœ€é•¿æŠ¥æ–‡æ®µå¯¿å‘½ï¼‰çš„æ—¶é—´åï¼Œå½“å®¢æˆ·ç«¯æ’¤é”€ç›¸åº”çš„ TCB åï¼Œæ‰è¿›å…¥ CLOSED çŠ¶æ€ã€‚</p>\n</li>\n<li>\n<p>æœåŠ¡å™¨åªè¦æ”¶åˆ°äº†å®¢æˆ·ç«¯å‘å‡ºçš„ç¡®è®¤ï¼Œç«‹å³è¿›å…¥ CLOSED çŠ¶æ€ã€‚åŒæ ·ï¼Œæ’¤é”€ TCB åï¼Œå°±ç»“æŸäº†è¿™æ¬¡çš„ TCP è¿æ¥ã€‚å¯ä»¥çœ‹åˆ°ï¼ŒæœåŠ¡å™¨ç»“æŸ TCP è¿æ¥çš„æ—¶é—´è¦æ¯”å®¢æˆ·ç«¯æ—©ä¸€äº›ã€‚</p>\n</li>\n</ul>\n<h4 id=\"å››æ¬¡æŒ¥æ‰‹è¿‡ç¨‹\"><a class=\"anchor\" href=\"#å››æ¬¡æŒ¥æ‰‹è¿‡ç¨‹\">#</a> å››æ¬¡æŒ¥æ‰‹è¿‡ç¨‹ï¼š</h4>\n<ol>\n<li>å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€ FIN æ§åˆ¶æŠ¥æ–‡æ®µï¼ˆé¦–éƒ¨ä¸­çš„ FIN æ¯”ç‰¹è¢«ç½®ä½ï¼‰ï¼›</li>\n<li>æœåŠ¡ç«¯æ”¶åˆ° FINï¼Œå›å¤ ACKã€‚æœåŠ¡å™¨è¿›å…¥å…³é—­ç­‰å¾…çŠ¶æ€ï¼Œå‘é€ FIN;</li>\n<li>å®¢æˆ·ç«¯æ”¶åˆ° FINï¼Œç»™æœåŠ¡å™¨å›å¤ ACKï¼Œå®¢æˆ·ç«¯è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼ˆè¿›å…¥ â€œç­‰å¾…â€ï¼Œä»¥ç¡®ä¿æœåŠ¡å™¨æ”¶åˆ° ACK çœŸæ­£å…³é—­è¿æ¥ï¼‰;</li>\n<li>æœåŠ¡ç«¯æ”¶åˆ° ACKï¼Œé“¾æ¥å…³é—­ã€‚</li>\n</ol>\n<h4 id=\"å››æ¬¡æŒ¥æ‰‹åŸå› \"><a class=\"anchor\" href=\"#å››æ¬¡æŒ¥æ‰‹åŸå› \">#</a> å››æ¬¡æŒ¥æ‰‹åŸå› ï¼š</h4>\n<p>TCP åè®®æ˜¯ä¸€ç§é¢å‘è¿æ¥çš„ã€å¯é çš„ã€åŸºäºå­—èŠ‚æµçš„è¿è¾“å±‚é€šä¿¡åè®®ã€‚TCP æ˜¯å…¨åŒå·¥æ¨¡å¼ï¼Œè¿™å°±æ„å‘³ç€ï¼Œå½“å®¢æˆ·ç«¯å‘å‡º FIN æŠ¥æ–‡æ®µæ—¶ï¼Œåªæ˜¯è¡¨ç¤ºå®¢æˆ·ç«¯å·²ç»æ²¡æœ‰æ•°æ®è¦å‘é€äº†ï¼Œå®¢æˆ·ç«¯å‘Šè¯‰æœåŠ¡å™¨ï¼Œå®ƒçš„æ•°æ®å·²ç»å…¨éƒ¨å‘é€å®Œæ¯•äº†ï¼›ä½†æ˜¯ï¼Œè¿™ä¸ªæ—¶å€™å®¢æˆ·ç«¯è¿˜æ˜¯å¯ä»¥æ¥å—æ¥è‡ªæœåŠ¡ç«¯çš„æ•°æ®ï¼›å½“æœåŠ¡ç«¯è¿”å› ACK æŠ¥æ–‡æ®µæ—¶ï¼Œè¡¨ç¤ºå®ƒå·²ç»çŸ¥é“å®¢æˆ·ç«¯æ²¡æœ‰æ•°æ®å‘é€äº†ï¼Œä½†æ˜¯æœåŠ¡ç«¯è¿˜æ˜¯å¯ä»¥å‘é€æ•°æ®åˆ°å®¢æˆ·ç«¯çš„ï¼›å½“æœåŠ¡ç«¯ä¹Ÿå‘é€äº† FIN æŠ¥æ–‡æ®µæ—¶ï¼Œè¿™ä¸ªæ—¶å€™å°±è¡¨ç¤ºæœåŠ¡ç«¯ä¹Ÿæ²¡æœ‰æ•°æ®è¦å‘é€äº†ï¼Œå°±ä¼šå‘Šè¯‰å®¢æˆ·ç«¯ï¼Œæˆ‘ä¹Ÿæ²¡æœ‰æ•°æ®è¦å‘é€äº†ï¼Œä¹‹åå½¼æ­¤å°±ä¼šæ„‰å¿«çš„ä¸­æ–­è¿™æ¬¡ TCP è¿æ¥ã€‚</p>\n<h2 id=\"ç²˜åŒ…\"><a class=\"anchor\" href=\"#ç²˜åŒ…\">#</a> ç²˜åŒ…</h2>\n<p>TCP ç²˜åŒ…å°±æ˜¯æŒ‡å‘é€æ–¹å‘é€çš„è‹¥å¹²åŒ…æ•°æ®åˆ°è¾¾æ¥æ”¶æ–¹æ—¶ç²˜æˆäº†ä¸€åŒ…ï¼Œä»æ¥æ”¶ç¼“å†²åŒºæ¥çœ‹ï¼Œåä¸€åŒ…æ•°æ®çš„å¤´ç´§æ¥ç€å‰ä¸€åŒ…æ•°æ®çš„å°¾ï¼Œå‡ºç°ç²˜åŒ…çš„åŸå› æ˜¯å¤šæ–¹é¢çš„ï¼Œå¯èƒ½æ˜¯æ¥è‡ªå‘é€æ–¹ï¼Œä¹Ÿå¯èƒ½æ˜¯æ¥è‡ªæ¥æ”¶æ–¹ã€‚</p>\n<h3 id=\"åŸå› \"><a class=\"anchor\" href=\"#åŸå› \">#</a> åŸå› </h3>\n<ol>\n<li>å‘é€æ–¹åŸå› <br />\n TCP é»˜è®¤ä½¿ç”¨ Nagle ç®—æ³•ï¼ˆä¸»è¦ä½œç”¨ï¼šå‡å°‘ç½‘ç»œä¸­æŠ¥æ–‡æ®µçš„æ•°é‡ï¼‰ï¼Œè€Œ Nagle ç®—æ³•ä¸»è¦åšä¸¤ä»¶äº‹ï¼š</li>\n</ol>\n<ul>\n<li>åªæœ‰ä¸Šä¸€ä¸ªåˆ†ç»„å¾—åˆ°ç¡®è®¤ï¼Œæ‰ä¼šå‘é€ä¸‹ä¸€ä¸ªåˆ†ç»„</li>\n<li>æ”¶é›†å¤šä¸ªå°åˆ†ç»„ï¼Œåœ¨ä¸€ä¸ªç¡®è®¤åˆ°æ¥æ—¶ä¸€èµ·å‘é€</li>\n</ul>\n<ol start=\"2\">\n<li>æ¥æ”¶æ–¹åŸå› <br />\n TCP æ¥æ”¶åˆ°æ•°æ®åŒ…æ—¶ï¼Œå¹¶ä¸ä¼šé©¬ä¸Šäº¤åˆ°åº”ç”¨å±‚è¿›è¡Œå¤„ç†ï¼Œæˆ–è€…è¯´åº”ç”¨å±‚å¹¶ä¸ä¼šç«‹å³å¤„ç†ã€‚å®é™…ä¸Šï¼ŒTCP å°†æ¥æ”¶åˆ°çš„æ•°æ®åŒ…ä¿å­˜åœ¨æ¥æ”¶ç¼“å­˜é‡Œï¼Œç„¶ååº”ç”¨ç¨‹åºä¸»åŠ¨ä»ç¼“å­˜è¯»å–æ”¶åˆ°çš„åˆ†ç»„ã€‚è¿™æ ·ä¸€æ¥ï¼Œå¦‚æœ TCP æ¥æ”¶æ•°æ®åŒ…åˆ°ç¼“å­˜çš„é€Ÿåº¦å¤§äºåº”ç”¨ç¨‹åºä»ç¼“å­˜ä¸­è¯»å–æ•°æ®åŒ…çš„é€Ÿåº¦ï¼Œå¤šä¸ªåŒ…å°±ä¼šè¢«ç¼“å­˜ï¼Œåº”ç”¨ç¨‹åºå°±æœ‰å¯èƒ½è¯»å–åˆ°å¤šä¸ªé¦–å°¾ç›¸æ¥ç²˜åˆ°ä¸€èµ·çš„åŒ…ã€‚</li>\n</ol>\n<h3 id=\"å¤„ç†æ–¹å¼\"><a class=\"anchor\" href=\"#å¤„ç†æ–¹å¼\">#</a> å¤„ç†æ–¹å¼</h3>\n<ul>\n<li>å‘é€ç«¯å°†æ¯ä¸ªåŒ…éƒ½å°è£…æˆå›ºå®šçš„é•¿åº¦ï¼Œæ¯”å¦‚ 100 å­—èŠ‚å¤§å°ã€‚å¦‚æœä¸è¶³ 100 å­—èŠ‚å¯é€šè¿‡è¡¥ 0 æˆ–ç©ºç­‰è¿›è¡Œå¡«å……åˆ°æŒ‡å®šé•¿åº¦ï¼›</li>\n<li>å‘é€ç«¯åœ¨æ¯ä¸ªåŒ…çš„æœ«å°¾ä½¿ç”¨å›ºå®šçš„åˆ†éš”ç¬¦ï¼Œä¾‹å¦‚ <code>\\r\\n</code> ã€‚å¦‚æœå‘ç”Ÿæ‹†åŒ…éœ€ç­‰å¾…å¤šä¸ªåŒ…å‘é€è¿‡æ¥ä¹‹åå†æ‰¾åˆ°å…¶ä¸­çš„ã€r\\n è¿›è¡Œåˆå¹¶ï¼›ä¾‹å¦‚ï¼ŒFTP åè®®ï¼›</li>\n<li>å°†æ¶ˆæ¯åˆ†ä¸ºå¤´éƒ¨å’Œæ¶ˆæ¯ä½“ï¼Œå¤´éƒ¨ä¸­ä¿å­˜æ•´ä¸ªæ¶ˆæ¯çš„é•¿åº¦ï¼Œåªæœ‰è¯»å–åˆ°è¶³å¤Ÿé•¿åº¦çš„æ¶ˆæ¯ä¹‹åæ‰ç®—æ˜¯è¯»åˆ°äº†ä¸€ä¸ªå®Œæ•´çš„æ¶ˆæ¯ï¼›</li>\n</ul>\n<h3 id=\"ä¸ºä»€ä¹ˆ-udp-æ²¡æœ‰ç²˜åŒ…\"><a class=\"anchor\" href=\"#ä¸ºä»€ä¹ˆ-udp-æ²¡æœ‰ç²˜åŒ…\">#</a> ä¸ºä»€ä¹ˆ UDP æ²¡æœ‰ç²˜åŒ…</h3>\n<p>ç²˜åŒ…æ‹†åŒ…é—®é¢˜åœ¨æ•°æ®é“¾è·¯å±‚ã€ç½‘ç»œå±‚ä»¥åŠä¼ è¾“å±‚éƒ½æœ‰å¯èƒ½å‘ç”Ÿã€‚æ—¥å¸¸çš„ç½‘ç»œåº”ç”¨å¼€å‘å¤§éƒ½åœ¨ä¼ è¾“å±‚è¿›è¡Œï¼Œç”±äº UDP æœ‰æ¶ˆæ¯ä¿æŠ¤è¾¹ç•Œï¼Œä¸ä¼šå‘ç”Ÿç²˜åŒ…æ‹†åŒ…é—®é¢˜ï¼Œå› æ­¤ç²˜åŒ…æ‹†åŒ…é—®é¢˜åªå‘ç”Ÿåœ¨ TCP åè®®ä¸­ã€‚</p>\n<h2 id=\"http-https\"><a class=\"anchor\" href=\"#http-https\">#</a> HTTP &amp; HTTPS</h2>\n<h3 id=\"http\"><a class=\"anchor\" href=\"#http\">#</a> HTTP</h3>\n<p>HTTP åè®®æ˜¯ Hyper Text Transfer Protocolï¼ˆè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼‰çš„ç¼©å†™ï¼Œæ˜¯ç”¨äºä»ä¸‡ç»´ç½‘ï¼ˆWWW:World Wide Web ï¼‰æœåŠ¡å™¨ä¼ è¾“è¶…æ–‡æœ¬åˆ°æœ¬åœ°æµè§ˆå™¨çš„ä¼ é€åè®®ã€‚</p>\n<h4 id=\"http-è¯·æ±‚æ–¹æ³•\"><a class=\"anchor\" href=\"#http-è¯·æ±‚æ–¹æ³•\">#</a> HTTP è¯·æ±‚æ–¹æ³•</h4>\n<p>HTTP1.0 å®šä¹‰äº†ä¸‰ç§è¯·æ±‚æ–¹æ³•ï¼š GET, POST å’Œ HEAD æ–¹æ³•ã€‚<br />\nHTTP1.1 æ–°å¢äº†å…­ç§è¯·æ±‚æ–¹æ³•ï¼šOPTIONSã€PUTã€PATCHã€DELETEã€TRACE å’Œ CONNECT æ–¹æ³•ã€‚</p>\n<table>\n<thead>\n<tr>\n<th>REQUEST METHOD</th>\n<th>æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>GET</td>\n<td>è¯·æ±‚æŒ‡å®šçš„é¡µé¢ä¿¡æ¯ï¼Œå¹¶è¿”å›å®ä½“ä¸»ä½“ã€‚</td>\n</tr>\n<tr>\n<td>HEAD</td>\n<td>ç±»ä¼¼äº GET è¯·æ±‚ï¼Œåªä¸è¿‡è¿”å›çš„å“åº”ä¸­æ²¡æœ‰å…·ä½“çš„å†…å®¹ï¼Œç”¨äºè·å–æŠ¥å¤´ã€‚</td>\n</tr>\n<tr>\n<td>POST</td>\n<td>å‘æŒ‡å®šèµ„æºæäº¤æ•°æ®è¿›è¡Œå¤„ç†è¯·æ±‚ï¼ˆä¾‹å¦‚æäº¤è¡¨å•æˆ–è€…ä¸Šä¼ æ–‡ä»¶ï¼‰ã€‚æ•°æ®è¢«åŒ…å«åœ¨è¯·æ±‚ä½“ä¸­ã€‚POST è¯·æ±‚å¯èƒ½ä¼šå¯¼è‡´æ–°çš„èµ„æºçš„å»ºç«‹å’Œ / æˆ–å·²æœ‰èµ„æºçš„ä¿®æ”¹ã€‚</td>\n</tr>\n<tr>\n<td>PUT</td>\n<td>ä»å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ä¼ é€çš„æ•°æ®å–ä»£æŒ‡å®šçš„æ–‡æ¡£çš„å†…å®¹ã€‚</td>\n</tr>\n<tr>\n<td>DELETE</td>\n<td>è¯·æ±‚æœåŠ¡å™¨åˆ é™¤æŒ‡å®šçš„é¡µé¢ã€‚</td>\n</tr>\n<tr>\n<td>CONNECT</td>\n<td>HTTP/1.1 åè®®ä¸­é¢„ç•™ç»™èƒ½å¤Ÿå°†è¿æ¥æ”¹ä¸ºç®¡é“æ–¹å¼çš„ä»£ç†æœåŠ¡å™¨ã€‚</td>\n</tr>\n<tr>\n<td>OPTIONS</td>\n<td>å…è®¸å®¢æˆ·ç«¯æŸ¥çœ‹æœåŠ¡å™¨çš„æ€§èƒ½ã€‚</td>\n</tr>\n<tr>\n<td>TRACE</td>\n<td>å›æ˜¾æœåŠ¡å™¨æ”¶åˆ°çš„è¯·æ±‚ï¼Œä¸»è¦ç”¨äºæµ‹è¯•æˆ–è¯Šæ–­ã€‚</td>\n</tr>\n<tr>\n<td>PATCH</td>\n<td>æ˜¯å¯¹ PUT æ–¹æ³•çš„è¡¥å……ï¼Œç”¨æ¥å¯¹å·²çŸ¥èµ„æºè¿›è¡Œå±€éƒ¨æ›´æ–° ã€‚</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"http-çŠ¶æ€ç \"><a class=\"anchor\" href=\"#http-çŠ¶æ€ç \">#</a> HTTP çŠ¶æ€ç </h4>\n<table>\n<thead>\n<tr>\n<th>çŠ¶æ€ç </th>\n<th>çŠ¶æ€ç è‹±æ–‡åç§°</th>\n<th>ä¸­æ–‡æè¿°</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>100</td>\n<td>Continue</td>\n<td>ç»§ç»­ã€‚å®¢æˆ·ç«¯åº”ç»§ç»­å…¶è¯·æ±‚</td>\n</tr>\n<tr>\n<td>101</td>\n<td>Switching Protocols</td>\n<td>åˆ‡æ¢åè®®ã€‚æœåŠ¡å™¨æ ¹æ®å®¢æˆ·ç«¯çš„è¯·æ±‚åˆ‡æ¢åè®®ã€‚åªèƒ½åˆ‡æ¢åˆ°æ›´é«˜çº§çš„åè®®ï¼Œä¾‹å¦‚ï¼Œåˆ‡æ¢åˆ° HTTP çš„æ–°ç‰ˆæœ¬åè®®</td>\n</tr>\n<tr>\n<td>200</td>\n<td>OK</td>\n<td>è¯·æ±‚æˆåŠŸã€‚ä¸€èˆ¬ç”¨äº GET ä¸ POST è¯·æ±‚</td>\n</tr>\n<tr>\n<td>201</td>\n<td>Created</td>\n<td>å·²åˆ›å»ºã€‚æˆåŠŸè¯·æ±‚å¹¶åˆ›å»ºäº†æ–°çš„èµ„æº</td>\n</tr>\n<tr>\n<td>202</td>\n<td>Accepted</td>\n<td>å·²æ¥å—ã€‚å·²ç»æ¥å—è¯·æ±‚ï¼Œä½†æœªå¤„ç†å®Œæˆ</td>\n</tr>\n<tr>\n<td>203</td>\n<td>Non-Authoritative Information</td>\n<td>éæˆæƒä¿¡æ¯ã€‚è¯·æ±‚æˆåŠŸã€‚ä½†è¿”å›çš„ meta ä¿¡æ¯ä¸åœ¨åŸå§‹çš„æœåŠ¡å™¨ï¼Œè€Œæ˜¯ä¸€ä¸ªå‰¯æœ¬</td>\n</tr>\n<tr>\n<td>204</td>\n<td>No Content</td>\n<td>æ— å†…å®¹ã€‚æœåŠ¡å™¨æˆåŠŸå¤„ç†ï¼Œä½†æœªè¿”å›å†…å®¹ã€‚åœ¨æœªæ›´æ–°ç½‘é¡µçš„æƒ…å†µä¸‹ï¼Œå¯ç¡®ä¿æµè§ˆå™¨ç»§ç»­æ˜¾ç¤ºå½“å‰æ–‡æ¡£</td>\n</tr>\n<tr>\n<td>205</td>\n<td>Reset Content</td>\n<td>é‡ç½®å†…å®¹ã€‚æœåŠ¡å™¨å¤„ç†æˆåŠŸï¼Œç”¨æˆ·ç»ˆç«¯ï¼ˆä¾‹å¦‚ï¼šæµè§ˆå™¨ï¼‰åº”é‡ç½®æ–‡æ¡£è§†å›¾ã€‚å¯é€šè¿‡æ­¤è¿”å›ç æ¸…é™¤æµè§ˆå™¨çš„è¡¨å•åŸŸ</td>\n</tr>\n<tr>\n<td>206</td>\n<td>Partial Content</td>\n<td>éƒ¨åˆ†å†…å®¹ã€‚æœåŠ¡å™¨æˆåŠŸå¤„ç†äº†éƒ¨åˆ† GET è¯·æ±‚</td>\n</tr>\n<tr>\n<td>300</td>\n<td>Multiple Choices</td>\n<td>å¤šç§é€‰æ‹©ã€‚è¯·æ±‚çš„èµ„æºå¯åŒ…æ‹¬å¤šä¸ªä½ç½®ï¼Œç›¸åº”å¯è¿”å›ä¸€ä¸ªèµ„æºç‰¹å¾ä¸åœ°å€çš„åˆ—è¡¨ç”¨äºç”¨æˆ·ç»ˆç«¯ï¼ˆä¾‹å¦‚ï¼šæµè§ˆå™¨ï¼‰é€‰æ‹©</td>\n</tr>\n<tr>\n<td>301</td>\n<td>Moved Permanently</td>\n<td>æ°¸ä¹…ç§»åŠ¨ã€‚è¯·æ±‚çš„èµ„æºå·²è¢«æ°¸ä¹…çš„ç§»åŠ¨åˆ°æ–° URIï¼Œè¿”å›ä¿¡æ¯ä¼šåŒ…æ‹¬æ–°çš„ URIï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨å®šå‘åˆ°æ–° URIã€‚ä»Šåä»»ä½•æ–°çš„è¯·æ±‚éƒ½åº”ä½¿ç”¨æ–°</td>\n<td>çš„ URI ä»£æ›¿</td>\n</tr>\n<tr>\n<td>302</td>\n<td>Found</td>\n<td>ä¸´æ—¶ç§»åŠ¨ã€‚ä¸ 301 ç±»ä¼¼ã€‚ä½†èµ„æºåªæ˜¯ä¸´æ—¶è¢«ç§»åŠ¨ã€‚å®¢æˆ·ç«¯åº”ç»§ç»­ä½¿ç”¨åŸæœ‰ URI</td>\n</tr>\n<tr>\n<td>303</td>\n<td>See Other</td>\n<td>æŸ¥çœ‹å…¶å®ƒåœ°å€ã€‚ä¸ 301 ç±»ä¼¼ã€‚ä½¿ç”¨ GET å’Œ POST è¯·æ±‚æŸ¥çœ‹</td>\n</tr>\n<tr>\n<td>304</td>\n<td>Not Modified</td>\n<td>æœªä¿®æ”¹ã€‚æ‰€è¯·æ±‚çš„èµ„æºæœªä¿®æ”¹ï¼ŒæœåŠ¡å™¨è¿”å›æ­¤çŠ¶æ€ç æ—¶ï¼Œä¸ä¼šè¿”å›ä»»ä½•èµ„æºã€‚å®¢æˆ·ç«¯é€šå¸¸ä¼šç¼“å­˜è®¿é—®è¿‡çš„èµ„æºï¼Œé€šè¿‡æä¾›ä¸€ä¸ªå¤´ä¿¡æ¯æŒ‡å‡ºå®¢æˆ·ç«¯å¸Œæœ›åªè¿”å›åœ¨æŒ‡å®šæ—¥æœŸä¹‹åä¿®æ”¹çš„èµ„æº</td>\n</tr>\n<tr>\n<td>305</td>\n<td>Use Proxy</td>\n<td>ä½¿ç”¨ä»£ç†ã€‚æ‰€è¯·æ±‚çš„èµ„æºå¿…é¡»é€šè¿‡ä»£ç†è®¿é—®</td>\n</tr>\n<tr>\n<td>306</td>\n<td>Unused</td>\n<td>å·²ç»è¢«åºŸå¼ƒçš„ HTTP çŠ¶æ€ç </td>\n</tr>\n<tr>\n<td>307</td>\n<td>Temporary Redirect</td>\n<td>ä¸´æ—¶é‡å®šå‘ã€‚ä¸ 302 ç±»ä¼¼ã€‚ä½¿ç”¨ GET è¯·æ±‚é‡å®šå‘</td>\n</tr>\n<tr>\n<td>400</td>\n<td>Bad Request</td>\n<td>å®¢æˆ·ç«¯è¯·æ±‚çš„è¯­æ³•é”™è¯¯ï¼ŒæœåŠ¡å™¨æ— æ³•ç†è§£</td>\n</tr>\n<tr>\n<td>401</td>\n<td>Unauthorized</td>\n<td>è¯·æ±‚è¦æ±‚ç”¨æˆ·çš„èº«ä»½è®¤è¯</td>\n</tr>\n<tr>\n<td>402</td>\n<td>Payment Required</td>\n<td>ä¿ç•™ï¼Œå°†æ¥ä½¿ç”¨</td>\n</tr>\n<tr>\n<td>403</td>\n<td>Forbidden</td>\n<td>æœåŠ¡å™¨ç†è§£è¯·æ±‚å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œä½†æ˜¯æ‹’ç»æ‰§è¡Œæ­¤è¯·æ±‚</td>\n</tr>\n<tr>\n<td>404</td>\n<td>Not Found</td>\n<td>æœåŠ¡å™¨æ— æ³•æ ¹æ®å®¢æˆ·ç«¯çš„è¯·æ±‚æ‰¾åˆ°èµ„æºï¼ˆç½‘é¡µï¼‰ã€‚é€šè¿‡æ­¤ä»£ç ï¼Œç½‘ç«™è®¾è®¡äººå‘˜å¯è®¾ç½® &quot;æ‚¨æ‰€è¯·æ±‚çš„èµ„æºæ— æ³•æ‰¾åˆ°&quot;  çš„ä¸ªæ€§é¡µé¢</td>\n</tr>\n<tr>\n<td>405</td>\n<td>Method Not Allowed</td>\n<td>å®¢æˆ·ç«¯è¯·æ±‚ä¸­çš„æ–¹æ³•è¢«ç¦æ­¢</td>\n</tr>\n<tr>\n<td>406</td>\n<td>Not Acceptable</td>\n<td>æœåŠ¡å™¨æ— æ³•æ ¹æ®å®¢æˆ·ç«¯è¯·æ±‚çš„å†…å®¹ç‰¹æ€§å®Œæˆè¯·æ±‚</td>\n</tr>\n<tr>\n<td>407</td>\n<td>Proxy Authentication Required</td>\n<td>è¯·æ±‚è¦æ±‚ä»£ç†çš„èº«ä»½è®¤è¯ï¼Œä¸ 401 ç±»ä¼¼ï¼Œä½†è¯·æ±‚è€…åº”å½“ä½¿ç”¨ä»£ç†è¿›è¡Œæˆæƒ</td>\n</tr>\n<tr>\n<td>408</td>\n<td>Request Time-out</td>\n<td>æœåŠ¡å™¨ç­‰å¾…å®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚æ—¶é—´è¿‡é•¿ï¼Œè¶…æ—¶</td>\n</tr>\n<tr>\n<td>409</td>\n<td>Conflict\tæœåŠ¡å™¨å®Œæˆå®¢æˆ·ç«¯çš„ PUT</td>\n<td>è¯·æ±‚æ—¶å¯èƒ½è¿”å›æ­¤ä»£ç ï¼ŒæœåŠ¡å™¨å¤„ç†è¯·æ±‚æ—¶å‘ç”Ÿäº†å†²çª</td>\n</tr>\n<tr>\n<td>410</td>\n<td>Gone</td>\n<td>å®¢æˆ·ç«¯è¯·æ±‚çš„èµ„æºå·²ç»ä¸å­˜åœ¨ã€‚410 ä¸åŒäº 404ï¼Œå¦‚æœèµ„æºä»¥å‰æœ‰ç°åœ¨è¢«æ°¸ä¹…åˆ é™¤äº†å¯ä½¿ç”¨ 410 ä»£ç ï¼Œç½‘ç«™è®¾è®¡äººå‘˜å¯é€šè¿‡ 301 ä»£ç æŒ‡å®šèµ„æºçš„æ–°ä½ç½®</td>\n</tr>\n<tr>\n<td>411</td>\n<td>Length Required</td>\n<td>æœåŠ¡å™¨æ— æ³•å¤„ç†å®¢æˆ·ç«¯å‘é€çš„ä¸å¸¦ Content-Length çš„è¯·æ±‚ä¿¡æ¯</td>\n</tr>\n<tr>\n<td>412</td>\n<td>Precondition Failed</td>\n<td>å®¢æˆ·ç«¯è¯·æ±‚ä¿¡æ¯çš„å…ˆå†³æ¡ä»¶é”™è¯¯</td>\n</tr>\n<tr>\n<td>413</td>\n<td>Request Entity Too Large</td>\n<td>ç”±äºè¯·æ±‚çš„å®ä½“è¿‡å¤§ï¼ŒæœåŠ¡å™¨æ— æ³•å¤„ç†ï¼Œå› æ­¤æ‹’ç»è¯·æ±‚ã€‚ä¸ºé˜²æ­¢å®¢æˆ·ç«¯çš„è¿ç»­è¯·æ±‚ï¼ŒæœåŠ¡å™¨å¯èƒ½ä¼šå…³é—­è¿æ¥ã€‚å¦‚æœåªæ˜¯æœåŠ¡å™¨æš‚æ—¶æ— æ³•å¤„ç†ï¼Œåˆ™ä¼šåŒ…å«ä¸€ä¸ª Retry-After çš„å“åº”ä¿¡æ¯</td>\n</tr>\n<tr>\n<td>414</td>\n<td>Request-URI Too Large</td>\n<td>è¯·æ±‚çš„ URI è¿‡é•¿ï¼ˆURI é€šå¸¸ä¸ºç½‘å€ï¼‰ï¼ŒæœåŠ¡å™¨æ— æ³•å¤„ç†</td>\n</tr>\n<tr>\n<td>415</td>\n<td>Unsupported Media Type</td>\n<td>æœåŠ¡å™¨æ— æ³•å¤„ç†è¯·æ±‚é™„å¸¦çš„åª’ä½“æ ¼å¼</td>\n</tr>\n<tr>\n<td>416</td>\n<td>Requested range not satisfiable</td>\n<td>å®¢æˆ·ç«¯è¯·æ±‚çš„èŒƒå›´æ— æ•ˆ</td>\n</tr>\n<tr>\n<td>417</td>\n<td>Expectation Failed</td>\n<td>æœåŠ¡å™¨æ— æ³•æ»¡è¶³ Expect çš„è¯·æ±‚å¤´ä¿¡æ¯</td>\n</tr>\n<tr>\n<td>500</td>\n<td>Internal Server Error</td>\n<td>æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼Œæ— æ³•å®Œæˆè¯·æ±‚</td>\n</tr>\n<tr>\n<td>501</td>\n<td>Not Implemented</td>\n<td>æœåŠ¡å™¨ä¸æ”¯æŒè¯·æ±‚çš„åŠŸèƒ½ï¼Œæ— æ³•å®Œæˆè¯·æ±‚</td>\n</tr>\n<tr>\n<td>502</td>\n<td>Bad Gateway</td>\n<td>ä½œä¸ºç½‘å…³æˆ–è€…ä»£ç†å·¥ä½œçš„æœåŠ¡å™¨å°è¯•æ‰§è¡Œè¯·æ±‚æ—¶ï¼Œä»è¿œç¨‹æœåŠ¡å™¨æ¥æ”¶åˆ°äº†ä¸€ä¸ªæ— æ•ˆçš„å“åº”</td>\n</tr>\n<tr>\n<td>503</td>\n<td>Service Unavailable</td>\n<td>ç”±äºè¶…è½½æˆ–ç³»ç»Ÿç»´æŠ¤ï¼ŒæœåŠ¡å™¨æš‚æ—¶çš„æ— æ³•å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚å»¶æ—¶çš„é•¿åº¦å¯åŒ…å«åœ¨æœåŠ¡å™¨çš„ Retry-After å¤´ä¿¡æ¯ä¸­</td>\n</tr>\n<tr>\n<td>504</td>\n<td>Gateway Time-out</td>\n<td>å……å½“ç½‘å…³æˆ–ä»£ç†çš„æœåŠ¡å™¨ï¼ŒæœªåŠæ—¶ä»è¿œç«¯æœåŠ¡å™¨è·å–è¯·æ±‚</td>\n</tr>\n<tr>\n<td>505</td>\n<td>HTTP Version not supported</td>\n<td>æœåŠ¡å™¨ä¸æ”¯æŒè¯·æ±‚çš„ HTTP åè®®çš„ç‰ˆæœ¬ï¼Œæ— æ³•å®Œæˆå¤„ç†</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"restfull\"><a class=\"anchor\" href=\"#restfull\">#</a> RESTFULL</h4>\n<figure class=\"highlight http\"><figcaption data-lang=\"HTTP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>GET /collectionï¼šä»æœåŠ¡å™¨æŸ¥è¯¢èµ„æºçš„åˆ—è¡¨ï¼ˆæ•°ç»„ï¼‰</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>GET /collection/resourceï¼šä»æœåŠ¡å™¨æŸ¥è¯¢å•ä¸ªèµ„æº</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>POST /collectionï¼šåœ¨æœåŠ¡å™¨åˆ›å»ºæ–°çš„èµ„æº</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>PUT /collection/resourceï¼šæ›´æ–°æœåŠ¡å™¨èµ„æº</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>DELETE /collection/resourceï¼šä»æœåŠ¡å™¨åˆ é™¤èµ„æº</pre></td></tr></table></figure><p>å››ä¸ªæ–¹æ³•é™¤ POST ä¹‹å¤–éƒ½éœ€è¦ä¿æŒå¹‚ç­‰æ€§ã€‚</p>\n<h3 id=\"https\"><a class=\"anchor\" href=\"#https\">#</a> HTTPS</h3>\n<p><strong>HTTPS</strong>ï¼ˆHyper Text Transfer Protocol over SecureSocket Layerï¼‰æ˜¯ä»¥å®‰å…¨ä¸ºç›®æ ‡çš„ HTTP é€šé“ï¼Œæ˜¯ HTTP çš„å®‰å…¨ç‰ˆã€‚HTTPS çš„å®‰å…¨åŸºç¡€æ˜¯ SSLã€‚SSL åè®®ä½äº TCP/IP åè®®ä¸å„ç§åº”ç”¨å±‚åè®®ä¹‹é—´ï¼Œä¸ºæ•°æ®é€šè®¯æä¾›å®‰å…¨æ”¯æŒã€‚SSL åè®®å¯åˆ†ä¸ºä¸¤å±‚ï¼šSSL è®°å½•åè®®ï¼ˆSSL Record Protocolï¼‰ï¼Œå®ƒå»ºç«‹åœ¨å¯é çš„ä¼ è¾“åè®®ï¼ˆå¦‚ TCPï¼‰ä¹‹ä¸Šï¼Œä¸ºé«˜å±‚åè®®æä¾›æ•°æ®å°è£…ã€å‹ç¼©ã€åŠ å¯†ç­‰åŸºæœ¬åŠŸèƒ½çš„æ”¯æŒã€‚SSL æ¡æ‰‹åè®®ï¼ˆSSL Handshake Protocolï¼‰ï¼Œå®ƒå»ºç«‹åœ¨ SSL è®°å½•åè®®ä¹‹ä¸Šï¼Œç”¨äºåœ¨å®é™…çš„æ•°æ®ä¼ è¾“å¼€å§‹å‰ï¼Œé€šè®¯åŒæ–¹è¿›è¡Œèº«ä»½è®¤è¯ã€åå•†åŠ å¯†ç®—æ³•ã€äº¤æ¢åŠ å¯†å¯†é’¥ç­‰ã€‚</p>\n<p><img data-src=\"https://uploadfiles.nowcoder.com/images/20220224/4107856_1645697886891/B7268EF66524898CEF0E068EA5F1BA26\" alt=\"https ç¤ºæ„å›¾\" /><br />\nå®¢æˆ·ç«¯åœ¨ä½¿ç”¨ HTTPS æ–¹å¼ä¸ Web æœåŠ¡å™¨é€šä¿¡æ—¶æœ‰ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼Œå¦‚å›¾ä¸Šå›¾æ‰€ç¤ºï¼š</p>\n<ol>\n<li>å®¢æˆ·ä½¿ç”¨ https çš„ URL è®¿é—® Web æœåŠ¡å™¨ï¼Œè¦æ±‚ä¸ Web æœåŠ¡å™¨å»ºç«‹ SSL è¿æ¥ã€‚</li>\n<li>Web æœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯è¯·æ±‚åï¼Œä¼šå°†ç½‘ç«™çš„è¯ä¹¦ä¿¡æ¯ï¼ˆè¯ä¹¦ä¸­åŒ…å«å…¬é’¥ï¼‰ä¼ é€ä¸€ä»½ç»™å®¢æˆ·ç«¯ã€‚</li>\n<li>å®¢æˆ·ç«¯çš„æµè§ˆå™¨ä¸ Web æœåŠ¡å™¨å¼€å§‹åå•† SSL è¿æ¥çš„å®‰å…¨ç­‰çº§ï¼Œä¹Ÿå°±æ˜¯ä¿¡æ¯åŠ å¯†çš„ç­‰çº§ã€‚</li>\n<li>å®¢æˆ·ç«¯çš„æµè§ˆå™¨æ ¹æ®åŒæ–¹åŒæ„çš„å®‰å…¨ç­‰çº§ï¼Œå»ºç«‹ä¼šè¯å¯†é’¥ï¼Œç„¶ååˆ©ç”¨ç½‘ç«™çš„å…¬é’¥å°†ä¼šè¯å¯†é’¥åŠ å¯†ï¼Œå¹¶ä¼ é€ç»™ç½‘ç«™ã€‚</li>\n<li>Web æœåŠ¡å™¨åˆ©ç”¨è‡ªå·±çš„ç§é’¥è§£å¯†å‡ºä¼šè¯å¯†é’¥ã€‚</li>\n<li>Web æœåŠ¡å™¨åˆ©ç”¨ä¼šè¯å¯†é’¥åŠ å¯†ä¸å®¢æˆ·ç«¯ä¹‹é—´çš„é€šä¿¡ã€‚</li>\n</ol>\n<h2 id=\"å…¶å®ƒé—®é¢˜\"><a class=\"anchor\" href=\"#å…¶å®ƒé—®é¢˜\">#</a> å…¶å®ƒé—®é¢˜</h2>\n<ol>\n<li>\n<p>ä»‹ç»ä¸€ä¸‹ HTTP åè®®ä¸­çš„é•¿è¿æ¥å’ŒçŸ­è¿æ¥ã€‚<br />\nHTTP åè®®çš„åº•å±‚ä½¿ç”¨ TCP åè®®ï¼Œæ‰€ä»¥ HTTP åè®®çš„é•¿è¿æ¥å’ŒçŸ­è¿æ¥åœ¨æœ¬è´¨ä¸Šæ˜¯ TCP å±‚çš„é•¿è¿æ¥å’ŒçŸ­è¿æ¥ã€‚ç”±äº TCP å»ºç«‹è¿æ¥ã€ç»´æŠ¤è¿æ¥ã€é‡Šæ”¾è¿æ¥éƒ½æ˜¯è¦æ¶ˆè€—ä¸€å®šçš„èµ„æºï¼Œæµªè´¹ä¸€å®šçš„æ—¶é—´ã€‚æ‰€å¯¹äºæœåŠ¡å™¨æ¥è¯´ï¼Œé¢‘ç¹çš„è¯·æ±‚é‡Šæ”¾è¿æ¥ä¼šæµªè´¹å¤§é‡çš„æ—¶é—´ï¼Œé•¿æ—¶é—´ç»´æŠ¤å¤ªå¤šçš„è¿æ¥çš„è¯åˆéœ€è¦æ¶ˆè€—èµ„æºã€‚æ‰€ä»¥é•¿è¿æ¥å’ŒçŸ­è¿æ¥å¹¶ä¸å­˜åœ¨ä¼˜åŠ£ä¹‹åˆ†ï¼Œåªæ˜¯é€‚ç”¨çš„åœºåˆä¸åŒè€Œå·²ã€‚é•¿è¿æ¥å’ŒçŸ­è¿æ¥åˆ†åˆ«æœ‰å¦‚ä¸‹ä¼˜ç‚¹å’Œç¼ºç‚¹ï¼š<br />\n<strong>é•¿è¿æ¥ä¼˜ç‚¹</strong>ï¼šå¯ä»¥èŠ‚çœè¾ƒå¤šçš„ TCP è¿æ¥å’Œé‡Šæ”¾çš„æ“ä½œï¼ŒèŠ‚çº¦æ—¶é—´ï¼Œå¯¹äºé¢‘ç¹è¯·æ±‚èµ„æºçš„ç”¨æˆ·æ¥è¯´ï¼Œé€‚åˆé•¿è¿æ¥ã€‚<br />\n<strong>é•¿è¿æ¥ç¼ºç‚¹</strong>ï¼šç”±äºæœ‰ä¿æ´»åŠŸèƒ½ï¼Œå½“é‡åˆ°å¤§é‡çš„æ¶æ„è¿æ¥æ—¶ï¼ŒæœåŠ¡å™¨çš„å‹åŠ›ä¼šè¶Šæ¥è¶Šå¤§ã€‚è¿™æ—¶æœåŠ¡å™¨éœ€è¦é‡‡å–ä¸€äº›ç­–ç•¥ï¼Œå…³é—­ä¸€äº›é•¿æ—¶é—´æ²¡æœ‰è¿›è¡Œè¯»å†™äº‹ä»¶çš„çš„è¿æ¥ã€‚<br />\n<strong>çŸ­è¿æ¥ä¼˜ç‚¹</strong>ï¼šçŸ­è¿æ¥å¯¹æœåŠ¡å™¨æ¥è¯´ç®¡ç†æ¯”è¾ƒç®€å•ï¼Œåªè¦å­˜åœ¨çš„è¿æ¥éƒ½æ˜¯æœ‰æ•ˆè¿æ¥ï¼Œä¸éœ€è¦é¢å¤–çš„æ§åˆ¶æ‰‹æ®µï¼Œè€Œä¸”ä¸ä¼šé•¿æ—¶é—´å ç”¨èµ„æº ã€‚<br />\n<strong>çŸ­è¿æ¥ç¼ºç‚¹</strong>ï¼šå¦‚æœå®¢æˆ·ç«¯è¯·æ±‚é¢‘ç¹çš„è¯ï¼Œä¼šåœ¨ TCP çš„å»ºç«‹å’Œé‡Šæ”¾ä¸Šæµªè´¹å¤§é‡çš„æ—¶é—´ã€‚<br />\nä» HTTP/1.1 ç‰ˆæœ¬èµ·ï¼Œé»˜è®¤ä½¿ç”¨é•¿è¿æ¥ç”¨ä»¥ä¿æŒè¿æ¥ç‰¹æ€§ã€‚ä½¿ç”¨é•¿è¿æ¥çš„ HTTP åè®®ï¼Œä¼šåœ¨å“åº”æ¶ˆæ¯æŠ¥æ–‡æ®µåŠ å…¥ï¼šConnection: keep-aliveã€‚TCP ä¸­ä¹Ÿæœ‰ keep aliveï¼Œä½†æ˜¯ TCP ä¸­çš„ keep alive åªæ˜¯æ¢æµ‹ TCP è¿æ¥æ˜¯å¦æ´»ç€ï¼Œè€Œ HTTP ä¸­çš„ keep-alive æ˜¯è®©ä¸€ä¸ª TCP è¿æ¥è·å¾—æ›´ä¹…ä¸€ç‚¹ã€‚</p>\n</li>\n<li>\n<p>è¯´ä¸€è¯´ HTTPS çš„è¯ä¹¦è®¤è¯è¿‡ç¨‹ã€‚</p>\n<ol>\n<li>\n<p>æµè§ˆå™¨å°†è‡ªå·±æ”¯æŒçš„ä¸€å¥—åŠ å¯†è§„åˆ™å‘é€ç»™ç½‘ç«™ã€‚</p>\n</li>\n<li>\n<p>ç½‘ç«™ä»ä¸­é€‰å‡ºä¸€ç»„åŠ å¯†ç®—æ³•ä¸ HASH ç®—æ³•ï¼Œå¹¶å°†è‡ªå·±çš„èº«ä»½ä¿¡æ¯ä»¥è¯ä¹¦çš„å½¢å¼å‘å›ç»™æµè§ˆå™¨ã€‚è¯ä¹¦é‡Œé¢åŒ…å«äº†ç½‘ç«™åœ°å€ï¼ŒåŠ å¯†å…¬é’¥ï¼Œä»¥åŠè¯ä¹¦çš„é¢å‘æœºæ„ç­‰ä¿¡æ¯ã€‚</p>\n</li>\n<li>\n<p>æµè§ˆå™¨è·å¾—ç½‘ç«™è¯ä¹¦ä¹‹åæµè§ˆå™¨è¦åšä»¥ä¸‹å·¥ä½œï¼š</p>\n</li>\n</ol>\n<ul>\n<li>éªŒè¯è¯ä¹¦çš„åˆæ³•æ€§ï¼ˆé¢å‘è¯ä¹¦çš„æœºæ„æ˜¯å¦åˆæ³•ï¼Œè¯ä¹¦ä¸­åŒ…å«çš„ç½‘ç«™åœ°å€æ˜¯å¦ä¸æ­£åœ¨è®¿é—®çš„åœ°å€ä¸€è‡´ç­‰ï¼‰ï¼Œå¦‚æœè¯ä¹¦å—ä¿¡ä»»ï¼Œåˆ™æµè§ˆå™¨æ é‡Œé¢ä¼šæ˜¾ç¤ºä¸€ä¸ªå°é”å¤´ï¼Œå¦åˆ™ä¼šç»™å‡ºè¯ä¹¦ä¸å—ä¿¡çš„æç¤ºã€‚</li>\n<li>å¦‚æœè¯ä¹¦å—ä¿¡ä»»ï¼Œæˆ–è€…æ˜¯ç”¨æˆ·æ¥å—äº†ä¸å—ä¿¡çš„è¯ä¹¦ï¼Œæµè§ˆå™¨ä¼šç”Ÿæˆä¸€ä¸²éšæœºæ•°çš„å¯†ç ï¼Œå¹¶ç”¨è¯ä¹¦ä¸­æä¾›çš„å…¬é’¥åŠ å¯†ã€‚</li>\n<li>ä½¿ç”¨çº¦å®šå¥½çš„ HASH ç®—æ³•è®¡ç®—æ¡æ‰‹æ¶ˆæ¯ï¼Œå¹¶ä½¿ç”¨ç”Ÿæˆçš„éšæœºæ•°å¯¹æ¶ˆæ¯è¿›è¡ŒåŠ å¯†ï¼Œæœ€åå°†ä¹‹å‰ç”Ÿæˆçš„æ‰€æœ‰ä¿¡æ¯å‘é€ç»™ç½‘ç«™ã€‚</li>\n</ul>\n<ol start=\"4\">\n<li>ç½‘ç«™æ¥æ”¶æµè§ˆå™¨å‘æ¥çš„æ•°æ®ä¹‹åè¦åšä»¥ä¸‹çš„æ“ä½œï¼š</li>\n</ol>\n<ul>\n<li>ä½¿ç”¨è‡ªå·±çš„ç§é’¥å°†ä¿¡æ¯è§£å¯†å–å‡ºå¯†ç ï¼Œä½¿ç”¨å¯†ç è§£å¯†æµè§ˆå™¨å‘æ¥çš„æ¡æ‰‹æ¶ˆæ¯ï¼Œå¹¶éªŒè¯ HASH æ˜¯å¦ä¸æµè§ˆå™¨å‘æ¥çš„ä¸€è‡´ã€‚</li>\n<li>ä½¿ç”¨å¯†ç åŠ å¯†ä¸€æ®µæ¡æ‰‹æ¶ˆæ¯ï¼Œå‘é€ç»™æµè§ˆå™¨ã€‚</li>\n</ul>\n<ol start=\"5\">\n<li>æµè§ˆå™¨è§£å¯†å¹¶è®¡ç®—æ¡æ‰‹æ¶ˆæ¯çš„ HASHï¼Œå¦‚æœä¸æœåŠ¡ç«¯å‘æ¥çš„ HASH ä¸€è‡´ï¼Œæ­¤æ—¶æ¡æ‰‹è¿‡ç¨‹ç»“æŸï¼Œä¹‹åæ‰€æœ‰çš„é€šä¿¡æ•°æ®å°†ç”±ä¹‹å‰æµè§ˆå™¨ç”Ÿæˆçš„éšæœºå¯†ç å¹¶åˆ©ç”¨å¯¹ç§°åŠ å¯†ç®—æ³•è¿›è¡ŒåŠ å¯†ã€‚</li>\n</ol>\n</li>\n<li>\n<p>æ‰“å¼€æµè§ˆå™¨ä»è¾“å…¥ç½‘å€åˆ°ç½‘é¡µå‘ˆç°åœ¨å¤§å®¶é¢å‰ï¼ŒèƒŒåå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ<br />\nDNS è§£æï¼šå°†åŸŸåè§£ææˆ IP åœ°å€<br />\n TCP è¿æ¥ï¼šTCP ä¸‰æ¬¡æ¡æ‰‹<br />\nå‘é€ HTTP è¯·æ±‚<br />\næœåŠ¡å™¨å¤„ç†è¯·æ±‚å¹¶è¿”å› HTTP æŠ¥æ–‡<br />\næµè§ˆå™¨è§£ææ¸²æŸ“é¡µé¢<br />\næ–­å¼€è¿æ¥ï¼šTCP å››æ¬¡æŒ¥æ‰‹</p>\n</li>\n</ol>\n",
            "tags": [
                "é¢è¯•æŒ‡åŒ—",
                "è®¡ç®—æœºåŸºç¡€",
                "å…«è‚¡æ–‡",
                "è®¡ç®—æœºç½‘ç»œ"
            ]
        },
        {
            "id": "https://haust-kevin.github.io/2023/10/17/2023-10-bubble-sort/",
            "url": "https://haust-kevin.github.io/2023/10/17/2023-10-bubble-sort/",
            "title": "å†’æ³¡æ’åºã€é¸¡å°¾é…’æ’åºã€æ¢³å­æ’åº",
            "date_published": "2023-10-17T01:40:45.000Z",
            "content_html": "<div class=\"note primary\">\n<p>å†’æ³¡æ’åºåŠå…¶å˜ç§</p>\n</div>\n<h1 id=\"å†’æ³¡æ’åº\"><a class=\"anchor\" href=\"#å†’æ³¡æ’åº\">#</a> å†’æ³¡æ’åº</h1>\n<h2 id=\"ä»‹ç»\"><a class=\"anchor\" href=\"#ä»‹ç»\">#</a> ä»‹ç»</h2>\n<p><strong>å†’æ³¡æ’åº</strong>ï¼Œæ˜¯ä¸€ç§ç®€å•çš„æ’åºç®—æ³•ã€‚å®ƒé‡å¤åœ°èµ°è®¿è¿‡è¦æ’åºçš„æ•°åˆ—ï¼Œä¸€æ¬¡æ¯”è¾ƒä¸¤ä¸ªå…ƒç´ ï¼Œå¦‚æœå®ƒä»¬çš„é¡ºåºé”™è¯¯å°±æŠŠå®ƒä»¬äº¤æ¢è¿‡æ¥ã€‚èµ°è®¿æ•°åˆ—çš„å·¥ä½œæ˜¯é‡å¤åœ°è¿›è¡Œç›´åˆ°æ²¡æœ‰å†éœ€è¦äº¤æ¢ï¼Œä¹Ÿå°±æ˜¯è¯´è¯¥æ•°åˆ—å·²ç»æ’åºå®Œæˆã€‚æ¯æ¬¡å†’æ³¡ï¼Œéƒ½ä¼šå°†æœ€å¤§çš„æ•°ç§»åŠ¨åˆ°æœ€æœ«ç«¯ï¼Œå¹¶ç¼©å°å†’æ³¡èŒƒå›´ã€‚</p>\n<h2 id=\"åŠ¨ç”»\"><a class=\"anchor\" href=\"#åŠ¨ç”»\">#</a> åŠ¨ç”»</h2>\n<p><img data-src=\"https://cdn.jsdelivr.net/gh/haust-Kevin/static@master//images/202310171010738.gif\" alt=\"å†’æ³¡æ’åº\" /></p>\n<h2 id=\"ä»£ç ç¤ºä¾‹\"><a class=\"anchor\" href=\"#ä»£ç ç¤ºä¾‹\">#</a> ä»£ç ç¤ºä¾‹</h2>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token function\">bubbleSort</span><span class=\"token punctuation\">(</span>vector<span class=\"token operator\">&lt;</span><span class=\"token keyword\">int</span><span class=\"token operator\">></span><span class=\"token operator\">&amp;</span> vec<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> vec<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token keyword\">bool</span> swapFlag <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> j <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> j <span class=\"token operator\">&lt;</span> vec<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span> <span class=\"token operator\">-</span> i<span class=\"token punctuation\">;</span> j<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>vec<span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">]</span> <span class=\"token operator\">></span> vec<span class=\"token punctuation\">[</span>j<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                <span class=\"token function\">swap</span><span class=\"token punctuation\">(</span>vec<span class=\"token punctuation\">[</span>j<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> vec<span class=\"token punctuation\">[</span>j <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                swapFlag <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>swapFlag<span class=\"token punctuation\">)</span> <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"é¸¡å°¾é…’æ’åº\"><a class=\"anchor\" href=\"#é¸¡å°¾é…’æ’åº\">#</a> é¸¡å°¾é…’æ’åº</h1>\n<h2 id=\"ä»‹ç»-2\"><a class=\"anchor\" href=\"#ä»‹ç»-2\">#</a> ä»‹ç»</h2>\n<p><strong>é¸¡å°¾é…’æ’åº</strong>ï¼Œæ˜¯å†’æ³¡æ’åºçš„è½»å¾®å˜å½¢ã€‚ä¸åŒçš„åœ°æ–¹åœ¨äºä»ä½åˆ°é«˜ç„¶åä»é«˜åˆ°ä½ï¼Œè€Œå†’æ³¡æ’åºåˆ™ä»…ä»ä½åˆ°é«˜å»æ¯”è¾ƒåºåˆ—é‡Œçš„æ¯ä¸ªå…ƒç´ ã€‚ä»–å¯ä»¥å¾—åˆ°æ¯”å†’æ³¡æ’åºç¨å¾®å¥½ä¸€ç‚¹çš„æ€§èƒ½ï¼ŒåŸå› æ˜¯å†’æ³¡æ’åºåªä»ä¸€ä¸ªæ–¹å‘è¿›è¡Œæ¯”å¯¹ï¼ˆç”±ä½åˆ°é«˜ï¼‰ï¼Œæ¯æ¬¡å¾ªç¯åªç§»åŠ¨ä¸€ä¸ªé¡¹ç›®ã€‚é¸¡å°¾é…’æ’åºï¼Œå¯¹äºä¹Œé¾Ÿï¼ˆåºåˆ—æœ«ç«¯è¾ƒå°çš„æ•°ï¼‰æ¯”è¾ƒå¤šçš„æƒ…å†µï¼Œç›¸å¯¹äºåŸå§‹å†’æ³¡æ’åºæœ‰æ›´å¥½çš„æ€§èƒ½ã€‚<br />\nä»¥åºåˆ—ï¼ˆ2,3,4,5,1ï¼‰ä¸ºä¾‹ï¼Œé¸¡å°¾é…’æ’åºåªéœ€è¦è®¿é—®ä¸€æ¬¡ï¼ˆæ¥å›ä¸¤è¶Ÿï¼‰åºåˆ—å°±å¯ä»¥å®Œæˆæ’åºï¼Œä½†å¦‚æœä½¿ç”¨å†’æ³¡æ’åºåˆ™éœ€è¦å››æ¬¡ã€‚</p>\n<h2 id=\"åŠ¨ç”»-2\"><a class=\"anchor\" href=\"#åŠ¨ç”»-2\">#</a> åŠ¨ç”»</h2>\n<p><img data-src=\"https://cdn.jsdelivr.net/gh/haust-Kevin/static@master//images/202310171008464.gif\" alt=\"é¸¡å°¾é…’æ’åº\" /></p>\n<h2 id=\"ä»£ç ç¤ºä¾‹-2\"><a class=\"anchor\" href=\"#ä»£ç ç¤ºä¾‹-2\">#</a> ä»£ç ç¤ºä¾‹</h2>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token function\">cocktailSort</span><span class=\"token punctuation\">(</span>vector<span class=\"token operator\">&lt;</span><span class=\"token keyword\">int</span><span class=\"token operator\">></span><span class=\"token operator\">&amp;</span> vec<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">int</span> left <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">int</span> right <span class=\"token operator\">=</span> vec<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span>left <span class=\"token operator\">&lt;</span> right<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">bool</span> swapFlag <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> left<span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> right<span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>vec<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">></span> vec<span class=\"token punctuation\">[</span>i <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>                <span class=\"token function\">swap</span><span class=\"token punctuation\">(</span>vec<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> vec<span class=\"token punctuation\">[</span>i <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                swapFlag <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        right<span class=\"token operator\">--</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> right<span class=\"token punctuation\">;</span> i <span class=\"token operator\">></span> left<span class=\"token punctuation\">;</span> i<span class=\"token operator\">--</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>vec<span class=\"token punctuation\">[</span>i <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">></span> vec<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                <span class=\"token function\">swap</span><span class=\"token punctuation\">(</span>vec<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> vec<span class=\"token punctuation\">[</span>i <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                swapFlag <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        left<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>swapFlag<span class=\"token punctuation\">)</span> <span class=\"token keyword\">break</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"æ¢³å­æ’åº\"><a class=\"anchor\" href=\"#æ¢³å­æ’åº\">#</a> æ¢³å­æ’åº</h1>\n<h2 id=\"ä»‹ç»-3\"><a class=\"anchor\" href=\"#ä»‹ç»-3\">#</a> ä»‹ç»</h2>\n<p><strong>æ¢³å­æ’åº</strong>ï¼Œæ”¹è‰¯è‡ªå†’æ³¡æ’åºå’Œå¿«é€Ÿæ’åºï¼Œå…¶è¦æ—¨åœ¨äºæ¶ˆé™¤ä¹Œé¾Ÿï¼Œäº¦å³åœ¨æ•°ç»„å°¾éƒ¨çš„å°æ•°å€¼ï¼Œè¿™äº›æ•°å€¼æ˜¯é€ æˆå†’æ³¡æ’åºç¼“æ…¢çš„ä¸»å› ã€‚ç›¸å¯¹åœ°ï¼Œå…”å­ï¼Œäº¦å³åœ¨æ•°ç»„å‰ç«¯çš„å¤§æ•°å€¼ï¼Œä¸å½±å“å†’æ³¡æ’åºçš„æ€§èƒ½ã€‚<br />\nåœ¨å†’æ³¡æ’åºä¸­ï¼Œåªæ¯”è¾ƒæ•°ç»„ä¸­ç›¸é‚»çš„äºŒé¡¹ï¼Œå³æ¯”è¾ƒçš„äºŒé¡¹çš„é—´è·ï¼ˆGapï¼‰æ˜¯ 1ï¼Œæ¢³æ’åºæå‡ºæ­¤é—´è·å…¶å®å¯å¤§äº 1ï¼Œæ”¹è‡ªæ’å…¥æ’åºçš„å¸Œå°”æ’åºåŒæ ·æå‡ºç›¸åŒè§‚ç‚¹ã€‚æ¢³æ’åºä¸­ï¼Œå¼€å§‹æ—¶çš„é—´è·è®¾ç½®ä¸ºæ•°ç»„é•¿åº¦ï¼Œå¹¶åœ¨å¾ªç¯ä¸­ä»¥å›ºå®šæ¯”ç‡é€’å‡ï¼Œé€šå¸¸é€’å‡ç‡è®¾ç½®ä¸º 1.3ï¼ˆçº¦ä¸ºåŸ gap çš„ 1/8ï¼‰ã€‚åœ¨ä¸€æ¬¡å¾ªç¯ä¸­ï¼Œæ¢³æ’åºå¦‚åŒå†’æ³¡æ’åºä¸€æ ·æŠŠæ•°ç»„ä»é¦–åˆ°å°¾æ‰«æä¸€æ¬¡ï¼Œæ¯”è¾ƒåŠäº¤æ¢ä¸¤é¡¹ï¼Œä¸åŒçš„æ˜¯ä¸¤é¡¹çš„é—´è·ä¸å›ºå®šäº 1ã€‚å¦‚æœé—´è·é€’å‡è‡³ 1ï¼Œæ¢³æ’åºå‡å®šè¾“å…¥æ•°ç»„å¤§è‡´æ’åºå¥½ï¼Œå¹¶ä»¥å†’æ³¡æ’åºä½œæœ€åæ£€æŸ¥åŠä¿®æ­£ã€‚<br />\nåœ¨ gap å¤§äº 1 æ—¶ï¼Œæ¯æ¬¡å°† gap é€’å‡å¹¶æ‰§è¡Œä¸€æ¬¡å†’æ³¡è¿‡ç¨‹ï¼Œåœ¨ gap å˜åˆ° 1 æ—¶ï¼Œæ‰§è¡Œæ­£å¸¸çš„å†’æ³¡æ’åºï¼Œä½†æ˜¯ç”±äºå‰é¢çš„æ¢³ç†ï¼Œåªéœ€è¦æå°‘é‡çš„å†’æ³¡å°±èƒ½å¾—åˆ°æœ‰åºçš„æ•°ç»„ã€‚</p>\n<h2 id=\"åŠ¨ç”»-3\"><a class=\"anchor\" href=\"#åŠ¨ç”»-3\">#</a> åŠ¨ç”»</h2>\n<p><img data-src=\"https://cdn.jsdelivr.net/gh/haust-Kevin/static@master//images/202310171022862.gif\" alt=\"æ¢³æ’åº\" /></p>\n<h2 id=\"ä»£ç ç¤ºä¾‹-3\"><a class=\"anchor\" href=\"#ä»£ç ç¤ºä¾‹-3\">#</a> ä»£ç ç¤ºä¾‹</h2>\n<figure class=\"highlight cpp\"><figcaption data-lang=\"C++\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">void</span> <span class=\"token function\">combSort</span><span class=\"token punctuation\">(</span>vector<span class=\"token operator\">&lt;</span><span class=\"token keyword\">int</span><span class=\"token operator\">></span><span class=\"token operator\">&amp;</span> vec<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">int</span> gap <span class=\"token operator\">=</span> vec<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">bool</span> swapFlag <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">while</span><span class=\"token punctuation\">(</span>gap <span class=\"token operator\">></span> <span class=\"token number\">1</span> <span class=\"token operator\">||</span> swapFlag<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>gap <span class=\"token operator\">></span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            gap <span class=\"token operator\">=</span> <span class=\"token keyword\">int</span> <span class=\"token punctuation\">(</span>gap <span class=\"token operator\">*</span> <span class=\"token number\">0.8</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        swapFlag <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> gap <span class=\"token operator\">+</span> i <span class=\"token operator\">&lt;</span> vec<span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>vec<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span> <span class=\"token operator\">></span> vec<span class=\"token punctuation\">[</span>i <span class=\"token operator\">+</span> gap<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                <span class=\"token function\">swap</span><span class=\"token punctuation\">(</span>vec<span class=\"token punctuation\">[</span>i<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> vec<span class=\"token punctuation\">[</span>i <span class=\"token operator\">+</span> gap<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                swapFlag <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"é€’å‡ç‡\"><a class=\"anchor\" href=\"#é€’å‡ç‡\">#</a> é€’å‡ç‡</h2>\n<p>é€’å‡ç‡çš„è®¾ç½®å½±å“ç€æ¢³æ’åºçš„æ•ˆç‡ï¼ŒåŸä½œè€…ä»¥éšæœºæ•°ä½œå®éªŒï¼Œå¾—åˆ°æœ€æœ‰æ•ˆé€’å‡ç‡ä¸º 1.3 çš„ã€‚å¦‚æœæ­¤æ¯”ç‡å¤ªå°ï¼Œåˆ™å¯¼è‡´ä¸€å¾ªç¯ä¸­æœ‰è¿‡å¤šçš„æ¯”è¾ƒï¼Œå¦‚æœæ¯”ç‡å¤ªå¤§ï¼Œåˆ™æœªèƒ½æœ‰æ•ˆæ¶ˆé™¤æ•°ç»„ä¸­çš„ä¹Œé¾Ÿã€‚<br />\näº¦æœ‰äººæè®®ç”¨ï¼<span class=\"exturl\" data-url=\"aHR0cHM6Ly93aWtpbWVkaWEub3JnL2FwaS9yZXN0X3YxL21lZGlhL21hdGgvcmVuZGVyL3N2Zy81YTY5MGFmODc0NGRlZGZjOGU1YzdjNTAzMWM2YjRjYWMxYWQ2OGEz\"></span> ä½œé€’å‡ç‡ï¼ŒåŒæ—¶å¢åŠ æ¢ç®—è¡¨ååŠ©äºæ¯ä¸€å¾ªç¯å¼€å§‹æ—¶è®¡ç®—æ–°é—´è·ã€‚<br />\nå› ä¸ºç¼–ç¨‹è¯­è¨€ä¸­ä¹˜æ³•æ¯”é™¤æ³•å¿«ï¼Œæ•…ä¼šå–é€’å‡ç‡å€’æ•°ä¸é—´è·ç›¸ä¹˜ï¼Œ<img data-src=\"https://wikimedia.org/api/rest_v1/media/math/render/svg/cf95dfe8165efadd4f406a92b6874f423f9a84c4\" alt=\"\" /></p>\n<h2 id=\"å…¶å®ƒä¼˜åŒ–\"><a class=\"anchor\" href=\"#å…¶å®ƒä¼˜åŒ–\">#</a> å…¶å®ƒä¼˜åŒ–</h2>\n<p>è®¾ç½®é€’å‡ç‡ä¸º 1.3 æ—¶ï¼Œæœ€ååªä¼šæœ‰ä¸‰ç§ä¸åŒçš„é—´è·ç»„åˆï¼š(9, 6, 4, 3, 2, 1)ã€(10, 7, 5, 3, 2, 1)ã€æˆ– (11, 8, 6, 4, 3, 2, 1)ã€‚å®éªŒè¯æ˜ï¼Œå¦‚æœé—´è·å˜æˆ 9 æˆ– 10 æ—¶ä¸€å¾‹æ”¹ä½œ 11ï¼Œåˆ™å¯¹æ•ˆç‡æœ‰æ˜æ˜¾æ”¹å–„ï¼ŒåŸå› æ˜¯å¦‚æœé—´è·æ›¾ç»æ˜¯ 9 æˆ– 10ï¼Œåˆ™åˆ°é—´è·å˜æˆ 1 æ—¶ï¼Œæ•°å€¼é€šå¸¸ä¸æ˜¯é€’å¢åºåˆ—ï¼Œæ•…æ­¤è¦è¿›è¡Œå‡ æ¬¡å†’æ³¡æ’åºå¾ªç¯ä¿®æ­£ã€‚åŠ å…¥æ­¤æŒ‡å®šé—´è·çš„å˜å¼‚å½¢å¼ç§°ä¸º<strong>æ¢³æ’åº - 11</strong></p>\n<h2 id=\"bilibili-è§†é¢‘åˆ†äº«\"><a class=\"anchor\" href=\"#bilibili-è§†é¢‘åˆ†äº«\">#</a> bilibili è§†é¢‘åˆ†äº«</h2>\n<p>\n<div style=\"position: relative; width: 100%; height: 0; padding-bottom: 75%;\">\n<iframe src=\"//player.bilibili.com/player.html?aid=990702293&bvid=BV1Fx4y1M7UZ&cid=974799135&p=1\" scrolling=\"no\" border=\"0\" frameborder=\"no\" framespacing=\"0\" allowfullscreen=\"true\" style=\"position: absolute; width: 100%; height: 100%; left: 0; top: 0;\"> </iframe>\n</div>\n</p>\n<h1 id=\"æ€»ç»“\"><a class=\"anchor\" href=\"#æ€»ç»“\">#</a> æ€»ç»“</h1>\n<p>å†’æ³¡æ’åºã€é¸¡å°¾é…’æ’åºã€æ¢³æ’åºéƒ½æ˜¯ä¼˜ç¾çš„ç®—æ³•ï¼Œåä¸¤ç§å±äºç¬¬ä¸€ç§çš„ä¼˜åŒ–ï¼Œä½†æ˜¯å†’æ³¡æ’åºåªé€‚åˆå¤„ç†åºåˆ—å¤§è‡´æœ‰åºçš„æƒ…å†µï¼Œå¯¹äºç»å¤§å¤šæ•°çš„ä¸€èˆ¬åºåˆ—è¿œä¸å¦‚å½’å¹¶æ’åºã€å¿«é€Ÿæ’åºç­‰ç®—æ³•ã€‚ä¹Ÿä¸ä¼šæœ‰ä»»ä½•è¯­è¨€å°†å†’æ³¡æ’åºä½œä¸ºé»˜è®¤çš„æ’åºç®—æ³•ï¼Œä»–ä»¬å¤§éƒ½é€‰æ‹©å¿«é€Ÿæ’åº + æ’å…¥æ’åºçš„ç»„åˆç®—æ³•ã€‚</p>\n",
            "tags": [
                "æ•°æ®ç»“æ„ä¸ç®—æ³•",
                "ç®—æ³•åŸºç¡€",
                "æ’åºç®—æ³•"
            ]
        },
        {
            "id": "https://haust-kevin.github.io/2023/09/04/2023-09-sgs-wallpaper/",
            "url": "https://haust-kevin.github.io/2023/09/04/2023-09-sgs-wallpaper/",
            "title": "ä¸‰å›½æ€å®˜æ–¹åŸç”»",
            "date_published": "2023-09-04T10:13:39.000Z",
            "content_html": "<div class=\"note primary\">\n<p>å®˜æ–¹å…¬å¼€çš„åŸç”»ã€‚</p>\n</div>\n<p>æœ€è¿‘åœ¨æ‰¾ DIY ä¸‰å›½æ€æ­¦å°†åˆ¶å›¾çš„èµ„æ–™ï¼Œå‘ç°ä¸‰å›½æ€å®˜æ–¹æœ‰å…¬å¼€çš„éƒ¨åˆ†åŸç”»ï¼Œæˆ‘é€šè¿‡ Python æå–å‡ºæ¥ç»™å¤§å®¶åˆ†äº«ä¸€ä¸‹ã€‚</p>\n<h1 id=\"äºŒåå››èŠ‚æ°”\"><a class=\"anchor\" href=\"#äºŒåå››èŠ‚æ°”\">#</a> äºŒåå››èŠ‚æ°”</h1>\n<h2 id=\"å¤„æš‘\"><a class=\"anchor\" href=\"#å¤„æš‘\">#</a> å¤„æš‘</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/K30Wdy1ApCF4lv5QEaU4dW2mUUlrMGAb6GAfui4n.jpeg\" alt=\"å¤„æš‘\" /></p>\n<h2 id=\"ç«‹ç§‹\"><a class=\"anchor\" href=\"#ç«‹ç§‹\">#</a> ç«‹ç§‹</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/YsCiKuMeW3YFL0qIsvXd83RK2e7Q8sfwyVaySOpM.jpeg\" alt=\"ç«‹ç§‹\" /></p>\n<h2 id=\"å¤§æš‘\"><a class=\"anchor\" href=\"#å¤§æš‘\">#</a> å¤§æš‘</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/6l6qW7xf9JOX1Epbt2Jl2echk8WBBN5Km4O1DXu9.jpeg\" alt=\"å¤§æš‘\" /></p>\n<h2 id=\"å°æš‘\"><a class=\"anchor\" href=\"#å°æš‘\">#</a> å°æš‘</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/OIHSRVQq9qMwqHfapVW9fYCkfAn4EdS0d3Sc1uHt.jpeg\" alt=\"å°æš‘\" /></p>\n<h2 id=\"å¤è‡³\"><a class=\"anchor\" href=\"#å¤è‡³\">#</a> å¤è‡³</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/QT4SbPC8ahaR4K4YQe5IJl20fVyF5hEgA18YsbF1.jpeg\" alt=\"å¤è‡³\" /></p>\n<h2 id=\"èŠ’ç§\"><a class=\"anchor\" href=\"#èŠ’ç§\">#</a> èŠ’ç§</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/yfzhEPpe7XR9qdi7kAEPG9PYGkayHY0ZO50sOPGd.jpeg\" alt=\"èŠ’ç§\" /></p>\n<h2 id=\"å°æ»¡\"><a class=\"anchor\" href=\"#å°æ»¡\">#</a> å°æ»¡</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/JUtT7BNyLNBXuYVF5zMRoMjbOnSS7TpVID2mG4XM.jpeg\" alt=\"å°æ»¡\" /></p>\n<h2 id=\"ç«‹å¤\"><a class=\"anchor\" href=\"#ç«‹å¤\">#</a> ç«‹å¤</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/NxSSX3l6fXHgmSoBJ3rjLf5fVrqPZX97UK7sR5tO.jpeg\" alt=\"ç«‹å¤\" /></p>\n<h2 id=\"è°·é›¨\"><a class=\"anchor\" href=\"#è°·é›¨\">#</a> è°·é›¨</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/AAeaiENBOa3DIdXIUr9YMD0Jb69IPWA0qm9yQawi.jpeg\" alt=\"è°·é›¨\" /></p>\n<h2 id=\"æ¸…æ˜\"><a class=\"anchor\" href=\"#æ¸…æ˜\">#</a> æ¸…æ˜</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/EXWshTCXLobNtegeCbCUrs1qB1Do1x120s1K8lPv.jpeg\" alt=\"æ¸…æ˜\" /></p>\n<h2 id=\"æ˜¥åˆ†\"><a class=\"anchor\" href=\"#æ˜¥åˆ†\">#</a> æ˜¥åˆ†</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/URX7WOFGoKE2eTkrX7XBGx43qemQiixqWsxw8bKy.jpeg\" alt=\"æ˜¥åˆ†\" /></p>\n<h2 id=\"æƒŠè›°\"><a class=\"anchor\" href=\"#æƒŠè›°\">#</a> æƒŠè›°</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/C6oeBaGMxPXnp6hCqoUhQfNHw9XCesCqJj4B18wU.jpeg\" alt=\"æƒŠè›°\" /></p>\n<h2 id=\"é›¨æ°´\"><a class=\"anchor\" href=\"#é›¨æ°´\">#</a> é›¨æ°´</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/SxfAs41sLug4Hjn62jS4HpymRSmwClo2KwyoqATJ.jpeg\" alt=\"é›¨æ°´\" /></p>\n<h2 id=\"ç«‹æ˜¥\"><a class=\"anchor\" href=\"#ç«‹æ˜¥\">#</a> ç«‹æ˜¥</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/CXVpDNndOnquHeltGSuYEVk4qxZuDlzpJxzp31cZ.jpeg\" alt=\"ç«‹æ˜¥\" /></p>\n<h2 id=\"å¤§å¯’\"><a class=\"anchor\" href=\"#å¤§å¯’\">#</a> å¤§å¯’</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/XZkwkQkIALrWgyGOG2sSh1X9qlgiNoXan64qepCA.jpeg\" alt=\"å¤§å¯’\" /></p>\n<h2 id=\"å°å¯’\"><a class=\"anchor\" href=\"#å°å¯’\">#</a> å°å¯’</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/uk8pjnheZ3TOZJlCs48s6656KRVTyroszkN7izSu.jpeg\" alt=\"å°å¯’\" /></p>\n<h2 id=\"å†¬è‡³\"><a class=\"anchor\" href=\"#å†¬è‡³\">#</a> å†¬è‡³</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/dDRSORSJvwyK7JslxXhMZrBJHB1YFto5T5qfvOAU.jpeg\" alt=\"å†¬è‡³\" /></p>\n<h2 id=\"å¤§é›ª\"><a class=\"anchor\" href=\"#å¤§é›ª\">#</a> å¤§é›ª</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/JX3Dp9ca3cDkeNUak6X7W5AO66Ywc2XTfSsmjbx3.jpeg\" alt=\"å¤§é›ª\" /></p>\n<h2 id=\"éœœé™\"><a class=\"anchor\" href=\"#éœœé™\">#</a> éœœé™</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/nDtqZ7PDhMGlkEu8t8fb8kEDyWU7YioE8D6Mi5cY.jpeg\" alt=\"éœœé™\" /></p>\n<h2 id=\"å°é›ª\"><a class=\"anchor\" href=\"#å°é›ª\">#</a> å°é›ª</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/w3Nz1MLoiu3E84DC81vQpvnoYi2M5cKJV59x7U3z.jpeg\" alt=\"å°é›ª\" /></p>\n<h2 id=\"å°æš‘-2\"><a class=\"anchor\" href=\"#å°æš‘-2\">#</a> å°æš‘</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/Rt2IG88FWYskcTQR36EJDn8Io8cjQYqMftdiu9ip.jpeg\" alt=\"å°æš‘\" /></p>\n<h2 id=\"ç§‹åˆ†\"><a class=\"anchor\" href=\"#ç§‹åˆ†\">#</a> ç§‹åˆ†</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/0rABBF488yydCkoYjBoMSYnFQv8CjGkRnZRaUexK.jpeg\" alt=\"ç§‹åˆ†\" /></p>\n<h2 id=\"ç«‹ç§‹-2\"><a class=\"anchor\" href=\"#ç«‹ç§‹-2\">#</a> ç«‹ç§‹</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/QvirFR4gaNnSPTWegOwvPwaPZTAFPvIMRpXJGzGI.jpeg\" alt=\"ç«‹ç§‹\" /></p>\n<h2 id=\"ç«‹å†¬\"><a class=\"anchor\" href=\"#ç«‹å†¬\">#</a> ç«‹å†¬</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/WEQ6Tm7I8PftgPSkXBQLugsfyGWorwlsEUMVcnN5.jpeg\" alt=\"ç«‹å†¬\" /></p>\n<h2 id=\"å¯’éœ²\"><a class=\"anchor\" href=\"#å¯’éœ²\">#</a> å¯’éœ²</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/0ojelnJjtdrOvR0aLwIOu2ZMIFvsD1VFrf0G6NKm.jpeg\" alt=\"å¯’éœ²\" /></p>\n<h2 id=\"å¤§æš‘-2\"><a class=\"anchor\" href=\"#å¤§æš‘-2\">#</a> å¤§æš‘</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/G9HhmaUkiKmLWoshxADXkFfZYqtN1TF1Lv339e4A.jpeg\" alt=\"å¤§æš‘\" /></p>\n<h2 id=\"å¤„æš‘-2\"><a class=\"anchor\" href=\"#å¤„æš‘-2\">#</a> å¤„æš‘</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/G88qKGvPR9JWiRrBSnE5c8bg4BHsjFRJCDU5Ucpy.jpeg\" alt=\"å¤„æš‘\" /></p>\n<h2 id=\"ç™½éœ²\"><a class=\"anchor\" href=\"#ç™½éœ²\">#</a> ç™½éœ²</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/p84hrkkwTTGS8stmA2YSHRY7aP4u1QXV1GoFbkcK.jpeg\" alt=\"ç™½éœ²\" /></p>\n<h2 id=\"ç«‹ç§‹-3\"><a class=\"anchor\" href=\"#ç«‹ç§‹-3\">#</a> ç«‹ç§‹</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/20221010045423c5e07ed4214486f3417dc81cb21ea23a.jpeg\" alt=\"ç«‹ç§‹\" /></p>\n<h2 id=\"å¯’éœ²-2\"><a class=\"anchor\" href=\"#å¯’éœ²-2\">#</a> å¯’éœ²</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/20221010045409123cc3d787608ea2b28a9b5bc2eda06f.jpeg\" alt=\"å¯’éœ²\" /></p>\n<h2 id=\"å¤§æš‘-3\"><a class=\"anchor\" href=\"#å¤§æš‘-3\">#</a> å¤§æš‘</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/2022101004535804ebef8b059965c26a9141358e20ee3f.jpeg\" alt=\"å¤§æš‘\" /></p>\n<h2 id=\"å°æš‘-3\"><a class=\"anchor\" href=\"#å°æš‘-3\">#</a> å°æš‘</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/20221010045344804109cf6cfa4c2af24809d1224ce975.jpeg\" alt=\"å°æš‘\" /></p>\n<h2 id=\"ç§‹åˆ†-2\"><a class=\"anchor\" href=\"#ç§‹åˆ†-2\">#</a> ç§‹åˆ†</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/202210100453310ba4b1c7cfdbbf5542f8a6f183af1cb1.jpeg\" alt=\"ç§‹åˆ†\" /></p>\n<h2 id=\"å¤„æš‘-3\"><a class=\"anchor\" href=\"#å¤„æš‘-3\">#</a> å¤„æš‘</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/202210100453196a4d1a12415b91f5387009df63f8a7f5.jpeg\" alt=\"å¤„æš‘\" /></p>\n<h2 id=\"ç™½éœ²-2\"><a class=\"anchor\" href=\"#ç™½éœ²-2\">#</a> ç™½éœ²</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/20221010045305747ee83d80d4d567e237a1a15b431036.jpeg\" alt=\"ç™½éœ²\" /></p>\n<h2 id=\"é›¨æ°´-2\"><a class=\"anchor\" href=\"#é›¨æ°´-2\">#</a> é›¨æ°´</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/20221010045253d55e387a56f50ca73ffe34a2073347c8.jpeg\" alt=\"é›¨æ°´\" /></p>\n<h2 id=\"å°é›ª-2\"><a class=\"anchor\" href=\"#å°é›ª-2\">#</a> å°é›ª</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/20221010045241b701ca8392f071c586e706fd07ad4d5e.jpeg\" alt=\"å°é›ª\" /></p>\n<h2 id=\"å°æ»¡-2\"><a class=\"anchor\" href=\"#å°æ»¡-2\">#</a> å°æ»¡</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/20221010045228bdeeab34890b66188b689adf33dfd7d8.jpeg\" alt=\"å°æ»¡\" /></p>\n<h2 id=\"å°å¯’-2\"><a class=\"anchor\" href=\"#å°å¯’-2\">#</a> å°å¯’</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/20221010045220fc7b0b28fa4892320840707c60b44290.jpeg\" alt=\"å°å¯’\" /></p>\n<h2 id=\"å¤è‡³-2\"><a class=\"anchor\" href=\"#å¤è‡³-2\">#</a> å¤è‡³</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/20221010045106dbbaa5f93b6f5445be99f2d47e0e21e4.jpeg\" alt=\"å¤è‡³\" /></p>\n<h2 id=\"éœœé™-2\"><a class=\"anchor\" href=\"#éœœé™-2\">#</a> éœœé™</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/20221010045056fe2d9728f870209539c43ffa633a214e.jpeg\" alt=\"éœœé™\" /></p>\n<h2 id=\"èŠ’ç§-2\"><a class=\"anchor\" href=\"#èŠ’ç§-2\">#</a> èŠ’ç§</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/20221010045042f993813aa3183ba51bdc12563d6bc4c5.jpeg\" alt=\"èŠ’ç§\" /></p>\n<h2 id=\"ç«‹å¤-2\"><a class=\"anchor\" href=\"#ç«‹å¤-2\">#</a> ç«‹å¤</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/2022101004501381a72e66b146e10d5f60ada7aaea968b.jpeg\" alt=\"ç«‹å¤\" /></p>\n<h2 id=\"ç«‹æ˜¥-2\"><a class=\"anchor\" href=\"#ç«‹æ˜¥-2\">#</a> ç«‹æ˜¥</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/202210100449567318cf603d9b32ba930a88a70d3a4444.jpeg\" alt=\"ç«‹æ˜¥\" /></p>\n<h2 id=\"æƒŠè›°-2\"><a class=\"anchor\" href=\"#æƒŠè›°-2\">#</a> æƒŠè›°</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/20221010044941f15843d99be0d1b3ba0670fa651409f8.jpeg\" alt=\"æƒŠè›°\" /></p>\n<h2 id=\"è°·é›¨-2\"><a class=\"anchor\" href=\"#è°·é›¨-2\">#</a> è°·é›¨</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/20221010044927974a79b4105e1db8ee467880302cb083.jpeg\" alt=\"è°·é›¨\" /></p>\n<h2 id=\"å†¬è‡³-2\"><a class=\"anchor\" href=\"#å†¬è‡³-2\">#</a> å†¬è‡³</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/202210100447241c8326f952a464301e4051375673f0ff.jpeg\" alt=\"å†¬è‡³\" /></p>\n<h2 id=\"å¤§é›ª-2\"><a class=\"anchor\" href=\"#å¤§é›ª-2\">#</a> å¤§é›ª</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/20221010044711a26ac4777f8f886192488c0e26922f47.jpeg\" alt=\"å¤§é›ª\" /></p>\n<h2 id=\"å¤§å¯’-2\"><a class=\"anchor\" href=\"#å¤§å¯’-2\">#</a> å¤§å¯’</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/2022101004465648203934bdd7df0e0daa221e740eb072.jpeg\" alt=\"å¤§å¯’\" /></p>\n<h2 id=\"æ˜¥åˆ†-2\"><a class=\"anchor\" href=\"#æ˜¥åˆ†-2\">#</a> æ˜¥åˆ†</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/20221010040341f0cf9922b6ca9a51fdb88ee3e880e50d.jpeg\" alt=\"æ˜¥åˆ†\" /></p>\n<h1 id=\"åŸç”»çš®è‚¤\"><a class=\"anchor\" href=\"#åŸç”»çš®è‚¤\">#</a> åŸç”»çš®è‚¤</h1>\n<h2 id=\"é’Ÿä¼š-æ½œè›Ÿè§Šå¤©-ç»ˆæå½¢æ€\"><a class=\"anchor\" href=\"#é’Ÿä¼š-æ½œè›Ÿè§Šå¤©-ç»ˆæå½¢æ€\">#</a> é’Ÿä¼š - æ½œè›Ÿè§Šå¤© - ç»ˆæå½¢æ€</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/D7TrosDX18Emcsgh0N5VS2npeSYTUl5qlijW815K.jpeg\" alt=\"é’Ÿä¼š-æ½œè›Ÿè§Šå¤©-ç»ˆæå½¢æ€\" /></p>\n<h2 id=\"é’Ÿä¼š-æ½œè›Ÿè§Šå¤©\"><a class=\"anchor\" href=\"#é’Ÿä¼š-æ½œè›Ÿè§Šå¤©\">#</a> é’Ÿä¼š - æ½œè›Ÿè§Šå¤©</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/CkjlwbTwtAL1VmWNs0nk2e7F6f8BpEv2Dp8a2EMU.jpeg\" alt=\"é’Ÿä¼š-æ½œè›Ÿè§Šå¤©\" /></p>\n<h2 id=\"è²‚è‰-èˆæƒ‘ç¾¤å¿ƒ\"><a class=\"anchor\" href=\"#è²‚è‰-èˆæƒ‘ç¾¤å¿ƒ\">#</a> è²‚è‰ - èˆæƒ‘ç¾¤å¿ƒ</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/jFRfaD6OGALMzUHw4bxO0kN4HN3vNpeaFU2YaTTy.jpeg\" alt=\"è²‚è‰-èˆæƒ‘ç¾¤å¿ƒ\" /></p>\n<h2 id=\"åˆ˜å-å›°é¾™çŠ¹æ–—\"><a class=\"anchor\" href=\"#åˆ˜å-å›°é¾™çŠ¹æ–—\">#</a> åˆ˜å - å›°é¾™çŠ¹æ–—</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/eMpeYXFvgqaI3AE96GT0wuqmMTVxS4W4Cvm329ty.jpeg\" alt=\"åˆ˜å-å›°é¾™çŠ¹æ–—\" /></p>\n<h2 id=\"ç¥å¼ è¾½-å¨éœ‡æ±Ÿä¸œ\"><a class=\"anchor\" href=\"#ç¥å¼ è¾½-å¨éœ‡æ±Ÿä¸œ\">#</a> ç¥å¼ è¾½ - å¨éœ‡æ±Ÿä¸œ</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/YcVOpo7kZQBg8RyOZ2VB8EGFFzzcwm7cqmiEk70V.jpeg\" alt=\"ç¥å¼ è¾½-å¨éœ‡æ±Ÿä¸œ\" /></p>\n<h2 id=\"ç¥åˆ˜å¤‡-é¾™å…´æµ·å†…\"><a class=\"anchor\" href=\"#ç¥åˆ˜å¤‡-é¾™å…´æµ·å†…\">#</a> ç¥åˆ˜å¤‡ - é¾™å…´æµ·å†…</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/vx9DxmSHCTzXrfETQoKi2FZ2LVoqAvmMJxd76Kym.jpeg\" alt=\"ç¥åˆ˜å¤‡-é¾™å…´æµ·å†…\" /></p>\n<h2 id=\"ç¥å…³ç¾½-ä½‘å­ä¼å´\"><a class=\"anchor\" href=\"#ç¥å…³ç¾½-ä½‘å­ä¼å´\">#</a> ç¥å…³ç¾½ - ä½‘å­ä¼å´</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/fOD2tOaTnm67Y7YxV7rcKf1JRqs43s7LtqZsrTMF.jpeg\" alt=\"ç¥å…³ç¾½-ä½‘å­ä¼å´\" /></p>\n<h2 id=\"å‘å¼¥å‘¼-å‘¼é£å”¤é›¨\"><a class=\"anchor\" href=\"#å‘å¼¥å‘¼-å‘¼é£å”¤é›¨\">#</a> å‘å¼¥å‘¼ - å‘¼é£å”¤é›¨</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/QPvP8MP3HnzmRkIiSyZmzH1cHM9JunNmnYm0T6yQ.jpeg\" alt=\"å‘å¼¥å‘¼-å‘¼é£å”¤é›¨\" /></p>\n<h2 id=\"é’Ÿä¼š-æ¬²è°‹è‡ªç«‹\"><a class=\"anchor\" href=\"#é’Ÿä¼š-æ¬²è°‹è‡ªç«‹\">#</a> é’Ÿä¼š - æ¬²è°‹è‡ªç«‹</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/pZV3fY9x7R2AIodn6D82N78EIIq31noN68WDFNld.jpeg\" alt=\"é’Ÿä¼š-æ¬²è°‹è‡ªç«‹\" /></p>\n<h2 id=\"è®¸æ”¸-ç«çƒ§ä¹Œå·¢\"><a class=\"anchor\" href=\"#è®¸æ”¸-ç«çƒ§ä¹Œå·¢\">#</a> è®¸æ”¸ - ç«çƒ§ä¹Œå·¢</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/8L2NDoxFZNbFRESjCsHt6FSCY6zhnKlI7uUOVIyE.jpeg\" alt=\"è®¸æ”¸-ç«çƒ§ä¹Œå·¢\" /></p>\n<h2 id=\"æ­¥ç»ƒå¸ˆ-é¸¾é£å‡¤èˆ\"><a class=\"anchor\" href=\"#æ­¥ç»ƒå¸ˆ-é¸¾é£å‡¤èˆ\">#</a> æ­¥ç»ƒå¸ˆ - é¸¾é£å‡¤èˆ</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/OljZVmbHXPlMJDpC25FfVznGeeajkS8KmpxRi8JM.jpeg\" alt=\"æ­¥ç»ƒå¸ˆ-é¸¾é£å‡¤èˆ\" /></p>\n<h2 id=\"å¤§ä¹”å°ä¹”-å§å¦¹æƒ…æ·±\"><a class=\"anchor\" href=\"#å¤§ä¹”å°ä¹”-å§å¦¹æƒ…æ·±\">#</a> å¤§ä¹”å°ä¹” - å§å¦¹æƒ…æ·±</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/a8JpNERvdL5ZpFnj2Pc65zz0MadFHN0xuSsWEmys.jpeg\" alt=\"å¤§ä¹”å°ä¹”-å§å¦¹æƒ…æ·±\" /></p>\n<h2 id=\"ç‹å…ƒå§¬-è°†è°†æ•™å¯¼\"><a class=\"anchor\" href=\"#ç‹å…ƒå§¬-è°†è°†æ•™å¯¼\">#</a> ç‹å…ƒå§¬ - è°†è°†æ•™å¯¼</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/JyeWpcFXiPJn8xxbF1J7pLTgc2gpmLy8fEB6PCsY.jpeg\" alt=\"ç‹å…ƒå§¬-è°†è°†æ•™å¯¼\" /></p>\n<h2 id=\"å‘¨ä»“-é’é¾™åŒ–åŠ›\"><a class=\"anchor\" href=\"#å‘¨ä»“-é’é¾™åŒ–åŠ›\">#</a> å‘¨ä»“ - é’é¾™åŒ–åŠ›</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/3J9gOIVWmOwNWuE2bPizDdJIWkJ16qETmpEpqh3r.jpeg\" alt=\"å‘¨ä»“-é’é¾™åŒ–åŠ›\" /></p>\n<h2 id=\"æ›¹æ“-é€é¹¿å¤©ä¸‹\"><a class=\"anchor\" href=\"#æ›¹æ“-é€é¹¿å¤©ä¸‹\">#</a> æ›¹æ“ - é€é¹¿å¤©ä¸‹</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/aUeA9b40tMLmX3n5tIZi6sOrEC9brFqu0zCyHZtP.jpeg\" alt=\"æ›¹æ“-é€é¹¿å¤©ä¸‹\" /></p>\n<h2 id=\"ç¥éƒ­å˜‰-å€šæ˜ŸæŠ˜æœˆ-ç»ˆæå½¢æ€\"><a class=\"anchor\" href=\"#ç¥éƒ­å˜‰-å€šæ˜ŸæŠ˜æœˆ-ç»ˆæå½¢æ€\">#</a> ç¥éƒ­å˜‰ - å€šæ˜ŸæŠ˜æœˆ - ç»ˆæå½¢æ€</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/ky7OzRF3OHmSltrKlOvGVwZkALhmGKhtfkF9UEwh.jpeg\" alt=\"ç¥éƒ­å˜‰-å€šæ˜ŸæŠ˜æœˆ-ç»ˆæå½¢æ€\" /></p>\n<h2 id=\"ç¥éƒ­å˜‰-å€šæ˜ŸæŠ˜æœˆ\"><a class=\"anchor\" href=\"#ç¥éƒ­å˜‰-å€šæ˜ŸæŠ˜æœˆ\">#</a> ç¥éƒ­å˜‰ - å€šæ˜ŸæŠ˜æœˆ</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/E4rhS2qUZFCQg6KpIsVkcsTOSlFjkwJvgazJTYD1.jpeg\" alt=\"ç¥éƒ­å˜‰-å€šæ˜ŸæŠ˜æœˆ\" /></p>\n<h2 id=\"å‘¨æ³°-çƒˆç«å†²æ€\"><a class=\"anchor\" href=\"#å‘¨æ³°-çƒˆç«å†²æ€\">#</a> å‘¨æ³° - çƒˆç«å†²æ€</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/XTDq5vMyGErjT5il3UtziXp31pTFtsMqhOT6gNTt.jpeg\" alt=\"å‘¨æ³°-çƒˆç«å†²æ€\" /></p>\n<h2 id=\"å°ä¹”-é‡‡è²æ±Ÿå—\"><a class=\"anchor\" href=\"#å°ä¹”-é‡‡è²æ±Ÿå—\">#</a> å°ä¹” - é‡‡è²æ±Ÿå—</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/BJTKuvl2CiZJXhjN2fRpT7sqIuJj9Zow8Xkyv66m.jpeg\" alt=\"å°ä¹”-é‡‡è²æ±Ÿå—\" /></p>\n<h2 id=\"å¤§ä¹”-è¡£å‚ç»¿å·-\"><a class=\"anchor\" href=\"#å¤§ä¹”-è¡£å‚ç»¿å·-\">#</a> å¤§ä¹” - è¡£å‚ç»¿å· -</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/UIWYW3QxaPoq5qe9oAMrPXW7eRjyuzqcbhIDR8pw.jpeg\" alt=\"å¤§ä¹”-è¡£å‚ç»¿å·-\" /></p>\n<h2 id=\"é™†é€Š-çƒˆç«çƒ›å¤©\"><a class=\"anchor\" href=\"#é™†é€Š-çƒˆç«çƒ›å¤©\">#</a> é™†é€Š - çƒˆç«çƒ›å¤©</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/o9BbZrdbPZ1pSMlZZr3A3nYuH296m0hDaoCRPEUX.jpeg\" alt=\"é™†é€Š-çƒˆç«çƒ›å¤©\" /></p>\n<h2 id=\"å­™å°šé¦™-æ˜Ÿæµéœ†å‡»\"><a class=\"anchor\" href=\"#å­™å°šé¦™-æ˜Ÿæµéœ†å‡»\">#</a> å­™å°šé¦™ - æ˜Ÿæµéœ†å‡»</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/GV01N2RLPYafpdCKzd5b5Loyz44476hhzeklz4f9.jpeg\" alt=\"å­™å°šé¦™-æ˜Ÿæµéœ†å‡»\" /></p>\n<h2 id=\"å…³é“¶å±-æ­¥æ­¥ç”ŸèŠ±\"><a class=\"anchor\" href=\"#å…³é“¶å±-æ­¥æ­¥ç”ŸèŠ±\">#</a> å…³é“¶å± - æ­¥æ­¥ç”ŸèŠ±</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/GX9UMBsFtZChnFngjPNNsVQuJuA3TRjxfzR3k8VE.jpeg\" alt=\"å…³é“¶å±-æ­¥æ­¥ç”ŸèŠ±\" /></p>\n<h2 id=\"ç§¦å®“ç¥å•å¸ƒ-å† ç»å¤©ä¸‹\"><a class=\"anchor\" href=\"#ç§¦å®“ç¥å•å¸ƒ-å† ç»å¤©ä¸‹\">#</a> ç§¦å®“ &amp; ç¥å•å¸ƒ - å† ç»å¤©ä¸‹</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/7zvbyqfX8sSPkeuwHUb8KgQ5izWHpqEA57WETMxO.jpeg\" alt=\"ç§¦å®“&amp;ç¥å•å¸ƒ-å† ç»å¤©ä¸‹\" /></p>\n<h2 id=\"åˆ˜èµªé»„å¿ -æ˜è‰¯åƒå¤\"><a class=\"anchor\" href=\"#åˆ˜èµªé»„å¿ -æ˜è‰¯åƒå¤\">#</a> åˆ˜èµª &amp; é»„å¿  - æ˜è‰¯åƒå¤</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/6KsY6GsKFaZdY1WKsb1XJfAbyCCXpNVJdqfsATfB.jpeg\" alt=\"åˆ˜èµª&amp;é»„å¿ -æ˜è‰¯åƒå¤\" /></p>\n<h2 id=\"æä¸°-å¤ªä»“èšç²Ÿ\"><a class=\"anchor\" href=\"#æä¸°-å¤ªä»“èšç²Ÿ\">#</a> æä¸° - å¤ªä»“èšç²Ÿ</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/iZeZqJJANdmyb2IKGW1dywQtPSuEu8HAbcGj9uoh.jpeg\" alt=\"æä¸°-å¤ªä»“èšç²Ÿ\" /></p>\n<h2 id=\"ç”˜å¤«äºº-ä¸ºå›æ‹…å¿§\"><a class=\"anchor\" href=\"#ç”˜å¤«äºº-ä¸ºå›æ‹…å¿§\">#</a> ç”˜å¤«äºº - ä¸ºå›æ‹…å¿§</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/Ep5DCfSDMRSNjZSnpAwYStLx5CIA3hZfKid4aHiF.jpeg\" alt=\"ç”˜å¤«äºº-ä¸ºå›æ‹…å¿§\" /></p>\n<h2 id=\"è¯¸è‘›ç»-ç»µç«¹ä¹‹æ®‡\"><a class=\"anchor\" href=\"#è¯¸è‘›ç»-ç»µç«¹ä¹‹æ®‡\">#</a> è¯¸è‘›ç» - ç»µç«¹ä¹‹æ®‡</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/3SPA2wJ5R3IL8nbaZncvtdzFL52XNRndGSIG8YP7.jpeg\" alt=\"è¯¸è‘›ç»-ç»µç«¹ä¹‹æ®‡\" /></p>\n<h2 id=\"æ›¹å©´-æ°´æ¸…æ¿¯ç¼¨\"><a class=\"anchor\" href=\"#æ›¹å©´-æ°´æ¸…æ¿¯ç¼¨\">#</a> æ›¹å©´ - æ°´æ¸…æ¿¯ç¼¨</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/1xpoJxWaed8wcop0LMqiskbB4SmsYMohrKyapqSa.jpeg\" alt=\"æ›¹å©´-æ°´æ¸…æ¿¯ç¼¨\" /></p>\n<h2 id=\"å¼ æ˜Œè’²-æœˆä¸‹ä½³äºº\"><a class=\"anchor\" href=\"#å¼ æ˜Œè’²-æœˆä¸‹ä½³äºº\">#</a> å¼ æ˜Œè’² - æœˆä¸‹ä½³äºº</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/pqhXT0XONQT6oniuPm6QKiMvYI9x1apEVZimwwrj.jpeg\" alt=\"å¼ æ˜Œè’²-æœˆä¸‹ä½³äºº\" /></p>\n<h2 id=\"è”¡è´å§¬-ä¸è¶å…±èˆ\"><a class=\"anchor\" href=\"#è”¡è´å§¬-ä¸è¶å…±èˆ\">#</a> è”¡è´å§¬ - ä¸è¶å…±èˆ</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/4Ku8dzet4pub91dMLvuRbfc50TI1qdmlnjAPgMtg.jpeg\" alt=\"è”¡è´å§¬-ä¸è¶å…±èˆ\" /></p>\n<h2 id=\"è”¡æ–‡å§¬-å† ç»å¤©ä¸‹\"><a class=\"anchor\" href=\"#è”¡æ–‡å§¬-å† ç»å¤©ä¸‹\">#</a> è”¡æ–‡å§¬ - å† ç»å¤©ä¸‹</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/XZkOkoM0YGoNsr21YjeGNl06hsz92NYZ1kEz67hR.jpeg\" alt=\"è”¡æ–‡å§¬-å† ç»å¤©ä¸‹\" /></p>\n<h2 id=\"å­™æƒ-å† ç»å¤©ä¸‹\"><a class=\"anchor\" href=\"#å­™æƒ-å† ç»å¤©ä¸‹\">#</a> å­™æƒ - å† ç»å¤©ä¸‹</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/dPHHNYLAGyQEzHh8V8FodAW8Yx2GPmQxm3k5WYqO.jpeg\" alt=\"å­™æƒ-å† ç»å¤©ä¸‹\" /></p>\n<h2 id=\"å¼ è¾½-ç™»å³°é™·é˜µ\"><a class=\"anchor\" href=\"#å¼ è¾½-ç™»å³°é™·é˜µ\">#</a> å¼ è¾½ - ç™»å³°é™·é˜µ</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/8jzgfkyzAOH7lY7QHHtfH3vIkzQ6cVmNuVCmNeEd.jpeg\" alt=\"å¼ è¾½-ç™»å³°é™·é˜µ\" /></p>\n<h2 id=\"æ›¹æ˜‚-ç«­æˆ˜é³ä¼¤\"><a class=\"anchor\" href=\"#æ›¹æ˜‚-ç«­æˆ˜é³ä¼¤\">#</a> æ›¹æ˜‚ - ç«­æˆ˜é³ä¼¤</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/oPzlBK7O8sCfY5OoqRK8Utb7lBJtyMOKSxX70tXM.jpeg\" alt=\"æ›¹æ˜‚-ç«­æˆ˜é³ä¼¤\" /></p>\n<h2 id=\"é’Ÿä¼šé’Ÿç¹‡-å·é…’ä¸æ‹œ\"><a class=\"anchor\" href=\"#é’Ÿä¼šé’Ÿç¹‡-å·é…’ä¸æ‹œ\">#</a> é’Ÿä¼š &amp; é’Ÿç¹‡ - å·é…’ä¸æ‹œ</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/i7U6YuBge8c2KiuT2lD9nxhiJQjSWK3UG1cl4nUb.jpeg\" alt=\"é’Ÿä¼š&amp;é’Ÿç¹‡-å·é…’ä¸æ‹œ\" /></p>\n<h2 id=\"ç•™èµ-çµé­‚æ­Œç‹\"><a class=\"anchor\" href=\"#ç•™èµ-çµé­‚æ­Œç‹\">#</a> ç•™èµ - çµé­‚æ­Œç‹</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/JEtSQUJyknSNvqKBp4XJ4IePmHrKFPpXG3NgeR9d.jpeg\" alt=\"ç•™èµ-çµé­‚æ­Œç‹\" /></p>\n<h2 id=\"è€å½§-é©±è™åç‹¼\"><a class=\"anchor\" href=\"#è€å½§-é©±è™åç‹¼\">#</a> è€å½§ - é©±è™åç‹¼</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/6kLHMKjP3jZWtp0t8cSlACioboZYBapA24br0Bb5.jpeg\" alt=\"è€å½§-é©±è™åç‹¼\" /></p>\n<h2 id=\"å¼ é£å¤ä¾¯æ°-æ˜è‰¯åƒå¤\"><a class=\"anchor\" href=\"#å¼ é£å¤ä¾¯æ°-æ˜è‰¯åƒå¤\">#</a> å¼ é£ &amp; å¤ä¾¯æ° - æ˜è‰¯åƒå¤</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/EXOMmWTDI57NmW1mRTAMCKUwai0YoDhCTGlYbvUb.jpeg\" alt=\"å¼ é£&amp;å¤ä¾¯æ°-æ˜è‰¯åƒå¤\" /></p>\n<h2 id=\"èµµäº‘é©¬äº‘ç¦„-æ˜è‰¯åƒå¤\"><a class=\"anchor\" href=\"#èµµäº‘é©¬äº‘ç¦„-æ˜è‰¯åƒå¤\">#</a> èµµäº‘ &amp; é©¬äº‘ç¦„ - æ˜è‰¯åƒå¤</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/Y2dhrrzHYd1v5ruMXG44Jkoq1vkac77uVXI1wJB6.jpeg\" alt=\"èµµäº‘&amp;é©¬äº‘ç¦„-æ˜è‰¯åƒå¤\" /></p>\n<h2 id=\"é©¬è¶…æ¨å©‰-æ˜è‰¯åƒå¤\"><a class=\"anchor\" href=\"#é©¬è¶…æ¨å©‰-æ˜è‰¯åƒå¤\">#</a> é©¬è¶… &amp; æ¨å©‰ - æ˜è‰¯åƒå¤</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/mlyzStnFX3bs7OgGlc4nam5kbQwBPUFp6nuZdZ8G.jpeg\" alt=\"é©¬è¶…&amp;æ¨å©‰-æ˜è‰¯åƒå¤\" /></p>\n<h2 id=\"å…³ç¾½èƒ¡é‡‘å®š-æ˜è‰¯åƒå¤\"><a class=\"anchor\" href=\"#å…³ç¾½èƒ¡é‡‘å®š-æ˜è‰¯åƒå¤\">#</a> å…³ç¾½ &amp; èƒ¡é‡‘å®š - æ˜è‰¯åƒå¤</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/99nRKFYANgV15cUiAmv9j6lmdwqiorIxMvLYgyNj.jpeg\" alt=\"å…³ç¾½&amp;èƒ¡é‡‘å®š-æ˜è‰¯åƒå¤\" /></p>\n<h2 id=\"æˆå¿—æ‰-ä¸¾æ£‹è‹¥å®š\"><a class=\"anchor\" href=\"#æˆå¿—æ‰-ä¸¾æ£‹è‹¥å®š\">#</a> æˆå¿—æ‰ - ä¸¾æ£‹è‹¥å®š</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/6a7f64RfFq7WWoC8L7FUuC2SoZIOJKKu7oOGul58.jpeg\" alt=\"æˆå¿—æ‰-ä¸¾æ£‹è‹¥å®š\" /></p>\n<h2 id=\"éƒ­å˜‰-æ¢…é¦™å¦‚æ•…\"><a class=\"anchor\" href=\"#éƒ­å˜‰-æ¢…é¦™å¦‚æ•…\">#</a> éƒ­å˜‰ - æ¢…é¦™å¦‚æ•…</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/SedOsxJkHiKm7mxVjNXoTVX5cu9araUOeYI7L7xn.jpeg\" alt=\"éƒ­å˜‰-æ¢…é¦™å¦‚æ•…\" /></p>\n<h2 id=\"å¼ æ˜Ÿå½©-ä¸´å†›å¯¹é˜µ\"><a class=\"anchor\" href=\"#å¼ æ˜Ÿå½©-ä¸´å†›å¯¹é˜µ\">#</a> å¼ æ˜Ÿå½© - ä¸´å†›å¯¹é˜µ</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/bpklbPfzjASjVETYDIXPpilgBXTGKiYvaUJtN6Oy.jpeg\" alt=\"å¼ æ˜Ÿå½©-ä¸´å†›å¯¹é˜µ\" /></p>\n<h2 id=\"æ›¹å†²-èªå¯Ÿå²å¶·\"><a class=\"anchor\" href=\"#æ›¹å†²-èªå¯Ÿå²å¶·\">#</a> æ›¹å†² - èªå¯Ÿå²å¶·</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/n8noE96tVcY0psl8gP8amk7ScxqCAKq49Ss2Dd8a.jpeg\" alt=\"æ›¹å†²-èªå¯Ÿå²å¶·\" /></p>\n<h2 id=\"å¼ æ˜­å¼ çº®-åŒå¿ƒååŠ›\"><a class=\"anchor\" href=\"#å¼ æ˜­å¼ çº®-åŒå¿ƒååŠ›\">#</a> å¼ æ˜­å¼ çº® - åŒå¿ƒååŠ›</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/dVLRImpp0hE8Y5tmMtVuROQYilVNbvWmkUbcKPFr.jpeg\" alt=\"å¼ æ˜­å¼ çº®-åŒå¿ƒååŠ›\" /></p>\n<h2 id=\"é»„å¿ -æ˜è‰¯åƒå¤\"><a class=\"anchor\" href=\"#é»„å¿ -æ˜è‰¯åƒå¤\">#</a> é»„å¿  - æ˜è‰¯åƒå¤</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/KKU0VyRJGIPqsEeUFTzbQ3PEf4c27FN5qUpD2iNM.jpeg\" alt=\"é»„å¿ -æ˜è‰¯åƒå¤\" /></p>\n<h2 id=\"åˆ˜èµª-æ˜è‰¯åƒå¤\"><a class=\"anchor\" href=\"#åˆ˜èµª-æ˜è‰¯åƒå¤\">#</a> åˆ˜èµª - æ˜è‰¯åƒå¤</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/4FPdnmAFwU4C7iy1THlN4SQGnOjyhjjVZpifaxnd.jpeg\" alt=\"åˆ˜èµª-æ˜è‰¯åƒå¤\" /></p>\n<h2 id=\"æœ±ç„¶-å‰‘èˆæ«é£\"><a class=\"anchor\" href=\"#æœ±ç„¶-å‰‘èˆæ«é£\">#</a> æœ±ç„¶ - å‰‘èˆæ«é£</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/5xk36VyRR2St1AMecOn2YrrVqtReqPUEig5YmQMO.jpeg\" alt=\"æœ±ç„¶-å‰‘èˆæ«é£\" /></p>\n<h2 id=\"ç‹å…ƒå§¬-è²æ± æˆæ°´\"><a class=\"anchor\" href=\"#ç‹å…ƒå§¬-è²æ± æˆæ°´\">#</a> ç‹å…ƒå§¬ - è²æ± æˆæ°´</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/fNEnD7QYnNH7mjDd5OybdpFaxo2965YXbgzwPdU9.jpeg\" alt=\"ç‹å…ƒå§¬-è²æ± æˆæ°´\" /></p>\n<h2 id=\"å¾ç››-ç ´å†›æ€å°†\"><a class=\"anchor\" href=\"#å¾ç››-ç ´å†›æ€å°†\">#</a> å¾ç›› - ç ´å†›æ€å°†</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/tLKYW5yN0Vl1HEcVlxm0CSCYIJPI6VTS6lSB3IgB.jpeg\" alt=\"å¾ç››-ç ´å†›æ€å°†\" /></p>\n<h2 id=\"èŠ±é¬˜-å—è›®å…¬ä¸»\"><a class=\"anchor\" href=\"#èŠ±é¬˜-å—è›®å…¬ä¸»\">#</a> èŠ±é¬˜ - å—è›®å…¬ä¸»</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/At8ex0HLH9fASAAwOZ3wJnKStkYZupa5quDeFY6O.jpeg\" alt=\"èŠ±é¬˜-å—è›®å…¬ä¸»\" /></p>\n<h2 id=\"æ›¹æ“-é›„åå¤©ä¸‹\"><a class=\"anchor\" href=\"#æ›¹æ“-é›„åå¤©ä¸‹\">#</a> æ›¹æ“ - é›„åå¤©ä¸‹</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/S8M9z0qqSenSnaFEMQtspf2l3NZoIcp0S4zWimw5.jpeg\" alt=\"æ›¹æ“-é›„åå¤©ä¸‹\" /></p>\n<h2 id=\"å¼ æ˜¥å-é›ªä¸­èˆåˆƒ\"><a class=\"anchor\" href=\"#å¼ æ˜¥å-é›ªä¸­èˆåˆƒ\">#</a> å¼ æ˜¥å - é›ªä¸­èˆåˆƒ</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/YYktjLbiDnQBUZDsW6cZkmHLuAhiW9h3dSvGqEuS.jpeg\" alt=\"å¼ æ˜¥å-é›ªä¸­èˆåˆƒ\" /></p>\n<h1 id=\"ä½³èŠ‚åº†å…¸\"><a class=\"anchor\" href=\"#ä½³èŠ‚åº†å…¸\">#</a> ä½³èŠ‚åº†å…¸</h1>\n<h2 id=\"2023-å…”å¹´æ¸…æ˜\"><a class=\"anchor\" href=\"#2023-å…”å¹´æ¸…æ˜\">#</a> 2023 - å…”å¹´æ¸…æ˜</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/lctjEaj2p01piHDg8OKd9tVtsOEHWwgDFYv0bhuV.jpeg\" alt=\"2023-å…”å¹´æ¸…æ˜\" /></p>\n<h2 id=\"2023-å…”å¹´æ˜¥èŠ‚\"><a class=\"anchor\" href=\"#2023-å…”å¹´æ˜¥èŠ‚\">#</a> 2023 - å…”å¹´æ˜¥èŠ‚</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/ikkowUajAhK9Uk7rboKZJz1wpXa8TzoNKATs9CXJ.jpeg\" alt=\"2023-å…”å¹´æ˜¥èŠ‚\" /></p>\n<h2 id=\"2022-è™å¹´ç«¯åˆ\"><a class=\"anchor\" href=\"#2022-è™å¹´ç«¯åˆ\">#</a> 2022 - è™å¹´ç«¯åˆ</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/BrTa3wVd3dDFyQwH2S8kjVLboGvMnGnPw2Zlbvi1.jpeg\" alt=\"2022-è™å¹´ç«¯åˆ\" /></p>\n<h2 id=\"2022-è™å¹´æ¸…æ˜\"><a class=\"anchor\" href=\"#2022-è™å¹´æ¸…æ˜\">#</a> 2022 - è™å¹´æ¸…æ˜</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/wvS3skEXImOkSWQXWFRVzH0YYpRTrrpqXcr33qJG.jpeg\" alt=\"2022-è™å¹´æ¸…æ˜\" /></p>\n<h2 id=\"2022-è™å¹´æ˜¥èŠ‚\"><a class=\"anchor\" href=\"#2022-è™å¹´æ˜¥èŠ‚\">#</a> 2022 - è™å¹´æ˜¥èŠ‚</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/fQKKAVnoJLZpwTnBltiOMxCv6hEO2gc6tWuBotew.jpeg\" alt=\"2022-è™å¹´æ˜¥èŠ‚\" /></p>\n<h2 id=\"2022-è™å¹´å†¬è‡³\"><a class=\"anchor\" href=\"#2022-è™å¹´å†¬è‡³\">#</a> 2022 - è™å¹´å†¬è‡³</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/3sxttL3ALEJAYB2BfS0CyNMZMvpvFsoL9bUJQlHi.jpeg\" alt=\"2022-è™å¹´å†¬è‡³\" /></p>\n<h2 id=\"2022-è™å¹´ä¸­ç§‹\"><a class=\"anchor\" href=\"#2022-è™å¹´ä¸­ç§‹\">#</a> 2022 - è™å¹´ä¸­ç§‹</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/w4FZ46Tx3mXDzDyPkrss6LoK6HzFVuXZEfmJzQNO.jpeg\" alt=\"2022-è™å¹´ä¸­ç§‹\" /></p>\n<h2 id=\"2022-è™å¹´ä¸ƒå¤•\"><a class=\"anchor\" href=\"#2022-è™å¹´ä¸ƒå¤•\">#</a> 2022 - è™å¹´ä¸ƒå¤•</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/Hgw8HNzW1a4nqrz4lw3eZwBJvEGD9y6NeQ8wIz5M.jpeg\" alt=\"2022-è™å¹´ä¸ƒå¤•\" /></p>\n<h2 id=\"2021-ç‰›å¹´ç«¯åˆ\"><a class=\"anchor\" href=\"#2021-ç‰›å¹´ç«¯åˆ\">#</a> 2021 - ç‰›å¹´ç«¯åˆ</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/P3rxF2qCTH6BPwpeJv8Ipg9bafKt1C1sNnq1JOg5.jpeg\" alt=\"2021-ç‰›å¹´ç«¯åˆ\" /></p>\n<h2 id=\"2021-ç‰›å¹´ç«‹å†¬\"><a class=\"anchor\" href=\"#2021-ç‰›å¹´ç«‹å†¬\">#</a> 2021 - ç‰›å¹´ç«‹å†¬</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/ElhwfQp05kzpQsfufxNsiI9xbn5NFzHMymWNB6Um.jpeg\" alt=\"2021-ç‰›å¹´ç«‹å†¬\" /></p>\n<h2 id=\"2021-ç‰›å¹´æ¸…æ˜\"><a class=\"anchor\" href=\"#2021-ç‰›å¹´æ¸…æ˜\">#</a> 2021 - ç‰›å¹´æ¸…æ˜</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/MaWTO2Lfg3AUQLFZATwf0ZRaK1GUVaWx6TG3TYeM.jpeg\" alt=\"2021-ç‰›å¹´æ¸…æ˜\" /></p>\n<h2 id=\"2021-ç‰›å¹´æ˜¥èŠ‚\"><a class=\"anchor\" href=\"#2021-ç‰›å¹´æ˜¥èŠ‚\">#</a> 2021 - ç‰›å¹´æ˜¥èŠ‚</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/hNLj3eOgnNRduaiTaKB561xz4u2lheRLuBrzTe1a.jpeg\" alt=\"2021-ç‰›å¹´æ˜¥èŠ‚\" /></p>\n<h2 id=\"2021-ç‰›å¹´ä¸­ç§‹\"><a class=\"anchor\" href=\"#2021-ç‰›å¹´ä¸­ç§‹\">#</a> 2021 - ç‰›å¹´ä¸­ç§‹</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/riIctvg39IAWHzMEl553CAUUoDSSeL6fisQGY00l.jpeg\" alt=\"2021-ç‰›å¹´ä¸­ç§‹\" /></p>\n<h2 id=\"2021-ç‰›å¹´ä¸ƒå¤•\"><a class=\"anchor\" href=\"#2021-ç‰›å¹´ä¸ƒå¤•\">#</a> 2021 - ç‰›å¹´ä¸ƒå¤•</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/yvpkRrr1ObYVLnl4I5uf4Oi9pk235yQv9DJvcqSQ.jpeg\" alt=\"2021-ç‰›å¹´ä¸ƒå¤•\" /></p>\n<h2 id=\"2020-é¼ å¹´ç«¯åˆ\"><a class=\"anchor\" href=\"#2020-é¼ å¹´ç«¯åˆ\">#</a> 2020 - é¼ å¹´ç«¯åˆ</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/NLiwLUOqSvdeA895OmP7hOUAywOQn2GAYAZEMj49.jpeg\" alt=\"2020-é¼ å¹´ç«¯åˆ\" /></p>\n<h2 id=\"2020-é¼ å¹´æ˜¥èŠ‚\"><a class=\"anchor\" href=\"#2020-é¼ å¹´æ˜¥èŠ‚\">#</a> 2020 - é¼ å¹´æ˜¥èŠ‚</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/SC6Gff4kBUBYpRuJMZi6KZjBivyOWpHcNnDix3EL.jpeg\" alt=\"2020-é¼ å¹´æ˜¥èŠ‚\" /></p>\n<h2 id=\"2020-é¼ å¹´æ˜¥åˆ†\"><a class=\"anchor\" href=\"#2020-é¼ å¹´æ˜¥åˆ†\">#</a> 2020 - é¼ å¹´æ˜¥åˆ†</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/worXkCcp5dphxpidUe1TIAiavQJDDhbObr0RNa7k.jpeg\" alt=\"2020-é¼ å¹´æ˜¥åˆ†\" /></p>\n<h2 id=\"2020-é¼ å¹´å†¬è‡³\"><a class=\"anchor\" href=\"#2020-é¼ å¹´å†¬è‡³\">#</a> 2020 - é¼ å¹´å†¬è‡³</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/fX1DeBOFD14MngMPvE149WZViVqu7e1HFWhuG0mv.jpeg\" alt=\"2020-é¼ å¹´å†¬è‡³\" /></p>\n<h2 id=\"2020-é¼ å¹´ä¸­ç§‹\"><a class=\"anchor\" href=\"#2020-é¼ å¹´ä¸­ç§‹\">#</a> 2020 - é¼ å¹´ä¸­ç§‹</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/a7IB2yjBkUmPnEwPODG4RFAx2LItbpaWDmtiAnia.jpeg\" alt=\"2020-é¼ å¹´ä¸­ç§‹\" /></p>\n<h2 id=\"2020-é¼ å¹´ä¸ƒå¤•\"><a class=\"anchor\" href=\"#2020-é¼ å¹´ä¸ƒå¤•\">#</a> 2020 - é¼ å¹´ä¸ƒå¤•</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/kYUTaW3FXRE3Ym4HRYreua3ONOAJupM254dXQbpp.jpeg\" alt=\"2020-é¼ å¹´ä¸ƒå¤•\" /></p>\n<h2 id=\"2019-çŒªå¹´ç«¯åˆ\"><a class=\"anchor\" href=\"#2019-çŒªå¹´ç«¯åˆ\">#</a> 2019 - çŒªå¹´ç«¯åˆ</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/tSvH2ESL6b3PI9GqsJTsQeYvS3dmPotGEERyeI4o.jpeg\" alt=\"2019-çŒªå¹´ç«¯åˆ\" /></p>\n<h2 id=\"2019-çŒªå¹´å¤§é›ª\"><a class=\"anchor\" href=\"#2019-çŒªå¹´å¤§é›ª\">#</a> 2019 - çŒªå¹´å¤§é›ª</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/D8hjEs5pP5Fc87VaS4uni4xDTPZy32DUybyIVU92.jpeg\" alt=\"2019-çŒªå¹´å¤§é›ª\" /></p>\n<h2 id=\"2019-çŒªå¹´åœ£è¯\"><a class=\"anchor\" href=\"#2019-çŒªå¹´åœ£è¯\">#</a> 2019 - çŒªå¹´åœ£è¯</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/iIcKQO5lFSCI4wRdKQfbBs8TeWEU6iRYeCi6FPdM.jpeg\" alt=\"2019-çŒªå¹´åœ£è¯\" /></p>\n<h2 id=\"2019-çŒªå¹´ä¸­ç§‹\"><a class=\"anchor\" href=\"#2019-çŒªå¹´ä¸­ç§‹\">#</a> 2019 - çŒªå¹´ä¸­ç§‹</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/7fVIxnF8vuY974URODtLxMNdGGe1RuP4Q9GqO1iM.jpeg\" alt=\"2019-çŒªå¹´ä¸­ç§‹\" /></p>\n<h2 id=\"2019-çŒªå¹´ä¸ƒå¤•\"><a class=\"anchor\" href=\"#2019-çŒªå¹´ä¸ƒå¤•\">#</a> 2019 - çŒªå¹´ä¸ƒå¤•</h2>\n<p><img data-src=\"https://www.sanguosha.cn/storage/uploads/images/bRKj32LVpBD2hdpn1nLkFqNsmT8J7pnGU8OxbDhj.jpeg\" alt=\"2019-çŒªå¹´ä¸ƒå¤•\" /></p>\n",
            "tags": [
                "ä¸‰å›½æ€"
            ]
        },
        {
            "id": "https://haust-kevin.github.io/2023/08/22/2023-08-%E7%BD%97%E7%BF%94%E8%B0%88%E3%80%8A%E9%87%8D%E5%88%91%E4%B8%BB%E4%B9%89%E3%80%8B/",
            "url": "https://haust-kevin.github.io/2023/08/22/2023-08-%E7%BD%97%E7%BF%94%E8%B0%88%E3%80%8A%E9%87%8D%E5%88%91%E4%B8%BB%E4%B9%89%E3%80%8B/",
            "title": "ç½—ç¿”è¯´åˆ‘æ³•ï¼šé‡åˆ‘ä¸»ä¹‰",
            "date_published": "2023-08-21T16:00:01.000Z",
            "content_html": "<div class=\"note primary\">\n<p>ç½—ç¿”è¯´åˆ‘æ³•ï¼šã€Šã€ç½—ç¿”ã€‘ç½‘ç»œåˆ¤æ¡ˆï¼Œäººå‡æ­»åˆ‘ï¼ŸèŠèŠé‡åˆ‘ä¸»ä¹‰ã€‹çš„æ¦‚è¦å’Œè§‚åæ€»ç»“</p>\n</div>\n<h1 id=\"åŸè§†é¢‘\"><a class=\"anchor\" href=\"#åŸè§†é¢‘\">#</a> åŸè§†é¢‘</h1>\n<ul>\n<li>è§†é¢‘åç§°ï¼šã€ç½—ç¿”ã€‘ç½‘ç»œåˆ¤æ¡ˆï¼Œäººå‡æ­»åˆ‘ï¼ŸèŠèŠé‡åˆ‘ä¸»ä¹‰</li>\n<li>è§†é¢‘é“¾æ¥ï¼š <code>https://www.bilibili.com/video/BV1Ep4y1J7mk</code></li>\n<li>ç›´è¾¾è§†é¢‘ï¼š<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYmlsaWJpbGkuY29tL3ZpZGVvL0JWMUVwNHkxSjdtaw==\">ã€ç½—ç¿”ã€‘ç½‘ç»œåˆ¤æ¡ˆï¼Œäººå‡æ­»åˆ‘ï¼ŸèŠèŠé‡åˆ‘ä¸»ä¹‰</span></li>\n</ul>\n<h1 id=\"è§†é¢‘ç²¾ç®€\"><a class=\"anchor\" href=\"#è§†é¢‘ç²¾ç®€\">#</a> è§†é¢‘ç²¾ç®€</h1>\n<h2 id=\"æ¡ˆä¾‹å¼•å‡º\"><a class=\"anchor\" href=\"#æ¡ˆä¾‹å¼•å‡º\">#</a> æ¡ˆä¾‹å¼•å‡º</h2>\n<p>å¤æŸåœ¨æ±ªæŸå®¶è¿›è¡Œæ–½å·¥ï¼Œå‘ç°æ±ªæŸå®¶æœ‰ä¸¤æœµå¥½çœ‹çš„èŠ±ï¼Œä¾¿æŒ–èµ°ç§å›äº†è‡ªå·±å®¶ï¼Œæ±ªæŸå‘ç°åæŠ¥äº†è­¦ï¼Œç»ä»·å€¼è®¤å®šä¸­å¿ƒè®¤å®šï¼Œä¸¤æœµèŠ±å±äºåè´µèŠ±å‰ï¼Œä»·å€¼ 70,000ã€‚<br />\nåœ¨è¯¥ç›—çªƒæ¡ˆä¸­å­˜åœ¨çš„æ•°é¢é—®é¢˜ä¸Šï¼Œç”±äºå¤æŸä¸»è§‚ä¸Šè®¤ä¸ºä¸¤æœµèŠ±åªå€¼å‡ ç™¾ç”šè‡³å‡ åå—é’±ï¼Œè€Œå®¢è§‚ä¸Šä¸¤æœµèŠ±ä»·å€¼ 70,000ï¼Œå…¶ä¸­å­˜åœ¨äº†è®¤çŸ¥é—®é¢˜ï¼Œè€Œå¦‚ä½•å®šè¯¥æ¡ˆä»¶çš„ç›—çªƒæ•°é¢å±äºåˆ‘æ³•å­¦éœ€è¦è®¨è®ºçš„é—®é¢˜ã€‚</p>\n<h2 id=\"é‡åˆ‘ä¸»ä¹‰\"><a class=\"anchor\" href=\"#é‡åˆ‘ä¸»ä¹‰\">#</a> é‡åˆ‘ä¸»ä¹‰</h2>\n<p>å¾ˆå¤šäººè®¤ä¸ºï¼šâ€œä¸ºä»€ä¹ˆè€æ˜¯ä¸ºçŠ¯ç½ªäººè¯´è¯å‘¢ï¼Ÿä¸ºçŠ¯ç½ªäººè¯´è¯å°±æ˜¯å¯¹è¢«å®³äººä¸å…¬å¹³ï¼â€ã€‚<br />\nç½—è€å¸ˆè®²åˆ°ï¼š<strong>å¦‚æœä¸åŠ åŒºåˆ†ä¸€å¾‹é‡åˆ‘ã€‚äº‹åå…¶å®æ˜¯å¯èƒ½ä¼šé¼“åŠ±çŠ¯ç½ªçš„</strong>ã€‚çŠ¯ç½ªè€…å®¹æ˜“äº§ç”Ÿäº¡å¾’æ€æƒ³ã€‚å¦‚æœç›—çªƒä¸€ä¸‡å…ƒä¸€å¾‹æ­»åˆ‘ï¼Œé‚£ä¹ˆå·çªƒä¸€ä¸‡çš„ç½ªçŠ¯å¯èƒ½ç›—çªƒæ›´å¤šï¼Œç”šè‡³æ€äººè¶Šè´§ï¼Œæ€ 100 ä¸ªäººï¼Œåæ­£æ˜¯ä¸€æ­»ã€‚<br />\nåˆ‘æ³•çš„ä¸‰å¤§åŸåˆ™ï¼š<strong>ç½ªè¡Œæ³•å®š</strong>ï¼Œ<strong>åˆ‘æ³•é¢å‰äººäººå¹³ç­‰</strong>ã€<strong>ç½ªè¡Œç›¸å½“</strong>ã€‚<br />\nâ€œé‡ç½ªè€…ï¼Œäººä¹‹æ‰€éš¾çŠ¯ä¹Ÿã€‚è€Œå°è¿‡è€…ï¼Œäººä¹‹æ‰€æ˜“å»ä¹Ÿã€‚ä½¿äººå»å…¶æ‰€æ˜“ï¼Œæ— ç¦»å…¶æ‰€éš¾ã€‚æ­¤æ²»ä¹‹é“ã€‚å¤«å°è¿‡ä¸ç”Ÿï¼Œå¤§ç½ªä¸æ²»ï¼Œä¸–äººæ— ç½ªè€Œä¹±ä¸ç”Ÿä¹Ÿã€‚--ã€ŠéŸ©éå­ãƒ»å†…å‚¨è¯´ä¸Šä¸ƒæœ¯ã€‹â€<br />\n éŸ©éå­è®¤ä¸ºï¼šé‡ç½ªäººä¸€èˆ¬å¾ˆéš¾çŠ¯ï¼Œè½»ç½ªäººä»¬å®¹æ˜“çŠ¯ï¼Œå¦‚æœç”¨ä¸¥é‡çš„åˆ‘ç½šæ¥æƒ©ç½šçŠ¯è½»ç½ªçš„äººï¼Œé‚£ä¹ˆäººä»¬ä¾¿ä¸æ•¢å»è¯•è¯•çŠ¯ç½ªï¼Œåˆ‘ç½šçš„ç›®çš„æ˜¯ä¸ºäº†å¨æ…‘ï¼Œæœ€ç»ˆè¾¾åˆ°ä¸€ä¸ªç†æƒ³çŠ¶æ€ â€”â€” æ²¡æœ‰åˆ‘ç½šã€‚<br />\néŸ©éå­ä¹Ÿå†™é“ï¼šâ€œç°äºå…¬é“è€…æ–­å…¶æ‰‹â€ï¼Œå¾ˆå¤šäººæ— æ³•ç†è§£ï¼Œä¸ºä»€ä¹ˆæ‰”åƒåœ¾è¦å‰æ‰‹ã€‚å­”å­ä¹Ÿåªèƒ½å‹‰å¼ºè§£é‡Šé“ï¼šâ€œæ— æ°”ç°æ‰€æ„è€…ï¼Œæ–­æ‰‹æ‰€æ‚Ÿä¹Ÿè¡Œï¼Œæ‰€ä»¥ä¸è§‚æ‰€æ‚Ÿã€‚å¤äººä»¥ä¸ºçŸ£ï¼Œæ•…è¡Œä¹‹ã€‚â€ è¿™æ®µè¯å¾ˆéš¾ç¿»æˆç™½è¯æ–‡ï¼Œå°±æ˜¯ä¸ä¹±æ‰”åƒåœ¾æ˜¯å¾ˆå®¹æ˜“åšåˆ°çš„ï¼Œä½†æ˜¯æ–­æ‰‹ä¼šä»¤äººæ„Ÿåˆ°å·¨å¤§çš„ç—›è‹¦ï¼Œé‚£å¦‚æœå¹²äº†ä¸€ä»¶å¾ˆå®¹æ˜“çš„äº‹æƒ…ï¼Œå°±å¯ä»¥é¿å…ä¸¥é‡çš„æƒ©ç½šï¼Œå¤äººè®¤ä¸ºè¿™æ˜¯å®¹æ˜“åšåˆ°çš„ï¼Œæ‰€ä»¥å®æ–½è¿™ç§åˆ‘æ³•ã€‚<br />\nå¦æœ‰è®°è½½ï¼ŒæŠŠç°å€’åœ¨å¤§é©¬è·¯ä¸Šï¼Œä¼šè®©ç°å°˜åˆ°å¤„ä¹±é£ï¼Œäººå°±ä¼šç”Ÿæ°”ï¼Œä¸€ç”Ÿæ°”å°±å¯èƒ½æ–—æ®´ï¼Œæ–—æ®´çš„ç»“æœå°±å¯èƒ½ä¼šè®©å®¶æ—ä¹‹é—´äº’ç›¸æ®‹æ€ã€‚æ‰€ä»¥éšä¾¿åœ¨é©¬è·¯ä¸Šå€’åƒåœ¾æ˜¯æ®‹å®³å®¶æ—çš„è¡Œä¸ºï¼Œé‚£å› æ­¤å¯¹å…¶é‡åˆ‘ï¼Œäº‹åä¹Ÿæ˜¯å¯ä»¥æ¥å—çš„ã€‚</p>\n<h3 id=\"æ”¯æŒé‡åˆ‘ä¸»ä¹‰çš„è§‚ç‚¹\"><a class=\"anchor\" href=\"#æ”¯æŒé‡åˆ‘ä¸»ä¹‰çš„è§‚ç‚¹\">#</a> æ”¯æŒé‡åˆ‘ä¸»ä¹‰çš„è§‚ç‚¹</h3>\n<p>æ”¯æŒè€…è®¤ä¸ºï¼Œä¸¥å‰çš„åˆ‘ç½šèƒ½å¤Ÿæœ‰æ•ˆåœ°å¨æ…‘æ½œåœ¨çŠ¯ç½ªè¡Œä¸ºï¼Œä¿æŠ¤ç¤¾ä¼šçš„å®‰å…¨å’Œç§©åºã€‚ä»–ä»¬å¼ºè°ƒåˆ‘ç½šçš„å…¬å¹³å’Œæ­£ä¹‰ï¼Œè®¤ä¸ºç½ªçŠ¯åº”å½“ä¸ºå…¶æ‰€çŠ¯ä¸‹çš„ç½ªè¡Œä»˜å‡ºä»£ä»·ã€‚ä»–ä»¬å¯èƒ½è®¤ä¸ºï¼Œå¯¹ä¸¥é‡çŠ¯ç½ªé‡‡å–é‡å‹åˆ‘ç½šèƒ½å¤Ÿæœ‰æ•ˆé˜»æ­¢çŠ¯ç½ªäººçš„è¡Œä¸ºï¼Œä»è€Œå‡å°‘ç¤¾ä¼šçš„ä¸å®‰å®šå› ç´ ã€‚</p>\n<h3 id=\"åå¯¹é‡åˆ‘ä¸»ä¹‰çš„è§‚ç‚¹\"><a class=\"anchor\" href=\"#åå¯¹é‡åˆ‘ä¸»ä¹‰çš„è§‚ç‚¹\">#</a> åå¯¹é‡åˆ‘ä¸»ä¹‰çš„è§‚ç‚¹</h3>\n<p>åå¯¹è€…å¯èƒ½è®¤ä¸ºï¼Œè¿‡åº¦çš„é‡å‹åˆ‘ç½šå¹¶ä¸èƒ½çœŸæ­£è§£å†³é—®é¢˜ï¼Œåè€Œå¯èƒ½å¯¼è‡´ä¸å…¬å¹³å’Œä¸¥é‡çš„äººæƒä¾µå®³ã€‚ä»–ä»¬å¼ºè°ƒäººé“ä¸»ä¹‰ï¼Œè®¤ä¸ºåˆ‘ç½šåº”å½“ä»¥äººçš„å°Šä¸¥ä¸ºå‰æï¼Œé¿å…è¿‡åº¦çš„ç—›è‹¦å’Œè‹¦éš¾ã€‚æ­¤å¤–ï¼Œä»–ä»¬ä¹Ÿå¯èƒ½å…³æ³¨åˆ°åˆ‘ç½šçš„ç¤¾ä¼šæˆæœ¬ï¼Œè®¤ä¸ºé•¿æœŸç›‘ç¦æˆ–æ­»åˆ‘ç­‰åˆ‘ç½šåœ¨æ‰§è¡Œä¸Šéœ€è¦å¤§é‡èµ„æºï¼Œå¯èƒ½å¹¶ä¸èƒ½è¾¾åˆ°é¢„æœŸçš„å¨æ…‘æ•ˆæœã€‚</p>\n<h2 id=\"åˆ‘ç½šæ­£å½“åŒ–\"><a class=\"anchor\" href=\"#åˆ‘ç½šæ­£å½“åŒ–\">#</a> åˆ‘ç½šæ­£å½“åŒ–</h2>\n<p>å…³äºåˆ‘ç½šçš„æ­£å½“åŒ–ï¼Œæ ¹æ®ä¸€ç›´æœ‰ä¸¤ç§äº‰è®ºï¼Œä¸€ç§è§‚ç‚¹è®¤ä¸ºå› ä¸ºæœ‰äº†çŠ¯ç½ªï¼Œæ‰€ä»¥è¦æœ‰åˆ‘ç½šã€‚<br />\nå¦ä¸€ç§è§‚ç‚¹è®¤ä¸ºæ²¡æœ‰çŠ¯ç½ªï¼Œæ‰€ä»¥éœ€è¦åˆ‘ç½šã€‚</p>\n<h3 id=\"æŠ¥åº”ä¸»ä¹‰\"><a class=\"anchor\" href=\"#æŠ¥åº”ä¸»ä¹‰\">#</a> æŠ¥åº”ä¸»ä¹‰</h3>\n<p>ç«‹è¶³æ—¢å¾€ï¼Œè®¤ä¸ºç½ªçŠ¯å®æ–½çŠ¯ç½ªæœ¬èº«å°±åº”è¯¥å—åˆ°æƒ©ç½šã€‚æœ‰äº†çŠ¯ç½ªï¼Œéœ€è¦åˆ‘ç½šã€‚<br />\nå–„æœ‰å–„æŠ¥ï¼Œæ¶æœ‰æ¶æŠ¥å—ï¼Ÿæƒ©ç½šå…·æœ‰é“å¾·ä¸Šçš„æ­£å½“æ€§ã€‚å¦‚æœä¸¥é‡çš„è°‹æ€è€…ä¸è¢«åˆ¤å¤„æ­»åˆ‘ï¼Œé‚£ä¹ˆè¢«å®³äººçš„å®¶å±ä¹Ÿå¯èƒ½ä¼šèµ°å‘å¤ä»‡ä¹‹è·¯ã€‚<br />\næŠ¥åº”ä¸»ä¹‰è¿˜ä½“ç°äº†å¯¹äººçš„å°Šé‡ï¼Œå®ƒæ—¢æ˜¯å¯¹çŠ¯ç½ªäººçš„å°Šé‡ï¼Œä¹Ÿæ˜¯å¯¹è¢«å®³äººçš„å°Šé‡ã€‚çŠ¯ç½ªäººå‡ºäºè‡ªç”±æ„å¿—é€‰æ‹©äº†çŠ¯ç½ªï¼Œä»–ä¹Ÿå°±é¢„è§äº†è¡Œä¸ºçš„åæœï¼Œä¸ºäº†å°Šé‡ä»–ç†æ€§çš„é€‰æ‹©ï¼Œå°±è¦è®©ä»–æ‰¿æ‹…ä»–æ‰€é¢„è§çš„åæœã€‚<br />\nçŠ¯ç½ªäººäºµæ¸äº†è¢«å®³çš„äººæ ¼å’Œå°Šä¸¥ï¼Œåˆ‘ç½šä¹Ÿå¿…é¡»çº æ­£è¿™ç§é”™è¯¯çš„æ€æƒ³ï¼Œæ‰€ä»¥é€šè¿‡å¯¹çŠ¯ç½ªçš„æƒ©ç½šä¹Ÿå¯ä»¥æ¢å¤è¢«å®³äººè¢«è·µè¸çš„å°Šä¸¥ã€‚<br />\nåº·å¾·è®¤ä¸ºï¼Œé‡åˆ‘ä¸»ä¹‰çš„è¿‡åº¦å¨æ…‘ï¼ŒæŠŠäººå½“æˆçº¯ç²¹çš„å·¥å…·å“äººï¼Œæ˜¯å¯¹åˆ‘ç½šçš„æ»¥ç”¨ã€‚<br />\né»‘æ ¼å°”è®¤ä¸ºï¼Œé‡å‹ä¸»ä¹‰ä¹Ÿæ²¡æœ‰å°Šé‡çŠ¯ç½ªäººä½œä¸ºç†æ€§çš„å­˜åœ¨ï¼ŒçŠ¯ç½ªäººç†æ€§ä¸ŠçŸ¥é“è‡ªå·±çŠ¯æ³•ä¼šå—åˆ°åˆ‘ç½šï¼Œæ‰€ä»¥å¤„ç½šä»–æ­£æ˜¯å°Šé‡ä»–æ˜¯ç†æ€§çš„å­˜åœ¨ã€‚</p>\n<h3 id=\"åŠŸåˆ©ä¸»ä¹‰\"><a class=\"anchor\" href=\"#åŠŸåˆ©ä¸»ä¹‰\">#</a> åŠŸåˆ©ä¸»ä¹‰</h3>\n<p>å…³æ³¨å°†æ¥ï¼Œæƒ©ç½šæ˜¯ä¸ºäº†é¢„é˜²ã€‚<br />\näººéƒ½æœ‰è¶‹åˆ©é¿å®³çš„æœ¬èƒ½ï¼Œåœ¨è¡Œä¸ºä¹‹å‰ï¼Œäººä»¬ä¼šæƒè¡¡åˆ©å¼Šï¼Œæ¯”è¾ƒçŠ¯ç½ªå¸¦æ¥çš„å¿«ä¹ï¼Œæ‰€é­å—åˆ‘ç½šå¯èƒ½å¸¦æ¥ç—›è‹¦ï¼Œå¦‚æœç»“è®ºæ˜¯åˆ‘ç½šçš„ç—›è‹¦å¤§äºçŠ¯ç½ªçš„ä¹è¶£ï¼Œä»–ä»¬å°±ä¸ä¼šå»å®æ–½çŠ¯ç½ªã€‚</p>\n<h4 id=\"ä¸€èˆ¬é¢„é˜²\"><a class=\"anchor\" href=\"#ä¸€èˆ¬é¢„é˜²\">#</a> ä¸€èˆ¬é¢„é˜²</h4>\n<p>ä¸€èˆ¬é¢„é˜²å°±æ˜¯æ‰€è°“çš„æ€é¸¡ç»™çŒ´çœ‹ï¼Œå¯¹çŠ¯ç½ªäººæ–½åŠ æƒ©ç½šï¼Œæ˜¯ä¸ºäº†<strong>å¨å“ç¤¾ä¼šå…¬ä¼—ï¼Œè®©ä»–ä»¬ä¸è¦ä»¥èº«è¯•æ³•</strong>ï¼Œå®ƒæŠŠæ‰€æœ‰å…¬æ°‘ç¾¤ä½“å½“åšæ½œåœ¨çš„çŠ¯ç½ªäººã€‚<br />\nä¸€èˆ¬é¢„é˜²è®¤ä¸ºæ³•å¾‹åº”è¯¥ä»¥æœ€å°çš„ç¤¾ä¼šç—›è‹¦è¿½æ±‚ç¤¾ä¼šç¦åˆ©çš„æœ€å¤§åŒ–ã€‚çŠ¯ç½ªå’Œåˆ‘ç½šéƒ½ä¼šç»™ç¤¾ä¼šå¸¦æ¥ç—›è‹¦ã€‚é‚£å¦‚æœåˆ‘ç½šçš„ç—›è‹¦å°äºçŠ¯ç½ªçš„ç—›è‹¦ï¼Œä½†å´èƒ½é˜²æ­¢æ›´å¤šçš„çŠ¯ç½ªï¼Œé‚£ä¹ˆåˆ‘ç½šå°±æ˜¯æ­£å½“çš„ã€‚åˆ‘ç½šä¹‹æ¶ä¸èƒ½è¶…è¿‡çŠ¯ç½ªä¹‹æ¶ï¼Œå¤šä½™çš„åˆ‘ç½šå°±æ˜¯å¤šä½™çš„æ¶ã€‚</p>\n<h4 id=\"ç‰¹æ®Šé¢„é˜²\"><a class=\"anchor\" href=\"#ç‰¹æ®Šé¢„é˜²\">#</a> ç‰¹æ®Šé¢„é˜²</h4>\n<p>ç‰¹æ®Šé¢„é˜²é‚£é’ˆå¯¹çš„æ˜¯çŠ¯ç½ªäººæœ¬äººï¼Œé˜²æ­¢ä»–ä»¬å†æ¬¡çŠ¯ç½ªï¼Œæ¯”å¦‚è¯´å¯¹ä»–ä»¬è¿›è¡Œæ•™è‚²æ”¹é€ ï¼Œè®©çŠ¯ç½ªäººèƒ½å¤Ÿå›å½’ç¤¾ä¼šã€‚<br />\nç‰¹æ®Šé¢„é˜²ä¸å†å°†ç¤¾ä¼šå…¬ä¼—è§†ä¸ºæ½œåœ¨çš„çŠ¯ç½ªäººï¼ŒæŠŠä»–ä»¬çº¯ç²¹ä½œä¸ºæå“çš„å¯¹è±¡ï¼Œè€Œæ˜¯æŠŠä»–ä»¬ä½œä¸ºå®ˆæ³•çš„å…¬æ°‘ï¼Œæ¯ä¸€æ¬¡å¯¹ç½ªçŠ¯çš„æƒ©ç½šéƒ½æ˜¯ä¸ºäº†å¼ºåŒ–æ°‘ä¼—å‘è‡ªå†…å¿ƒçš„å®ˆæ³•æ„æ€ã€‚<br />\nç‰¹æ®Šé¢„é˜²<strong>å¼ºè°ƒå‰¥å¤ºç½ªçŠ¯çš„å†çŠ¯èƒ½åŠ›ï¼Œè®©å…¶ç§¯æçš„å›å½’ç¤¾ä¼š</strong></p>\n<h2 id=\"ç»“å°¾\"><a class=\"anchor\" href=\"#ç»“å°¾\">#</a> ç»“å°¾</h2>\n<p>å¦‚æœä½ å¼ƒç°äºè·¯ï¼Œä½ æˆ–ä½ çš„å®¶äººæ˜¯å¦æ¥å—æ›¿ç½ªç¾Šçš„åä¹‰ï¼Ÿæˆ–è€…ä½ æˆ–ä½ çš„å®¶äººæ˜¯å¦ä¾ç„¶ä¸ºå‰æ‰‹æ³•ç‚¹èµï¼Ÿæ³•å¾‹çš„ç”Ÿå‘½æ˜¯ç»éªŒè€Œéé€»è¾‘ï¼Œæ²¡æœ‰äººæ‹¥æœ‰å®Œå…¨çš„ç†æ€§ï¼Œå› æ­¤ä¹Ÿä¸å¯èƒ½åœ¨ç†æ€§ä¸Šè¢«å½»åº•è¯´æœã€‚äººç±»å„ä¸ªä¸–ä»£åƒåƒä¸‡ä¸‡çš„äººï¼Œä»ä¸ªäººç»éªŒä¸­æ‰€æ±‡æ€»çš„æµ·é‡çŸ¥è¯†ï¼Œé‚£è‚¯å®šå¤§äºæˆ‘ä»¬è¿™äº›è‡ªè¯©ä¸ºæ³•å¾‹ä¸“å®¶çš„ç‹­å°çŸ¥è¯†ã€‚è¿˜æ˜¯åˆšæ‰æ‰€è¯´çš„æ‰€æœ‰çš„ä¸“ä¸šçŸ¥è¯†ï¼Œå…¶å®éƒ½æ˜¯å°ä¼—ä¸€è§ï¼Œä½†æ˜¯æˆ‘ä»¬ä¾ç„¶æœ‰è´£ä»»è¯´å‡ºæˆ‘ä»¬è‡ªå·±ä¸“ä¸šçš„å°ä¼—æ„è§ã€‚æ³•å¾‹æ²¡æœ‰æœ€ä¼˜è§£ï¼Œåªèƒ½æä¾›ä¸€ä¸ªç›¸å¯¹è¾ƒå¥½æˆ–è€…è¯´ä¸åçš„è§£å†³æ–¹æ¡ˆã€‚</p>\n<h1 id=\"ä¸ªäººæ€»ç»“\"><a class=\"anchor\" href=\"#ä¸ªäººæ€»ç»“\">#</a> ä¸ªäººæ€»ç»“</h1>\n<p>é‡åˆ‘ä¸»ä¹‰åœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½ä¼šæœ‰ä¸€å®šçš„åˆç†æ€§ï¼Œä½†éœ€è¦åœ¨æ³•å¾‹ã€ä¼¦ç†å’Œç¤¾ä¼šæ•ˆç›Šä¹‹é—´è¿›è¡Œæƒè¡¡å’Œå–èˆã€‚åˆ‘ç½šæ”¿ç­–åº”å½“å……åˆ†è€ƒè™‘ç¤¾ä¼šçš„å¤šæ ·æ€§å’Œå¤æ‚æ€§ï¼Œä»¥å»ºç«‹æ›´åŠ å…¬æ­£ã€æœ‰æ•ˆå’Œå¹³è¡¡çš„åˆ‘æ³•ä½“ç³»ã€‚<br />\nå›é¡¾åˆ‘ç½šåˆç†æ€§ä¸ä¸ªä½“æƒç›Šçš„å¹³è¡¡ï¼Œæˆ‘ä¸ç¦æ€è€ƒæ³•æ²»çš„ä½œç”¨ã€‚æ³•æ²»å¹¶ä¸ä¼šåˆ›é€ å®Œç¾çš„ç¤¾ä¼šï¼Œä½†å®ƒå¯ä»¥é˜²æ­¢æœ€åçš„æƒ…å†µå‘ç”Ÿï¼Œæˆ‘ä»¬éœ€è¦åœ¨æƒè¡¡ä¸­æ‰¾åˆ°æœ€ä¸ºåˆé€‚çš„æŠ˜ä¸­æ–¹æ¡ˆã€‚è¿™å¼•å¯¼æˆ‘æ·±å…¥æ€è€ƒåˆ‘ç½šä¸äººæ€§ã€å…¬æ­£ã€ç¤¾ä¼šç§©åºçš„å…³ç³»ï¼Œä»¥åŠæ³•å¾‹åº”å¦‚ä½•åœ¨ç¤¾ä¼šä¸­å‘æŒ¥ä½œç”¨ã€‚</p>\n",
            "tags": [
                "äººæ–‡ç¤¾ç§‘",
                "ç½—ç¿”è¯´åˆ‘æ³•"
            ]
        },
        {
            "id": "https://haust-kevin.github.io/2023/08/20/2023-08-%E7%8B%82%E4%BA%BA%E6%97%A5%E8%AE%B0/",
            "url": "https://haust-kevin.github.io/2023/08/20/2023-08-%E7%8B%82%E4%BA%BA%E6%97%A5%E8%AE%B0/",
            "title": "ç‹‚äººæ—¥è®°",
            "date_published": "2023-08-20T12:02:57.000Z",
            "content_html": "<div class=\"note primary\">\n<p>é‡æ¸©ã€Šç‹‚äººæ—¥è®°ã€‹ï¼Œå°±åƒæ˜¯é‡æ–°ç©¿è¶Šæ—¶å…‰å›åˆ°äº†ä¸€ä¸ªæ‰‘æœ”è¿·ç¦»çš„å†…å¿ƒä¸–ç•Œã€‚æ¯ä¸€æ®µéƒ½æ˜¯å¯¹äººæ€§æ·±åˆ»æ¢ç´¢çš„æ—…ç¨‹ï¼Œé€šè¿‡ä¸»äººå…¬çš„ç‹¬ç™½ï¼Œæˆ‘ä»¬èƒ½æ„Ÿå—åˆ°ä»–å†…å¿ƒçš„å†²çªã€æŒ£æ‰å’Œåæ€ã€‚ä½œå“ä»¥å¹½é»˜çš„ç¬”è§¦æ­ç¤ºäº†ç¤¾ä¼šçš„è’è°¬ï¼ŒåŒæ—¶ä¹Ÿå±•ç¤ºäº†ä¸ªä½“åœ¨å›°å¢ƒä¸­çš„æ— å¥ˆã€‚åœ¨è¿™ç‰‡æ–‡å­—çš„æµ·æ´‹ä¸­ï¼Œæˆ‘ä»¬æˆ–è®¸èƒ½æ‰¾åˆ°ä¸€ä¸å¯ç¤ºï¼Œä¸€ä¸ªæ›´åŠ æ¸…æ™°çš„æ€è€ƒè§’åº¦ï¼Œç”šè‡³æ˜¯å¯¹ç°å®çš„å‹‡æ•¢ç›´é¢ã€‚ã€Šç‹‚äººæ—¥è®°ã€‹ä¸ä»…ä»…æ˜¯ä¸€éƒ¨æ–‡å­¦ä½œå“ï¼Œæ›´æ˜¯ä¸€æ¬¡å¯¹è‡ªæˆ‘å’Œç¤¾ä¼šçš„æ·±åˆ»å®¡è§†ï¼Œå€¼å¾—æ¯ä¸ªäººåœ¨ä¸åŒçš„ç”Ÿå‘½é˜¶æ®µå¤šæ¬¡å“å‘³ã€‚æ— è®ºæ˜¯åˆè¯»è¿˜æ˜¯å†è¯»ï¼Œå®ƒéƒ½èƒ½å¸¦ç»™æˆ‘ä»¬æ–°çš„é¢†æ‚Ÿå’Œå…±é¸£ï¼Œè®©æˆ‘ä»¬æ›´åŠ æ·±åˆ»åœ°æ€è€ƒäººæ€§ä¸ä¸–ç•Œï¼Œå³ä½¿ã€Šç‹‚äººæ—¥è®°ã€‹çš„è‘—ä½œç¯å¢ƒå·²æ˜¯ç™¾å¹´å‰ï¼Œä»èƒ½å¸¦ç»™æˆ‘ä»¬æ— æ¯”çš„éœ‡æ’¼ã€‚</p>\n</div>\n<h1 id=\"å…¨æ–‡\"><a class=\"anchor\" href=\"#å…¨æ–‡\">#</a> å…¨æ–‡</h1>\n<h2 id=\"åºè¨€\"><a class=\"anchor\" href=\"#åºè¨€\">#</a> åºè¨€</h2>\n<blockquote>\n<p>æŸå›æ˜†ä»²ï¼Œä»Šéšå…¶åï¼Œçš†ä½™æ˜”æ—¥åœ¨ä¸­å­¦æ—¶è‰¯å‹ï¼›åˆ†éš”å¤šå¹´ï¼Œæ¶ˆæ¯æ¸é˜™ã€‚æ—¥å‰å¶é—»å…¶ä¸€å¤§ç—…ï¼›é€‚å½’æ•…ä¹¡ï¼Œè¿‚é“å¾€è®¿ï¼Œåˆ™ä»…æ™¤ä¸€äººï¼Œè¨€ç—…è€…å…¶å¼Ÿä¹Ÿã€‚åŠ³å›è¿œé“æ¥è§†ï¼Œç„¶å·²æ—©æ„ˆï¼Œèµ´æŸåœ°å€™è¡¥çŸ£ã€‚å› å¤§ç¬‘ï¼Œå‡ºç¤ºæ—¥è®°äºŒå†Œï¼Œè°“å¯è§å½“æ—¥ç—…çŠ¶ï¼Œä¸å¦¨çŒ®è¯¸æ—§å‹ã€‚æŒå½’é˜…ä¸€è¿‡ï¼ŒçŸ¥æ‰€æ‚£ç›– â€œè¿«å®³ç‹‚â€ ä¹‹ç±»ã€‚è¯­é¢‡é”™æ‚æ— ä¼¦æ¬¡ï¼Œåˆå¤šè’å”ä¹‹è¨€ï¼›äº¦ä¸è‘—æœˆæ—¥ï¼ŒæƒŸå¢¨è‰²å­—ä½“ä¸ä¸€ï¼ŒçŸ¥éä¸€æ—¶æ‰€ä¹¦ã€‚é—´äº¦æœ‰ç•¥å…·è”ç»œè€…ï¼Œä»Šæ’®å½•ä¸€ç¯‡ï¼Œä»¥ä¾›åŒ»å®¶ç ”ç©¶ã€‚è®°ä¸­è¯­è¯¯ï¼Œä¸€å­—ä¸æ˜“ï¼›æƒŸäººåè™½çš†æ‘äººï¼Œä¸ä¸ºä¸–é—´æ‰€çŸ¥ï¼Œæ— å…³å¤§ä½“ï¼Œç„¶äº¦æ‚‰æ˜“å»ã€‚è‡³äºä¹¦åï¼Œåˆ™æœ¬äººæ„ˆåæ‰€é¢˜ï¼Œä¸å¤æ”¹ä¹Ÿã€‚ä¸ƒå¹´å››æœˆäºŒæ—¥è¯†ã€‚</p>\n</blockquote>\n<h2 id=\"ç¬¬ä¸€è¯\"><a class=\"anchor\" href=\"#ç¬¬ä¸€è¯\">#</a> ç¬¬ä¸€è¯</h2>\n<p>ä»Šå¤©æ™šä¸Šï¼Œå¾ˆå¥½çš„æœˆå…‰ã€‚<br />\næˆ‘ä¸è§ä»–ï¼Œå·²æ˜¯ä¸‰åå¤šå¹´ï¼›ä»Šå¤©è§äº†ï¼Œç²¾ç¥åˆ†å¤–çˆ½å¿«ã€‚æ‰çŸ¥é“ä»¥å‰çš„ä¸‰åå¤šå¹´ï¼Œå…¨æ˜¯å‘æ˜ï¼›ç„¶è€Œé¡»ååˆ†å°å¿ƒã€‚ä¸ç„¶ï¼Œé‚£èµµå®¶çš„ç‹—ï¼Œä½•ä»¥çœ‹æˆ‘ä¸¤çœ¼å‘¢ï¼Ÿ<br />\næˆ‘æ€•å¾—æœ‰ç†ã€‚</p>\n<h2 id=\"ç¬¬äºŒè¯\"><a class=\"anchor\" href=\"#ç¬¬äºŒè¯\">#</a> ç¬¬äºŒè¯</h2>\n<p>ä»Šå¤©å…¨æ²¡æœˆå…‰ï¼Œæˆ‘çŸ¥é“ä¸å¦™ã€‚æ—©ä¸Šå°å¿ƒå‡ºé—¨ï¼Œèµµè´µç¿çš„çœ¼è‰²ä¾¿æ€ªï¼šä¼¼ä¹æ€•æˆ‘ï¼Œä¼¼ä¹æƒ³å®³æˆ‘ã€‚è¿˜æœ‰ä¸ƒå…«ä¸ªäººï¼Œäº¤å¤´æ¥è€³çš„è®®è®ºæˆ‘ï¼Œå¼ ç€å˜´ï¼Œå¯¹æˆ‘ç¬‘äº†ä¸€ç¬‘ï¼›æˆ‘ä¾¿ä»å¤´ç›´å†·åˆ°è„šæ ¹ï¼Œæ™“å¾—ä»–ä»¬å¸ƒç½®ï¼Œéƒ½å·²å¦¥å½“äº†ã€‚<br />\næˆ‘å¯ä¸æ€•ï¼Œä»æ—§èµ°æˆ‘çš„è·¯ã€‚å‰é¢ä¸€ä¼™å°å­©å­ï¼Œä¹Ÿåœ¨é‚£é‡Œè®®è®ºæˆ‘ï¼›çœ¼è‰²ä¹ŸåŒèµµè´µç¿ä¸€æ ·ï¼Œè„¸è‰²ä¹Ÿé“é’ã€‚æˆ‘æƒ³æˆ‘åŒå°å­©å­æœ‰ä»€ä¹ˆä»‡ï¼Œä»–ä¹Ÿè¿™æ ·ã€‚å¿ä¸ä½å¤§å£°è¯´ï¼Œâ€œä½ å‘Šè¯‰æˆ‘ï¼â€ ä»–ä»¬å¯å°±è·‘äº†ã€‚<br />\næˆ‘æƒ³ï¼šæˆ‘åŒèµµè´µç¿æœ‰ä»€ä¹ˆä»‡ï¼ŒåŒè·¯ä¸Šçš„äººåˆæœ‰ä»€ä¹ˆä»‡ï¼›åªæœ‰å»¿å¹´ä»¥å‰ï¼ŒæŠŠå¤ä¹…å…ˆç”Ÿçš„é™ˆå¹´æµæ°´ç°¿å­ï¼Œè¸¹äº†ä¸€è„šï¼Œå¤ä¹…å…ˆç”Ÿå¾ˆä¸é«˜å…´ã€‚èµµè´µç¿è™½ç„¶ä¸è®¤è¯†ä»–ï¼Œä¸€å®šä¹Ÿå¬åˆ°é£å£°ï¼Œä»£æŠ±ä¸å¹³ï¼›çº¦å®šè·¯ä¸Šçš„äººï¼ŒåŒæˆ‘ä½œå†¤å¯¹ã€‚ä½†æ˜¯å°å­©å­å‘¢ï¼Ÿé‚£æ—¶å€™ï¼Œä»–ä»¬è¿˜æ²¡æœ‰å‡ºä¸–ï¼Œä½•ä»¥ä»Šå¤©ä¹Ÿçç€æ€ªçœ¼ç›ï¼Œä¼¼ä¹æ€•æˆ‘ï¼Œä¼¼ä¹æƒ³å®³æˆ‘ã€‚è¿™çœŸæ•™æˆ‘æ€•ï¼Œæ•™æˆ‘çº³ç½•è€Œä¸”ä¼¤å¿ƒã€‚<br />\næˆ‘æ˜ç™½äº†ã€‚è¿™æ˜¯ä»–ä»¬å¨˜è€å­æ•™çš„ï¼</p>\n<h2 id=\"ç¬¬ä¸‰è¯\"><a class=\"anchor\" href=\"#ç¬¬ä¸‰è¯\">#</a> ç¬¬ä¸‰è¯</h2>\n<p>æ™šä¸Šæ€»æ˜¯ç¡ä¸ç€ã€‚å‡¡äº‹é¡»å¾—ç ”ç©¶ï¼Œæ‰ä¼šæ˜ç™½ã€‚<br />\nä»–ä»¬ â€”â€” ä¹Ÿæœ‰ç»™çŸ¥å¿æ‰“æ·è¿‡çš„ï¼Œä¹Ÿæœ‰ç»™ç»…å£«æŒè¿‡å˜´çš„ï¼Œä¹Ÿæœ‰è¡™å½¹å äº†ä»–å¦»å­çš„ï¼Œä¹Ÿæœ‰è€å­å¨˜è¢«å€ºä¸»é€¼æ­»çš„ï¼›ä»–ä»¬é‚£æ—¶å€™çš„è„¸è‰²ï¼Œå…¨æ²¡æœ‰æ˜¨å¤©è¿™ä¹ˆæ€•ï¼Œä¹Ÿæ²¡æœ‰è¿™ä¹ˆå‡¶ã€‚<br />\næœ€å¥‡æ€ªçš„æ˜¯æ˜¨å¤©è¡—ä¸Šçš„é‚£ä¸ªå¥³äººï¼Œæ‰“ä»–å„¿å­ï¼Œå˜´é‡Œè¯´é“ï¼Œâ€œè€å­å‘€ï¼æˆ‘è¦å’¬ä½ å‡ å£æ‰å‡ºæ°”ï¼â€ ä»–çœ¼ç›å´çœ‹ç€æˆ‘ã€‚æˆ‘å‡ºäº†ä¸€æƒŠï¼Œé®æ©ä¸ä½ï¼›é‚£é’é¢ç ç‰™çš„ä¸€ä¼™äººï¼Œä¾¿éƒ½å“„ç¬‘èµ·æ¥ã€‚é™ˆè€äº”èµ¶ä¸Šå‰ï¼Œç¡¬æŠŠæˆ‘æ‹–å›å®¶ä¸­äº†ã€‚<br />\næ‹–æˆ‘å›å®¶ï¼Œå®¶é‡Œçš„äººéƒ½è£…ä½œä¸è®¤è¯†æˆ‘ï¼›ä»–ä»¬çš„è„¸è‰²ï¼Œä¹Ÿå…¨åŒåˆ«äººä¸€æ ·ã€‚è¿›äº†ä¹¦æˆ¿ï¼Œä¾¿åæ‰£ä¸Šé—¨ï¼Œå®›ç„¶æ˜¯å…³äº†ä¸€åªé¸¡é¸­ã€‚è¿™ä¸€ä»¶äº‹ï¼Œè¶Šæ•™æˆ‘çŒœä¸å‡ºåº•ç»†ã€‚<br />\nå‰å‡ å¤©ï¼Œç‹¼å­æ‘çš„ä½ƒæˆ·æ¥å‘Šè’ï¼Œå¯¹æˆ‘å¤§å“¥è¯´ï¼Œä»–ä»¬æ‘é‡Œçš„ä¸€ä¸ªå¤§æ¶äººï¼Œç»™å¤§å®¶æ‰“æ­»äº†ï¼›å‡ ä¸ªäººä¾¿æŒ–å‡ºä»–çš„å¿ƒè‚æ¥ï¼Œç”¨æ²¹ç…ç‚’äº†åƒï¼Œå¯ä»¥å£®å£®èƒ†å­ã€‚æˆ‘æ’äº†ä¸€å¥å˜´ï¼Œä½ƒæˆ·å’Œå¤§å“¥ä¾¿éƒ½çœ‹æˆ‘å‡ çœ¼ã€‚ä»Šå¤©æ‰æ™“å¾—ä»–ä»¬çš„çœ¼å…‰ï¼Œå…¨åŒå¤–é¢çš„é‚£ä¼™äººä¸€æ¨¡ä¸€æ ·ã€‚<br />\næƒ³èµ·æ¥ï¼Œæˆ‘ä»é¡¶ä¸Šç›´å†·åˆ°è„šè·Ÿã€‚<br />\nä»–ä»¬ä¼šåƒäººï¼Œå°±æœªå¿…ä¸ä¼šåƒæˆ‘ã€‚<br />\nä½ çœ‹é‚£å¥³äºº â€œå’¬ä½ å‡ å£â€ çš„è¯ï¼Œå’Œä¸€ä¼™é’é¢ç ç‰™äººçš„ç¬‘ï¼Œå’Œå‰å¤©ä½ƒæˆ·çš„è¯ï¼Œæ˜æ˜æ˜¯æš—å·ã€‚æˆ‘çœ‹å‡ºä»–è¯ä¸­å…¨æ˜¯æ¯’ï¼Œç¬‘ä¸­å…¨æ˜¯åˆ€ã€‚ä»–ä»¬çš„ç‰™é½¿ï¼Œå…¨æ˜¯ç™½å‰å‰çš„æ’ç€ï¼Œè¿™å°±æ˜¯åƒäººçš„å®¶ä¼™ã€‚<br />\nç…§æˆ‘è‡ªå·±æƒ³ï¼Œè™½ç„¶ä¸æ˜¯æ¶äººï¼Œè‡ªä»è¸¹äº†å¤å®¶çš„ç°¿å­ï¼Œå¯å°±éš¾è¯´äº†ã€‚ä»–ä»¬ä¼¼ä¹åˆ«æœ‰å¿ƒæ€ï¼Œæˆ‘å…¨çŒœä¸å‡ºã€‚å†µä¸”ä»–ä»¬ä¸€ç¿»è„¸ï¼Œä¾¿è¯´äººæ˜¯æ¶äººã€‚æˆ‘è¿˜è®°å¾—å¤§å“¥æ•™æˆ‘åšè®ºï¼Œæ— è®ºæ€æ ·å¥½äººï¼Œç¿»ä»–å‡ å¥ï¼Œä»–ä¾¿æ‰“ä¸Šå‡ ä¸ªåœˆï¼›åŸè°…åäººå‡ å¥ï¼Œä»–ä¾¿è¯´ â€œç¿»å¤©å¦™æ‰‹ï¼Œä¸ä¼—ä¸åŒâ€ã€‚æˆ‘é‚£é‡ŒçŒœå¾—åˆ°ä»–ä»¬çš„å¿ƒæ€ï¼Œç©¶ç«Ÿæ€æ ·ï¼›å†µä¸”æ˜¯è¦åƒçš„æ—¶å€™ã€‚<br />\nå‡¡äº‹æ€»é¡»ç ”ç©¶ï¼Œæ‰ä¼šæ˜ç™½ã€‚å¤æ¥æ—¶å¸¸åƒäººï¼Œæˆ‘ä¹Ÿè¿˜è®°å¾—ï¼Œå¯æ˜¯ä¸ç”šæ¸…æ¥šã€‚æˆ‘ç¿»å¼€å†å²ä¸€æŸ¥ï¼Œè¿™å†å²æ²¡æœ‰å¹´ä»£ï¼Œæ­ªæ­ªæ–œæ–œçš„æ¯å¶ä¸Šéƒ½å†™ç€ â€œä»ä¹‰é“å¾·â€ å‡ ä¸ªå­—ã€‚æˆ‘æ¨ªç«–ç¡ä¸ç€ï¼Œä»”ç»†çœ‹äº†åŠå¤œï¼Œæ‰ä»å­—ç¼é‡Œçœ‹å‡ºå­—æ¥ï¼Œæ»¡æœ¬éƒ½å†™ç€ä¸¤ä¸ªå­—æ˜¯ â€œåƒäººâ€ï¼<br />\nä¹¦ä¸Šå†™ç€è¿™è®¸å¤šå­—ï¼Œä½ƒæˆ·è¯´äº†è¿™è®¸å¤šè¯ï¼Œå´éƒ½ç¬‘åŸåŸçš„çç€æ€ªçœ¼çœ‹æˆ‘ã€‚<br />\næˆ‘ä¹Ÿæ˜¯äººï¼Œä»–ä»¬æƒ³è¦åƒæˆ‘äº†ï¼</p>\n<h2 id=\"ç¬¬å››è¯\"><a class=\"anchor\" href=\"#ç¬¬å››è¯\">#</a> ç¬¬å››è¯</h2>\n<p>æ—©ä¸Šï¼Œæˆ‘é™åäº†ä¸€ä¼šå„¿ã€‚é™ˆè€äº”é€è¿›é¥­æ¥ï¼Œä¸€ç¢—èœï¼Œä¸€ç¢—è’¸é±¼ï¼›è¿™é±¼çš„çœ¼ç›ï¼Œç™½è€Œä¸”ç¡¬ï¼Œå¼ ç€å˜´ï¼ŒåŒé‚£ä¸€ä¼™æƒ³åƒäººçš„äººä¸€æ ·ã€‚åƒäº†å‡ ç­·ï¼Œæ»‘æºœæºœçš„ä¸çŸ¥æ˜¯é±¼æ˜¯äººï¼Œä¾¿æŠŠä»–å…œè‚šè¿è‚ çš„åå‡ºã€‚<br />\næˆ‘è¯´ â€œè€äº”ï¼Œå¯¹å¤§å“¥è¯´ï¼Œæˆ‘é—·å¾—æ…Œï¼Œæƒ³åˆ°å›­é‡Œèµ°èµ°ã€‚â€ è€äº”ä¸ç­”åº”ï¼Œèµ°äº†ï¼›åœä¸€ä¼šï¼Œå¯å°±æ¥å¼€äº†é—¨ã€‚<br />\næˆ‘ä¹Ÿä¸åŠ¨ï¼Œç ”ç©¶ä»–ä»¬å¦‚ä½•æ‘†å¸ƒæˆ‘ï¼›çŸ¥é“ä»–ä»¬ä¸€å®šä¸è‚¯æ”¾æ¾ã€‚æœç„¶ï¼æˆ‘å¤§å“¥å¼•äº†ä¸€ä¸ªè€å¤´å­ï¼Œæ…¢æ…¢èµ°æ¥ï¼›ä»–æ»¡çœ¼å‡¶å…‰ï¼Œæ€•æˆ‘çœ‹å‡ºï¼Œåªæ˜¯ä½å¤´å‘ç€åœ°ï¼Œä»çœ¼é•œæ¨ªè¾¹æš—æš—çœ‹æˆ‘ã€‚å¤§å“¥è¯´ï¼Œâ€œä»Šå¤©ä½ ä»¿ä½›å¾ˆå¥½ã€‚â€ æˆ‘è¯´ â€œæ˜¯çš„ã€‚â€ å¤§å“¥è¯´ï¼Œâ€œä»Šå¤©è¯·ä½•å…ˆç”Ÿæ¥ï¼Œç»™ä½ è¯Šä¸€è¯Šã€‚â€ æˆ‘è¯´ â€œå¯ä»¥ï¼â€ å…¶å®æˆ‘å²‚ä¸çŸ¥é“è¿™è€å¤´å­æ˜¯åˆ½å­æ‰‹æ‰®çš„ï¼æ— éå€Ÿäº†çœ‹è„‰è¿™åç›®ï¼Œæ£ä¸€æ£è‚¥ç˜ ï¼šå› è¿™åŠŸåŠ³ï¼Œä¹Ÿåˆ†ä¸€ç‰‡è‚‰åƒã€‚æˆ‘ä¹Ÿä¸æ€•ï¼›è™½ç„¶ä¸åƒäººï¼Œèƒ†å­å´æ¯”ä»–ä»¬è¿˜å£®ã€‚ä¼¸å‡ºä¸¤ä¸ªæ‹³å¤´ï¼Œçœ‹ä»–å¦‚ä½•ä¸‹æ‰‹ã€‚è€å¤´å­åç€ï¼Œé—­äº†çœ¼ç›ï¼Œæ‘¸äº†å¥½ä¸€ä¼šï¼Œå‘†äº†å¥½ä¸€ä¼šï¼›ä¾¿å¼ å¼€ä»–é¬¼çœ¼ç›è¯´ï¼Œâ€œä¸è¦ä¹±æƒ³ã€‚é™é™çš„å…»å‡ å¤©ï¼Œå°±å¥½äº†ã€‚â€<br />\n ä¸è¦ä¹±æƒ³ï¼Œé™é™çš„å…»ï¼å…»è‚¥äº†ï¼Œä»–ä»¬æ˜¯è‡ªç„¶å¯ä»¥å¤šåƒï¼›æˆ‘æœ‰ä»€ä¹ˆå¥½å¤„ï¼Œæ€ä¹ˆä¼š â€œå¥½äº†â€ï¼Ÿä»–ä»¬è¿™ç¾¤äººï¼Œåˆæƒ³åƒäººï¼Œåˆæ˜¯é¬¼é¬¼ç¥Ÿç¥Ÿï¼Œæƒ³æ³•å­é®æ©ï¼Œä¸æ•¢ç›´æˆªä¸‹æ‰‹ï¼ŒçœŸè¦ä»¤æˆ‘ç¬‘æ­»ã€‚æˆ‘å¿ä¸ä½ï¼Œä¾¿æ”¾å£°å¤§ç¬‘èµ·æ¥ï¼Œååˆ†å¿«æ´»ã€‚è‡ªå·±æ™“å¾—è¿™ç¬‘å£°é‡Œé¢ï¼Œæœ‰çš„æ˜¯ä¹‰å‹‡å’Œæ­£æ°”ã€‚è€å¤´å­å’Œå¤§å“¥ï¼Œéƒ½å¤±äº†è‰²ï¼Œè¢«æˆ‘è¿™å‹‡æ°”æ­£æ°”é•‡å‹ä½äº†ã€‚<br />\nä½†æ˜¯æˆ‘æœ‰å‹‡æ°”ï¼Œä»–ä»¬ä¾¿è¶Šæƒ³åƒæˆ‘ï¼Œæ²¾å…‰ä¸€ç‚¹è¿™å‹‡æ°”ã€‚è€å¤´å­è·¨å‡ºé—¨ï¼Œèµ°ä¸å¤šè¿œï¼Œä¾¿ä½å£°å¯¹å¤§å“¥è¯´é“ï¼Œâ€œèµ¶ç´§åƒç½¢ï¼â€ å¤§å“¥ç‚¹ç‚¹å¤´ã€‚åŸæ¥ä¹Ÿæœ‰ä½ ï¼è¿™ä¸€ä»¶å¤§å‘è§ï¼Œè™½ä¼¼æ„å¤–ï¼Œä¹Ÿåœ¨æ„ä¸­ï¼šåˆä¼™åƒæˆ‘çš„äººï¼Œä¾¿æ˜¯æˆ‘çš„å“¥å“¥ï¼<br />\nåƒäººçš„æ˜¯æˆ‘å“¥å“¥ï¼<br />\næˆ‘æ˜¯åƒäººçš„äººçš„å…„å¼Ÿï¼<br />\næˆ‘è‡ªå·±è¢«äººåƒäº†ï¼Œå¯ä»ç„¶æ˜¯åƒäººçš„äººçš„å…„å¼Ÿï¼</p>\n<h2 id=\"ç¬¬äº”è¯\"><a class=\"anchor\" href=\"#ç¬¬äº”è¯\">#</a> ç¬¬äº”è¯</h2>\n<p>è¿™å‡ å¤©æ˜¯é€€ä¸€æ­¥æƒ³ï¼šå‡ä½¿é‚£è€å¤´å­ä¸æ˜¯åˆ½å­æ‰‹æ‰®çš„ï¼ŒçœŸæ˜¯åŒ»ç”Ÿï¼Œä¹Ÿä»ç„¶æ˜¯åƒäººçš„äººã€‚ä»–ä»¬çš„ç¥–å¸ˆææ—¶çåšçš„ â€œæœ¬è‰ä»€ä¹ˆâ€ ä¸Šï¼Œæ˜æ˜å†™ç€äººè‚‰å¯ä»¥ç…åƒï¼›ä»–è¿˜èƒ½è¯´è‡ªå·±ä¸åƒäººä¹ˆï¼Ÿ<br />\nè‡³äºæˆ‘å®¶å¤§å“¥ï¼Œä¹Ÿæ¯«ä¸å†¤æ‰ä»–ã€‚ä»–å¯¹æˆ‘è®²ä¹¦çš„æ—¶å€™ï¼Œäº²å£è¯´è¿‡å¯ä»¥ â€œæ˜“å­è€Œé£Ÿâ€ï¼›åˆä¸€å›å¶ç„¶è®®è®ºèµ·ä¸€ä¸ªä¸å¥½çš„äººï¼Œä»–ä¾¿è¯´ä¸ä½†è¯¥æ€ï¼Œè¿˜å½“ â€œé£Ÿè‚‰å¯çš®â€ã€‚æˆ‘é‚£æ—¶å¹´çºªè¿˜å°ï¼Œå¿ƒè·³äº†å¥½åŠå¤©ã€‚å‰å¤©ç‹¼å­æ‘ä½ƒæˆ·æ¥è¯´åƒå¿ƒè‚çš„äº‹ï¼Œä»–ä¹Ÿæ¯«ä¸å¥‡æ€ªï¼Œä¸ä½çš„ç‚¹å¤´ã€‚å¯è§å¿ƒæ€æ˜¯åŒä»å‰ä¸€æ ·ç‹ ã€‚æ—¢ç„¶å¯ä»¥ â€œæ˜“å­è€Œé£Ÿâ€ï¼Œä¾¿ä»€ä¹ˆéƒ½æ˜“å¾—ï¼Œä»€ä¹ˆäººéƒ½åƒå¾—ã€‚æˆ‘ä»å‰å•å¬ä»–è®²é“ç†ï¼Œä¹Ÿç³Šæ¶‚è¿‡å»ï¼›ç°åœ¨æ™“å¾—ä»–è®²é“ç†çš„æ—¶å€™ï¼Œä¸ä½†å”‡è¾¹è¿˜æŠ¹ç€äººæ²¹ï¼Œè€Œä¸”å¿ƒé‡Œæ»¡è£…ç€åƒäººçš„æ„æ€ã€‚</p>\n<h2 id=\"ç¬¬å…­è¯\"><a class=\"anchor\" href=\"#ç¬¬å…­è¯\">#</a> ç¬¬å…­è¯</h2>\n<p>é»‘æ¼†æ¼†çš„ï¼Œä¸çŸ¥æ˜¯æ—¥æ˜¯å¤œã€‚èµµå®¶çš„ç‹—åˆå«èµ·æ¥äº†ã€‚<br />\nç‹®å­ä¼¼çš„å‡¶å¿ƒï¼Œå…”å­çš„æ€¯å¼±ï¼Œç‹ç‹¸çš„ç‹¡çŒ¾ï¼Œâ€¦â€¦</p>\n<h2 id=\"ç¬¬ä¸ƒè¯\"><a class=\"anchor\" href=\"#ç¬¬ä¸ƒè¯\">#</a> ç¬¬ä¸ƒè¯</h2>\n<p>æˆ‘æ™“å¾—ä»–ä»¬çš„æ–¹æ³•ï¼Œç›´æ·æ€äº†ï¼Œæ˜¯ä¸è‚¯çš„ï¼Œè€Œä¸”ä¹Ÿä¸æ•¢ï¼Œæ€•æœ‰ç¥¸ç¥Ÿã€‚æ‰€ä»¥ä»–ä»¬å¤§å®¶è¿ç»œï¼Œå¸ƒæ»¡äº†ç½—ç½‘ï¼Œé€¼æˆ‘è‡ªæˆ•ã€‚è¯•çœ‹å‰å‡ å¤©è¡—ä¸Šç”·å¥³çš„æ ·å­ï¼Œå’Œè¿™å‡ å¤©æˆ‘å¤§å“¥çš„ä½œä¸ºï¼Œä¾¿è¶³å¯æ‚Ÿå‡ºå…«ä¹åˆ†äº†ã€‚æœ€å¥½æ˜¯è§£ä¸‹è…°å¸¦ï¼ŒæŒ‚åœ¨æ¢ä¸Šï¼Œè‡ªå·±ç´§ç´§å‹’æ­»ï¼›ä»–ä»¬æ²¡æœ‰æ€äººçš„ç½ªåï¼Œåˆå¿äº†å¿ƒæ„¿ï¼Œè‡ªç„¶éƒ½æ¬¢å¤©å–œåœ°çš„å‘å‡ºä¸€ç§å‘œå‘œå’½å’½çš„ç¬‘å£°ã€‚å¦åˆ™æƒŠå“å¿§æ„æ­»äº†ï¼Œè™½åˆ™ç•¥ç˜¦ï¼Œä¹Ÿè¿˜å¯ä»¥é¦–è‚¯å‡ ä¸‹ã€‚<br />\nä»–ä»¬æ˜¯åªä¼šåƒæ­»è‚‰çš„ï¼â€”â€” è®°å¾—ä»€ä¹ˆä¹¦ä¸Šè¯´ï¼Œæœ‰ä¸€ç§ä¸œè¥¿ï¼Œå« â€œæµ·ä¹™é‚£â€ çš„ï¼Œçœ¼å…‰å’Œæ ·å­éƒ½å¾ˆéš¾çœ‹ï¼›æ—¶å¸¸åƒæ­»è‚‰ï¼Œè¿æå¤§çš„éª¨å¤´ï¼Œéƒ½ç»†ç»†åš¼çƒ‚ï¼Œå’½ä¸‹è‚šå­å»ï¼Œæƒ³èµ·æ¥ä¹Ÿæ•™äººå®³æ€•ã€‚â€œæµ·ä¹™é‚£â€ æ˜¯ç‹¼çš„äº²çœ·ï¼Œç‹¼æ˜¯ç‹—çš„æœ¬å®¶ã€‚å‰å¤©èµµå®¶çš„ç‹—ï¼Œçœ‹æˆ‘å‡ çœ¼ï¼Œå¯è§ä»–ä¹ŸåŒè°‹ï¼Œæ—©å·²æ¥æ´½ã€‚è€å¤´å­çœ¼çœ‹ç€åœ°ï¼Œå²‚èƒ½ç’å¾—æˆ‘è¿‡ã€‚<br />\næœ€å¯æ€œçš„æ˜¯æˆ‘çš„å¤§å“¥ï¼Œä»–ä¹Ÿæ˜¯äººï¼Œä½•ä»¥æ¯«ä¸å®³æ€•ï¼›è€Œä¸”åˆä¼™åƒæˆ‘å‘¢ï¼Ÿè¿˜æ˜¯å†æ¥æƒ¯äº†ï¼Œä¸ä»¥ä¸ºéå‘¢ï¼Ÿè¿˜æ˜¯ä¸§äº†è‰¯å¿ƒï¼Œæ˜çŸ¥æ•…çŠ¯å‘¢ï¼Ÿ<br />\næˆ‘è¯…å’’åƒäººçš„äººï¼Œå…ˆä»ä»–èµ·å¤´ï¼›è¦åŠè½¬åƒäººçš„äººï¼Œä¹Ÿå…ˆä»ä»–ä¸‹æ‰‹ã€‚</p>\n<h2 id=\"ç¬¬å…«è¯\"><a class=\"anchor\" href=\"#ç¬¬å…«è¯\">#</a> ç¬¬å…«è¯</h2>\n<p>å…¶å®è¿™ç§é“ç†ï¼Œåˆ°äº†ç°åœ¨ï¼Œä»–ä»¬ä¹Ÿè¯¥æ—©å·²æ‡‚å¾—ï¼Œâ€¦â€¦<br />\n å¿½ç„¶æ¥äº†ä¸€ä¸ªäººï¼›å¹´çºªä¸è¿‡äºŒåå·¦å³ï¼Œç›¸è²Œæ˜¯ä¸å¾ˆçœ‹å¾—æ¸…æ¥šï¼Œæ»¡é¢ç¬‘å®¹ï¼Œå¯¹äº†æˆ‘ç‚¹å¤´ï¼Œä»–çš„ç¬‘ä¹Ÿä¸åƒçœŸç¬‘ã€‚æˆ‘ä¾¿é—®ä»–ï¼Œâ€œåƒäººçš„äº‹ï¼Œå¯¹ä¹ˆï¼Ÿâ€ ä»–ä»ç„¶ç¬‘ç€è¯´ï¼Œâ€œä¸æ˜¯è’å¹´ï¼Œæ€ä¹ˆä¼šåƒäººã€‚â€ æˆ‘ç«‹åˆ»å°±æ™“å¾—ï¼Œä»–ä¹Ÿæ˜¯ä¸€ä¼™ï¼Œå–œæ¬¢åƒäººçš„ï¼›ä¾¿è‡ªå‹‡æ°”ç™¾å€ï¼Œåè¦é—®ä»–ã€‚<br />\nâ€œå¯¹ä¹ˆï¼Ÿâ€<br />\nâ€œè¿™ç­‰äº‹é—®ä»–ä»€ä¹ˆã€‚ä½ çœŸä¼šâ€¦â€¦ è¯´ç¬‘è¯ã€‚â€¦â€¦ ä»Šå¤©å¤©æ°”å¾ˆå¥½ã€‚â€<br />\n å¤©æ°”æ˜¯å¥½ï¼Œæœˆè‰²ä¹Ÿå¾ˆäº®äº†ã€‚å¯æ˜¯æˆ‘è¦é—®ä½ ï¼Œâ€œå¯¹ä¹ˆï¼Ÿâ€<br />\n ä»–ä¸ä»¥ä¸ºç„¶äº†ã€‚å«å«èƒ¡èƒ¡çš„ç­”é“ï¼Œâ€œä¸â€¦â€¦â€<br />\nâ€œä¸å¯¹ï¼Ÿä»–ä»¬ä½•ä»¥ç«Ÿåƒï¼Ÿï¼â€<br />\nâ€œæ²¡æœ‰çš„äº‹â€¦â€¦â€<br />\nâ€œæ²¡æœ‰çš„äº‹ï¼Ÿç‹¼å­æ‘ç°åƒï¼›è¿˜æœ‰ä¹¦ä¸Šéƒ½å†™ç€ï¼Œé€šçº¢æ–©æ–°ï¼â€<br />\n ä»–ä¾¿å˜äº†è„¸ï¼Œé“ä¸€èˆ¬é’ã€‚çç€çœ¼è¯´ï¼Œâ€œæœ‰è®¸æœ‰çš„ï¼Œè¿™æ˜¯ä»æ¥å¦‚æ­¤â€¦â€¦â€<br />\nâ€œä»æ¥å¦‚æ­¤ï¼Œä¾¿å¯¹ä¹ˆï¼Ÿâ€<br />\nâ€œæˆ‘ä¸åŒä½ è®²è¿™äº›é“ç†ï¼›æ€»ä¹‹ä½ ä¸è¯¥è¯´ï¼Œä½ è¯´ä¾¿æ˜¯ä½ é”™ï¼â€<br />\n æˆ‘ç›´è·³èµ·æ¥ï¼Œå¼ å¼€çœ¼ï¼Œè¿™äººä¾¿ä¸è§äº†ã€‚å…¨èº«å‡ºäº†ä¸€å¤§ç‰‡æ±—ã€‚ä»–çš„å¹´çºªï¼Œæ¯”æˆ‘å¤§å“¥å°å¾—è¿œï¼Œå±…ç„¶ä¹Ÿæ˜¯ä¸€ä¼™ï¼›è¿™ä¸€å®šæ˜¯ä»–å¨˜è€å­å…ˆæ•™çš„ã€‚è¿˜æ€•å·²ç»æ•™ç»™ä»–å„¿å­äº†ï¼›æ‰€ä»¥è¿å°å­©å­ï¼Œä¹Ÿéƒ½æ¶ç‹ ç‹ çš„çœ‹æˆ‘ã€‚</p>\n<h2 id=\"ç¬¬ä¹è¯\"><a class=\"anchor\" href=\"#ç¬¬ä¹è¯\">#</a> ç¬¬ä¹è¯</h2>\n<p>è‡ªå·±æƒ³åƒäººï¼Œåˆæ€•è¢«åˆ«äººåƒäº†ï¼Œéƒ½ç”¨ç€ç–‘å¿ƒææ·±çš„çœ¼å…‰ï¼Œé¢é¢ç›¸è§‘ã€‚â€¦â€¦<br />\n å»äº†è¿™å¿ƒæ€ï¼Œæ”¾å¿ƒåšäº‹èµ°è·¯åƒé¥­ç¡è§‰ï¼Œä½•ç­‰èˆ’æœã€‚è¿™åªæ˜¯ä¸€æ¡é—¨æ§›ï¼Œä¸€ä¸ªå…³å¤´ã€‚ä»–ä»¬å¯æ˜¯çˆ¶å­å…„å¼Ÿå¤«å¦‡æœ‹å‹å¸ˆç”Ÿä»‡æ•Œå’Œå„ä¸ç›¸è¯†çš„äººï¼Œéƒ½ç»“æˆä¸€ä¼™ï¼Œäº’ç›¸åŠå‹‰ï¼Œäº’ç›¸ç‰µæ£ï¼Œæ­»ä¹Ÿä¸è‚¯è·¨è¿‡è¿™ä¸€æ­¥ã€‚</p>\n<h2 id=\"ç¬¬åè¯\"><a class=\"anchor\" href=\"#ç¬¬åè¯\">#</a> ç¬¬åè¯</h2>\n<p>å¤§æ¸…æ—©ï¼Œå»å¯»æˆ‘å¤§å“¥ï¼›ä»–ç«‹åœ¨å ‚é—¨å¤–çœ‹å¤©ï¼Œæˆ‘ä¾¿èµ°åˆ°ä»–èƒŒåï¼Œæ‹¦ä½é—¨ï¼Œæ ¼å¤–æ²‰é™ï¼Œæ ¼å¤–å’Œæ°”çš„å¯¹ä»–è¯´ï¼Œ<br />\nâ€œå¤§å“¥ï¼Œæˆ‘æœ‰è¯å‘Šè¯‰ä½ ã€‚â€<br />\nâ€œä½ è¯´å°±æ˜¯ï¼Œâ€ ä»–èµ¶ç´§å›è¿‡è„¸æ¥ï¼Œç‚¹ç‚¹å¤´ã€‚<br />\nâ€œæˆ‘åªæœ‰å‡ å¥è¯ï¼Œå¯æ˜¯è¯´ä¸å‡ºæ¥ã€‚å¤§å“¥ï¼Œå¤§çº¦å½“åˆé‡è›®çš„äººï¼Œéƒ½åƒè¿‡ä¸€ç‚¹äººã€‚åæ¥å› ä¸ºå¿ƒæ€ä¸åŒï¼Œæœ‰çš„ä¸åƒäººäº†ï¼Œä¸€å‘³è¦å¥½ï¼Œä¾¿å˜äº†äººï¼Œå˜äº†çœŸçš„äººã€‚æœ‰çš„å´è¿˜åƒï¼Œâ€”â€” ä¹ŸåŒè™«å­ä¸€æ ·ï¼Œæœ‰çš„å˜äº†é±¼é¸ŸçŒ´å­ï¼Œä¸€ç›´å˜åˆ°äººã€‚æœ‰çš„ä¸è¦å¥½ï¼Œè‡³ä»Šè¿˜æ˜¯è™«å­ã€‚è¿™åƒäººçš„äººæ¯”ä¸åƒäººçš„äººï¼Œä½•ç­‰æƒ­æ„§ã€‚æ€•æ¯”è™«å­çš„æƒ­æ„§çŒ´å­ï¼Œè¿˜å·®å¾—å¾ˆè¿œå¾ˆè¿œã€‚<br />\nâ€œæ˜“ç‰™è’¸äº†ä»–å„¿å­ï¼Œç»™æ¡€çº£åƒï¼Œè¿˜æ˜¯ä¸€ç›´ä»å‰çš„äº‹ã€‚è°æ™“å¾—ä»ç›˜å¤å¼€è¾Ÿå¤©åœ°ä»¥åï¼Œä¸€ç›´åƒåˆ°æ˜“ç‰™çš„å„¿å­ï¼›ä»æ˜“ç‰™çš„å„¿å­ï¼Œä¸€ç›´åƒåˆ°å¾é”¡æ—ï¼›ä»å¾é”¡æ—ï¼Œåˆä¸€ç›´åƒåˆ°ç‹¼å­æ‘æ‰ä½çš„äººã€‚å»å¹´åŸé‡Œæ€äº†çŠ¯äººï¼Œè¿˜æœ‰ä¸€ä¸ªç”Ÿç—¨ç—…çš„äººï¼Œç”¨é¦’å¤´è˜¸è¡€èˆã€‚<br />\nâ€œä»–ä»¬è¦åƒæˆ‘ï¼Œä½ ä¸€ä¸ªäººï¼ŒåŸä¹Ÿæ— æ³•å¯æƒ³ï¼›ç„¶è€Œåˆä½•å¿…å»å…¥ä¼™ã€‚åƒäººçš„äººï¼Œä»€ä¹ˆäº‹åšä¸å‡ºï¼›ä»–ä»¬ä¼šåƒæˆ‘ï¼Œä¹Ÿä¼šåƒä½ ï¼Œä¸€ä¼™é‡Œé¢ï¼Œä¹Ÿä¼šè‡ªåƒã€‚ä½†åªè¦è½¬ä¸€æ­¥ï¼Œåªè¦ç«‹åˆ»æ”¹äº†ï¼Œä¹Ÿå°±æ˜¯äººäººå¤ªå¹³ã€‚è™½ç„¶ä»æ¥å¦‚æ­¤ï¼Œæˆ‘ä»¬ä»Šå¤©ä¹Ÿå¯ä»¥æ ¼å¤–è¦å¥½ï¼Œè¯´æ˜¯ä¸èƒ½ï¼å¤§å“¥ï¼Œæˆ‘ç›¸ä¿¡ä½ èƒ½è¯´ï¼Œå‰å¤©ä½ƒæˆ·è¦å‡ç§Ÿï¼Œä½ è¯´è¿‡ä¸èƒ½ã€‚â€<br />\n å½“åˆï¼Œä»–è¿˜åªæ˜¯å†·ç¬‘ï¼Œéšåçœ¼å…‰ä¾¿å‡¶ç‹ èµ·æ¥ï¼Œä¸€åˆ°è¯´ç ´ä»–ä»¬çš„éšæƒ…ï¼Œé‚£å°±æ»¡è„¸éƒ½å˜æˆé’è‰²äº†ã€‚å¤§é—¨å¤–ç«‹ç€ä¸€ä¼™äººï¼Œèµµè´µç¿å’Œä»–çš„ç‹—ï¼Œä¹Ÿåœ¨é‡Œé¢ï¼Œéƒ½æ¢å¤´æ¢è„‘çš„æŒ¨è¿›æ¥ã€‚æœ‰çš„æ˜¯çœ‹ä¸å‡ºé¢è²Œï¼Œä¼¼ä¹ç”¨å¸ƒè’™ç€ï¼›æœ‰çš„æ˜¯ä»æ—§é’é¢ç ç‰™ï¼ŒæŠ¿ç€å˜´ç¬‘ã€‚æˆ‘è®¤è¯†ä»–ä»¬æ˜¯ä¸€ä¼™ï¼Œéƒ½æ˜¯åƒäººçš„äººã€‚å¯æ˜¯ä¹Ÿæ™“å¾—ä»–ä»¬å¿ƒæ€å¾ˆä¸ä¸€æ ·ï¼Œä¸€ç§æ˜¯ä»¥ä¸ºä»æ¥å¦‚æ­¤ï¼Œåº”è¯¥åƒçš„ï¼›ä¸€ç§æ˜¯çŸ¥é“ä¸è¯¥åƒï¼Œå¯æ˜¯ä»ç„¶è¦åƒï¼Œåˆæ€•åˆ«äººè¯´ç ´ä»–ï¼Œæ‰€ä»¥å¬äº†æˆ‘çš„è¯ï¼Œè¶Šå‘æ°”æ„¤ä¸è¿‡ï¼Œå¯æ˜¯æŠ¿ç€å˜´å†·ç¬‘ã€‚<br />\nè¿™æ—¶å€™ï¼Œå¤§å“¥ä¹Ÿå¿½ç„¶æ˜¾å‡ºå‡¶ç›¸ï¼Œé«˜å£°å–é“ï¼Œâ€œéƒ½å‡ºå»ï¼ç–¯å­æœ‰ä»€ä¹ˆå¥½çœ‹ï¼â€<br />\n è¿™æ—¶å€™ï¼Œæˆ‘åˆæ‡‚å¾—ä¸€ä»¶ä»–ä»¬çš„å·§å¦™äº†ã€‚ä»–ä»¬å²‚ä½†ä¸è‚¯æ”¹ï¼Œè€Œä¸”æ—©å·²å¸ƒç½®ï¼›é¢„å¤‡ä¸‹ä¸€ä¸ªç–¯å­çš„åç›®ç½©ä¸Šæˆ‘ã€‚å°†æ¥åƒäº†ï¼Œä¸ä½†å¤ªå¹³æ— äº‹ï¼Œæ€•è¿˜ä¼šæœ‰äººè§æƒ…ã€‚ä½ƒæˆ·è¯´çš„å¤§å®¶åƒäº†ä¸€ä¸ªæ¶äººï¼Œæ­£æ˜¯è¿™æ–¹æ³•ã€‚è¿™æ˜¯ä»–ä»¬çš„è€è°±ï¼<br />\né™ˆè€äº”ä¹Ÿæ°”æ„¤æ„¤çš„ç›´èµ°è¿›æ¥ã€‚å¦‚ä½•æŒ‰å¾—ä½æˆ‘çš„å£ï¼Œæˆ‘åè¦å¯¹è¿™ä¼™äººè¯´ï¼Œâ€œä½ ä»¬å¯ä»¥æ”¹äº†ï¼Œä»çœŸå¿ƒæ”¹èµ·ï¼è¦æ™“å¾—å°†æ¥å®¹ä¸å¾—åƒäººçš„äººï¼Œæ´»åœ¨ä¸–ä¸Šã€‚<br />\nâ€œä½ ä»¬è¦ä¸æ”¹ï¼Œè‡ªå·±ä¹Ÿä¼šåƒå°½ã€‚å³ä½¿ç”Ÿå¾—å¤šï¼Œä¹Ÿä¼šç»™çœŸçš„äººé™¤ç­äº†ï¼ŒåŒçŒäººæ‰“å®Œç‹¼å­ä¸€æ ·ï¼â€”â€” åŒè™«å­ä¸€æ ·ï¼â€<br />\n é‚£ä¸€ä¼™äººï¼Œéƒ½è¢«é™ˆè€äº”èµ¶èµ°äº†ã€‚å¤§å“¥ä¹Ÿä¸çŸ¥é‚£é‡Œå»äº†ã€‚é™ˆè€äº”åŠæˆ‘å›å±‹å­é‡Œå»ã€‚å±‹é‡Œé¢å…¨æ˜¯é»‘æ²‰æ²‰çš„ã€‚æ¨ªæ¢å’Œæ¤½å­éƒ½åœ¨å¤´ä¸Šå‘æŠ–ï¼›æŠ–äº†ä¸€ä¼šï¼Œå°±å¤§èµ·æ¥ï¼Œå †åœ¨æˆ‘èº«ä¸Šã€‚<br />\nä¸‡åˆ†æ²‰é‡ï¼ŒåŠ¨å¼¹ä¸å¾—ï¼›ä»–çš„æ„æ€æ˜¯è¦æˆ‘æ­»ã€‚æˆ‘æ™“å¾—ä»–çš„æ²‰é‡æ˜¯å‡çš„ï¼Œä¾¿æŒ£æ‰å‡ºæ¥ï¼Œå‡ºäº†ä¸€èº«æ±—ã€‚å¯æ˜¯åè¦è¯´ï¼Œâ€œä½ ä»¬ç«‹åˆ»æ”¹äº†ï¼Œä»çœŸå¿ƒæ”¹èµ·ï¼ä½ ä»¬è¦æ™“å¾—å°†æ¥æ˜¯å®¹ä¸å¾—åƒäººçš„äººï¼Œâ€¦â€¦â€</p>\n<h2 id=\"ç¬¬åä¸€è¯\"><a class=\"anchor\" href=\"#ç¬¬åä¸€è¯\">#</a> ç¬¬åä¸€è¯</h2>\n<p>å¤ªé˜³ä¹Ÿä¸å‡ºï¼Œé—¨ä¹Ÿä¸å¼€ï¼Œæ—¥æ—¥æ˜¯ä¸¤é¡¿é¥­ã€‚<br />\næˆ‘æèµ·ç­·å­ï¼Œä¾¿æƒ³èµ·æˆ‘å¤§å“¥ï¼›æ™“å¾—å¦¹å­æ­»æ‰çš„ç¼˜æ•…ï¼Œä¹Ÿå…¨åœ¨ä»–ã€‚é‚£æ—¶æˆ‘å¦¹å­æ‰äº”å²ï¼Œå¯çˆ±å¯æ€œçš„æ ·å­ï¼Œè¿˜åœ¨çœ¼å‰ã€‚æ¯äº²å“­ä¸ªä¸ä½ï¼Œä»–å´åŠæ¯äº²ä¸è¦å“­ï¼›å¤§çº¦å› ä¸ºè‡ªå·±åƒäº†ï¼Œå“­èµ·æ¥ä¸å…æœ‰ç‚¹è¿‡æ„ä¸å»ã€‚å¦‚æœè¿˜èƒ½è¿‡æ„ä¸å»ï¼Œâ€¦â€¦ å¦¹å­æ˜¯è¢«å¤§å“¥åƒäº†ï¼Œæ¯äº²çŸ¥é“æ²¡æœ‰ï¼Œæˆ‘å¯ä¸å¾—è€ŒçŸ¥ã€‚<br />\næ¯äº²æƒ³ä¹ŸçŸ¥é“ï¼›ä¸è¿‡å“­çš„æ—¶å€™ï¼Œå´å¹¶æ²¡æœ‰è¯´æ˜ï¼Œå¤§çº¦ä¹Ÿä»¥ä¸ºåº”å½“çš„äº†ã€‚è®°å¾—æˆ‘å››äº”å²æ—¶ï¼Œååœ¨å ‚å‰ä¹˜å‡‰ï¼Œå¤§å“¥è¯´çˆ·å¨˜ç”Ÿç—…ï¼Œåšå„¿å­çš„é¡»å‰²ä¸‹ä¸€ç‰‡è‚‰æ¥ï¼Œç…®ç†Ÿäº†è¯·ä»–åƒï¼Œæ‰ç®—å¥½äººï¼›æ¯äº²ä¹Ÿæ²¡æœ‰è¯´ä¸è¡Œã€‚ä¸€ç‰‡åƒå¾—ï¼Œæ•´ä¸ªçš„è‡ªç„¶ä¹Ÿåƒå¾—ã€‚ä½†æ˜¯é‚£å¤©çš„å“­æ³•ï¼Œç°åœ¨æƒ³èµ·æ¥ï¼Œå®åœ¨è¿˜æ•™äººä¼¤å¿ƒï¼Œè¿™çœŸæ˜¯å¥‡æçš„äº‹ï¼</p>\n<h2 id=\"ç¬¬åäºŒè¯\"><a class=\"anchor\" href=\"#ç¬¬åäºŒè¯\">#</a> ç¬¬åäºŒè¯</h2>\n<p>ä¸èƒ½æƒ³äº†ã€‚<br />\nå››åƒå¹´æ¥æ—¶æ—¶åƒäººçš„åœ°æ–¹ï¼Œä»Šå¤©æ‰æ˜ç™½ï¼Œæˆ‘ä¹Ÿåœ¨å…¶ä¸­æ··äº†å¤šå¹´ï¼›å¤§å“¥æ­£ç®¡ç€å®¶åŠ¡ï¼Œå¦¹å­æ°æ°æ­»äº†ï¼Œä»–æœªå¿…ä¸å’Œåœ¨é¥­èœé‡Œï¼Œæš—æš—ç»™æˆ‘ä»¬åƒã€‚<br />\næˆ‘æœªå¿…æ— æ„ä¹‹ä¸­ï¼Œä¸åƒäº†æˆ‘å¦¹å­çš„å‡ ç‰‡è‚‰ï¼Œç°åœ¨ä¹Ÿè½®åˆ°æˆ‘è‡ªå·±ï¼Œâ€¦â€¦ æœ‰äº†å››åƒå¹´åƒäººå±¥å†çš„æˆ‘ï¼Œå½“åˆè™½ç„¶ä¸çŸ¥é“ï¼Œç°åœ¨æ˜ç™½ï¼Œéš¾è§çœŸçš„äººï¼</p>\n<h2 id=\"ç¬¬åä¸‰è¯\"><a class=\"anchor\" href=\"#ç¬¬åä¸‰è¯\">#</a> ç¬¬åä¸‰è¯</h2>\n<p>æ²¡æœ‰åƒè¿‡äººçš„å­©å­ï¼Œæˆ–è€…è¿˜æœ‰ï¼Ÿ<br />\næ•‘æ•‘å­©å­â€¦â€¦</p>\n<p>ä¸€ä¹ä¸€å…«å¹´å››æœˆã€‚</p>\n",
            "tags": [
                "å¥½æ–‡æ‘˜æŠ„",
                "å°è¯´",
                "é²è¿…"
            ]
        },
        {
            "id": "https://haust-kevin.github.io/2023/08/19/2023-08-docker-container-2-image/",
            "url": "https://haust-kevin.github.io/2023/08/19/2023-08-docker-container-2-image/",
            "title": "Dockerï¼šå®¹å™¨å¤‡ä»½",
            "date_published": "2023-08-19T06:33:40.000Z",
            "content_html": "<div class=\"note primary\">\n<p>å°† docker å®¹å™¨æ‰“åŒ…æˆé•œåƒå¹¶åœ¨å¦ä¸€å°æœåŠ¡å™¨ä¸Šè¿è¡Œ</p>\n</div>\n<p>1ï¸âƒ£ å°†å®¹å™¨æ‰“åŒ…æˆé•œåƒ</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> commit <span class=\"token operator\">&lt;</span>container-name<span class=\"token operator\">></span> <span class=\"token operator\">&lt;</span>image-name<span class=\"token operator\">></span><span class=\"token punctuation\">[</span>:tag<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># example: docker commit myblog hexo-blog</span></pre></td></tr></table></figure><p>ä¼šåœ¨æœ¬åœ°ç”Ÿæˆä¸€ä¸ªæ–°çš„ docker é•œåƒï¼Œå¯ä»¥é€šè¿‡ <code>docker images</code>  å‘½ä»¤æŸ¥çœ‹ç”Ÿæˆçš„é•œåƒã€‚</p>\n<div class=\"note warning\">\n<p>æ‰“åŒ…æ—¶ï¼Œå®¹å™¨æŒ‚çš„ç›®å½• / æ–‡ä»¶ä¸ä¼šè¢«æ‰“åŒ…è¿›é•œåƒã€‚è§£å†³æ–¹æ¡ˆï¼šâ‘  åœ¨æ‰“åŒ…å‰ä¸ºæŒ‚è½½çš„ç›®å½•ç”Ÿæˆä¸€ä»½ copyï¼Œåœ¨å¦ä¸€å°æœºå™¨è¿è¡Œæ—¶ä½ éœ€è¦æŒ‚è½½è¿™ä»½ copyã€‚â‘¡ å°†æŒ‚è½½çš„ç›®å½• copy è‡³æ–°æœºå™¨ã€‚å¦‚æœæ‰“åŒ…åçš„é•œåƒåªéœ€åœ¨å½“å‰æœåŠ¡å™¨è¿è¡Œï¼Œåˆ™ä¸éœ€è¦è€ƒè™‘è¿™ä¸ªé—®é¢˜ã€‚</p>\n</div>\n<p>2ï¸âƒ£ å°†é•œåƒæ‰“åŒ…æˆæ–‡ä»¶</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> save <span class=\"token parameter variable\">-o</span> <span class=\"token operator\">&lt;</span>outfile<span class=\"token operator\">></span> <span class=\"token operator\">&lt;</span>image-name<span class=\"token operator\">></span><span class=\"token punctuation\">[</span>:tag<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># example: docker save -o blog.jar hexo-blog</span></pre></td></tr></table></figure><p>ä¼šåœ¨å½“å‰ç›®å½•ç”Ÿæˆ <code>blog.jar</code>  æ–‡ä»¶ã€‚</p>\n<p>3ï¸âƒ£ å°†æ‰“åŒ…ç”Ÿæˆçš„æ–‡ä»¶ä¸Šä¼ è‡³å¦ä¸€å°æœåŠ¡å™¨<br />\nä½¿ç”¨ scp å‘½ä»¤æˆ–è€… ssh å·¥å…·å°† <code>blog.jar</code>  å¤åˆ¶åˆ°å¦ä¸€å°æœåŠ¡å™¨ã€‚</p>\n<p>4ï¸âƒ£ æ–°æœºå™¨è½½å…¥é•œåƒ</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> load <span class=\"token parameter variable\">--input</span> <span class=\"token operator\">&lt;</span>file<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># example: docker load --input blog.jar</span></pre></td></tr></table></figure><p>ä¼šåœ¨æ–°æœºå™¨ç”Ÿæˆä¸€ä¸ªæ–°çš„ docker é•œåƒï¼Œå¯ä»¥é€šè¿‡ <code>docker images</code>  å‘½ä»¤æŸ¥çœ‹ç”Ÿæˆçš„é•œåƒã€‚</p>\n<p>5ï¸âƒ£ è¿è¡Œå®¹å™¨<br />\nå¯¼å…¥é•œåƒåå°±å¯ä»¥è¿›è¡Œæ­£å¸¸ <code>docker run</code>  å‘½ä»¤äº†ã€‚</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> run <span class=\"token parameter variable\">-itd</span> <span class=\"token parameter variable\">--name</span> <span class=\"token operator\">&lt;</span>container-name<span class=\"token operator\">></span> <span class=\"token operator\">&lt;</span>image-name<span class=\"token operator\">></span><span class=\"token punctuation\">[</span>:tag<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># example: docker run -itd --name myblog hexo-blog</span></pre></td></tr></table></figure><div class=\"note success\">\n<p>å¤‡ä»½å¹¶å¯¼å…¥å®Œæˆ</p>\n</div>\n",
            "tags": [
                "Linux",
                "Docker",
                "Linux"
            ]
        }
    ]
}